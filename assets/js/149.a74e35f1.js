(window.webpackJsonp=window.webpackJsonp||[]).push([[149],{475:function(t,s,a){"use strict";a.r(s);var n=a(7),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"kubernetes安全"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes安全"}},[t._v("#")]),t._v(" KUbernetes安全")]),t._v(" "),s("h2",{attrs:{id:"kubernetes安全框架"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes安全框架"}},[t._v("#")]),t._v(" Kubernetes安全框架")]),t._v(" "),s("p",[t._v("K8S安全控制框架主要由下面3个阶段进行控制，每一个阶段都支持插件方式，通过API Server配置来启用插件。")]),t._v(" "),s("ol",[s("li",[s("strong",[s("code",[t._v("Authentication（鉴权）")])])]),t._v(" "),s("li",[s("strong",[s("code",[t._v("Authorization（授权）")])])]),t._v(" "),s("li",[s("strong",[s("code",[t._v("Admission Control（准入控制）")])])])]),t._v(" "),s("p",[t._v("客户端想要访问k8s集群API Server，一般需要证书，Token或者用户名+密码；如果Pod访问，需要ServiceAccount")]),t._v(" "),s("h2",{attrs:{id:"认证、授权、准入控制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#认证、授权、准入控制"}},[t._v("#")]),t._v(" 认证、授权、准入控制")]),t._v(" "),s("blockquote",[s("p",[s("strong",[t._v("鉴权Authentication")])])]),t._v(" "),s("ul",[s("li",[t._v("K8s Apiserver提供三种客户端认证：\n"),s("ul",[s("li",[s("code",[t._v("HTTPS证书认证")]),t._v("： 基于CA证书签名的数字证书认证")]),t._v(" "),s("li",[s("code",[t._v("HTTP Token认证")]),t._v("：通过一个Token来识别用户")]),t._v(" "),s("li",[s("code",[t._v("HTTP Base认证")]),t._v("： 用户名+密码的方式认证 "),s("code",[t._v("（基本不采用）")])])])])]),t._v(" "),s("blockquote",[s("p",[s("strong",[t._v("授权Authorization")])])]),t._v(" "),s("p",[s("code",[t._v("RBAC （Role-Based Access Control,基于角色的访问控制）：负责完成授权（Authorization工作）。")])]),t._v(" "),s("p",[t._v("RBAC根据API请求属性，决定允许还是拒绝。")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("比较常见的授权维度：")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("user")]),t._v("： 用户名")]),t._v(" "),s("li",[s("code",[t._v("group")]),t._v("： 用户分组")]),t._v(" "),s("li",[t._v("资源,例如Pod ConfigMaps Deployments Nodes Secrets Namespaces")]),t._v(" "),s("li",[s("code",[t._v("资源操作方法")]),t._v("： get,list,create,update,patch,watch,delete")]),t._v(" "),s("li",[t._v("命名空间")]),t._v(" "),s("li",[t._v("API组")])])])]),t._v(" "),s("blockquote",[s("p",[s("strong",[t._v("准入控制Admission Control")])])]),t._v(" "),s("p",[t._v("Admission Control实际上是一个准入控制器插件列表，发到API Server的请求都需要经过这个列表中的每个准入控制器插件来检查，检查不通过，则拒绝请求。")]),t._v(" "),s("h2",{attrs:{id:"基于角色的权限访问控制-rbac"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基于角色的权限访问控制-rbac"}},[t._v("#")]),t._v(" 基于角色的权限访问控制：RBAC")]),t._v(" "),s("p",[t._v("RBAC 使⽤ rbac.authorization.k8s.io API Group 来实现授权决策，允许管理员通过 Kubernetes API 动态配置策略，要启⽤ RBAC ，需要在 apiserver 中添加参数 --authorization-mode=RBAC ，如果 使⽤的 kubeadm 安装的集群，1.6 版本以上的都默认开启了 RBAC ，可以通过查看 Master 节点上 apiserver 的静态 Pod 定义⽂件：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" /etc/kubernetes/manifests/kube-apiserver.yaml\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n- --authorization-mode"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("Node,RBAC\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])])]),s("p",[s("strong",[t._v("RBAC（Role-Based Access Control，基于角色的访问控制），允许Kubernetes API动态配置策略。")])]),t._v(" "),s("ul",[s("li",[s("h3",{attrs:{id:"角色"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#角色"}},[t._v("#")]),t._v(" 角色")]),t._v(" "),s("ul",[s("li",[s("strong",[s("code",[t._v("Role")])]),t._v("： 授权特定命名空间的访问权限")]),t._v(" "),s("li",[s("strong",[s("code",[t._v("ClusterRole")])]),t._v("： 授权所有命名空间的访问权限")])])]),t._v(" "),s("li",[s("h3",{attrs:{id:"角色绑定"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#角色绑定"}},[t._v("#")]),t._v(" 角色绑定")]),t._v(" "),s("ul",[s("li",[s("strong",[s("code",[t._v("RoleBinding")])]),t._v("： 将角色绑定到主体（即subject）")]),t._v(" "),s("li",[s("strong",[s("code",[t._v("ClusterRoleBinding")])]),t._v("： 将集群角色绑定到主体")])])]),t._v(" "),s("li",[s("h3",{attrs:{id:"主体-subject"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#主体-subject"}},[t._v("#")]),t._v(" 主体（subject）")]),t._v(" "),s("ul",[s("li",[s("strong",[s("code",[t._v("User")])]),t._v("： 用户")]),t._v(" "),s("li",[s("strong",[s("code",[t._v("Group")])]),t._v("： 用户组")]),t._v(" "),s("li",[s("strong",[s("code",[t._v("cluster-admin")])]),t._v("：K8s中默认管理员角色")]),t._v(" "),s("li",[s("strong",[s("code",[t._v("ServiceAccount")])]),t._v("： 服务账号")])])]),t._v(" "),s("li",[s("h3",{attrs:{id:"rolebinding和clusterrolebinding"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#rolebinding和clusterrolebinding"}},[t._v("#")]),t._v(" RoleBinding和ClusterRoleBinding")]),t._v(" "),s("ul",[s("li",[t._v("RoleBinding 和 ClusterRoleBinding：⻆⾊绑定和集群⻆⾊绑定，简单来说就是把声明的 Subject 和我们的 Role 进⾏绑定的过程(给某个⽤户绑定上操作的权限)，⼆者的区别也是作⽤范围的区 别：RoleBinding 只会影响到当前 namespace 下⾯的资源操作权限，⽽ ClusterRoleBinding 会影 响到所有的 namespace。")])])])]),t._v(" "),s("blockquote",[s("h3",{attrs:{id:"role和rolebinding使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#role和rolebinding使用"}},[t._v("#")]),t._v(" Role和RoleBinding使用")])]),t._v(" "),s("ul",[s("li",[t._v("创建⼀个只能访问某个 namespace 的⽤户")]),t._v(" "),s("li",[t._v("我们来创建⼀个 User Account，只能访问 kube-system 这个命名空间：\n"),s("ul",[s("li",[t._v("username: haima")]),t._v(" "),s("li",[t._v("group: haimamax")])])])]),t._v(" "),s("h3",{attrs:{id:"第1步-创建用户凭证"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第1步-创建用户凭证"}},[t._v("#")]),t._v(" 第1步：创建⽤户凭证")]),t._v(" "),s("ul",[s("li",[t._v("这⾥我们来使⽤ OpenSSL 证书来创建⼀个 User，给⽤户 haima 创建⼀个私钥，命名成：haima.key：")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# openssl genrsa -out haima.key 2048")]),t._v("\nGenerating RSA private key, "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2048")]),t._v(" bit long modulus\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("+++\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("+++\ne is "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("65537")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0x10001"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("ul",[s("li",[t._v("使⽤我们刚刚创建的私钥创建⼀个证书签名请求⽂件：haima.csr，要注意需要确保在 -subj 参 数中指定⽤户名和组(CN表示⽤户名，O表示组)：")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# openssl req -new -key haima.key -out haima.csr -subj "/CN=haima/O=haimamax"')]),t._v("\n")])])]),s("ul",[s("li",[t._v("然后找到我们的 Kubernetes 集群的 CA ，我们使⽤的是 kubeadm 安装的集群， CA 相关证书位 于 /etc/kubernetes/pki/ ⽬录下⾯，利⽤该⽬录下⾯的 ca.crt 和 ca.key 两个⽂件来批准上⾯ 的证书请求。")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# openssl x509 -req -in haima.csr -CA /etc/kubernetes/pki/ca.crt -CAkey /etc/kubernetes/pki/ca.key -CAcreateserial -out haima.crt -days 500")]),t._v("\nSignature ok\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("subject")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/CN"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("haima/O"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("haimamax\nGetting CA Private Key\n")])])]),s("ul",[s("li",[t._v("现在查看我们当前⽂件夹下⾯是否⽣成了⼀个证书⽂件：")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ll")]),t._v("\n-rw-r--r-- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("997")]),t._v(" Nov  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v(":27 haima.crt\n-rw-r--r-- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("911")]),t._v(" Nov  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v(":25 haima.csr\n-rw-r--r-- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root       "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1675")]),t._v(" Nov  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v(":23 haima.key\n")])])]),s("ul",[s("li",[t._v("现在我们可以使⽤刚刚创建的证书⽂件和私钥⽂件在集群中创建新的凭证和上下⽂(Context):")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl config set-credentials haima --client-certificate=haima.crt --client-key=haima.key ")]),t._v("\nUser "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"haima"')]),t._v(" set.\n")])])]),s("ul",[s("li",[t._v("我们可以看到⼀个⽤户 haima 创建了，然后为这个⽤户设置新的 Context:")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl config set-context haima-context --cluster=kubernetes --namespace=kube-system --user=haima")]),t._v("\nContext "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"haima-context"')]),t._v(" created.\n")])])]),s("ul",[s("li",[t._v("到这⾥，我们的⽤户 haima 就已经创建成功了，现在我们使⽤当前的这个配置⽂件来操 作 kubectl 命令的时候，应该会出现错误，因为我们还没有为该⽤户定义任何操作的权限呢：")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get pods --context=haima-context ")]),t._v("\nError from server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Forbidden"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(": pods is forbidden: User "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"haima"')]),t._v(" cannot list resource "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pods"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" API group "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" the namespace "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kube-system"')]),t._v("\n")])])]),s("h3",{attrs:{id:"第2步-创建⻆色"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第2步-创建⻆色"}},[t._v("#")]),t._v(" "),s("strong",[t._v("第2步：创建⻆⾊")])]),t._v(" "),s("ul",[s("li",[t._v("⽤户创建完成后，接下来就需要给该⽤户添加操作权限，我们来定义⼀个 YAML ⽂件，创建⼀个允许 ⽤户操作 Deployment、Pod、ReplicaSets 的⻆⾊，如下定义：")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master work"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl create role haima --namespace=kube-system --resource=pods,deployments,replicasets --verb=* --dry-run -o yaml > haima-role.yaml ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master work"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat haima-role.yaml ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io/v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Role\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("creationTimestamp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token null important"}},[t._v("null")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" haima\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("system\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rules")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroups")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" pods\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("verbs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroups")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" apps\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" deployments\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" replicasets\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("verbs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*'")]),t._v("\n  \n注：\n其中 Pod 属于 core 这个 API Group，在 YAML 中⽤空字符就可以，⽽ Deployment 属于 apps 这个API Group， ReplicaSets 属于 extensions 这个 API Group所以rules 下⾯的 apiGroups 就综合了这⼏个资源的 API Group："),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"extensions"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"apps"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("，其中 verbs 就是我们上⾯提到的可以对这些资源对象执⾏的操作，我们这⾥需要所有的操作⽅法，所以我们也可以使⽤"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("来代替。\n")])])]),s("ul",[s("li",[t._v("然后创建这个 Role ：")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master work"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f haima-role.yaml  ")]),t._v("\nrole.rbac.authorization.k8s.io/haima created\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master work"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get role -n kube-system | grep haima ")]),t._v("\nhaima                                            "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v("-11-07T22:05:29Z\n\n注：注意这⾥我们没有使⽤上⾯的 haimaxy-context 这个上下⽂了，因为⽊有权限\n")])])]),s("h3",{attrs:{id:"第3步-创建⻆色权限绑定"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第3步-创建⻆色权限绑定"}},[t._v("#")]),t._v(" "),s("strong",[t._v("第3步：创建⻆⾊权限绑定")])]),t._v(" "),s("ul",[s("li",[t._v("Role 创建完成了，但是很明显现在我们这个 Role 和我们的⽤户 haima 还没有任何关系，对吧？这 ⾥我就需要创建⼀个 RoleBinding 对象，在 kube-system 这个命名空间下⾯将上⾯的 haimaxy-role ⻆ ⾊和⽤户 haima 进⾏绑定")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master work"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl create rolebinding haima-rolebinding --namespace=kube-system --role haima-role --user=haima --dry-run -o yaml > haima-rolebinding.yaml ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master work"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat  haima-rolebinding.yaml    ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io/v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" RoleBinding\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("creationTimestamp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token null important"}},[t._v("null")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" haima"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("rolebinding\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("system\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("roleRef")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroup")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Role\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" haima"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("role\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subjects")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroup")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" User\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" haima\n")])])]),s("ul",[s("li",[t._v("上⾯的 YAML ⽂件中我们看到了 subjects 关键字，这⾥就是我们上⾯提到的⽤来尝试操作集群的对 象，这⾥对应上⾯的 User 帐号 haimaxy，使⽤ kubectl 创建上⾯的资源对象：")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master work"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f haima-rolebinding.yaml  ")]),t._v("\nrolebinding.rbac.authorization.k8s.io/haima-rolebinding created\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master work"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get rolebindings -n kube-system  | grep haima ")]),t._v("\nhaima-rolebinding                                   Role/haima-role                                       21s\n")])])]),s("h3",{attrs:{id:"第4步-测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第4步-测试"}},[t._v("#")]),t._v(" "),s("strong",[t._v("第4步：测试")])]),t._v(" "),s("ul",[s("li",[t._v("现在我们应该可以上⾯的 haimaxy-context 上下⽂来操作集群了：")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master work"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get pods --context=haima-context ")]),t._v("\nError from server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Forbidden"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(": pods is forbidden: User "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"haima"')]),t._v(" cannot list resource "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pods"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" API group "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" the namespace "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kube-system"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" RBAC: role.rbac.authorization.k8s.io "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"haima-role"')]),t._v(" not found\n")])])]),s("ul",[s("li",[t._v("我们可以看到我们使⽤ kubectl 的使⽤并没有指定 namespace 了，这是因为我们已经为该⽤户分配 了权限了，如果我们在后⾯加上⼀个 -n default")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master work"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get pods --context=haima-context -n default                                        ")]),t._v("\nError from server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Forbidden"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(": pods is forbidden: User "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"haima"')]),t._v(" cannot list resource "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pods"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" API group "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" the namespace "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default"')]),t._v("\n\n注：\n是符合我们预期的吧？因为该⽤户并没有 default 这个命名空间的操作权限\n")])])]),s("ul",[s("li",[s("code",[t._v("创建⼀个只能访问某个 namespace 的ServiceAccount")])]),t._v(" "),s("li",[t._v("上⾯我们创建了⼀个只能访问某个命名空间下⾯的普通⽤户，我们前⾯也提到过 subjects 下⾯还有⼀ 直类型的主题资源：ServiceAccount，现在我们来创建⼀个集群内部的⽤户只能操作 kube-system 这 个命名空间下⾯的 pods 和 deployments，⾸先来创建⼀个 ServiceAccount 对象：")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master work"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl create sa haima-sa -n kube-system  ")]),t._v("\nserviceaccount/haima-sa created\n")])])]),s("ul",[s("li",[t._v("然后新建⼀个 Role 对象：")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master work"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl create role haima-sa-role --namespace=kube-system --resource=pod,deployments --verb=get,watch,list,create,update,patch,delete  --dry-run -o yaml > haima-sa-role.yaml")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master work"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vi haima-sa-role.yaml ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io/v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Role\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("creationTimestamp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token null important"}},[t._v("null")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" haima"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("sa"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("role\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("system\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rules")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroups")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" pods\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("verbs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" get\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" watch\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" list\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroups")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" apps\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" deployments\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("verbs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" get\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" watch\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" list\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" create\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" update\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" patch\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" delete\n")])])]),s("ul",[s("li",[t._v("可以看到我们这⾥定义的⻆⾊没有创建、删除、更新 Pod 的权限，待会我们可以重点测试⼀下，创建 该 Role 对象：")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master work"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f haima-sa-role.yaml ")]),t._v("\nrole.rbac.authorization.k8s.io/haima-sa-role created\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master work"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get role -n kube-system | grep sa")]),t._v("\nhaimaxy-sa-role                                  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v("-11-07T20:56:00Z\n")])])]),s("ul",[s("li",[t._v("然后创建⼀个 RoleBinding 对象，将上⾯的 haimaxy-sa 和⻆⾊ haimaxy-sa-role 进⾏绑定：")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master work"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl create rolebinding haima-sa-rolebinding --namespace=kube-system --role=haima-sa-role --serviceaccount kube-system:haima-sa --dry-run -o yaml > haima-sa-rolebinding.yaml ")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master work"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat  haima-sa-rolebinding.yaml  ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io/v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" RoleBinding\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("creationTimestamp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token null important"}},[t._v("null")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" haima"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("sa"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("rolebinding\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("system\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("roleRef")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroup")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Role\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" haima"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("sa"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("role\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subjects")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ServiceAccount\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" haima"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("sa\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("system\n")])])]),s("ul",[s("li",[s("strong",[t._v("添加这个资源对象：")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master work"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f  haima-rolebinding.yaml  ")]),t._v("\nrolebinding.rbac.authorization.k8s.io/haima-sa-rolebinding created\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master work"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get rolebinding -n kube-system | grep sa")]),t._v("\nhaima-sa-rolebinding                                Role/haima-sa-role                                    26s\n")])])]),s("ul",[s("li",[t._v("然后我们怎么去验证这个 ServiceAccount 呢？我们前⾯的课程中是不是提到过⼀个 ServiceAccount 会⽣成⼀个 Secret 对象和它进⾏映射，这个 Secret ⾥⾯包含⼀个 token，我们可以利⽤这个 token 去 登录 Dashboard，然后我们就可以在 Dashboard 中来验证我们的功能是否符合预期了：")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master work"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get secrets -n kube-system | grep haima-sa")]),t._v("\nhaima-sa-token-k26k7                             kubernetes.io/service-account-token   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("      20m\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master work"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  kubectl get secret haima-sa-token-k26k7 -o jsonpath={.data.token} -n kube-system |base64 -d ")]),t._v("\neyJhbGciOiJSUzI1NiIsImtpZCI6IjNzT0lqNW1qTjBCcjBQcTRseTdPc0ZoWDd1T3hXazRtWHk1TGI1alp0QU0ifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJoYWltYS1zYS10b2tlbi1rMjZrNyIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50Lm5hbWUiOiJoYWltYS1zYSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6Ijc1ZDc4Mzc3LTY4MGItNDhiNS04YTM1LWEzY2UxODhlZTJhNyIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDprdWJlLXN5c3RlbTpoYWltYS1zYSJ9.ubKdejm1cCRcEcNLUCUrXCkD6BahSnyEhxszyfBSol6FDhBqRiz2G7IuIgF4EGlvfmnFTmBsKD8iyDfCAwfGMqg_crwFc8DFPyACLjjPVAI-zLdQhlsfnQrulFVCftbVA3HjQ3qF04Uu59jPm7Hm4ap-1SRHSzxnqGWLHQpwJpSdh8lk1C4uRWyJLXQz0_2prQH5roFySmvKRvVujcEqsv_Meu9h9HoSNQNN1oyhfx9kZLCviMALeLxWB8WkhfZzKDVN0bag2g8i7Q-i_76I19C0dd-F-wueQOjA86R9x7RcuakqET_5pkl31bxfA6xUOY8p25s3koP5RjshIskclA"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master work"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ")]),t._v("\n")])])]),s("ul",[s("li",[s("p",[t._v("使⽤这⾥的 token 去 Dashboard ⻚⾯进⾏登录：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://pic.imgdb.cn/item/61ebf3e22ab3f51d911abf79.png",alt:""}})])])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://pic.imgdb.cn/item/61ebf3e22ab3f51d911abf7d.png",alt:""}})]),t._v(" "),s("ul",[s("li",[s("p",[s("code",[t._v("我们可以看到可以访问pod列表了，但是也会有⼀些其他额外的提示：events is forbidden: User “system:serviceaccount:kube-system:haimaxy-sa” cannot list events in the namespace “kube-system”，这是因为当前登录⽤只被授权了访问 pod 和 deployment 的权限.")])])]),t._v(" "),s("li",[s("p",[t._v("创建⼀个可以访问所有 namespace 的ServiceAccount")])]),t._v(" "),s("li",[s("p",[t._v("如果我们现在创建⼀ 个新的 ServiceAccount，需要他操作的权限作⽤于所有的 namespace，这个时候我们就需要使⽤到 ClusterRole 和 ClusterRoleBinding 这两种资源对象了。同样，⾸先新建⼀个 ServiceAcount 对象：")])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master work"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat haima-sa2.yaml  ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ServiceAccount\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" haima"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("sa2\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("system\n  \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master work"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f haima-sa2.yaml  ")]),t._v("\nserviceaccount/haimaxy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("sa2 created \n")])])]),s("ul",[s("li",[t._v("然后创建⼀个 ClusterRoleBinding 对象:")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master work"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat clusterrolebinding.yaml ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClusterRoleBinding\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io/v1beta1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" haima"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("sa2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("clusterrolebinding\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subjects")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ServiceAccount\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" haima"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("sa2\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("system\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("roleRef")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClusterRole\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cluster"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("admin\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroup")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io\n")])])]),s("blockquote",[s("p",[s("code",[t._v("从上⾯我们可以看到我们没有为这个资源对象声明 namespace，因为这是⼀个 ClusterRoleBinding 资 源对象，是作⽤于整个集群的，我们也没有单独新建⼀个 ClusterRole 对象，⽽是使⽤的 cluster-admin 这个对象，这是 Kubernetes 集群内置的 ClusterRole 对象，我们可以使⽤ kubectl get clusterrole 和 kubectl get clusterrolebinding 查看系统内置的⼀些集群⻆⾊和集群⻆⾊绑定，这 ⾥我们使⽤的 cluster-admin 这个集群⻆⾊是拥有最⾼权限的集群⻆⾊，所以⼀般需要谨慎使⽤该集群 ⻆⾊。")])])]),t._v(" "),s("ul",[s("li",[t._v("创建上⾯集群⻆⾊绑定资源对象，创建完成后同样使⽤ ServiceAccount 对应的 token 去登录 Dashboard 验证下：")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master work"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f clusterrolebinding.yaml            ")]),t._v("\nclusterrolebinding.rbac.authorization.k8s.io/haima-sa2-clusterrolebinding created\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master work"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get secrets -n kube-system | grep haima")]),t._v("\nhaima-sa-token-khljg                             kubernetes.io/service-account-token   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("      14m\n")])])]),s("h2",{attrs:{id:"网络策略概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#网络策略概述"}},[t._v("#")]),t._v(" 网络策略概述")]),t._v(" "),s("p",[t._v("网络策略（Network Policy），用于限制Pod出入流量，提供Pod级别和Nameaspace级别的网络访问控制。flannel不支持，calico是支持的。")]),t._v(" "),s("ul",[s("li",[t._v("Pod 可以通信的 Pod 是通过如下三个标识符的组合来辩识的：\n"),s("ul",[s("li",[s("strong",[s("code",[t._v("其他被允许的 Pods（例外：Pod 无法阻塞对自身的访问）")])])]),t._v(" "),s("li",[s("strong",[s("code",[t._v("被允许的名字空间")])])]),t._v(" "),s("li",[s("strong",[s("code",[t._v("IP 组块（例外：与 Pod 运行所在的节点的通信总是被允许的， 无论 Pod 或节点的 IP 地址）")])])])])])]),t._v(" "),s("h3",{attrs:{id:"一些应用场景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一些应用场景"}},[t._v("#")]),t._v(" 一些应用场景：")]),t._v(" "),s("ul",[s("li",[t._v("应用程序的访问控制。例如微服务A允许访问微服务B，微服务C不能访问微服务A")]),t._v(" "),s("li",[t._v("开发环境命名空间不能访问测试环境命名空间Pod")]),t._v(" "),s("li",[t._v("当Pod暴露到外部时，需要做Pod白名单")]),t._v(" "),s("li",[t._v("多租户网络环境隔离")])]),t._v(" "),s("h3",{attrs:{id:"pod网络入口方向隔离"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pod网络入口方向隔离"}},[t._v("#")]),t._v(" Pod网络入口方向隔离：")]),t._v(" "),s("ul",[s("li",[t._v("基于Pod级网络隔离： 只允许特定对象访问Pod（使用标签定义），允许白名单上的IP地址或者IP段访问Pod。")]),t._v(" "),s("li",[t._v("基于Namespace级网络隔离： 多个命名空间，A和B命名空间Pod完全隔离")])]),t._v(" "),s("h3",{attrs:{id:"pod网络出口方向隔离"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pod网络出口方向隔离"}},[t._v("#")]),t._v(" "),s("strong",[t._v("Pod网络出口方向隔离:")])]),t._v(" "),s("ul",[s("li",[t._v("拒绝某一个Namespace上所有的Pod访问外部")]),t._v(" "),s("li",[t._v("基于目的IP的网络隔离： 只允许Pod访问白名单上的IP地址或者IP段")]),t._v(" "),s("li",[t._v("基于目标端的网络隔离： 只允许Pod访问白名单上的端口")])]),t._v(" "),s("h3",{attrs:{id:"networkpolicy的选项"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#networkpolicy的选项"}},[t._v("#")]),t._v(" NetworkPolicy的选项")]),t._v(" "),s("ul",[s("li",[s("p",[s("code",[t._v("podSelector：")]),t._v("目标Pod，根据标签选择，每个 NetworkPolicy 都包括一个 "),s("code",[t._v("podSelector")]),t._v("，它对该策略所 适用的一组 Pod 进行选择。")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("policyTypes：")]),t._v("策略类型，每个 NetworkPolicy 都包含一个 "),s("code",[t._v("policyTypes")]),t._v(" 列表，其中包含 "),s("code",[t._v("Ingress")]),t._v(" 或 "),s("code",[t._v("Egress")]),t._v(" 或两者兼具。指定策略用于入站，出站流量。 如果 NetworkPolicy 未指定 policyTypes 则默认情况下始终设置 "),s("code",[t._v("Ingress")]),t._v("； 如果 NetworkPolicy 有任何出口规则的话则设置 "),s("code",[t._v("Egress")])])]),t._v(" "),s("li",[s("p",[s("code",[t._v("Ingress：")]),t._v("每个 NetworkPolicy 可包含一个 "),s("code",[t._v("ingress")]),t._v(" 规则的白名单列表。 每个规则都允许同时匹配 "),s("code",[t._v("from")]),t._v(" 和 "),s("code",[t._v("ports")]),t._v(" 部分的流量。")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("Egress:")]),t._v(" 每个 NetworkPolicy 可包含一个 "),s("code",[t._v("egress")]),t._v(" 规则的白名单列表。 每个规则都允许匹配 "),s("code",[t._v("to")]),t._v(" 和 "),s("code",[t._v("port")]),t._v(" 部分的流量。该示例策略包含一条规则， 该规则将指定端口上的流量匹配到 10.0.0.0/24 中的任何目的地。")])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master work"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vim networkpolicy.yaml ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.k8s.io/v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" NetworkPolicy\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" test"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("network"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("policy\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" default\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("podSelector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\t\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#标签选择器")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\t\t\t\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("role")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" db\t\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#匹配role等于db的")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("policyTypes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\t\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#策略的类型")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Ingress\t\t\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#Ingress类型  指定入口的流量")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Egress\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ingress")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\t\t\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#指定入口流量")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("from")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\t\t\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#入口流量来自哪里")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ipBlock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\t\t\t\t\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cidr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 172.17.0.0/16\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#指定该ip的段16掩码是可以访问我")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("except")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 172.17.1.0/24\t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#除了该网段24掩码的不能访问")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespaceSelector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#命名空间标签选择器")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("project")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" myproject\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#myproject的标签")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("podSelector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#Pod标签选择 ")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("role")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" frontend\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#role的标签的Pod可以访问")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\t\t\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#port的协议以及端口")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" TCP\t\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("egress")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\t\t\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#限制出口流量")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("to")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\t\t\t\t\t\t\t\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ipBlock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\t\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cidr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10.0.0.0/24\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#可以访问该网段")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" TCP\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#可以访问该网段的端口")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5978")]),t._v("\n")])])]),s("h2",{attrs:{id:"对项目pod出入流量控制-隔离"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#对项目pod出入流量控制-隔离"}},[t._v("#")]),t._v(" 对项目Pod出入流量控制：隔离")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[s("code",[t._v("将default命名空间携带app=web标签的Pod隔离，只允许default命名空间携带run=client1标签的Pod访问80端口")])])])]),t._v(" "),s("li",[s("p",[t._v("准备测试环境（做好ingress）")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl create deployment web --image=nginx ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl run client1 --image=busybox --sleep 36000")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl run client2 --image=busybox --sleep 36000")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get pods ")]),t._v("\nNAME                  READY   STATUS    RESTARTS   AGE\nclient1               "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          53m\nclient2               "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          53m\nweb-96d5df5c8-w2vvf   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          53m\n")])])]),s("ul",[s("li",[t._v("先不做网络策略尝试")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get pods -o wide ")]),t._v("\nNAME                  READY   STATUS    RESTARTS   AGE   IP               NODE   NOMINATED NODE   READINESS GATES\nclient1               "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          55m   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".167.130   "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("node")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nclient2               "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          55m   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".167.131   "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("node")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nweb-96d5df5c8-w2vvf   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          55m   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".167.129   "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("node")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),s("ul",[s("li",[t._v("可以发现没有网络策略是可以ping可以拉取")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl exec -it  client1  -- sh ")]),t._v("\n/ "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ping 10.244.167.129")]),t._v("\nPING "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".167.129 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".167.129"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(": "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("56")]),t._v(" data bytes\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(" bytes from "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".167.129: "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("seq")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ttl")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("63")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("time")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.088")]),t._v(" ms\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(" bytes from "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".167.129: "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("seq")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ttl")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("63")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("time")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.073")]),t._v(" ms\n^C\n--- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".167.129 "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ping")]),t._v(" statistics ---\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" packets transmitted, "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" packets received, "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("% packet loss\nround-trip min/avg/max "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.073")]),t._v("/0.080/0.088 ms\n\n\n/ "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# wget 10.244.167.129")]),t._v("\nConnecting to "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".167.129 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".167.129:80"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nsaving to "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'index.html'")]),t._v("\nindex.html           "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("% "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("**********************************************************************************************************"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("615")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(":00:00 ETA\n"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'index.html'")]),t._v(" saved\n")])])]),s("ul",[s("li",[t._v("创建一个将app=web的pod隔离，run=client1的可以访问")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat networkpolicy.yaml ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.k8s.io/v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" NetworkPolicy\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" test"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("network"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("policy\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" default\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("podSelector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#隔离app=web的pods")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" web \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("policyTypes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Ingress\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ingress")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("from")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("podSelector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#只允许run=client1的访问tcp的80端口")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" client1\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" TCP\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v(" \n")])])]),s("ul",[s("li",[s("p",[t._v("测试网络策略是否生效")])]),t._v(" "),s("li",[s("p",[t._v("此时会发现networkpolicy的入口流量被阻断，无法ping通，但是可以访问80端口")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f networkpolicy.yaml ")]),t._v("\nnetworkpolicy.networking.k8s.io/test-network-policy created\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl exec -it  client1  -- sh ")]),t._v("\n/ "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ping 10.244.167.129")]),t._v("\nPING "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".167.129 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".167.129"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(": "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("56")]),t._v(" data bytes\n^C\n--- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".167.129 "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ping")]),t._v(" statistics ---\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" packets transmitted, "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" packets received, "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("% packet loss\n\n/ "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# wget 10.244.167.129")]),t._v("\nConnecting to "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".167.129 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".167.129:80"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nsaving to "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'index.html'")]),t._v("\nindex.html           "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("% "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("**********************************************************************************************************"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("615")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(":00:00 ETA\n"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'index.html'")]),t._v(" saved\n/ "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ")]),t._v("\n")])])]),s("ul",[s("li",[t._v("用client2去测试，发现都被阻断了")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl exec -it  client2  -- sh ")]),t._v("\n/ "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ping 10.244.167.129")]),t._v("\nPING "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".167.129 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".167.129"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(": "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("56")]),t._v(" data bytes\n^C\n--- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".167.129 "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ping")]),t._v(" statistics ---\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" packets transmitted, "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" packets received, "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("% packet loss\n/ "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# wget 10.244.167.129")]),t._v("\nConnecting to "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".167.129 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".167.129:80"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n^C\n/ "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ")]),t._v("\n")])])]),s("h2",{attrs:{id:"对项目pod出入流量控制-单向访问"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#对项目pod出入流量控制-单向访问"}},[t._v("#")]),t._v(" 对项目Pod出入流量控制：单向访问")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("default命名空间的所有Pod可以互相访问，也可以访问其他命名空间的Pod，但是其他命名空间的Pod不能访问default的Pod。")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("podSelector：{}")]),t._v(" ：如果未配置，默认所有Pod")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("from.podSelector：{}")]),t._v(" ：如果未配置，默认不允许")])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat networkpolicy.yaml ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.k8s.io/v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" NetworkPolicy\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" np2 \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" default\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("podSelector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#针对当前命名空间所有")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("policyTypes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Ingress\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ingress")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("from")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("podSelector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#所有默认不允许")]),t._v("\n    \n    \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f networkpolicy.yaml ")]),t._v("\nnetworkpolicy.networking.k8s.io/np2 created\n")])])]),s("ul",[s("li",[t._v("使用之前的三个默认命名空间的Pod")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get pods ")]),t._v("\nNAME                  READY   STATUS    RESTARTS   AGE\nclient1               "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          82m\nclient2               "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          82m\nweb-96d5df5c8-w2vvf   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          82m\n")])])]),s("ul",[s("li",[t._v("再创建一个kube-system的client3做实验")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl run client3 --image=busybox --namespace=kube-system -- sleep 36000")]),t._v("\npod/client3 created\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get pods -n kube-system | grep client3 ")]),t._v("\nclient3                                    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          92s\n")])])]),s("ul",[s("li",[t._v("查看当前default的Pods和kube-system的Pods")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get pods -n kube-system  -o wide ")]),t._v("\nNAME                                       READY   STATUS    RESTARTS   AGE     IP               NODE     NOMINATED NODE   READINESS GATES\n···\ncoredns-7f89b7bc75-qf8dg                   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          154m    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".219.65    master   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get pods   -o wide ")]),t._v("\nNAME                  READY   STATUS    RESTARTS   AGE   IP               NODE   NOMINATED NODE   READINESS GATES\nclient1               "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          83m   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".167.130   "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("node")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nclient2               "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          83m   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".167.131   "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("node")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nweb-96d5df5c8-w2vvf   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          84m   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".167.129   "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("node")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),s("ul",[s("li",[t._v("使用clinet1去测试，去ping两个命名空间的pods，发现成功ping通")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl exec -it client1 -- sh ")]),t._v("\n/ "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ping 10.244.219.65")]),t._v("\nPING "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".219.65 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".219.65"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(": "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("56")]),t._v(" data bytes\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(" bytes from "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".219.65: "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("seq")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ttl")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("62")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("time")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.525")]),t._v(" ms\n^C\n--- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".219.65 "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ping")]),t._v(" statistics ---\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" packets transmitted, "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" packets received, "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("% packet loss\nround-trip min/avg/max "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.525")]),t._v("/0.525/0.525 ms\n/ "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ping 10.244.167.129")]),t._v("\nPING "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".167.129 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".167.129"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(": "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("56")]),t._v(" data bytes\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(" bytes from "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".167.129: "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("seq")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ttl")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("63")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("time")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.100")]),t._v(" ms\n^C\n--- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".167.129 "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ping")]),t._v(" statistics ---\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" packets transmitted, "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" packets received, "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("% packet loss\nround-trip min/avg/max "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.100")]),t._v("/0.100/0.100 ms\n/ "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ")]),t._v("\n")])])]),s("ul",[s("li",[t._v("使用kube-system命名空间的client3测试")]),t._v(" "),s("li",[t._v("可以看出直接被拒绝访问")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl exec -it client3 -n kube-system -- sh ")]),t._v("\n/ "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ping 10.244.167.130")]),t._v("\nPING "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".167.130 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".167.130"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(": "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("56")]),t._v(" data bytes\n^C\n--- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".167.130 "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ping")]),t._v(" statistics ---\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" packets transmitted, "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" packets received, "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("% packet loss\n/ "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);