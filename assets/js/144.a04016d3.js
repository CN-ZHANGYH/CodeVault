(window.webpackJsonp=window.webpackJsonp||[]).push([[144],{457:function(t,s,a){"use strict";a.r(s);var e=a(7),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"kubernetes监控与日志管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes监控与日志管理"}},[t._v("#")]),t._v(" Kubernetes监控与日志管理")]),t._v(" "),s("h2",{attrs:{id:"查看资源集群状态"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看资源集群状态"}},[t._v("#")]),t._v(" 查看资源集群状态")]),t._v(" "),s("h3",{attrs:{id:"查看master组件状态"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看master组件状态"}},[t._v("#")]),t._v(" 查看master组件状态")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  kubectl get cs ")]),t._v("\nNAME                 STATUS    MESSAGE             ERROR\ncontroller-manager   Healthy   ok                  \nscheduler            Healthy   ok                  \netcd-0               Healthy   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"health"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  \n")])])]),s("h3",{attrs:{id:"查看node状态"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看node状态"}},[t._v("#")]),t._v(" 查看node状态")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  kubectl get node")]),t._v("\nNAME     STATUS   ROLES    AGE   VERSION\nmaster   Ready    master   20h   v1.18.1\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("node")]),t._v("     Ready    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("   20h   v1.18.1\n")])])]),s("h3",{attrs:{id:"查看apiserver代理的url"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看apiserver代理的url"}},[t._v("#")]),t._v(" 查看Apiserver代理的URL")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl cluster-info ")]),t._v("\nKubernetes master is running at https://172.25.254.140:6443\nKubeDNS is running at https://172.25.254.140:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy\n\nTo further debug and diagnose cluster problems, use "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'kubectl cluster-info dump'")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n")])])]),s("h3",{attrs:{id:"查看群详细信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看群详细信息"}},[t._v("#")]),t._v(" 查看群详细信息")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl describe  <资源> <名称>    ")]),t._v("\n")])])]),s("h3",{attrs:{id:"查看资源信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看资源信息"}},[t._v("#")]),t._v(" 查看资源信息")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get pods ")]),t._v("\nNAME                     READY   STATUS              RESTARTS   AGE\npod-1-7cf5dd459b-fjpcb   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("/1     ContainerCreating   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          5s\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# kubectl  get  pod pod-1-7cf5dd459b-fjpcb --watch  "查看创建状态"')]),t._v("\n")])])]),s("h3",{attrs:{id:"集群错误排查"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#集群错误排查"}},[t._v("#")]),t._v(" 集群错误排查")]),t._v(" "),s("p",[s("strong",[t._v("当我们使用kubectl工具执行出现错误的时候？")])]),t._v(" "),s("blockquote",[s("p",[s("strong",[t._v("kubectl  >  kube-apiserver > etcd")])])]),t._v(" "),s("p",[s("strong",[t._v("当get node的时候有节点显示NotReady状态，怎么去排查？")])]),t._v(" "),s("blockquote",[s("p",[s("strong",[t._v("kubectl  >  runtime")])])]),t._v(" "),s("h3",{attrs:{id:"集群不健康"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#集群不健康"}},[t._v("#")]),t._v(" 集群不健康")]),t._v(" "),s("p",[s("strong",[t._v("当有一个节点出现不是健康的时候怎么办？")])]),t._v(" "),s("blockquote"),t._v(" "),s("p",[s("strong",[t._v("解决方法：")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('cd /etc/kubernetes/manifest\n然后将你的scheduler以及controll manager.yaml中都port=0注释掉\ncontainers:\n  - command:\n    - kube-scheduler\n    - --authentication-kubeconfig=/etc/kubernetes/scheduler.conf\n    - --authorization-kubeconfig=/etc/kubernetes/scheduler.conf\n    - --bind-address=127.0.0.1\n    - --kubeconfig=/etc/kubernetes/scheduler.conf\n    - --leader-elect=true\n#    - --port=0\n    image: k8s.gcr.io/kube-sc\n    \n[root@master ~]# systemctl restart kubelet \n[root@master ~]# kubectl get cs \nWarning: v1 ComponentStatus is deprecated in v1.19+\nNAME                 STATUS    MESSAGE                         ERROR\nscheduler            Healthy   ok                              \ncontroller-manager   Healthy   ok                              \netcd-0               Healthy   {"health":"true","reason":""}   \n')])])]),s("blockquote",[s("h2",{attrs:{id:"监控集群资源利用率"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#监控集群资源利用率"}},[t._v("#")]),t._v(" 监控集群资源利用率")])]),t._v(" "),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://pic.imgdb.cn/item/61ebeca92ab3f51d91139195.png"}}),t._v(" "),s("h2",{attrs:{id:"监控数据聚合器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#监控数据聚合器"}},[t._v("#")]),t._v(" 监控数据聚合器")]),t._v(" "),s("p",[t._v("kubectl > apiserver > metrics-server > kubelet(cadviisor)（https）")]),t._v(" "),s("h3",{attrs:{id:"metrics-server部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#metrics-server部署"}},[t._v("#")]),t._v(" Metrics Server部署：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# wget https://github.com/kubernetes-sigs/metrics-server/releases/download/v0.3.7/components.yaml")]),t._v("\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vim components.yaml")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\ncontainers:\n- name: metrics-server\nimage: lizhenliang/metrics-server:v0.3.7 \t\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#修改镜像")]),t._v("\nimagePullPolicy: IfNotPresent\nargs:\n- --cert-dir"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/tmp\n- --secure-port"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4443")]),t._v("\n- --kubelet-insecure-tls\t\t\t\t\t\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#不验证kubelet提供的https证书")]),t._v("\n- --kubelet-preferred-address-types"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("InternalIP\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#使用节点IP连接kubelet")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])])]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("创建yaml文件生效\n[root@master ~]# kubectl apply -f components.yaml \n")])])]),s("blockquote",[s("h3",{attrs:{id:"如果提示报错"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如果提示报错"}},[t._v("#")]),t._v(" 如果提示报错：")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f metrics-server.yaml  ")]),t._v("\n·\nerror: unable to recognize "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"metrics-server.yaml"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" no matches "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" kind "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"APIService"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" version "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"apiregistration.k8s.io/v1beta1"')]),t._v("\n")])])]),s("p",[s("strong",[t._v("修改yaml文件")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("---\napiVersion: apiregistration.k8s.io/v1  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#去掉bate")]),t._v("\nkind: APIService\nmetadata:\n  name: v1beta1.metrics.k8s.io\n")])])]),s("p",[s("strong",[t._v("执行yaml")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f metrics-server.yaml  ")]),t._v("\nclusterrole.rbac.authorization.k8s.io/system:aggregated-metrics-reader unchanged\nclusterrolebinding.rbac.authorization.k8s.io/metrics-server:system:auth-delegator unchanged\nrolebinding.rbac.authorization.k8s.io/metrics-server-auth-reader unchanged\napiservice.apiregistration.k8s.io/v1beta1.metrics.k8s.io created\nserviceaccount/metrics-server unchanged\ndeployment.apps/metrics-server unchanged\nservice/metrics-server unchanged\nclusterrole.rbac.authorization.k8s.io/system:metrics-server unchanged\nclusterrolebinding.rbac.authorization.k8s.io/system:metrics-server unchanged\n")])])]),s("h3",{attrs:{id:"查看node资源消耗"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看node资源消耗"}},[t._v("#")]),t._v(" 查看Node资源消耗")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("kubectl "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("top")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("node")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("node name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl top node ")]),t._v("\nNAME     CPU"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cores"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("   CPU%   MEMORY"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bytes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("   MEMORY%   \nmaster   146m         "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("%     1853Mi          "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v("%       \n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("node")]),t._v("     61m          "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("%     945Mi           "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v("%       \n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl top node  master ")]),t._v("\nNAME     CPU"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cores"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("   CPU%   MEMORY"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bytes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("   MEMORY%   \nmaster   146m         "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("%     1853Mi          "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v("%       \n")])])]),s("h3",{attrs:{id:"查看pod资源消耗"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看pod资源消耗"}},[t._v("#")]),t._v(" 查看Pod资源消耗")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("kubectl "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("top")]),t._v(" pod "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("pod name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl top  pod calico-node-9w9tt -n kube-system ")]),t._v("\nNAME                CPU"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cores"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("   MEMORY"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bytes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("   \ncalico-node-9w9tt   20m          113Mi     \n")])])]),s("h3",{attrs:{id:"管理k8s应用日志"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#管理k8s应用日志"}},[t._v("#")]),t._v(" 管理K8s应用日志")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("kubectl logs "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("Pod名称"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nkubectl logs "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("Pod名称"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nkubectl logs "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("Pod名称"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("容器名称"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),s("p",[s("strong",[t._v("k8s查看标准输出日志流程")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("kubectl logs "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" apiserver "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" kubelet "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" docker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("接管了容器标准输出日志并写到了/var/lib/docker/containers/"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("container_id"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("/"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("container_id"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("-json"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cd /var/lib/docker/containers/0852da4a53a2ccbeff729fc48d6d3e96915f80e1ffcd0bd65240577d5a88176c")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master 0852da4a53a2ccbeff729fc48d6d3e96915f80e1ffcd0bd65240577d5a88176c"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ll")]),t._v("\n-rw-r----- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("108")]),t._v(" Oct "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":23 0852da4a53a2ccbeff729fc48d6d3e96915f80e1ffcd0bd65240577d5a88176c-json.log\ndrwx------ "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" root root    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v(" Oct "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":22 checkpoints\n-rw------- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3177")]),t._v(" Oct "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":24 config.v2.json\n-rw-r--r-- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1553")]),t._v(" Oct "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":24 hostconfig.json\n-rw-r--r-- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v(" Oct "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":22 "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("hostname")]),t._v("\n-rw-r--r-- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("201")]),t._v(" Oct "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":22 hosts\ndrwx--x--- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" root root   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),t._v(" Oct "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":22 mounts\n-rw-r--r-- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("114")]),t._v(" Oct "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":22 resolv.conf\n")])])]),s("p",[s("strong",[t._v("进入所有容器终端")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl exec -it web-96d5df5c8-vwwlv -- bash ")]),t._v("\nroot@web-96d5df5c8-vwwlv:~"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cd /var/log/nginx/")]),t._v("\nroot@web-96d5df5c8-vwwlv:/var/log/nginx"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ls -l ")]),t._v("\ntotal "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\nlrwxrwxrwx "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v(" Oct "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" 02:03 access.log -"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /dev/stdout\nlrwxrwxrwx "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v(" Oct "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" 02:03 error.log -"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /dev/stderr\n")])])]),s("p",[s("strong",[t._v("容器中应用日志可以使用emptyDir数据卷将日志文件持久化到宿主机上。")])]),t._v(" "),s("p",[s("strong",[t._v("宿主机的路径：")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("/var/lib/kubelet/pods/"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("pod-id"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("/volumes/kubernetes.io~empty-dir/logs/access.log \n")])])]),s("blockquote",[s("h3",{attrs:{id:"pod创建一个边车容器读取业务容器日志"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pod创建一个边车容器读取业务容器日志"}},[t._v("#")]),t._v(" Pod创建一个边车容器读取业务容器日志")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat pod.yaml  ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Pod\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pod\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" pod\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" web\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" lizhenliang/nginx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("php\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumeMounts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" logs\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPath")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /usr/local/nginx/logs\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" log\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" busybox\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("args")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("/bin/sh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("c"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'tail -f /opt/access.log'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumeMounts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" logs\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPath")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /opt\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" logs\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("emptyDir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[s("strong",[t._v("执行yaml并且检测")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f pod.yaml ")]),t._v("\npod/my-pod configured\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl logs my-pod  web ")]),t._v("\nStarting php-fpm  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v("\nnginx: the configuration "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" /usr/local/nginx/conf/nginx.conf syntax is ok\nnginx: configuration "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" /usr/local/nginx/conf/nginx.conf "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("test")]),t._v(" is successful\n")])])]),s("h3",{attrs:{id:"收集k8s日志思路"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#收集k8s日志思路"}},[t._v("#")]),t._v(" 收集K8s日志思路")]),t._v(" "),s("p",[s("strong",[s("code",[t._v("日志平台搭建哪个技术用的多？")])])]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("ELK：重量级 Elasticsearch+Logstash（日志采集器，使用go写了filebeat替代日志采集功能）+Kibana")])]),t._v(" "),s("li",[s("strong",[t._v("Graylog、Loki：轻量级")])]),t._v(" "),s("li",[s("strong",[t._v("官方推荐的EFK日志系统是啥？ Elasticsearch+Flunend（日志采集器）+Kibana")])])]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://pic.imgdb.cn/item/61ebeca92ab3f51d91139199.png"}})])}),[],!1,null,null,null);s.default=n.exports}}]);