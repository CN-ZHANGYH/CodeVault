(window.webpackJsonp=window.webpackJsonp||[]).push([[171],{487:function(t,a,s){"use strict";s.r(a);var e=s(7),n=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"kubernetes-crd详解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes-crd详解"}},[t._v("#")]),t._v(" Kubernetes CRD详解")]),t._v(" "),a("h2",{attrs:{id:"crd基本概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#crd基本概念"}},[t._v("#")]),t._v(" CRD基本概念")]),t._v(" "),a("h3",{attrs:{id:"定制资源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#定制资源"}},[t._v("#")]),t._v(" 定制资源")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("资源（Resource） 是 Kubernetes API 中的一个端点")]),t._v("， 其中存储的是某个类别的 API 对象 的一个集合。 例 如内置的 pods 资源包含一组 Pod 对象。")]),t._v(" "),a("li",[a("code",[t._v("定制资源（Custom Resource） 是对 Kubernetes API 的扩展")]),t._v("，不一定在默认的 Kubernetes 安装中就可 用。定制资源所代表的是对特定 Kubernetes 安装的一种定制。 不过，很多 Kubernetes 核心功能现在都用定 制资源来实现，这使得 Kubernetes 更加模块化。")]),t._v(" "),a("li",[a("code",[t._v("定制资源可以通过动态注册的方式在运行中的集群内或出现或消失")]),t._v("，集群管理员可以独立于集群 更新定制资源。一旦 某定制资源被安装，用户可以使用 kubectl 来创建和访问其中的对象，就像他们为 pods 这种内置资源所做的一 样。")])]),t._v(" "),a("h3",{attrs:{id:"定制控制器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#定制控制器"}},[t._v("#")]),t._v(" 定制控制器")]),t._v(" "),a("ul",[a("li",[t._v("就定制资源本身而言，它只能用来存取结构化的数据。 当你将定制资源与 定制控制器（Custom Controller） 相结合时，定制资源就能够 提供真正的 声明式 API（Declarative API）。")]),t._v(" "),a("li",[t._v("使用声明式 API， 你可以 声明 或者设定你的资源的期望状态，并尝试让 Kubernetes 对象的当前状态 同步到 其期望状态。控制器负责将结构化的数据解释为用户所期望状态的记录，并 持续地维护该状态。")]),t._v(" "),a("li",[t._v("你可以在一个运行中的集群上部署和更新定制控制器，这类操作与集群的生命周期无关。 定制控制器可以用于任何类 别的资源，不过它们与定制资源结合起来时最为有效。 Operator 模式就是将定制资源 与定制控制器相结合的。你 可以使用定制控制器来将特定于某应用的领域知识组织 起来，以编码的形式构造对 Kubernetes API 的扩展。")])]),t._v(" "),a("h3",{attrs:{id:"声明式-apis"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#声明式-apis"}},[t._v("#")]),t._v(" 声明式 APIs")]),t._v(" "),a("p",[a("strong",[t._v("典型地，在声明式 API 中：")])]),t._v(" "),a("ol",[a("li",[t._v("你的 API 包含相对而言为数不多的、尺寸较小的对象（资源）。")]),t._v(" "),a("li",[t._v("对象定义了应用或者基础设施的配置信息。")]),t._v(" "),a("li",[t._v("对象更新操作频率较低。")]),t._v(" "),a("li",[t._v("通常需要人来读取或写入对象。")]),t._v(" "),a("li",[t._v("对象的主要操作是 CRUD 风格的（创建、读取、更新和删除）。")]),t._v(" "),a("li",[t._v("不需要跨对象的事务支持：API 对象代表的是期望状态而非确切实际状态。")])]),t._v(" "),a("p",[a("strong",[t._v("命令式 API（Imperative API）与声明式有所不同。 以下迹象表明你的 API 可能不是声明式的：")])]),t._v(" "),a("ol",[a("li",[t._v("客户端发出“做这个操作”的指令，之后在该操作结束时获得同步响应。")]),t._v(" "),a("li",[t._v("客户端发出“做这个操作”的指令，并获得一个操作 ID，之后需要检查一个 Operation（操作） 对象来判断 请求是否成功完成。")]),t._v(" "),a("li",[t._v("你会将你的 API 类比为远程过程调用（Remote Procedure Call，RPCs）。")]),t._v(" "),a("li",[t._v("直接存储大量数据；例如每个对象几 kB，或者存储上千个对象。")]),t._v(" "),a("li",[t._v("需要较高的访问带宽（长期保持每秒数十个请求）。")]),t._v(" "),a("li",[t._v("存储有应用来处理的最终用户数据（如图片、个人标识信息（PII）等）或者其他大规模数据。")]),t._v(" "),a("li",[t._v("在对象上执行的常规操作并非 CRUD 风格。")]),t._v(" "),a("li",[t._v("API 不太容易用对象来建模。")]),t._v(" "),a("li",[t._v("你决定使用操作 ID 或者操作对象来表现悬决的操作。")])]),t._v(" "),a("h3",{attrs:{id:"添加定制资源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加定制资源"}},[t._v("#")]),t._v(" 添加定制资源")]),t._v(" "),a("p",[t._v("Kubernetes 提供了两种方式供你向集群中添加定制资源：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("CRD 相对简单，创建 CRD 可以不必编程。")])]),t._v(" "),a("li",[a("p",[t._v("API 聚合 需要编程，但支持对 API 行为进行更多的控制，例如数据如何存储以及在不同 API 版本间如何转 换等。")])])]),t._v(" "),a("p",[a("code",[t._v("聚合 API 指的是一些下位的 API 服务器，运行在主 API 服务器后面")]),t._v("；主 API 服务器以代理的方式工作。这种 组织形式称作 API 聚合（API Aggregation，AA） 。 对用户而言，看起来仅仅是 Kubernetes API 被扩展 了。")]),t._v(" "),a("p",[a("code",[t._v("CRD 允许用户创建新的资源类别同时又不必添加新的 API 服务器")]),t._v("。 使用 CRD 时，你并不需要理解 API 聚合。")]),t._v(" "),a("h3",{attrs:{id:"customresourcedefinitions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#customresourcedefinitions"}},[t._v("#")]),t._v(" CustomResourceDefinitions")]),t._v(" "),a("p",[a("code",[t._v("CustomResourceDefinition API 资源允许你定义定制资源。")]),t._v(" 定义 CRD 对象的操作会使用你所设定的名字和 模式定义"),a("code",[t._v("（Schema）")]),t._v("创建一个新的定制资源， Kubernetes API 负责为你的定制资源提供存储和访问服务。 CRD 对象的名称必须是合法的 DNS 子域名。")]),t._v(" "),a("p",[t._v("CRD 使得你不必编写自己的 API 服务器来处理定制资源，不过其背后实现的通用性也意味着 你所获得的灵活性要 比 API 服务器聚合少很多。")]),t._v(" "),a("h3",{attrs:{id:"比较易用性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#比较易用性"}},[t._v("#")]),t._v(" 比较易用性")]),t._v(" "),a("p",[t._v("CRD 比聚合 API 更容易创建")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("CRDs")]),t._v(" "),a("th",[t._v("聚合 API")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("无需编程。用户可选择任何语言来实现 CRD 控制器。")]),t._v(" "),a("td",[t._v("需要使用 Go 来编程，并构建可执行文件和 镜像。")])]),t._v(" "),a("tr",[a("td",[t._v("无需额外运行服务；CRD 由 API 服务器处理。")]),t._v(" "),a("td",[t._v("需要额外创建服务，且该服务可能失效。")])]),t._v(" "),a("tr",[a("td",[t._v("一旦 CRD 被创建，不需要持续提供支持。Kubernetes 主控 节点升级过程中自动会带入缺陷修复。")]),t._v(" "),a("td",[t._v("可能需要周期性地从上游提取缺陷修复并更新 聚合 API 服务器。")])]),t._v(" "),a("tr",[a("td",[t._v("无需处理 API 的多个版本；例如，当你控制资源的客户端 时，你可以更新它使之与 API 同步。")]),t._v(" "),a("td",[t._v("你需要处理 API 的多个版本；例如，在开发 打算与很多人共享的扩展时。")])])])]),t._v(" "),a("h2",{attrs:{id:"crd基本使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#crd基本使用"}},[t._v("#")]),t._v(" CRD基本使用")]),t._v(" "),a("h3",{attrs:{id:"如何使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何使用"}},[t._v("#")]),t._v(" 如何使用")]),t._v(" "),a("p",[t._v("在K8S系统扩展点中，开发者可以通过CRD（CustomResourceDefinition）来扩展K8S API，其功能主要由APIExtensionServer负责。使用CRD扩展资源分为三步：")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("注册自定义资源")]),t._v("：开发者需要通过K8S提供的方式注册自定义资源，即通过CRD进行注册，注册之后，K8S就知道我们自定义资源的存在了，然后我们就可以像使用K8S内置资源一样使用自定义资源（CR）")]),t._v(" "),a("li",[a("strong",[t._v("使用自定义资源")]),t._v("：像内置资源比如Pod一样声明资源，使用CR声明我们的资源信息")]),t._v(" "),a("li",[a("strong",[t._v("删除自定义资源")]),t._v("：当我们不再需要时，可以删除自定义资源")])]),t._v(" "),a("h3",{attrs:{id:"创建自定义资源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建自定义资源"}},[t._v("#")]),t._v(" 创建自定义资源")]),t._v(" "),a("p",[t._v("当你创建新的 CustomResourceDefinition（CRD）时，Kubernetes API 服务器会为你所 指定的每一个版本 生成一个 RESTful 的 资源路径。CRD 可以是名字空间作用域的，也可以 是集群作用域的，取决于 CRD 的 "),a("code",[t._v("scope")]),t._v(" 字段设置。和其他现有的内置对象一样，删除 一个名字空间时，该名字空间下的所有定制对象也会被删 除。CustomResourceDefinition 本身是不受名字空间限制的，对所有名字空间可用。")]),t._v(" "),a("p",[t._v("将下面的 CustomResourceDefinition 保存到 "),a("code",[t._v("resourcedefinition.yaml")]),t._v(" 文件：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apiextensions.k8s.io/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CustomResourceDefinition\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 名字必需与下面的 spec 字段匹配，并且格式为 '<名称的复数形式>.<组名>'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" crontabs.stable.example.com\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 组名称，用于 REST API: /apis/<组>/<版本>")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" stable.example.com\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 列举此 CustomResourceDefinition 所支持的版本")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("versions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 每个版本都可以通过 served 标志来独立启用或禁止")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("served")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 其中一个且只有一个版本必需被标记为存储版本")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("storage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("schema")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("openAPIV3Schema")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cronSpec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string\n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string\n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" integer\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" object\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" object\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 可以是 Namespaced 或 Cluster")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scope")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Namespaced\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("names")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 名称的复数形式，用于 URL：/apis/<组>/<版本>/<名称的复数形式>")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("plural")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" crontabs\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kind 通常是单数形式的驼峰编码（CamelCased）形式。你的资源清单会使用这一形式。")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("singular")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" crontab\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CronTab\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# shortNames 允许你在命令行使用较短的字符串来匹配资源")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("shortNames")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ct\n")])])]),a("p",[t._v("创建CRD资源，查看当前的新增加的自定义资源")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f resourcedefinition.yaml  ")]),t._v("\ncustomresourcedefinition.apiextensions.k8s.io/crontabs.stable.example.com created\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get crd")]),t._v("\nNAME                               CREATED AT\ncrontabs.stable.example.com        "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-05-03T00:35:58Z\nkuboardaddonresources.kuboard.cn   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-05-02T23:38:10Z\nkuboardaddons.kuboard.cn           "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-05-02T23:38:10Z\n")])])]),a("p",[t._v("这样一个新的受名字空间约束的 RESTful API 端点会被创建在：")]),t._v(" "),a("blockquote",[a("p",[t._v("注意： 此端点 URL 自此可以用来创建和管理定制对象。对象的 kind 将是来自你上面创建时 所用的 spec 中指定的 CronTab 。")])]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[t._v("/apis/stable.example.com/v1/namespaces"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*/crontabs/...\n")])])])]),a("h3",{attrs:{id:"使用自定义资源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用自定义资源"}},[t._v("#")]),t._v(" 使用自定义资源")]),t._v(" "),a("p",[t._v("在创建了 CustomResourceDefinition 对象之后，你可以创建定制对象（Custom Objects）。定制对象可以 包含定制字段。这些字段可以包含任意的 JSON 数据。 在下面的例子中，在类别为 "),a("code",[t._v("CrontTab")]),t._v(" 的定制对象中，设 置了 "),a("code",[t._v("cronSpec")]),t._v(" 和 "),a("code",[t._v("image")]),t._v(" 定制字段。类别 "),a("code",[t._v("CronTab")]),t._v(" 来自你在上面所创建的 CRD 的规约。")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" stable.example.com/v1 \n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CronTab \n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("new"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cron"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("object \n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cronSpec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"* * * * */5"')]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("awesome"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cron"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("image\n")])])]),a("p",[t._v("执行创建资源后，查看详细的信息")]),t._v(" "),a("p",[t._v("你可以看到输出中包含了你创建定制对象时在 YAML 文件中指定的定制字段 cronSpec 和 image ：")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f my-crontab.yaml  ")]),t._v("\ncrontab.stable.example.com/my-new-cron-object created\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get crontabs.stable.example.com ")]),t._v("\nNAME                 AGE\nmy-new-cron-object   11s\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get crontabs.stable.example.com my-new-cron-object -o yaml ")]),t._v("\napiVersion: stable.example.com/v1\nkind: CronTab\nmetadata:\n  creationTimestamp: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2022-05-03T00:43:18Z"')]),t._v("\n  generation: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  name: my-new-cron-object\n  namespace: default\n  resourceVersion: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"6570"')]),t._v("\n  uid: 20b3d16b-5b44-4ec2-ac95-e5f5a9183b77\nspec:\n  cronSpec: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'* * * * */5'")]),t._v("\n  image: my-awesome-cron-image\n")])])]),a("h3",{attrs:{id:"牛刀小试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#牛刀小试"}},[t._v("#")]),t._v(" 牛刀小试")]),t._v(" "),a("p",[t._v("创建一个自定义API资源exam，API资源类型为Scaling，作用域为命名空间。")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apiextensions.k8s.io/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CustomResourceDefinition\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" exam.stable.example.com\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" stable.example.com\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("versions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("served")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("storage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("schema")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("openAPIV3Schema")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" object\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scope")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Namespaced\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("names")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("plural")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" exam\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("singular")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" exam \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Scaling \n")])])]),a("p",[t._v("查看创建的结果:")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl api-resources | grep -w exam ")]),t._v("\nexam                                           stable.example.com/v1                  "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("         Scaling\n")])])]),a("h3",{attrs:{id:"设置结构化的模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置结构化的模式"}},[t._v("#")]),t._v(" 设置结构化的模式")]),t._v(" "),a("p",[t._v("CustomResource 对象在定制字段中保存结构化的数据，这些字段和内置的字段 "),a("code",[t._v("apiVersion")]),t._v(" 、 "),a("code",[t._v("kind")]),t._v(" 和 "),a("code",[t._v("metadata")]),t._v(" 等一起存储，不过内置的字段都会被 API 服务器隐式完成合法性检查。有了 OpenAPI v3.0 检查 能 力之后，你可以设置一个模式（Schema），在创建和更新定制对象时，这一模式会被用来 对对象内容进行合法性检 查。参阅下文了解这类模式的细节和局限性。")]),t._v(" "),a("p",[t._v("在 "),a("code",[t._v("apiextensions.k8s.io/v1")]),t._v(" 版本中，CustomResourceDefinition 的这一结构化模式 定义是必需的。 在 CustomResourceDefinition 的 beta 版本中，结构化模式定义是可选的。")]),t._v(" "),a("p",[t._v("结构化模式本身是一个 OpenAPI v3.0 验证模式，其中：")]),t._v(" "),a("ol",[a("li",[t._v("为对象根（root）设置一个非空的 type 值（藉由 OpenAPI 中的 "),a("code",[t._v("type")]),t._v(" ），对每个 object 节点的每个 字段（藉由 OpenAPI 中的 "),a("code",[t._v("properties")]),t._v(" 或 "),a("code",[t._v("additionalProperties")]),t._v(" ）以及 array 节点的每个条目（藉由 OpenAPI 中的 "),a("code",[t._v("items")]),t._v(" ）也要设置非空的 type 值， 除非：\n"),a("ul",[a("li",[t._v("节点包含属性 "),a("code",[t._v("x-kubernetes-int-or-string: true")])]),t._v(" "),a("li",[t._v("节点包含属性 "),a("code",[t._v("x-kubernetes-preserve-unknown-fields: true")])])])]),t._v(" "),a("li",[t._v("对于 object 的每个字段或 array 中的每个条目，如果其定义中包含 "),a("code",[t._v("allOf")]),t._v(" 、 "),a("code",[t._v("anyOf")]),t._v(" 、 "),a("code",[t._v("oneOf")]),t._v(" 或 "),a("code",[t._v("not")]),t._v(" ，则模式也要指定这些逻辑组合之外的字段或条目（试比较例 1 和例 2)。")]),t._v(" "),a("li",[t._v("在 "),a("code",[t._v("allOf")]),t._v(" 、 "),a("code",[t._v("anyOf")]),t._v(" 、 "),a("code",[t._v("oneOf")]),t._v(" 或 "),a("code",[t._v("not")]),t._v(" 上下文内不设置 "),a("code",[t._v("description")]),t._v(" 、 "),a("code",[t._v("type")]),t._v(" 、 "),a("code",[t._v("default")]),t._v(" 、 "),a("code",[t._v("additionalProperties")]),t._v(" 或者 "),a("code",[t._v("nullable")]),t._v(" 。此规则的例外是 x-kubernetes-int-or-string 的两种模式（见下 文）。")]),t._v(" "),a("li",[t._v("如果 "),a("code",[t._v("metadata")]),t._v(" 被设置，则只允许对 "),a("code",[t._v("metadata.name")]),t._v(" 和 "),a("code",[t._v("metadata.generateName")]),t._v(" 设置约束。")])]),t._v(" "),a("p",[t._v("非结构化的例 1：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("allOf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("foo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n")])])]),a("p",[t._v("违反了第 2 条规则。下面的是正确的：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("foo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  \n "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("allOf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n     "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("foo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n")])])]),a("p",[t._v("非结构化的例 2：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("allOf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("items")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("foo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n")])])]),a("p",[t._v("违反了第 2 条规则。下面的是正确的：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("items")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("foo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    \n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("allOf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("items")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("foo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n")])])]),a("p",[t._v("非结构化的例 3：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("foo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pattern")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"abc"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" object\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string \n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pattern")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^a"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("finalizers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" array \n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("items")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string \n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pattern")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"my-finalizer"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("anyOf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("bar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" integer \n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("minimum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("42")]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("required")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bar"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("description")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"foo bar object"')]),t._v("\n")])])]),a("p",[t._v("不是一个结构化的模式，因为其中存在以下违例：")]),t._v(" "),a("ul",[a("li",[t._v("根节点缺失 type 设置（规则 1）")]),t._v(" "),a("li",[a("code",[t._v("foo")]),t._v(" 的 type 缺失（规则 1）")]),t._v(" "),a("li",[a("code",[t._v("anyOf")]),t._v(" 中的 "),a("code",[t._v("bar")]),t._v(" 未在外部指定（规则 2）")]),t._v(" "),a("li",[a("code",[t._v("bar")]),t._v(" 的 "),a("code",[t._v("type")]),t._v(" 位于 "),a("code",[t._v("anyOf")]),t._v(" 中（规则 3）")]),t._v(" "),a("li",[a("code",[t._v("anyOf")]),t._v(" 中设置了 "),a("code",[t._v("description")]),t._v(" （规则 3）")]),t._v(" "),a("li",[a("code",[t._v("metadata.finalizers")]),t._v(" 不可以被限制 (规则 4）")])]),t._v(" "),a("p",[t._v("作为对比，下面的 YAML 所对应的模式则是结构化的：")]),t._v(" "),a("blockquote",[a("p",[t._v("注意： 如果违反了结构化模式规则，CustomResourceDefinition 的 NonStructural 状况中 会包含报告信息。")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" object \n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("description")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"foo bar object"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("foo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pattern")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"abc"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("bar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" integer \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" object \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string \n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pattern")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^a"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("anyOf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("bar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("minimum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("42")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("required")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bar"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("h3",{attrs:{id:"字段剪裁"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#字段剪裁"}},[t._v("#")]),t._v(" 字段剪裁")]),t._v(" "),a("p",[t._v("CustomResourceDefinition 在集群的持久性存储 etcd 中保存经过合法性检查的资源数据。 就像原生的 Kubernetes 资源，例如 ConfigMap， 如果你指定了 API 服务器所无法识别的字段，则该未知字段会在保存资 源之前 被 剪裁（Pruned） 掉（删除）。")]),t._v(" "),a("p",[t._v("将下面的 YAML 保存到 my-crontab.yaml 文件：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat my-crontab.yaml  ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" stable.example.com/v1 \n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CronTab \n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("new"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cron"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("object \n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cronSpec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"* * * * */5"')]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("awesome"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cron"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("imagae\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("someRandomFied")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("42")]),t._v(" \n")])])]),a("p",[t._v("并创建之：")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f my-crontab.yaml --validate=false ")]),t._v("\ncrontab.stable.example.com/my-new-cron-object created\n")])])]),a("p",[t._v("查看crontab的详细信息：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get crontabs.stable.example.com my-new-cron-object -o yaml ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" stable.example.com/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CronTab\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("creationTimestamp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2022-05-03T01:26:00Z"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("generation")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("new"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cron"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("object\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" default\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resourceVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"9919"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uid")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 81f709aa"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("4b78"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("4f55"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("bf11"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f51b4efab576\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cronSpec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'* * * * */5'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("awesome"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cron"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("imagae\n")])])]),a("blockquote",[a("p",[t._v("注意： 其中的字段 someRandomField 已经被剪裁掉。")])]),t._v(" "),a("p",[t._v("通过 "),a("code",[t._v("--validate=false")]),t._v(" 命令行选项 关闭了客户端的合法性检查以展示 API 服务器的行为， 因为 OpenAPI 合法性检查模式也会发布到 客户端， "),a("code",[t._v("kubectl")]),t._v(" 也会检查未知的字段并在对象被发送到 API 服务器之前 就拒绝它们。")]),t._v(" "),a("h2",{attrs:{id:"crd进阶"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#crd进阶"}},[t._v("#")]),t._v(" CRD进阶")]),t._v(" "),a("h3",{attrs:{id:"finalizers"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#finalizers"}},[t._v("#")]),t._v(" Finalizers")]),t._v(" "),a("p",[a("code",[t._v("Finalizer 能够让控制器实现异步的删除前（Pre-delete）回调。")]),t._v(" 与内置对象类似，定制对象也支持 Finalizer。")]),t._v(" "),a("p",[a("strong",[t._v("Finalizers的作用：")])]),t._v(" "),a("ol",[a("li",[a("code",[t._v("自定义 Finalizer 的标识符包含一个域名、一个正向斜线和 finalizer 的名称。")]),t._v(" 任何控制器都可以在任何对象 的 finalizer 列表中添加新的 finalizer。")]),t._v(" "),a("li",[t._v("对带有 Finalizer 的对象的第一个删除请求会为其 metadata.deletionTimestamp 设置一个值，但不会真的删除对 象。一旦此值被设置， finalizers 列表中的表项 只能被移除。在列表中仍然包含 finalizer 时，无法强制删除 对应的对象。")]),t._v(" "),a("li",[t._v("当 metadata.deletionTimestamp 字段被设置时，监视该对象的各个控制器会 执行它们所能处理的 finalizer，并 在完成处理之后将其从列表中移除。 每个控制器负责将其 finalizer 从列表中删除。")]),t._v(" "),a("li",[t._v("metadata.deletionGracePeriodSeconds 的取值控制对更新的轮询周期。 一旦 finalizers 列表为空时，就意味着所有 finalizer 都被执行过， Kubernetes 会最终删除该资源。")])]),t._v(" "),a("p",[t._v("你可以像下面一样为定制对象添加 Finalizer：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" stable.example.com/v1 \n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CronTab \n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("new"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cron"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("object \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("finalizers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" stable.example.com/finalizer\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cronSpec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"* * * * */5"')]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("awesome"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cron"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("imagae\n")])])]),a("h3",{attrs:{id:"合法性检查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#合法性检查"}},[t._v("#")]),t._v(" 合法性检查")]),t._v(" "),a("p",[t._v("定制资源是通过 OpenAPI v3 模式定义 来执行合法性检查的， 你可以通过使用准入控制 Webhook 来添加额外的合法性检查 。")]),t._v(" "),a("p",[t._v("此外，对模式定义存在以下限制：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("以下字段不可设置：")]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("definitions")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("dependencies")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("deprecated")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("discriminator")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("id")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("patternProperties")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("readOnly")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("writeOnly")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("xml")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("$ref")])])])])]),t._v(" "),a("li",[a("p",[t._v("字段 "),a("code",[t._v("uniqueItems")]),t._v(" 不可设置为 "),a("code",[t._v("true")])])]),t._v(" "),a("li",[a("p",[t._v("字段 "),a("code",[t._v("additionalProperties")]),t._v(" 不可设置为 "),a("code",[t._v("false")])])]),t._v(" "),a("li",[a("p",[t._v("字段 "),a("code",[t._v("additionalProperties")]),t._v(" 与 "),a("code",[t._v("properties")]),t._v(" 互斥，不可同时使用")])])]),t._v(" "),a("p",[t._v("当设置默认值特性被启用时，可以设置字段 "),a("code",[t._v("default")]),t._v(" 。 就 "),a("code",[t._v("apiextensions.k8s.io/v1")]),t._v(" 组的 CustomResourceDefinitions，这一条件是满足的。 设置默认值的功能特性从 1.17 开始正式发布。该特性在 1.16 版本中处于 Beta 状态，要求 "),a("code",[t._v("CustomResourceDefaulting")]),t._v(" 特性门控 被启用。对于大多数集群而言，Beta 状态的特性门控默认都是自动启用的。")]),t._v(" "),a("p",[t._v("模式定义是在 CustomResourceDefinition 中设置的。在下面的例子中， CustomResourceDefinition 对 定制对象执行以下合法性检查：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("spec.cronSpec")]),t._v(" 必须是一个字符串，必须是正则表达式所描述的形式；")]),t._v(" "),a("li",[a("code",[t._v("spec.replicas")]),t._v(" 必须是一个整数，且其最小值为 1、最大值为 10。")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apiextensions.k8s.io/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CustomResourceDefinition\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 名字必需与下面的 spec 字段匹配，并且格式为 '<名称的复数形式>.<组名>'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" crontabs.stable.example.com\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 组名称，用于 REST API: /apis/<组>/<版本>")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" stable.example.com\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 列举此 CustomResourceDefinition 所支持的版本")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("versions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 每个版本都可以通过 served 标志来独立启用或禁止")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("served")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 其中一个且只有一个版本必需被标记为存储版本")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("storage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("schema")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("openAPIV3Schema")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" object\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" object\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cronSpec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string \n                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 添加正则表达式")]),t._v("\n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pattern")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'^(\\d+|\\*)(/\\d+)?(\\s+(\\d+|\\*)(/\\d+)?){4}$'")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string\n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" integer\n                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  设置副本数为的最小值和最大值")]),t._v("\n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("minimum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" \n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("maximum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 可以是 Namespaced 或 Cluster")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scope")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Namespaced\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("names")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 名称的复数形式，用于 URL：/apis/<组>/<版本>/<名称的复数形式>")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("plural")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" crontabs\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kind 通常是单数形式的驼峰编码（CamelCased）形式。你的资源清单会使用这一形式。")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("singular")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" crontab\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CronTab\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# shortNames 允许你在命令行使用较短的字符串来匹配资源")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("shortNames")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ct\n")])])]),a("p",[t._v("并创建 CustomResourceDefinition：")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f resourcedefinition.yaml")]),t._v("\n")])])]),a("p",[t._v("对于一个创建 CronTab 类别对象的定制对象的请求而言，如果其字段中包含非法值，则 该请求会被拒绝。 在下面 的例子中，定制对象中包含带非法值的字段：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("spec.cronSpec")]),t._v(" 与正则表达式不匹配")]),t._v(" "),a("li",[a("code",[t._v("spec.replicas")]),t._v(" 数值大于 10。")])]),t._v(" "),a("p",[t._v("如果你将下面的 YAML 保存到 my-crontab.yaml ：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" stable.example.com/v1 \n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CronTab \n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("new"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cron"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("object \n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cronSpec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"* * * *"')]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("awesome"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cron"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("imagae\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(" \n")])])]),a("p",[t._v("尝试创建对象，则会报如下错误：")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f  my-crontab.yaml ")]),t._v("\nThe CronTab "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"my-new-cron-object"')]),t._v(" is invalid: \n* spec.replicas: Invalid value: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(": spec.replicas "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" body should be "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("less")]),t._v(" than or equal to "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n* spec.cronSpec: Invalid value: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"* * * *"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" spec.cronSpec "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" body should match "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'^(\\d+|\\*)(/\\d+)?(\\s+(\\d+|\\*)(/\\d+)?){4}$'")]),t._v("\n")])])]),a("p",[t._v("如果所有字段都包含合法值，则对象创建的请求会被接受。")]),t._v(" "),a("p",[t._v("将下面的 YAML 保存到 my-crontab.yaml 文件：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" stable.example.com/v1 \n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CronTab \n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("new"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cron"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("object \n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cronSpec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"* * * * */5"')]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("awesome"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cron"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("imagae\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\n")])])]),a("p",[t._v("并创建定制对象：")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f my-crontab.yaml")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("crontab")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"my-new-cron-object"')]),t._v(" created\n")])])]),a("h3",{attrs:{id:"设置默认值"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置默认值"}},[t._v("#")]),t._v(" 设置默认值")]),t._v(" "),a("blockquote",[a("p",[t._v("说明： 要使用设置默认值功能，你的 CustomResourceDefinition 必须使用 API 版本 apiextensions.k8s.io/v1 。")])]),t._v(" "),a("p",[t._v("设置默认值的功能允许在 OpenAPI v3 合法性检查模式定义中设置默认值：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apiextensions.k8s.io/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CustomResourceDefinition\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" crontabs.stable.example.com\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" stable.example.com\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("versions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("served")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("storage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("schema")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# openAPIV3Schema 是用来检查定制对象的模式定义 ")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("openAPIV3Schema")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" object\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" object\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cronSpec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string\n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pattern")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'^(\\d+|\\*)(/\\d+)?(\\s+(\\d+|\\*)(/\\d+)?){4}$'")]),t._v("\n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"5 0 * * *"')]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string\n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" integer\n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("minimum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" \n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("maximum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" \n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scope")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Namespaced\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("names")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("plural")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" crontabs\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("singular")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" crontab\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CronTab\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("shortNames")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ct\n")])])]),a("p",[t._v("使用此 CRD 定义时， cronSpec 和 replicas 都会被设置默认值：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" stable.example.com/v1 \n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CronTab \n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("new"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cron"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("object \n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("awesome"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cron"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("imagae\n")])])]),a("p",[t._v("会生成：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get crontabs.stable.example.com my-new-cron-object -o yaml ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" stable.example.com/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CronTab\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("creationTimestamp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2022-05-03T16:41:05Z"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("generation")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("new"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cron"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("object\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" default\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resourceVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"81618"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uid")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 5127b8d6"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("46c1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("48c3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("8b92"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("7cce6c7d3929\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 这里默认设置了参数")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cronSpec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 5 0 * * *\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("awesome"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cron"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("imagae\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 这里也默认设置了参数")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n")])])]),a("p",[t._v("默认值设定的行为发生在定制对象上：")]),t._v(" "),a("ul",[a("li",[t._v("在向 API 服务器发送的请求中，基于请求版本的设定设置默认值；")]),t._v(" "),a("li",[t._v("在从 etcd 读取对象时，使用存储版本来设置默认值；")]),t._v(" "),a("li",[t._v("在 Mutating 准入控制插件执行非空的补丁操作时，基于准入 Webhook 对象 版本设置默认值。")])]),t._v(" "),a("h3",{attrs:{id:"nullable"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nullable"}},[t._v("#")]),t._v(" Nullable")]),t._v(" "),a("p",[t._v("设置默认值和字段是否可为空（Nullable）")]),t._v(" "),a("p",[t._v("1.20 版本新增: 对于未设置其 nullable 标志的字段或者将该标志设置为 "),a("code",[t._v("false")]),t._v(" 的字段，其空值（Null）会 在设置默认值之前被剪裁掉。如果对应字段 存在默认值，则默认值会被赋予该字段。当 "),a("code",[t._v("nullable")]),t._v(" 被设置为 "),a("code",[t._v("true")]),t._v(" 时， 字段的空值会被保留，且不会在设置默认值时被覆盖。")]),t._v(" "),a("p",[t._v("例如，给定下面的 OpenAPI 模式定义：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apiextensions.k8s.io/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CustomResourceDefinition\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" crontabs.stable.example.com\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" stable.example.com\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("versions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("served")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("storage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("schema")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# openAPIV3Schema 是用来检查定制对象的模式定义 ")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("openAPIV3Schema")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" object\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" object\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置nullable的可选参数选项")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("foo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string \n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nullable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v(" \n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default"')]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("bar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string\n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nullable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v(" \n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("baz")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string \n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cronSpec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string\n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pattern")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'^(\\d+|\\*)(/\\d+)?(\\s+(\\d+|\\*)(/\\d+)?){4}$'")]),t._v("\n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"5 0 * * *"')]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string\n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" integer\n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("minimum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("maximum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n···\n")])])]),a("p",[t._v("像下面这样创建一个为 foo 、 bar 和 baz 设置空值的对象时：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" stable.example.com/v1 \n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CronTab \n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("new"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cron"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("object \n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("awesome"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cron"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("imagae  \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("foo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token null important"}},[t._v("null")]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("bar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token null important"}},[t._v("null")]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("baz")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token null important"}},[t._v("null")]),t._v(" \n")])])]),a("p",[t._v("其返回的结果将会是这样的：")]),t._v(" "),a("blockquote",[a("p",[t._v("其中的 foo 字段被剪裁掉并重新设置默认值，因为该字段是不可为空的。 "),a("code",[t._v("bar")]),t._v(" 字段的 "),a("code",[t._v("nullable: true")]),t._v(" 使 得其能够保有其空值。 "),a("code",[t._v("baz 字段则被完全剪裁掉")]),t._v("，因为该字段是不可为空的，并且没有默认值设置。")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get crontab my-new-cron-object -o yaml ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" stable.example.com/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CronTab\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("creationTimestamp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2022-05-03T17:14:31Z"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("generation")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("new"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cron"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("object\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" default\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resourceVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"84245"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uid")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 73f5fe25"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("0aac"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("4631"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("b33a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("a2ed3acebb8b\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("bar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token null important"}},[t._v("null")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cronSpec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 5 0 * * *\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("foo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" default\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("awesome"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cron"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("imagae\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n")])])]),a("h3",{attrs:{id:"openapi-v2-形式发布合法性检查模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#openapi-v2-形式发布合法性检查模式"}},[t._v("#")]),t._v(" OpenAPI v2 形式发布合法性检查模式")]),t._v(" "),a("p",[t._v("CustomResourceDefinition 的结构化的、 启用了剪裁的 OpenAPI v3 合法性检查模式 会在 Kubernetes API 服务器上作为 OpenAPI v2 规约 的一部分发布出来。")]),t._v(" "),a("p",[t._v("kubectl 命令行工具会基于所发布的模式定义来执行 客户端的合法性检查（ "),a("code",[t._v("kubectl create")]),t._v(" 和 "),a("code",[t._v("kubectl apply")]),t._v(" ），为定制资源的模式定义 提供解释（ "),a("code",[t._v("kubectl explain")]),t._v(" ）。 所发布的模式还可被用于其他目的，例如生成 客户端或者生成文档。")]),t._v(" "),a("p",[t._v("OpenAPI v3 合法性检查模式定义会被转换为 OpenAPI v2 模式定义，并出现在 OpenAPI v2 规范 的 definitions 和 paths 字段中。")]),t._v(" "),a("p",[t._v("在转换过程中会发生以下修改，目的是保持与 1.13 版本以前的 kubectl 工具兼容。 这些修改可以避免 kubectl 过于严格，以至于拒绝它无法理解的 OpenAPI 模式定义。 转换过程不会更改 CRD 中定义的合法性检查 模式定义，因此不会影响到 API 服务器中 的合法性检查。")]),t._v(" "),a("ol",[a("li",[t._v("以下字段会被移除，因为它们在 OpenAPI v2 中不支持（在将来版本中将使用 OpenAPI v3， 因而不会有 这些限制） 字段 "),a("code",[t._v("allOf")]),t._v(" 、 "),a("code",[t._v("anyOf")]),t._v(" 、 "),a("code",[t._v("oneOf")]),t._v(" 和 "),a("code",[t._v("not")]),t._v(" 会被删除")]),t._v(" "),a("li",[t._v("如果设置了 "),a("code",[t._v("nullable: true")]),t._v(" ，我们会丢弃 "),a("code",[t._v("type")]),t._v(" 、 "),a("code",[t._v("nullable")]),t._v(" 、 "),a("code",[t._v("items")]),t._v(" 和 "),a("code",[t._v("properties")]),t._v(" OpenAPI v2 无法 表达 Nullable。为了避免 kubectl 拒绝正常的对象，这一转换是必要的。")])]),t._v(" "),a("h3",{attrs:{id:"额外的打印列"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#额外的打印列"}},[t._v("#")]),t._v(" 额外的打印列")]),t._v(" "),a("p",[a("code",[t._v("kubectl")]),t._v(" 工具依赖服务器端的输出格式化。你的集群的 API 服务器决定 "),a("code",[t._v("kubectl get")]),t._v(" 命令要显示的列有哪 些。 你可以为 CustomResourceDefinition 定制这些要打印的列。 下面的例子添加了 "),a("code",[t._v("Spec")]),t._v(" 、 "),a("code",[t._v("Replicas")]),t._v(" 和 "),a("code",[t._v("Age")]),t._v(" 列：")]),t._v(" "),a("p",[t._v("将此 CustomResourceDefinition 保存到 resourcedefinition.yaml 文件：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apiextensions.k8s.io/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CustomResourceDefinition\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" crontabs.stable.example.com\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" stable.example.com\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("versions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1 \n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("served")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("storage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("schema")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# openAPIV3Schema 是用来检查定制对象的模式定义 ")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("openAPIV3Schema")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" object\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" object\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cronSpec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string \n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pattern")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'^(\\d+|\\*)(/\\d+)?(\\s+(\\d+|\\*)(/\\d+)?){4}$'")]),t._v(" \n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"5 0 * * *"')]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string\n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" integer\n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("minimum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" \n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("maximum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" \n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("  \n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 添加额外的打印")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("additionalPrinterColumns")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Spec\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("description")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" The cron spec defining the interval a CronJob is run\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("jsonPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" .spec.cronSpec\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Replicas\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" integer\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("description")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" The number of jobs launched by the CronJob\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("jsonPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" .spec.replicas\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Age\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" date\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("jsonPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" .metadata.creationTimestamp    \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scope")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Namespaced\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("names")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("plural")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" crontabs\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("singular")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" crontab\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CronTab\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("shortNames")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ct \n")])])]),a("p",[t._v("创建 CustomResourceDefinition：")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f resourcedefinition.yaml")]),t._v("\n")])])]),a("p",[t._v("使用创建好的crontab实例，查看当前的状态。")]),t._v(" "),a("blockquote",[a("p",[t._v("注意输出中的 NAME 、 SPEC 、 REPLICAS 和 AGE 列：")]),t._v(" "),a("p",[a("strong",[t._v("说明")]),t._v("： NAME 列是隐含的，不需要在 CustomResourceDefinition 中定义。")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get crontabs my-new-cron-object ")]),t._v("\nNAME                 SPEC        REPLICAS   AGE\nmy-new-cron-object   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" * * *   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("          38m\n")])])]),a("h3",{attrs:{id:"优先级"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#优先级"}},[t._v("#")]),t._v(" 优先级")]),t._v(" "),a("p",[t._v("每个列都包含一个 "),a("code",[t._v("priority")]),t._v(" （优先级）字段。当前，优先级用来区分标准视图（Standard View）和宽视图 （Wide View）（使用 "),a("code",[t._v("-o wide")]),t._v(" 标志）中显示的列：")]),t._v(" "),a("ul",[a("li",[t._v("优先级为 "),a("code",[t._v("0")]),t._v(" 的列会在标准视图中显示。")]),t._v(" "),a("li",[t._v("优先级大于 "),a("code",[t._v("0")]),t._v(" 的列只会在宽视图中显示。")])]),t._v(" "),a("h3",{attrs:{id:"类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#类型"}},[t._v("#")]),t._v(" 类型")]),t._v(" "),a("p",[t._v("列的 type 字段可以是以下值之一 （比较 OpenAPI v3 数据类型）：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("integer")]),t._v(" – 非浮点数字")]),t._v(" "),a("li",[a("code",[t._v("number")]),t._v(" – 浮点数字")]),t._v(" "),a("li",[a("code",[t._v("string")]),t._v(" – 字符串")]),t._v(" "),a("li",[a("code",[t._v("boolean")]),t._v(" – "),a("code",[t._v("true")]),t._v(" 或 "),a("code",[t._v("false")])]),t._v(" "),a("li",[a("code",[t._v("date")]),t._v(" – 显示为以自此时间戳以来经过的时长")])]),t._v(" "),a("h3",{attrs:{id:"格式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#格式"}},[t._v("#")]),t._v(" 格式")]),t._v(" "),a("p",[t._v("列的 format 字段可以是以下值之一：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("int32")])]),t._v(" "),a("li",[a("code",[t._v("int64")])]),t._v(" "),a("li",[a("code",[t._v("float")])]),t._v(" "),a("li",[a("code",[t._v("double")])]),t._v(" "),a("li",[a("code",[t._v("byte")])]),t._v(" "),a("li",[a("code",[t._v("date")])]),t._v(" "),a("li",[a("code",[t._v("date-time")])]),t._v(" "),a("li",[a("code",[t._v("password")])])]),t._v(" "),a("p",[t._v("列的 format 字段控制 kubectl 打印对应取值时采用的风格。")]),t._v(" "),a("h3",{attrs:{id:"子资源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#子资源"}},[t._v("#")]),t._v(" 子资源")]),t._v(" "),a("p",[t._v("定制资源支持 "),a("code",[t._v("/status")]),t._v(" 和 "),a("code",[t._v("/scale")]),t._v(" 子资源。 通过在 CustomResourceDefinition 中定义 "),a("code",[t._v("status")]),t._v(" 和 "),a("code",[t._v("scale")]),t._v(" ， 可以有选择地启用这些子资源。")]),t._v(" "),a("h3",{attrs:{id:"status-子资源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#status-子资源"}},[t._v("#")]),t._v(" Status 子资源")]),t._v(" "),a("p",[t._v("当启用了 status 子资源时，对应定制资源的 "),a("code",[t._v("/status")]),t._v(" 子资源会被暴露出来。")]),t._v(" "),a("ol",[a("li",[t._v("status 和 spec 内容分别用定制资源内的 "),a("code",[t._v(".status")]),t._v(" 和 "),a("code",[t._v(".spec JSON")]),t._v(" 路径来表达；")]),t._v(" "),a("li",[t._v("对 "),a("code",[t._v("/status")]),t._v(" 子资源的 "),a("code",[t._v("PUT")]),t._v(" 请求要求使用定制资源对象作为其输入，但会忽略 status 之外的所有内容。")]),t._v(" "),a("li",[t._v("对 "),a("code",[t._v("/status")]),t._v(" 子资源的 "),a("code",[t._v("PUT")]),t._v(" 请求仅对定制资源的 status 内容进行合法性检查。")]),t._v(" "),a("li",[t._v("对定制资源的 "),a("code",[t._v("PUT")]),t._v(" 、 "),a("code",[t._v("POST")]),t._v(" 、 "),a("code",[t._v("PATCH")]),t._v(" 请求会忽略 status 内容的改变。")]),t._v(" "),a("li",[t._v("对所有变更请求，除非改变是针对 "),a("code",[t._v(".metadata")]),t._v(" 或 "),a("code",[t._v(".status")]),t._v(" ， "),a("code",[t._v(".metadata.generation")]),t._v(" 的取值都会增加。 在 CRD")])]),t._v(" "),a("p",[t._v("OpenAPI 合法性检查模式定义的根节点，只允许存在以下结构：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("description")])]),t._v(" "),a("li",[a("code",[t._v("example")])]),t._v(" "),a("li",[a("code",[t._v("exclusiveMaximum")])]),t._v(" "),a("li",[a("code",[t._v("exclusiveMinimum")])]),t._v(" "),a("li",[a("code",[t._v("externalDocs format")])]),t._v(" "),a("li",[a("code",[t._v("items")])]),t._v(" "),a("li",[a("code",[t._v("maximum")])]),t._v(" "),a("li",[a("code",[t._v("maxItems")])]),t._v(" "),a("li",[a("code",[t._v("maxLength")])]),t._v(" "),a("li",[a("code",[t._v("minimum")])]),t._v(" "),a("li",[a("code",[t._v("minItems")])]),t._v(" "),a("li",[a("code",[t._v("minLength")])]),t._v(" "),a("li",[a("code",[t._v("multipleOf")])]),t._v(" "),a("li",[a("code",[t._v("pattern")])]),t._v(" "),a("li",[a("code",[t._v("properties")])]),t._v(" "),a("li",[a("code",[t._v("required")])]),t._v(" "),a("li",[a("code",[t._v("title")])]),t._v(" "),a("li",[a("code",[t._v("type")])]),t._v(" "),a("li",[a("code",[t._v("uniqueItems")])])]),t._v(" "),a("h3",{attrs:{id:"scale-子资源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#scale-子资源"}},[t._v("#")]),t._v(" Scale 子资源")]),t._v(" "),a("p",[t._v("当启用了 scale 子资源时，定制资源的 "),a("code",[t._v("/scale")]),t._v(" 子资源就被暴露出来。 针对 "),a("code",[t._v("/scale")]),t._v(" 所发送的对象是 "),a("code",[t._v("autoscaling/v1.Scale")]),t._v("。")]),t._v(" "),a("p",[t._v("为了启用 scale 子资源，CustomResourceDefinition 定义了以下字段：")]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("specReplicasPath")]),t._v(" 指定定制资源内与 "),a("code",[t._v("scale.spec.replicas")]),t._v(" 对应的 JSON 路径。")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("此字段为必需值。")])]),t._v(" "),a("li",[a("p",[t._v("只可以使用 "),a("code",[t._v(".spec")]),t._v(" 下的 JSON 路径，只可使用带句点的路径。")])]),t._v(" "),a("li",[a("p",[t._v("如果定制资源的 "),a("code",[t._v("specReplicasPath")]),t._v(" 下没有取值，则针对 "),a("code",[t._v("/scale")]),t._v(" 子资源执行 GET 操作时会返回错 误。")])])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("statusReplicasPath")]),t._v(" 指定定制资源内与 "),a("code",[t._v("scale.status.replicas")]),t._v(" 对应的 JSON 路径。")])]),t._v(" "),a("li",[a("p",[t._v("此字段为必需值。")])]),t._v(" "),a("li",[a("p",[t._v("只可以使用 "),a("code",[t._v(".status")]),t._v(" 下的 JSON 路径，只可使用带句点的路径。")])]),t._v(" "),a("li",[a("p",[t._v("如果定制资源的 "),a("code",[t._v("statusReplicasPath")]),t._v(" 下没有取值，则针对 "),a("code",[t._v("/scale")]),t._v(" 子资源的 副本个数状态值默认为 0。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("labelSelectorPath")]),t._v(" 指定定制资源内与 "),a("code",[t._v("scale.status.selector")]),t._v(" 对应的 JSON 路径。")]),t._v(" "),a("ul",[a("li",[t._v("此字段为可选值。")]),t._v(" "),a("li",[t._v("此字段必须设置才能使用 "),a("code",[t._v("HPA")]),t._v("。")]),t._v(" "),a("li",[t._v("只可以使用 "),a("code",[t._v(".status")]),t._v(" 或 "),a("code",[t._v(".spec")]),t._v(" 下的 JSON 路径，只可使用带句点的路径。")]),t._v(" "),a("li",[t._v("如果定制资源的 "),a("code",[t._v("labelSelectorPath")]),t._v(" 下没有取值，则针对 "),a("code",[t._v("/scale")]),t._v(" 子资源的 选择算符状态值默认为空 字符串。")]),t._v(" "),a("li",[t._v("此 JSON 路径所指向的字段必须是一个字符串字段（而不是复合的选择算符结构）， 其中包含标签选择 算符串行化的字符串形式。")])])])]),t._v(" "),a("p",[t._v("在下面的例子中， "),a("code",[t._v("status")]),t._v(" 和 "),a("code",[t._v("scale")]),t._v(" 子资源都被启用。")]),t._v(" "),a("p",[t._v("将此 CustomResourceDefinition 保存到 "),a("code",[t._v("resourcedefinition.yaml")]),t._v(" 文件：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apiextensions.k8s.io/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CustomResourceDefinition\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" crontabs.stable.example.com\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" stable.example.com\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("versions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1 \n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("served")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("storage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("schema")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# openAPIV3Schema 是用来检查定制对象的模式定义 ")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("openAPIV3Schema")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" object\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" object\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cronSpec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string \n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string\n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" integer \n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("status")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" object \n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" integer \n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labelSelector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string \n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  subresources 描述定制资源的子资源")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subresources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# status 启用 status 子资源")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("status")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# scale 启用 scale 子资源")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scale")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# specReplicasPath 定义定制资源中对应的 scale.spec.replicas 的 JSON 路径")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("specReplicasPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" .spec.replicas\n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# statusReplicasPath 定义定制资源中对应的 scale.status.replicas 的 JSON 路径")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("statusReplicasPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" .status.replicas \n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# labelSelectorPath 定义定制资源中对应 scale.status.selector 的 JSON 路径")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labelSelectorPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" .status.labelSelector \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scope")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Namespaced\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("names")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("plural")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" crontabs\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("singular")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" crontab\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CronTab\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("shortNames")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ct \n")])])]),a("p",[t._v("CustomResourceDefinition 对象创建完毕之后，你可以创建定制对象。")]),t._v(" "),a("p",[t._v("如果你将下面的 YAML 保存到 my-crontab.yaml 文件：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat  my-crontab.yaml  ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" stable.example.com/v1 \n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CronTab \n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("new"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cron"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("object \n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("awesome"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cron"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("imagae   \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cronSpec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"* * * * */5"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" \n")])])]),a("p",[t._v("定制资源可以使用 kubectl scale 命令来扩缩其规模。 例如下面的命令将前面创建的定制资源的 .spec.replicas 设置为 5：")]),t._v(" "),a("blockquote",[a("p",[t._v("注意： 你可以使用 PodDisruptionBudget 来保护启用了 scale 子资源的定制资源。")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f my-crontab.yaml  ")]),t._v("\ncrontab.stable.example.com/my-new-cron-object created\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl scale  --replicas=5 crontabs.stable.example.com my-new-cron-object ")]),t._v("\ncrontab.stable.example.com/my-new-cron-object scaled\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get  crontabs.stable.example.com my-new-cron-object -o jsonpath='{.spec.replicas}'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\n")])])]),a("h3",{attrs:{id:"分类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分类"}},[t._v("#")]),t._v(" 分类")]),t._v(" "),a("p",[t._v("分类（Categories）是定制资源所归属的分组资源列表（例如， "),a("code",[t._v("all")]),t._v(" ）。 你可以使用 "),a("code",[t._v("kubectl get <分类名称>")]),t._v(" 来列举属于某分类的所有资源。")]),t._v(" "),a("p",[t._v("下面的示例在 CustomResourceDefinition 中将 "),a("code",[t._v("all")]),t._v(" 添加到分类列表中， 并展示了如何使用 "),a("code",[t._v("kubectl get all")]),t._v(" 来输出定制资源：")]),t._v(" "),a("p",[t._v("将下面的 CustomResourceDefinition 保存到 "),a("code",[t._v("resourcedefinition.yaml")]),t._v(" 文件中：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apiextensions.k8s.io/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CustomResourceDefinition\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" crontabs.stable.example.com\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" stable.example.com\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("versions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1 \n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("served")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("storage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("schema")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# openAPIV3Schema 是用来检查定制对象的模式定义 ")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("openAPIV3Schema")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" object\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" object\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cronSpec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string \n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string\n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" integer \n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("status")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" object \n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" integer \n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labelSelector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n                  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scope")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Namespaced\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("names")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("plural")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" crontabs\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("singular")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" crontab\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CronTab\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("shortNames")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ct  \n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 添加一个分类归属")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("categories")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" crontab"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("all \n")])])]),a("p",[t._v("创建了 CustomResourceDefinition 对象之后，你可以创建定制对象。")]),t._v(" "),a("p",[t._v("将下面的 YAML 保存到 "),a("code",[t._v("my-crontab.yaml")]),t._v(" 中：")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat my-crontab.yaml ")]),t._v("\napiVersion: stable.example.com/v1 \nkind: CronTab \nmetadata: \n  name: my-new-cron-object \nspec: \n  image: my-awesome-cron-imagae   \n  cronSpec: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"* * * * */5"')]),t._v("\n  replicas: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" \n  \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f my-crontab.yaml ")]),t._v("\ncrontab.stable.example.com/my-new-cron-object unchanged\n\n"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'你可以在使用 kubectl get 时指定分类：'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get crontab-all ")]),t._v("\nNAME                 AGE\nmy-new-cron-object   2m3s\n")])])]),a("h2",{attrs:{id:"crd的版本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#crd的版本"}},[t._v("#")]),t._v(" CRD的版本")]),t._v(" "),a("h3",{attrs:{id:"概览"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#概览"}},[t._v("#")]),t._v(" 概览")]),t._v(" "),a("p",[t._v("CustomResourceDefinition API 提供了用于引入和升级的工作流程到 CustomResourceDefinition 的新 版本。")]),t._v(" "),a("p",[t._v("创建 CustomResourceDefinition 时，会在 CustomResourceDefinition spec.versions 列表设置适当 的稳定级别和版本号。例如， v1beta1 表示第一个版本尚未稳定。 所有定制资源对象将首先用这个版本保存。")]),t._v(" "),a("p",[t._v("创建 CustomResourceDefinition 后，客户端可以开始使用 v1beta1 API,稍后可能需要添加新版本，例如 v1 。")]),t._v(" "),a("p",[a("strong",[t._v("添加新版本：")])]),t._v(" "),a("ol",[a("li",[t._v("选择一种转化策略。由于定制资源对象需要能够两种版本都可用， 这意味着它们有时会以与存储版本不同的版 本来提供服务。为了能够做到这一点， 有时必须在它们存储的版本和提供的版本之间进行转换。如果转换涉及 模式变更， 并且需要自定义逻辑，则应该使用 Webhook 来完成。如果没有模式变更， 则可使用默认的 "),a("code",[t._v("None")]),t._v(" 转换策略，为不同版本提供服务时只有 "),a("code",[t._v("apiVersion")]),t._v(" 字段 会被改变。")]),t._v(" "),a("li",[t._v("如果使用转换 Webhook，请创建并部署转换 Webhook。更多详细信息请参见 Webhook conversion。")]),t._v(" "),a("li",[t._v("更新 CustomResourceDefinition，将新版本设置为 "),a("code",[t._v("served：true")]),t._v(" ，加入到 "),a("code",[t._v("spec.versions")]),t._v(" 列表。另 外，还要设置 "),a("code",[t._v("spec.conversion")]),t._v(" 字段 为所选的转换策略。如果使用转换 Webhook，请配置 "),a("code",[t._v("spec.conversion.webhookClientConfig")]),t._v(" 来调用 Webhook。")])]),t._v(" "),a("p",[t._v("对于客户来说，在将对象升级到新的存储版本之前、期间和之后使用旧版本和新版本都是安全的。")]),t._v(" "),a("p",[a("strong",[t._v("删除旧版本：")])]),t._v(" "),a("ol",[a("li",[t._v("确保所有客户端都已完全迁移到新版本。 可以查看 kube-apiserver 的日志以识别仍通过旧版本进行访问 的所有客户端。")]),t._v(" "),a("li",[t._v("在 "),a("code",[t._v("spec.versions")]),t._v(" 列表中将旧版本的 "),a("code",[t._v("served")]),t._v(" 设置为 "),a("code",[t._v("false")]),t._v(" 。 如果仍有客户端意外地使用旧版本，他们 可能开始会报告采用旧版本尝试访 定制资源的错误消息。 如果发生这种情况，请将旧版本的 "),a("code",[t._v("served：true")]),t._v(" 恢 复，然后迁移余下的客户端 使用新版本，然后重复此步骤。")]),t._v(" "),a("li",[t._v("确保已完成将现有对象升级到新存储版本 的步骤。\n"),a("ul",[a("li",[t._v("CustomResourceDefinition 的 "),a("code",[t._v("spec.versions")]),t._v(" 列表中，确认新版本的 "),a("code",[t._v("stored")]),t._v(" 已被设置为 "),a("code",[t._v("true")]),t._v(" 。")]),t._v(" "),a("li",[t._v("确认旧版本不在 CustomResourceDefinition "),a("code",[t._v("status.storedVersions")]),t._v(" 中。")])])]),t._v(" "),a("li",[t._v("从 CustomResourceDefinition "),a("code",[t._v("spec.versions")]),t._v(" 列表中删除旧版本。")]),t._v(" "),a("li",[t._v("在转换 Webhooks 中放弃对旧版本的转换支持。")])]),t._v(" "),a("h3",{attrs:{id:"指定多个版本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#指定多个版本"}},[t._v("#")]),t._v(" 指定多个版本")]),t._v(" "),a("p",[t._v("CustomResourceDefinition API 的 "),a("code",[t._v("versions")]),t._v(" 字段可用于支持你所开发的 定制资源的多个版本。版本可以 具有不同的模式，并且转换 Webhooks 可以在多个版本之间转换定制资源。 在适当的情况下，Webhook 转换应遵 循 Kubernetes API 约定。 尤其是，请查阅 API 变更文档 以了解一些有用的常见错误和建议。")]),t._v(" "),a("blockquote",[a("p",[t._v("说明： 在 apiextensions.k8s.io/v1beta1 版本中曾经有一个 version 字段， 名字不叫做 versions 。该 version 字 段已经被废弃，成为可选项。 不过如果该字段不是空，则必须与 versions 字段中的第一个条目匹配。")])]),t._v(" "),a("p",[t._v("下面的示例显示了两个版本的 CustomResourceDefinition。 第一个例子中假设所有的版本使用相同的模式而它 们之间没有转换。 YAML 中的注释提供了更多背景信息。")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("apiextensions.k8s.io/v1")])]),t._v(" "),a("li",[a("code",[t._v("apiextensions.k8s.io/v1beta1")])])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apiextensions.k8s.io/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CustomResourceDefinition\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# name 必须匹配后面 spec 中的字段，且使用格式 <plural>.<group>")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" crontabs.stable.example.com\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 组名，用于 REST API: /apis/<group>/<version>")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" stable.example.com\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 此 CustomResourceDefinition 所支持的版本列表")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("versions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1beta1 \n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 每个 version 可以通过 served 标志启用或禁止")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("served")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 有且只能有一个 version 必须被标记为存储版本")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("storage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# schema 是必需字段")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("schema")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# openAPIV3Schema 是用来检查定制对象的模式定义 ")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("openAPIV3Schema")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" object\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string \n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1 \n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("served")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("storage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v(" \n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("schema")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("openAPIV3Schema")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" object\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string \n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string \n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# conversion 节是 Kubernetes 1.13+ 版本引入的，其默认值为无转换，即")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# strategy 子字段设置为 None。")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("conversion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# None 转换假定所有版本采用相同的模式定义，仅仅将定制资源的 apiVersion")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置为合适的值.")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("strategy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" None \n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 可以是 Namespaced 或 Cluster")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scope")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Namespaced\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("names")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 名称的复数形式，用于 URL: /apis/<group>/<version>/<plural>")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("plural")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" crontabs\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 名称的单数形式，用于在命令行接口和显示时作为其别名")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("singular")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" crontab\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kind 通常是驼峰编码（CamelCased）的单数形式，用于资源清单中")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CronTab\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# shortNames 允许你在命令行接口中使用更短的字符串来匹配你的资源")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("shortNames")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ct \n")])])]),a("blockquote",[a("p",[t._v("注意： 在创建之后，API 服务器开始在 HTTP REST 端点上为每个已启用的版本提供服务。 在上面的示例中，API 版本 可以在 /apis/example.com/v1beta1 和 /apis/example.com/v1 处获得。")])]),t._v(" "),a("h3",{attrs:{id:"版本优先级"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#版本优先级"}},[t._v("#")]),t._v(" 版本优先级")]),t._v(" "),a("p",[t._v("不考虑 CustomResourceDefinition 中版本被定义的顺序，kubectl 使用 具有最高优先级的版本作为访问对 象的默认版本。 通过解析 name 字段确定优先级来决定版本号，稳定性（GA、Beta 或 Alpha） 级别及该稳定性 级别内的序列。")]),t._v(" "),a("p",[t._v("用于对版本进行排序的算法在设计上与 Kubernetes 项目对 Kubernetes 版本进行排序的方式相同。 版本以 "),a("code",[t._v("v")]),t._v(" 开头跟一个数字，一个可选的 "),a("code",[t._v("beta")]),t._v(" 或者 "),a("code",[t._v("alpha")]),t._v(" 和一个可选的附加数字 作为版本信息。 从广义上讲， 版本字符串可能看起来像 "),a("code",[t._v("v2")]),t._v(" 或者 "),a("code",[t._v("v2beta1")]),t._v(" 。 使用以下算法对版本进行排序：")]),t._v(" "),a("ul",[a("li",[t._v("遵循 Kubernetes 版本模式的条目在不符合条件的条目之前进行排序。")]),t._v(" "),a("li",[t._v("对于遵循 Kubernetes 版本模式的条目，版本字符串的数字部分从最大到最小排序。")]),t._v(" "),a("li",[t._v("如果第一个数字后面有字符串 "),a("code",[t._v("beta")]),t._v(" 或 "),a("code",[t._v("alpha")]),t._v(" ，它们首先按去掉 "),a("code",[t._v("beta")]),t._v(" 或 "),a("code",[t._v("alpha")]),t._v(" 之后的版本号排序 （相当于 GA 版本），之后按 "),a("code",[t._v("beta")]),t._v(" 先、 "),a("code",[t._v("alpha")]),t._v(" 后的顺序排序， 版本优先级 CustomResourceDefinition 的版本")]),t._v(" "),a("li",[t._v("如果 "),a("code",[t._v("beta")]),t._v(" 或 "),a("code",[t._v("alpha")]),t._v(" 之后还有另一个数字，那么也会针对这些数字 从大到小排序。")]),t._v(" "),a("li",[t._v("不符合上述格式的字符串按字母顺序排序，数字部分不经过特殊处理。 请注意，在下面的示例中， foo1 排在 foo10 之前。 这与遵循 Kubernetes 版本模式的条目的数字部分排序不同。")])]),t._v(" "),a("p",[t._v("如果查看以下版本排序列表，这些规则就容易懂了：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" v10\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" v2\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" v1\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" v11beta2\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" v10beta3\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" v3beta1\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" v12alpha1\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" v11alpha2\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" foo1\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" foo10\n")])])]),a("h3",{attrs:{id:"版本废弃"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#版本废弃"}},[t._v("#")]),t._v(" 版本废弃")]),t._v(" "),a("p",[t._v("从 v1.19 开始，CustomResourceDefinition 可用来标明所定义的资源的特定版本 被废弃。当发起对已废弃的 版本的 API 请求时，会在 API 响应中以 HTTP 头部 的形式返回警告消息。 如果需要，可以对资源的每个废弃版 本定制该警告消息。")]),t._v(" "),a("p",[t._v("定制的警告消息应该标明废弃的 API 组、版本和类别（kind），并且应该标明 应该使用（如果有的话）哪个 API 组、版本和类别作为替代。")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("apiextensions.k8s.io/v1")])]),t._v(" "),a("li",[a("code",[t._v("apiextensions.k8s.io/v1beta1")])])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apiextensions.k8s.io/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CustomResourceDefinition\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" crontabs.example.com\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" example.com\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("names")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("plural")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" crontabs\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("singular")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" crontab\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CronTab\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scope")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Namespaced\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("versions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1alpha1\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("served")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("storage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 此属性标明此定制资源的 v1alpha1 版本已被弃用。")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 发给此版本的 API 请求会在服务器响应中收到警告消息头。")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("deprecated")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 此属性设置用来覆盖返回给发送 v1alpha1 API 请求的客户端的默认警告信息。")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("deprecationWarning")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"example.com/v1alpha1 CronTab is deprecated; Please Update !!!"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("schema")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("openAPIV3Schema")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" object\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("txt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("served")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("storage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("schema")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("openAPIV3Schema")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" object\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("txt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string\n")])])]),a("p",[t._v("通过创建"),a("code",[t._v("v1alpha1")]),t._v("版本的资源，触发告警。")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat test-crontab.yaml ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" example.com/v1alpha1 \n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CronTab\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" tes\n  \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f test-crontab.yaml ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Warning")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" example.com/v1alpha1 CronTab is deprecated; Please Update "),a("span",{pre:!0,attrs:{class:"token tag"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token tag"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token tag"}},[t._v("!")]),t._v(" \ncrontab.example.com/test created\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);