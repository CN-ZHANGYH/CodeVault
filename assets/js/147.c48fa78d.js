(window.webpackJsonp=window.webpackJsonp||[]).push([[147],{462:function(s,t,a){"use strict";a.r(t);var n=a(7),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"kubernetes网络"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes网络"}},[s._v("#")]),s._v(" Kubernetes网络")]),s._v(" "),t("h2",{attrs:{id:"service"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#service"}},[s._v("#")]),s._v(" Service")]),s._v(" "),t("h3",{attrs:{id:"service存在的意义"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#service存在的意义"}},[s._v("#")]),s._v(" Service存在的意义")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("service是k8s中的一个重要概念，主要是提供负载均衡和服务")])]),s._v(" "),t("li",[t("p",[s._v("防止Pod失联")])]),s._v(" "),t("li",[t("p",[s._v("定义一组Pod的访问策略")])]),s._v(" "),t("li",[t("p",[s._v("为了解决以下两个问题，K8s引入Service")])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("Pod的IP不固定：")])]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("增加一个控制器负责动态获取Pod的列表IP，动态更新到负载均衡器配置。")])])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("Pod是多副本")])]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("前面增加一个负载均衡器")])])])])]),s._v(" "),t("h3",{attrs:{id:"pod与service的关系"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pod与service的关系"}},[s._v("#")]),s._v(" Pod与Service的关系")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("通过label-selector相关联")])]),s._v(" "),t("li",[t("p",[s._v("通过Service实现Pod的负载均衡（TCP/UDP 4层）")])])]),s._v(" "),t("h3",{attrs:{id:"service的三种类型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#service的三种类型"}},[s._v("#")]),s._v(" Service的三种类型")]),s._v(" "),t("ul",[t("li",[t("p",[t("strong",[s._v("ClusterIP：集群内部使用")])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("NodePort：对外暴露应用")])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("LoadBalancer：对外暴露应用，适用公有云")])])]),s._v(" "),t("li",[t("p",[t("code",[s._v("ClusterIP")]),s._v("：默认，分配一个稳定的IP地址，即VIP，只能在集群内 部访问（同Namespace内的Pod）。")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("NodePort")]),s._v("：在每个节点上启用一个端口来暴露服务，可以在集群 外部访问。也会分配一个稳定内部集群IP地址。 访问地址：: 端口范围：30000-32767。")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("LoadBalancer")]),s._v("：与NodePort类似，在每个节点上启用一个端口来暴 露服务。除此之外，Kubernetes会请求底层云平台上的负载均衡器， 将每个Node（[NodeIP]:[NodePort]）作为后端添加进去。")])])]),s._v(" "),t("blockquote",[t("p",[t("strong",[s._v("ClusterIP的用法")])])]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("查看deployment")])])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get deployment")]),s._v("\nNAME   READY   UP-TO-DATE   AVAILABLE   AGE\nweb    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("           71s\n")])])]),t("ul",[t("li",[t("strong",[s._v("快速生成一个绑定deployment的web的service端口开放")])])]),s._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl expose deployment web --port=80 --target-port=80 --type=ClusterIP --dry-run -o yaml  > service.yaml")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat service.yaml")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Service\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" web\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" web\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterIP\t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#这里是指定类型，默认是ClusterIP")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\t\t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#service（负载均衡器）端口，只能再k8s集群内部访问，（node和Pod）")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("protocol")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" TCP\t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#端口的协议")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targetPort")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#容器中提供服务的端口")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\t\t\t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#标签选择器，用来关联pod")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" web\n")])])]),t("ul",[t("li",[t("strong",[s._v("运行service的yaml文件")])])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f service.yaml")]),s._v("\nservice/web created\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get service")]),s._v("\nNAME         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   AGE\nkubernetes   ClusterIP   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.1      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("/TCP   29h\nweb          ClusterIP   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.107")]),s._v(".119.3   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/TCP    5s\n")])])]),t("ul",[t("li",[t("strong",[s._v("访问service的地址")])])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl 10.107.119.3")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("DOCTYPE html"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("html"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("head"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("title"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("Welcome to nginx"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/title"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("style"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nhtml "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" color-scheme: light dark"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nbody "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" width: 35em"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" margin: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" auto"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nfont-family: Tahoma, Verdana, Arial, sans-serif"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/style"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/head"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("body"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("h"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v("Welcome to nginx"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/h"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("p"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("If you see this page, the nginx web server is successfully installed and\nworking. Further configuration is required."),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/p"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("p"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("For online documentation and support please refer to\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("href")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://nginx.org/"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("nginx.org"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/a"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("."),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("br/"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nCommercial support is available at\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("href")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://nginx.com/"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("nginx.com"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/a"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("."),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/p"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("p"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("em"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("Thank you "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" using nginx."),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/em"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/p"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/body"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/html"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),t("blockquote",[t("p",[t("strong",[s._v("NodePort的用法")])])]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("修改service的端口类型")])])]),s._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat service.yaml")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Service\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" web\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" web\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" NodePort\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#暴露端口类型用NodePort ")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("protocol")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" TCP\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targetPort")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nodePort")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30002")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#可以指定一个暴露端口，也可以默认生成")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" web\n")])])]),t("ul",[t("li",[t("strong",[s._v("查看service更新的端口并且访问")])])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get service")]),s._v("\nNAME         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("        AGE\nkubernetes   ClusterIP   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.1       "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("/TCP        29h\nweb          NodePort    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.111")]),s._v(".240.72   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":30002/TCP   8s\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl 192.168.1.104:30002")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("DOCTYPE html"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("html"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("head"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("title"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("Welcome to nginx"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/title"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("style"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nhtml "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" color-scheme: light dark"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nbody "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" width: 35em"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" margin: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" auto"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nfont-family: Tahoma, Verdana, Arial, sans-serif"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/style"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/head"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("body"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("h"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v("Welcome to nginx"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/h"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("p"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("If you see this page, the nginx web server is successfully installed and\nworking. Further configuration is required."),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/p"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("p"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("For online documentation and support please refer to\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("href")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://nginx.org/"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("nginx.org"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/a"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("."),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("br/"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nCommercial support is available at\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("href")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://nginx.com/"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("nginx.com"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/a"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("."),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/p"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("p"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("em"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("Thank you "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" using nginx."),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/em"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/p"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/body"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/html"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),t("h3",{attrs:{id:"service代理模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#service代理模式"}},[s._v("#")]),s._v(" Service代理模式")]),s._v(" "),t("blockquote",[t("p",[t("strong",[s._v("Service的几种代理")])])]),s._v(" "),t("ul",[t("li",[t("p",[t("code",[s._v("userspace")])])]),s._v(" "),t("li",[t("p",[t("code",[s._v("iptables （默认）")])])]),s._v(" "),t("li",[t("p",[t("code",[s._v("ipvs （lvs）")])])])]),s._v(" "),t("blockquote",[t("p",[t("strong",[s._v("iptables默认方式")])])]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("部署一个ClusterIP的方式暴露端口的Pod")])])]),s._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat service.yaml")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Service\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" web\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" web\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("protocol")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" TCP\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targetPort")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" web\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterIP\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply  -f service.yaml")]),s._v("\nservice/web unchanged\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl  get service")]),s._v("\nNAME         TYPE        CLUSTER"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("IP      EXTERNAL"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("IP   PORT(S)   AGE\nkubernetes   ClusterIP   10.96.0.1       <none"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("        443/TCP   4h20m\nweb          ClusterIP   10.101.63.199   <none"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("        80/TCP    21m\n")])])]),t("ul",[t("li",[t("strong",[s._v("查看默认的iptables代理是怎么实现负载均衡的机制")])])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# iptables-save  | grep 10.101.63.199")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#第一步")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-A")]),s._v(" KUBE-SERVICES "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".0.0/16 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.101")]),s._v(".63.199/32 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" comment "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--comment")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default/web cluster IP"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--dport")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-j")]),s._v(" KUBE-MARK-MASQ\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#第二步")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-A")]),s._v(" KUBE-SVC-LOLE4ISW44XBNF3G "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" comment "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--comment")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default/web"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-j")]),s._v(" KUBE-SEP-NBPPORLROMQLLPIL\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#第三步")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-A")]),s._v(" KUBE-SERVICES "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.101")]),s._v(".63.199/32 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" comment "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--comment")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default/web cluster IP"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--dport")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-j")]),s._v(" KUBE-SVC-LOLE4ISW44XBNF3G\n")])])]),t("blockquote",[t("p",[s._v("ipvs模式")])]),s._v(" "),t("p",[t("strong",[s._v("修改为ipvs模式")])]),s._v(" "),t("p",[t("strong",[s._v("kubeadm方式修改ipvs模式：")])]),s._v(" "),t("p",[t("strong",[s._v("注：")])]),s._v(" "),t("ul",[t("li",[t("p",[t("strong",[s._v("kube-proxy配置文件以configmap方式存储")])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("如果让所有节点生效，需要重建所有节点kube-proxy pod")])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("修改配置文件删除Pod")])])])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl edit configmaps -n kube-system kube-proxy")]),s._v("\n···\n    mode: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ipvs"')]),s._v("\n···\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl delete pod -n kube-system kube-proxy-628k6 kube-proxy-7sbfn kube-proxy-jzrxz")]),s._v("\npod "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kube-proxy-628k6"')]),s._v(" deleted\npod "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kube-proxy-7sbfn"')]),s._v(" deleted\npod "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kube-proxy-jzrxz"')]),s._v(" deleted\n")])])]),t("ul",[t("li",[t("strong",[s._v("查看当前模式")])])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl logs -n kube-system kube-proxy-c8vzr | grep ipvs")]),s._v("\nI1103 09:20:08.747308       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" server_others.go:258"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Using ipvs Proxier.\n")])])]),t("ul",[t("li",[t("strong",[s._v("安装ipvs工具")])])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum install -y  ipvsadm")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ipvsadm -L -n   ")]),s._v("\n· "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-L")]),s._v(" 列出所有规则\n· "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" 以非主机名的方式去显示\n\nIP Virtual Server version "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.2")]),s._v(".1 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("size"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nProt LocalAddress:Port Scheduler Flags\n  -"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" RemoteAddress:Port           Forward Weight ActiveConn InActConn\nTCP  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.104:32238 rr\n  -"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".104.1:80              Masq    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nTCP  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.1:443 rr\n  -"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.104:6443           Masq    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nTCP  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.10:53 rr\n  -"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".219.66:53             Masq    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n  -"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".219.67:53             Masq    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nTCP  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.10:9153 rr\n  -"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".219.66:9153           Masq    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n  -"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".219.67:9153           Masq    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nTCP  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.101")]),s._v(".63.199:80 rr\n  -"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".104.1:80              Masq    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nTCP  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".219.64:32238 rr\n  -"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".104.1:80              Masq    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nTCP  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:32238 rr\n  -"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".104.1:80              Masq    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nTCP  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".0.1:32238 rr\n  -"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".104.1:80              Masq    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nUDP  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.10:53 rr\n  -"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".219.66:53             Masq    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n  -"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".219.67:53             Masq    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])])]),t("p",[t("strong",[s._v("ipvs的访问流程：")])]),s._v(" "),t("ul",[t("li",[t("strong",[t("code",[s._v("curl service ip > kube-ipvs0(virtual server) > pod(real server)")])])]),s._v(" "),t("li",[t("code",[s._v("通过内置的ipvs网卡实现负载的功能")])]),s._v(" "),t("li",[t("strong",[t("code",[s._v("IPVS模式下，ingress和service使用相同的ELB实例时，无法在集群内的节点和容器中访问ingress")])])])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(": kube-ipvs0: "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("BROADCAST,NOARP"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" mtu "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v(" qdisc noop state DOWN group default\n    link/ether 2e:a3:33:75:1d:20 brd ff:ff:ff:ff:ff:ff\n    inet "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.1/32 scope global kube-ipvs0\n       valid_lft forever preferred_lft forever\n    inet "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.10/32 scope global kube-ipvs0\n       valid_lft forever preferred_lft forever\n    inet "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.101")]),s._v(".63.199/32 scope global kube-ipvs0\n       valid_lft forever preferred_lft forever\n")])])]),t("blockquote",[t("p",[t("strong",[s._v("Iptables VS IPVS")])])]),s._v(" "),t("p",[t("strong",[s._v("Iptables：")])]),s._v(" "),t("ul",[t("li",[t("p",[t("code",[s._v("灵活，功能强大")])])]),s._v(" "),t("li",[t("p",[t("code",[s._v("规则遍历匹配和更新，呈线性时延")])])])]),s._v(" "),t("p",[t("strong",[s._v("IPVS：")])]),s._v(" "),t("ul",[t("li",[t("p",[t("code",[s._v("工作在内核态，有更好的性能")])])]),s._v(" "),t("li",[t("p",[t("code",[s._v("调度算法丰富：rr，wrr，lc，wlc，ip hash..")])])])]),s._v(" "),t("h3",{attrs:{id:"service-dns名称"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#service-dns名称"}},[s._v("#")]),s._v(" Service DNS名称")]),s._v(" "),t("blockquote",[t("p",[t("strong",[s._v("CoreDNS：")])]),s._v(" "),t("p",[s._v("是一个DNS服务器，Kubernetes默认采用，以Pod部署在集群中，CoreDNS服 务监视Kubernetes API，为每一个Service创建DNS记录用于域名解析。")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("CoreDNS YAML文件：\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wget https://github.com/kubernetes/kubernetes/tree/master/cluster/addons/dns/coredns  ")]),s._v("\n")])])]),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("ClusterIP A记录格式："),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("service-name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("."),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("namespace-name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(".svc.cluster.local\n示例：my-svc.my-namespace.svc.cluster.local\n")])])]),t("ul",[t("li",[t("strong",[s._v("运行一个容器用来解析k8s集群的域名")])])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl run -it --rm --image=busybox:1.28.4 -- sh")]),s._v("\n\nIf you don't see a "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" prompt, try pressing enter.\n\n/ "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nslookup")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看一下service的custer—ip")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get service")]),s._v("\nNAME         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("        AGE\nkubernetes   ClusterIP   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.1       "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("/TCP        4h58m\nweb          NodePort    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.101")]),s._v(".63.199   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":32238/TCP   59m\n")])])]),t("ul",[t("li",[t("strong",[s._v("解析一下clusterip")])])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("BusyBox v1.28.4 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-05-22 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":00:17 UTC"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" multi-call binary.\nUsage: "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nslookup")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("HOST"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("SERVER"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nQuery the nameserver "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the IP address of the given HOST\noptionally using a specified DNS server\n/ "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nslookup 10.101.63.199")]),s._v("\nServer:    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.10\nAddress "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.10 kube-dns.kube-system.svc.cluster.local\n\nName:      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.101")]),s._v(".63.199\nAddress "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.101")]),s._v(".63.199 web.default.svc.cluster.local\n/ "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n")])])]),t("h2",{attrs:{id:"ingress"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ingress"}},[s._v("#")]),s._v(" Ingress")]),s._v(" "),t("h3",{attrs:{id:"ingress为弥补nodeport不足而生"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ingress为弥补nodeport不足而生"}},[s._v("#")]),s._v(" Ingress为弥补NodePort不足而生")]),s._v(" "),t("p",[t("strong",[s._v("NodePort存在的不足：")])]),s._v(" "),t("ul",[t("li",[t("p",[s._v("一个端口只能一个服务使用，端口需提前规划")])]),s._v(" "),t("li",[t("p",[s._v("只支持4层负载均衡")])])]),s._v(" "),t("blockquote",[t("p",[t("strong",[s._v("Ingress是什么？")])]),s._v(" "),t("ul",[t("li",[t("p",[s._v("Ingress：Ingress公开了从集群外部到集群内服务的HTTP和HTTPS路由的规则集合，而具体实现流量路 由则是由Ingress Controller负责。")])]),s._v(" "),t("li",[t("p",[s._v("Ingress：K8s中的一个抽象资源，给管理员 提供一个暴露应用的入口定义方法")])]),s._v(" "),t("li",[t("p",[s._v("Ingress Controller：根据Ingress生成具体 的路由规则，并对Pod负载均衡器")])])]),s._v(" "),t("p",[t("strong",[s._v("Ingress是授权入站连接到达集群服务的规则集合。")])]),s._v(" "),t("ul",[t("li",[s._v("从外部流量调度到nodeprot上的service")]),s._v(" "),t("li",[s._v("从service调度到ingress-controller")]),s._v(" "),t("li",[s._v("ingress-controller根据ingress中的定义（虚拟主机或者后端的url）")]),s._v(" "),t("li",[s._v("根据虚拟主机名调度到后端的一组pod中")])])]),s._v(" "),t("blockquote",[t("p",[t("strong",[s._v("Ingress Controller是什么？")])]),s._v(" "),t("p",[s._v("Ingress管理的负载均衡器，为集群提供全局的负载均衡能力。")]),s._v(" "),t("p",[t("strong",[s._v("使用流程：")])]),s._v(" "),t("ol",[t("li",[s._v("部署Ingress Controller")]),s._v(" "),t("li",[s._v("创建Ingress规则")])])]),s._v(" "),t("h3",{attrs:{id:"ingress-controller"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ingress-controller"}},[s._v("#")]),s._v(" Ingress Controller")]),s._v(" "),t("ul",[t("li",[t("p",[t("strong",[s._v("Ingress 不会公开任意端口或协议。 将 HTTP 和 HTTPS 以外的服务公开到 Internet 时，通常使用 "),t("a",{attrs:{href:"https://kubernetes.io/zh/docs/concepts/services-networking/service/#nodeport",target:"_blank",rel:"noopener noreferrer"}},[s._v("Service.Type=NodePort"),t("OutboundLink")],1),s._v(" 或 "),t("a",{attrs:{href:"https://kubernetes.io/zh/docs/concepts/services-networking/service/#loadbalancer",target:"_blank",rel:"noopener noreferrer"}},[s._v("Service.Type=LoadBalancer"),t("OutboundLink")],1),s._v(" 类型的服务。")])])]),s._v(" "),t("li",[t("p",[s._v("Ingress Controller有很多实现，我们这里采用官方维护的Nginx控制器。")])]),s._v(" "),t("li",[t("p",[s._v("项目地址：https://github.com/kubernetes/ingress-nginx")])])]),s._v(" "),t("p",[t("strong",[s._v("修改YAML：")])]),s._v(" "),t("ul",[t("li",[t("code",[s._v("镜像地址修改成国内的：lizhenliang/nginx-ingress-controller:0.30.0")])]),s._v(" "),t("li",[t("code",[s._v("将Ingress Controller暴露，一般使用宿主机网络（hostNetwork: true）或者使用NodePort")])])]),s._v(" "),t("h3",{attrs:{id:"环境准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#环境准备"}},[s._v("#")]),s._v(" 环境准备")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("你必须具有 "),t("a",{attrs:{href:"https://kubernetes.io/zh/docs/concepts/services-networking/ingress-controllers",target:"_blank",rel:"noopener noreferrer"}},[s._v("Ingress 控制器"),t("OutboundLink")],1),s._v(" 才能满足 Ingress 的要求。 仅创建 Ingress 资源本身没有任何效果。")])]),s._v(" "),t("li",[t("p",[s._v("你可能需要部署 Ingress 控制器，例如 "),t("a",{attrs:{href:"https://kubernetes.github.io/ingress-nginx/deploy/",target:"_blank",rel:"noopener noreferrer"}},[s._v("ingress-nginx"),t("OutboundLink")],1),s._v("。 你可以从许多 "),t("a",{attrs:{href:"https://kubernetes.io/zh/docs/concepts/services-networking/ingress-controllers",target:"_blank",rel:"noopener noreferrer"}},[s._v("Ingress 控制器"),t("OutboundLink")],1),s._v(" 中进行选择。")])]),s._v(" "),t("li",[t("p",[s._v("理想情况下，所有 Ingress 控制器都应符合参考规范。但实际上，不同的 Ingress 控制器操作略有不同。")])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("初始化Ingress的控制器")])])])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f  ingress-controller.yaml")]),s._v("\nnamespace/ingress-nginx unchanged\nconfigmap/nginx-configuration unchanged\nconfigmap/tcp-services unchanged\nconfigmap/udp-services unchanged\nserviceaccount/nginx-ingress-serviceaccount unchanged\nWarning: rbac.authorization.k8s.io/v1beta1 ClusterRole is deprecated "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" v1.17+, unavailable "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" v1.22+"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" use rbac.authorization.k8s.io/v1 ClusterRole\nclusterrole.rbac.authorization.k8s.io/nginx-ingress-clusterrole unchanged\nWarning: rbac.authorization.k8s.io/v1beta1 Role is deprecated "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" v1.17+, unavailable "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" v1.22+"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" use rbac.authorization.k8s.io/v1 Role\nrole.rbac.authorization.k8s.io/nginx-ingress-role unchanged\nWarning: rbac.authorization.k8s.io/v1beta1 RoleBinding is deprecated "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" v1.17+, unavailable "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" v1.22+"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" use rbac.authorization.k8s.io/v1 RoleBinding\nrolebinding.rbac.authorization.k8s.io/nginx-ingress-role-nisa-binding unchanged\nWarning: rbac.authorization.k8s.io/v1beta1 ClusterRoleBinding is deprecated "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" v1.17+, unavailable "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" v1.22+"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" use rbac.authorization.k8s.io/v1 ClusterRoleBinding\nclusterrolebinding.rbac.authorization.k8s.io/nginx-ingress-clusterrole-nisa-binding unchanged\ndaemonset.apps/nginx-ingress-controller unchanged\nlimitrange/ingress-nginx configured\n")])])]),t("ul",[t("li",[t("strong",[s._v("使用命名空间隔离资源，创建deployment和service")])])]),s._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat nginx.yaml")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Namespace\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" web"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ns\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apps/v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Deployment\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" web"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ns\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("matchLabels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Service\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" web"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ns\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("protocol")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" TCP\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targetPort")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" NodePort\n  \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f  nginx.yaml")]),s._v("\nnamespace/web"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ns created\ndeployment.apps/nginx created\nservice/nginx created\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get deployment -n web-test-ns")]),s._v("\nNAME    READY   UP"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("TO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("DATE   AVAILABLE   AGE\nnginx   1/1     1            1           30m\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get service")]),s._v("\nNAME         TYPE        CLUSTER"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("IP    EXTERNAL"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("IP   PORT(S)        AGE\nkubernetes   ClusterIP   10.96.0.1     <none"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("        443/TCP        8h\nnginx        NodePort    10.106.56.3   <none"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("        80"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("31410/TCP   30m\n")])])]),t("h3",{attrs:{id:"ingress-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ingress-2"}},[s._v("#")]),s._v(" Ingress")]),s._v(" "),t("ul",[t("li",[t("p",[t("strong",[s._v("ingress可以给service提供集群外部访问的url、负载均衡、ssl终止、http路由等。")])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("为了配置这些ingress规则，集群管理员需要部署一个ingress controller，它监听ingress和service的变化，根据规则配置负载均衡并提供访问入口")])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("创建一个最小资源化的Ingress")])])])]),s._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ kubectl create ingress ingsecret "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("class=default "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('rule="/'),t("span",{pre:!0,attrs:{class:"token important"}},[s._v('*=nginx:80"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("run "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("o yaml "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(" ingress.yaml\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat ingress2.yaml")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  networking.k8s.io/v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Ingress\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ingress"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("web\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" web"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ns  \n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rules")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\t\t\t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建一个规则")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test.com\t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定主机的域名")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\t\t\t\t\t\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\t\t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将请求映射到后端的路径集合")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /  \n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pathType")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Prefix\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("backend")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#service的名称")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("number")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#service的端口")]),s._v("\n")])])]),t("ul",[t("li",[t("strong",[s._v("创建ingress查看ingress的状态")])])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f  ingress2.yaml")]),s._v("\nWarning: extensions/v1beta1 Ingress is deprecated "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" v1.14+, unavailable "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" v1.22+"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" use networking.k8s.io/v1 Ingress\ningress.extensions/ingress-web configured\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get ingress -n web-test-ns")]),s._v("\nNAME          CLASS    HOSTS      ADDRESS   PORTS   AGE\ningress-web   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   test.com             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("      28m\n")])])]),t("ul",[t("li",[t("strong",[s._v("Ingress control的入口地址是什么？怎么访问呢？")])])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pods -A  -o wide   ")]),s._v("\nNAMESPACE       NAME                                       READY   STATUS    RESTARTS   AGE     IP              NODE     NOMINATED NODE   READINESS GATES\ningress-nginx   nginx-ingress-controller-26w7m             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          3h25m   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.121   node2    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\ningress-nginx   nginx-ingress-controller-9bm8d             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          3h25m   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.120   node1    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n···\nweb-test-ns     nginx-7848d4b86f-v27pj                     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          39m     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".104.2    node2    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#192.168.1.121就是访问地址")]),s._v("\n")])])]),t("ul",[t("li",[t("strong",[s._v("在本地的hosts配置映射")])])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("C:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Windows"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("System32"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("drivers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("etc\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.121 test.com\n\n\nC:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Users"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("zyh"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("ping test.com\n\n正在 Ping test.com "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.121"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" 具有 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v(" 字节的数据:\n来自 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.121 的回复: 字节"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v(" 时间"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("1ms "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TTL")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("\n来自 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.121 的回复: 字节"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v(" 时间"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("1ms "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TTL")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("\n")])])]),t("ul",[t("li",[t("p",[t("strong",[s._v("然后可以在网站上用域名访问，可以访问到，然后查看两个node节点的端口开放")])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("masetr节点的端口并没发现有80和443端口")])])])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ss -anpt | grep 80")]),s._v("\nLISTEN     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.104:2380                     *:*                   users:"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v('"etcd"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10511")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\nESTAB      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:2379               "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:47360               users:"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v('"etcd"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10511")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\nESTAB      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:2379               "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:47280               users:"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v('"etcd"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10511")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\nTIME-WAIT  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.104:46336              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".219.69:8080\nESTAB      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:47280              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:2379                users:"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v('"kube'),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v('apiserver"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10492")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("34")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\nTIME-WAIT  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.104:46254              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".219.69:8080\nESTAB      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:47376              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:2379                users:"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v('"kube'),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v('apiserver"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10492")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ss -anpt | grep 443")]),s._v("\nESTAB      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.104:49890              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.104:6443                users:"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v('"kubelet"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("906")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\nESTAB      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.1:33866              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.1:443                 users:"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v('"calico'),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v('node"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13259")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\nESTAB      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.104:50300              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.104:6443                users:"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v('"kube'),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v('controller"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10462")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\nESTAB      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.104:50150              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.104:6443                users:"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v('"kube'),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v('proxy"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12370")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\nESTAB      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.1:33860              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.1:443                 users:"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v('"calico'),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v('node"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13257")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\nESTAB      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.104:49906              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.104:6443                users:"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v('"kube'),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v('controller"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10462")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\nESTAB      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.104:50118              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.104:6443                users:"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v('"kube'),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v('scheduler"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10479")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\nESTAB      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.1:33864              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.1:443                 users:"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v('"calico'),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v('node"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13261")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\nESTAB      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.104:49888              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.104:6443                users:"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v('"kube'),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v('scheduler"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10479")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\n")])])]),t("ul",[t("li",[t("p",[t("strong",[t("code",[s._v("此时查看两个node节点发现80端口和443端口开放")])])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("说明负载的作用成功了，ingress正常")])])])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ss -anpt  | grep 80")]),s._v("\nLISTEN     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")]),s._v("          *:80                       *:*                   users:"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v('"nginx"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20388")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("33")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v('"nginx"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13765")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("33")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\nLISTEN     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")]),s._v("          *:80                       *:*                   users:"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v('"nginx"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20388")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v('"nginx"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13764")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\nLISTEN     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")]),s._v("          *:80                       *:*                   users:"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v('"nginx"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20388")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v('"nginx"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13763")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\nLISTEN     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")]),s._v("          *:80                       *:*                   users:"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v('"nginx"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20388")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v('"nginx"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13762")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\nTIME-WAIT  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:36780              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:9099\nTIME-WAIT  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:36804              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:9099\nTIME-WAIT  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:36800              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:9099\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ss -anpt  | grep  443")]),s._v("\nLISTEN     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")]),s._v("          *:443                      *:*                   users:"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v('"nginx"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20388")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("39")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v('"nginx"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13765")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("39")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\nLISTEN     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")]),s._v("          *:443                      *:*                   users:"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v('"nginx"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20388")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("38")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v('"nginx"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13764")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("38")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\nLISTEN     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")]),s._v("          *:443                      *:*                   users:"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v('"nginx"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20388")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("37")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v('"nginx"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13763")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("37")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\nLISTEN     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")]),s._v("          *:443                      *:*                   users:"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v('"nginx"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20388")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v('"nginx"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13762")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\nESTAB      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.1:54834              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.1:443                 users:"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v('"calico'),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v('node"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14921")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\nESTAB      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.1:54928              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.1:443                 users:"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v('"nginx'),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ingress"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v('c"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20287")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\nESTAB      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.120:44100              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.104:6443                users:"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v('"kubelet"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13313")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\nESTAB      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.1:54820              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.1:443                 users:"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v('"calico'),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v('node"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14916")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\nESTAB      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.1:54822              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.1:443                 users:"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v('"calico'),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v('node"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14918")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\nESTAB      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.120:44166              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.104:6443                users:"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v('"kube'),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v('proxy"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8637")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\n")])])]),t("h3",{attrs:{id:"ingress配置https的加密认证"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ingress配置https的加密认证"}},[s._v("#")]),s._v(" Ingress配置https的加密认证")]),s._v(" "),t("blockquote",[t("p",[t("strong",[s._v("Ingress | Https")])])]),s._v(" "),t("ul",[t("li",[t("p",[t("strong",[s._v("配置HTTPS步骤：")])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("准备域名证书文件（来自：openssl/cfssl工具自签或者权威机构颁发）")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tar -zxvf cfssl.tar.gz  -C /usr/local/bin/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# chmod +x certs.sh ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./certs.sh")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("/11/04 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":21:17 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" generating a new CA key and certificate from CSR\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("/11/04 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":21:17 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" generate received request\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("/11/04 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":21:17 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" received CSR\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("/11/04 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":21:17 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" generating key: rsa-2048\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("/11/04 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":21:18 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" encoded CSR\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("/11/04 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":21:18 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" signed certificate with serial number "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("122465585755296665714458411579230792812069987507")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("/11/04 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":21:18 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" generate received request\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("/11/04 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":21:18 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" received CSR\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("/11/04 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":21:18 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" generating key: rsa-2048\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("/11/04 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":21:18 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" encoded CSR\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("/11/04 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":21:18 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" signed certificate with serial number "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("552651333045426922300417138573432468469848830218")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("/11/04 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":21:18 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("WARNING"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" This certificate lacks a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hosts"')]),s._v(" field. This makes it unsuitable "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v("\nwebsites. For "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("more")]),s._v(" information see the Baseline Requirements "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the Issuance and Management\nof Publicly-Trusted Certificates, v.1.1.6, from the CA/Browser Forum "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("https://cabforum.org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nspecifically, section "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),s._v(".3 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Information Requirements"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".\n")])])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("将证书文件保存到Secret kubectl create secret tls web-aliangedu-cn -- cert=web.aliangedu.cn.pem --key=web.aliangedu.cn-key.pem")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create secret tls web-aliangedu-cn --cert=web.aliangedu.cn.pem --key=web.aliangedu.cn-key.pem")]),s._v("\n")])])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("Ingress规则配置tls")])]),s._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat ingress.yaml")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.k8s.io/v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Ingress\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" aliangedu"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("https\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" web"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ns\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tls")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\t\t\t\t\t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#TLS配置")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\t\t\t\t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#tls里包含的主机列表")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" web.aliangedu.cn\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("secretName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" web"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("aliangedu"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cn\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#TLS通信的密码的名称")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rules")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" web.aliangedu.cn\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pathType")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Prefix\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("backend")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("service")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("number")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n              \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master work"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f ingress.yaml")]),s._v("\n")])])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("查看ingress，配置本机的域名映射就可以访问")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master work"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pods -A -o wide")]),s._v("\nNAMESPACE       NAME                                       READY   STATUS    RESTARTS   AGE   IP               NODE     NOMINATED NODE   READINESS GATES\ndefault         web-5b87848979-l6zjz                       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          9h    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".104.10    node2    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\ningress-nginx   nginx-ingress-controller-26w7m             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          17h   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.121    node2    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\ningress-nginx   nginx-ingress-controller-9bm8d             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          17h   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.120    node1    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n···\nweb-test-ns     nginx-6799fc88d8-6ccsk                     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          24m   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".104.11    node2    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master work"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get ingress -n web-test-ns")]),s._v("\nNAME              CLASS    HOSTS              ADDRESS   PORTS     AGE\naliangedu-https   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   web.aliangedu.cn             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("   24m\n")])])])])])])}),[],!1,null,null,null);t.default=e.exports}}]);