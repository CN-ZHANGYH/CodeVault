(window.webpackJsonp=window.webpackJsonp||[]).push([[194],{508:function(t,a,s){"use strict";s.r(a);var r=s(7),e=Object(r.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"制作windows-server2019-qcow2镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#制作windows-server2019-qcow2镜像"}},[t._v("#")]),t._v(" 制作Windows server2019 qcow2镜像")]),t._v(" "),a("h3",{attrs:{id:"利用vm环境制作该镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#利用vm环境制作该镜像"}},[t._v("#")]),t._v(" 利用VM环境制作该镜像")]),t._v(" "),a("h3",{attrs:{id:"_1-制作准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-制作准备"}},[t._v("#")]),t._v(" 1.制作准备")]),t._v(" "),a("blockquote",[a("ul",[a("li",[t._v("准备一个window_server2019.iso镜像")]),t._v(" "),a("li",[t._v("准备一个win10的virtio驱动 （这里我没有找到server2019的virtio驱动所以用的是win10的驱动）")]),t._v(" "),a("li",[t._v("准备好一个qcow2存储盘")])])]),t._v(" "),a("p",[t._v("提前将准备好的镜像放进一个新的目录中，然后需要用到该目录的路径。")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ls /root/")]),t._v("\ncn_windows_server_2019_updated_march_2019_x64_dvd_c1ffb46c.iso\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cd windows/ ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost windows"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# pwd")]),t._v("\n/root/windows\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost windows"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ls ")]),t._v("\nwindows_server2019.qcow2\n")])])]),a("h3",{attrs:{id:"_2-安装virtio"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-安装virtio"}},[t._v("#")]),t._v(" 2.安装virtio")]),t._v(" "),a("p",[t._v("因为linux本身并没有virtio驱动合适windows，所以需要借助windos10的virtio的驱动。不然安装系统的时候会报错，而且没有网络驱动模块。")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost windows"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#yum install -y https://fedorapeople.org/groups/virt/virtio-win/repo/stable/virtio-win-0.1.185-2.noarch.rpm")]),t._v("\n")])])]),a("h3",{attrs:{id:"_3-创建一个存储磁盘"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-创建一个存储磁盘"}},[t._v("#")]),t._v(" 3.创建一个存储磁盘")]),t._v(" "),a("p",[t._v("qemu-img的命令是创建qcow2镜像，可以当作系统盘或者是启动盘。")]),t._v(" "),a("p",[t._v("这里选择创建qcow2的类型，大小为40G。")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost windows"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# qemu-img create  -f qcow2 windows_server2019.qcow2 40G")]),t._v("\n")])])]),a("h3",{attrs:{id:"_4-创建一台windows-server2019的实例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-创建一台windows-server2019的实例"}},[t._v("#")]),t._v(" 4.创建一台windows_server2019的实例")]),t._v(" "),a("p",[t._v("使用virt-install命令创建")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost windows"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# virt-install  --name winserver2019       \\")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--ram")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4096")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--vcpus")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--arch")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("x86_64         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--network")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("network")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("default,model"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("virtio      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--cdrom")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/root/cn_windows_server_2019_updated_march_2019_x64_dvd_c1ffb46c.iso "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--disk")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/root/windows/windows_server2019.qcow2,format"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("qcow2,device"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("disk,bus"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("virtio   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--disk")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/share/virtio-win/virtio-win-0.1.185.iso      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--disk")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/share/virtio-win/virtio-win-0.1.185_amd64.vfd,device"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("floppy   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--graphics")]),t._v(" vnc,listen"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--video")]),t._v(" qxl "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--channel")]),t._v(" spicevmc       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --os-type windows --os-variant win2k19\n")])])]),a("p",[t._v("运行完命令之后会出现如下开始安装然后弹出窗口。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/cn-zhangyh/images/raw/master/202202091621230.png",alt:"img"}})]),t._v(" "),a("h3",{attrs:{id:"_5-加载驱动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-加载驱动"}},[t._v("#")]),t._v(" 5.加载驱动")]),t._v(" "),a("p",[t._v("创建完成之后进去装系统会遇到问题没有加载驱动，按照我的操作解决。")]),t._v(" "),a("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202205070145317.png",alt:"img"}}),t._v(" "),a("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202205070145284.png",alt:"img"}}),t._v(" "),a("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202205070145386.png",alt:"img"}}),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202205070145227.png",alt:"img"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202205070146089.png",alt:"img"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204111247182.png",alt:"img"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202205070146566.png",alt:"img"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202205070146516.png",alt:"img"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202205070146038.png",alt:"img"}})]),t._v(" "),a("h3",{attrs:{id:"_6-安装驱动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-安装驱动"}},[t._v("#")]),t._v(" 6.安装驱动")]),t._v(" "),a("p",[t._v("系统安装完成之后，需要安装以太网适配器（原本是坏的是需要安装）")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204111247141.png",alt:"img"}})]),t._v(" "),a("img",{staticStyle:{zoom:"80%"},attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202205070146077.png",alt:"img"}}),t._v(" "),a("p",[t._v("然后关机，保存退出。")]),t._v(" "),a("h3",{attrs:{id:"_7-查看当前的qcow2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-查看当前的qcow2"}},[t._v("#")]),t._v(" 7.查看当前的qcow2")]),t._v(" "),a("p",[t._v("可以发现这个镜像已经14GB，因为带有环境。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202205070146943.png",alt:"img"}})]),t._v(" "),a("h3",{attrs:{id:"_8-镜像压缩-压缩磁盘文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-镜像压缩-压缩磁盘文件"}},[t._v("#")]),t._v(" 8.镜像压缩（"),a("strong",[t._v("压缩磁盘文件")]),t._v("）")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost windows"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# virt-sparsify  --compress  /root/windows/windows_server2019.qcow2  /opt/windows_server2019.qcow2 ")]),t._v("\n")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);