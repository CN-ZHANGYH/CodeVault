(window.webpackJsonp=window.webpackJsonp||[]).push([[123],{437:function(s,t,a){"use strict";a.r(t);var e=a(7),n=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"ceph部署-14-2-0-nautilus版"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ceph部署-14-2-0-nautilus版"}},[s._v("#")]),s._v(" Ceph部署(14.2.0 nautilus版)")]),s._v(" "),t("h2",{attrs:{id:"ceph-介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ceph-介绍"}},[s._v("#")]),s._v(" Ceph 介绍")]),s._v(" "),t("p",[s._v("在过去几年中，数据存储需求急剧增长。研究表明，大型组织中的数据正以每年40%到60%的速度增 长，许多公司每年的数据都翻了一番。国际数据公司(IDC)的分析师估计，到2000年，全球共 有 54.4 exabytes 的数据。到2007年，这一数字达到 295 艾字节，到2020年，全球预计将 达到 44 zettabytes 。传统的存储系统无法管理这样的数据增长;我们需要一个像Ceph这样的系 统，它是 分布式的 ， 可扩展的 ，最重要的是，在经济上是可行的。Ceph是专门为处理当今 和 未来的数据存储 需求而设计的。")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("1ZB=1024EB 1EB=1024PB 1PB=1024TB\n")])])]),t("h2",{attrs:{id:"ceph安装-14-2-0-nautilus版"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ceph安装-14-2-0-nautilus版"}},[s._v("#")]),s._v(" Ceph安装(14.2.0 nautilus版)")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("主机名称")]),s._v(" "),t("th"),s._v(" "),t("th"),s._v(" "),t("th")])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("ceph1")]),s._v(" "),t("td",[s._v("192.168.0.20")]),s._v(" "),t("td",[s._v("OSD，MGR，MON")]),s._v(" "),t("td",[s._v("硬盘*3（CentOS7.6）")])]),s._v(" "),t("tr",[t("td",[s._v("ceph2")]),s._v(" "),t("td",[s._v("192.168.0.116")]),s._v(" "),t("td",[s._v("OSD，MGR")]),s._v(" "),t("td",[s._v("硬盘*3（CentOS7.6）")])]),s._v(" "),t("tr",[t("td",[s._v("ceph3")]),s._v(" "),t("td",[s._v("192.168.0.140")]),s._v(" "),t("td",[s._v("OSD，MGR")]),s._v(" "),t("td",[s._v("硬盘*3（CentOS7.6）")])])])]),s._v(" "),t("h3",{attrs:{id:"_1-安装epel源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装epel源"}},[s._v("#")]),s._v(" 1.安装epel源")]),s._v(" "),t("p",[t("code",[s._v("//集群所有节点选择一个安装版本即可")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" epel-release "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v("\n")])])]),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ivh")]),s._v(" http://mirrors.aliyun.com/ceph/rpm-luminous/el7/noarch/ceph-release-1-1.el7.noarch.rpm  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# L版本")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ivh")]),s._v(" http://mirrors.aliyun.com/ceph/rpm-mimic/el7/noarch/ceph-release-1-1.el7.noarch.rpm  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# M版本")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ivh")]),s._v(" http://mirrors.aliyun.com/ceph/rpm-nautilus/el7/noarch/ceph-release-1-1.el7.noarch.rpm  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# N版本 Ceph-CSI需要N版及以上版本")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ivh")]),s._v(" http://mirrors.aliyun.com/ceph/rpm-octopus/el7/noarch/ceph-release-1-1.el7.noarch.rpm  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# O版本")]),s._v("\n")])])]),t("h3",{attrs:{id:"_2-配置主机映射"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置主机映射"}},[s._v("#")]),s._v(" 2.配置主机映射")]),s._v(" "),t("p",[t("code",[s._v("//在所有的节点上面配置主机名称和主机映射")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# hostnamectl ")]),s._v("\n   Static hostname: ceph1\n         Icon name: computer-vm\n           Chassis: vm\n        Machine ID: de03a5f3bf5a4b7e9df939c9dc5b428d\n           Boot ID: f9e3a46fbd1a4512a1e4271efad386ec\n    Virtualization: kvm\n  Operating System: CentOS Linux "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Core"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n       CPE OS Name: cpe:/o:centos:centos:7\n            Kernel: Linux "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.10")]),s._v(".0-1160.15.2.el7.x86_64\n      Architecture: x86-64\n      \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/hosts ")]),s._v("\n::1     localhost       localhost.localdomain   localhost6      localhost6.localdomain6\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1       localhost       localhost.localdomain   localhost4      localhost4.localdomain4\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1       ceph-0001       ceph-0001\n \n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.20 ceph1 \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.116 ceph2 \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.140 ceph3 \n")])])]),t("h3",{attrs:{id:"_3-配置免密"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-配置免密"}},[s._v("#")]),s._v(" 3.配置免密")]),s._v(" "),t("p",[t("code",[s._v("//在控制节点上配置对所有机器的免密操作")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ssh-keygen ")]),s._v("\nGenerating public/private rsa key pair.\nEnter "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("which")]),s._v(" to save the key "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/root/.ssh/id_rsa"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": \n/root/.ssh/id_rsa already exists.\nOverwrite "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("y/n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("? y\nEnter passphrase "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("empty "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" no passphrase"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": \nEnter same passphrase again: \nYour identification has been saved "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" /root/.ssh/id_rsa.\nYour public key has been saved "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" /root/.ssh/id_rsa.pub.\nThe key fingerprint is:\nSHA256:V/E84SuSSepxM+tFvU8r0NzAcUq9XJsBkrzDEZVtE+Y root@ceph1\nThe key's randomart image is:\n+---"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("RSA "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("----+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("          .o"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("o*o."),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("           +.OoO."),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("          o * @EB"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("         o B "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" B "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("        S O * "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" + B + o "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" o "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" o."),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+----"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("SHA256"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("-----+\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ssh-copy-id ceph2 ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ssh-copy-id ceph3 ")]),s._v("\n")])])]),t("h3",{attrs:{id:"_4-管理节点安装部署工具并新建集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-管理节点安装部署工具并新建集群"}},[s._v("#")]),s._v(" 4.管理节点安装部署工具并新建集群")]),s._v(" "),t("p",[t("code",[s._v("//管理节点安装部署工具（以下步骤仅在管理节点执行即可）")])]),s._v(" "),t("p",[s._v("主要安装ceph-deploy工具，用来创建集群，在使用ceph-deploy命令报错的时候，需要用到几个python的依赖包，所以需要把依赖包安装上。")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum install ceph-deploy python-setuptools python2-subprocess32 ceph-common -y")]),s._v("\n")])])]),t("p",[s._v("新建集群指定Mon节点并生成ceph.conf和keyring")]),s._v(" "),t("p",[s._v("cluster-network用于集群内部通信为可选网络 生产环境应设置为其他私有网段地址")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir my-cluster ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd my-cluster ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph-deploy new ceph1 ceph2 ceph3 --cluster-network 192.168.0.0/24 --public-network 192.168.0.0/24")]),s._v("\n")])])]),t("h3",{attrs:{id:"_5-部署集群节点安装ceph"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-部署集群节点安装ceph"}},[s._v("#")]),s._v(" 5.部署集群节点安装Ceph")]),s._v(" "),t("p",[t("code",[s._v("//集群节点安装Ceph软件包（以下步骤仅在管理节点执行即可）")])]),s._v(" "),t("p",[s._v("同yum -y install ceph ceph-radosgw,这条命令相当于每个集群都要执行")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph-deploy install --no-adjust-repos ceph1 ceph2 ceph3")]),s._v("\n")])])]),t("h3",{attrs:{id:"_6-初始化mon节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-初始化mon节点"}},[s._v("#")]),s._v(" 6.初始化Mon节点")]),s._v(" "),t("p",[t("code",[s._v("//创建并初始化Mon节点，Mon进程监听在6789端口（以下步骤仅在管理节点执行即可）")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph-deploy mon create-initial")]),s._v("\n")])])]),t("p",[s._v("推送配置文件和admin秘钥到其他主机")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph-deploy admin ceph1 ceph2 ceph3")]),s._v("\n")])])]),t("p",[s._v("仅推送配置")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph-deploy config push ceph1 ceph2 ceph3")]),s._v("\n")])])]),t("h3",{attrs:{id:"_7-在目标主机部署mgr"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-在目标主机部署mgr"}},[s._v("#")]),s._v(" 7.在目标主机部署Mgr")]),s._v(" "),t("p",[t("code",[s._v("//从12版本开始之后都需要部署Mgr（以下步骤仅在管理节点执行即可）")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph-deploy mgr create ceph1 ceph2 ceph3")]),s._v("\n")])])]),t("h3",{attrs:{id:"_8-关闭不安全模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-关闭不安全模式"}},[s._v("#")]),s._v(" 8.关闭不安全模式")]),s._v(" "),t("p",[t("code",[s._v("//这时候查看集群的状态会报错，WRN并不是OK，是因为开启了安全模式（以下步骤仅在管理节点执行即可）")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看集群状态")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph -s")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 集群warnning处理")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mon is allowing insecure global_id reclaim")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph config set mon auth_allow_insecure_global_id_reclaim false")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Module 'restful' has failed dependency: No module named 'pecan'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pip3 install pecan werkzeug")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart ceph-mon.target")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart ceph-mgr.target")]),s._v("\n")])])]),t("h3",{attrs:{id:"_9-创建osd"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-创建osd"}},[s._v("#")]),s._v(" 9.创建OSD")]),s._v(" "),t("p",[t("code",[s._v("//创建9个OSD（以下步骤仅在管理节点执行即可）")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出集群节点上的所有可用磁盘")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph-deploy disk list ceph1 ceph2 ceph3")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 擦除集群节点上用来用作OSD设备的磁盘(disk zap)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生产环境下可以单独指定block-db和block-wal设备以优化性能")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# for dev in /dev/vdb /dev/vdc /dev/vdd")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ceph-deploy disk zap ceph1 "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$dev")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ceph-deploy osd create ceph1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--bluestore")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--data")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$dev")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ceph-deploy disk zap ceph2 "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$dev")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ceph-deploy osd create ceph2 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--bluestore")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--data")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$dev")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ceph-deploy disk zap ceph3 "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$dev")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ceph-deploy osd create ceph3 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--bluestore")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--data")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$dev")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v(" \n")])])]),t("h3",{attrs:{id:"_10-开启dashboard"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_10-开启dashboard"}},[s._v("#")]),s._v(" 10.开启Dashboard")]),s._v(" "),t("p",[t("code",[s._v("//查看Ceph版本，nautilus版及以后需要在所有运行mgr的节点安装ceph-mgr-dashboard")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph mgr versions")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum install -y ceph-mgr-dashboard")]),s._v("\n")])])]),t("p",[s._v("查看MGR模块和帮助信息")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph mgr module --help")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph mgr module ls")]),s._v("\n")])])]),t("p",[s._v("启用或禁用MGR dashboard模块")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph mgr module enable dashboard")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph mgr module disable dashboard")]),s._v("\n")])])]),t("p",[s._v("创建自签名证书或者禁用ssl")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph dashboard create-self-signed-cert")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph config set mgr mgr/dashboard/ssl false")]),s._v("\n")])])]),t("p",[s._v("设置MGR dashboard模块的ip和port(可选)")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph config set mgr mgr/dashboard/server_addr 0.0.0.0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph config set mgr mgr/dashboard/server_port 8443")]),s._v("\n")])])]),t("p",[s._v("设置登录认证")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# echo "1" > password.txt')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph dashboard ac-user-create admin -i password.txt administrator")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph dashboard ac-user-show admin")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart ceph-mgr.target")]),s._v("\n")])])]),t("p",[s._v("列出MGR模块提供的服务端点")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph mgr services")]),s._v("\n")])])]),t("p",[s._v("开启对象网关管理功能")]),s._v(" "),t("p",[s._v("创建rgw用户")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("[root@ceph1 ~]# radosgw-admin user create --uid=<value> --display-name=<value>\n")])])]),t("p",[s._v("配置对象网关认证")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph dashboard set-rgw-api-access-key $access_key")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph dashboard set-rgw-api-secret-key $secret_key")]),s._v("\n")])])]),t("p",[s._v("配置对象网关主机名和端口")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph dashboard set-rgw-api-host <value>")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph dashboard set-rgw-api-port <int>")]),s._v("\n")])])]),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"https://i.bmp.ovh/imgs/2022/02/a86d7dc906dc25a6.png"}}),s._v(" "),t("h3",{attrs:{id:"_11-配置客户端"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_11-配置客户端"}},[s._v("#")]),s._v(" 11.配置客户端")]),s._v(" "),t("p",[s._v("客户端上操作：")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@client ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum -y install centos-release-ceph-nautilus.noarch")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@client ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum -y install ceph-common")]),s._v("\n")])])]),t("h3",{attrs:{id:"_12-在ceph的服务端配置密钥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_12-在ceph的服务端配置密钥"}},[s._v("#")]),s._v(" 12.在ceph的服务端配置密钥：")]),s._v(" "),t("p",[t("code",[s._v("//创建用户（以下步骤仅在管理节点执行即可）")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ceph"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph auth get-or-create client.rbdtest mon 'allow r' osd 'allow class-read object_prefix rbd_children,allow rwx pool=rbd' | tee /etc/ceph/ceph.client.rbdtest.keyring")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ceph"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat ceph.conf ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("global"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nfsid "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 235b6c2c-91c6-4535-b5aa-9337e934ed56\npublic_network "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.0/24\ncluster_network "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.0/24\nmon_initial_members "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ceph1, ceph2, ceph3\nmon_host "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.203,192.168.0.226,192.168.0.172\nauth_cluster_required "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" cephx\nauth_service_required "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" cephx\nauth_client_required "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" cephx\nrbd_default_features "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" \n")])])]),t("p",[t("code",[s._v("//将密钥传输到客户端中（以下步骤仅在管理节点执行即可）")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ceph"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# scp  ceph.client.rbdtest.keyring  root@192.168.0.51:/etc/ceph/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ceph"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# scp  ceph.conf  root@192.168.0.51:/etc/ceph/   ")]),s._v("\n")])])]),t("h3",{attrs:{id:"_13-客户端验证密钥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_13-客户端验证密钥"}},[s._v("#")]),s._v(" 13.客户端验证密钥")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@client ceph"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph -s --name client.rbdtest")]),s._v("\n  cluster:\n    id:     235b6c2c-91c6-4535-b5aa-9337e934ed56\n    health: HEALTH_OK\n \n  services:\n    mon: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" daemons, quorum ceph3,ceph1,ceph2 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("age 8m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    mgr: ceph1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("active, since 8m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", standbys: ceph3, ceph2\n    osd: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" osds: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" up "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("since 2h"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("since 2h"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n \n  data:\n    pools:   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" pools, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" pgs\n    objects: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" objects, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" MiB\n    usage:   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9.1")]),s._v(" GiB used, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("171")]),s._v(" GiB / "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("180")]),s._v(" GiB avail\n    pgs:     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" active+clean\n")])])]),t("blockquote",[t("h3",{attrs:{id:"错误解决"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#错误解决"}},[s._v("#")]),s._v(" 错误解决")])]),s._v(" "),t("p",[s._v("遇到一个错误是，检查ceph的集群健康的时候出现WARN的错误，检查健康发现需要在’sata-pool’上开启应用授权（这里的 rbd 是我们手动建的 pool）")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ceph"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph -s ")]),s._v("\n  cluster:\n    id:     235b6c2c-91c6-4535-b5aa-9337e934ed56\n    health: HEALTH_WARN\n            application not enabled on "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" pool"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n \n  services:\n    mon: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" daemons, quorum ceph3,ceph1,ceph2 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("age 2h"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    mgr: ceph1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("active, since 110m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", standbys: ceph3, ceph2\n    osd: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" osds: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" up "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("since 115m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("since 115m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n \n  data:\n    pools:   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" pools, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" pgs\n    objects: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" objects, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" MiB\n    usage:   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9.1")]),s._v(" GiB used, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("171")]),s._v(" GiB / "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("180")]),s._v(" GiB avail\n    pgs:     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" active+clean\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ceph"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph health")]),s._v("\nHEALTH_WARN application not enabled on "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" pool"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph health detail")]),s._v("\nHEALTH_WARN application not enabled on "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" pool"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nPOOL_APP_NOT_ENABLED application not enabled on "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" pool"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    application not enabled on pool "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rbd'")]),s._v("\n    use "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ceph osd pool application enable <pool-name> <app-name>'")]),s._v(", where "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("app-name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" is "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cephfs'")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rbd'")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rgw'")]),s._v(", or freeform "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" custom applications.\n")])])]),t("p",[s._v("通过开启应用授权")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph osd pool application enable rbd rbd")]),s._v("\n  abled application "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rbd'")]),s._v(" on pool "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rbd'")]),s._v("\n")])])]),t("p",[s._v("然后再看 dashboard ，已经没有报错了，而且block 也能识别到了。\n这里我们使用了rbd（块设备），pool 只能对一种类型进行 enable，另外两种类型是cephfs（文件系统），rgw（对象存储）")])])}),[],!1,null,null,null);t.default=n.exports}}]);