(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{342:function(s,t,a){"use strict";a.r(t);var n=a(7),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"容器化部署django博客"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#容器化部署django博客"}},[s._v("#")]),s._v(" 容器化部署Django博客")]),s._v(" "),t("h2",{attrs:{id:"案例分析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#案例分析"}},[s._v("#")]),s._v(" 案例分析")]),s._v(" "),t("h4",{attrs:{id:"_1-规划节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-规划节点"}},[s._v("#")]),s._v(" 1. 规划节点")]),s._v(" "),t("p",[s._v("节点规划，见表1。")]),s._v(" "),t("p",[s._v("表1 节点规划")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"left"}},[s._v("IP")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("主机名")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("节点")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("10.24.2.17")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("master")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("docker-compose节点")])])])]),s._v(" "),t("h4",{attrs:{id:"_2-基础准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-基础准备"}},[s._v("#")]),s._v(" 2. 基础准备")]),s._v(" "),t("p",[s._v("Docker和Docker Compose已安装完成，将提供的软件包DjangoBlog.tar.gz上传至master节点/root目录下并解压。")]),s._v(" "),t("h2",{attrs:{id:"案例实施"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#案例实施"}},[s._v("#")]),s._v(" 案例实施")]),s._v(" "),t("h4",{attrs:{id:"_1-基础环境准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-基础环境准备"}},[s._v("#")]),s._v(" 1. 基础环境准备")]),s._v(" "),t("h5",{attrs:{id:"_1-导入软件包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-导入软件包"}},[s._v("#")]),s._v(" （1）导入软件包")]),s._v(" "),t("p",[s._v("下载并解压软件包：")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wget http://mirrors.douxuedu.com/competition/DjangoBlog.tar.gz")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tar -xf DjangoBlog.tar.gz")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll DjangoBlog")]),s._v("\ntotal "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("229260")]),s._v("\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" root root       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("219")]),s._v(" Jan "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" 01:48 accounts\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" root root        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v(" Jan "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" 01:48 bin\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" root root       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("301")]),s._v(" Jan "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" 01:49 blog\n-rw------- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("211696640")]),s._v(" Jan "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":49 CentOS_7.9.2009.tar\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" root root       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("105")]),s._v(" Jan "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" 01:50 collectedstatic\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" root root       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("190")]),s._v(" Jan "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" 01:50 comments\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root root       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("292")]),s._v(" Jan "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" 01:50 djangoblog\n-rw-r--r-- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("808")]),s._v(" Jan  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":34 manage.py\n-rw-r--r-- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1090")]),s._v(" Jan  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" 09:58 nginx.conf\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" root root       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("197")]),s._v(" Jan "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" 01:50 oauth\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" root root       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("138")]),s._v(" Jan "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" 01:50 owntracks\n-rw-r--r-- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22994617")]),s._v(" Jan  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":35 Python-3.6.5.tgz\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root root      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Jan "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" 01:50 Python-pip\n-rw-r--r-- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("493")]),s._v(" Jan  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":35 requirements.txt\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" root root       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("191")]),s._v(" Jan "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" 01:50 servermanager\n-rw-r--r-- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32061")]),s._v(" Jan "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" 00:40 sqlfile.sql\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" root root       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("113")]),s._v(" Jan "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" 01:50 templates\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" root root     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),s._v(" Jan "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" 01:52 yum\n")])])]),t("p",[s._v("导入CentOS:7.9.2009镜像：")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker load -i DjangoBlog/CentOS_7.9.2009.tar ")]),s._v("\nLoaded image: centos:centos7.9.2009\n")])])]),t("h5",{attrs:{id:"_2-启动kubernetes集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-启动kubernetes集群"}},[s._v("#")]),s._v(" （2）启动Kubernetes集群")]),s._v(" "),t("p",[s._v("初始化Kubernetes集群：")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# init-cluster")]),s._v("\n")])])]),t("p",[s._v("查看集群状态：")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl cluster-info")]),s._v("\nKubernetes control plane is running at https://apiserver.cluster.local:6443\nCoreDNS is running at https://apiserver.cluster.local:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy\n\nTo further debug and diagnose cluster problems, use "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'kubectl cluster-info dump'")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])])]),t("h4",{attrs:{id:"_2-容器化部署memcached"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-容器化部署memcached"}},[s._v("#")]),s._v(" 2. 容器化部署Memcached")]),s._v(" "),t("h5",{attrs:{id:"_1-编写dockerfile"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-编写dockerfile"}},[s._v("#")]),s._v(" （1）编写Dockerfile")]),s._v(" "),t("p",[s._v("编写yum源配置文件：")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd DjangoBlog/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master DjangoBlog"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vi local.repo ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("yum"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yum\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("baseurl")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("file:///root/yum\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gpgcheck")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("enabled")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])])]),t("p",[s._v("编写Dockerfile：")]),s._v(" "),t("div",{staticClass:"language-dockerfile extra-class"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[s._v("[root@master DjangoBlog]# vi Dockerfile-memcached\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" centos:centos7.9.2009")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("MAINTAINER")]),s._v(" Chinaskills")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" rm -rf /etc/yum.repos.d/*")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" local.repo /etc/yum.repos.d/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" yum /root/yum")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" yum install libevent libevent-devel -y")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" yum install memcached -y")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 11211")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENTRYPOINT")]),s._v(" /usr/bin/memcached -u root")]),s._v("\n")])])]),t("h5",{attrs:{id:"_2-构建镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-构建镜像"}},[s._v("#")]),s._v(" （2）构建镜像")]),s._v(" "),t("p",[s._v("构建镜像：")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master DjangoBlog"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker build -t blog-memcached:v1.0 -f Dockerfile-memcached .")]),s._v("\nSending build context to Docker daemon    606MB\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/9 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" FROM centos:centos7.9.2009\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" eeb6ee3f44bd\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/9 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" MAINTAINER Chinaskills\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 815a4a5f2242\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("/9 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" RUN "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rf")]),s._v(" /etc/yum.repos.d/*\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 6afa0315cb5b\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("/9 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" COPY local.repo /etc/yum.repos.d/\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("140618900604")]),s._v("\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("/9 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" COPY yum /root/yum\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ad30591b1d15\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("/9 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" RUN yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" libevent libevent-devel "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v("\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 8299be2cb3bf\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("/9 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" RUN yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" memcached "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v("\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 439f91db606c\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("/9 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" EXPOSE "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11211")]),s._v("\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" c56ab6056bac\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("/9 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" ENTRYPOINT /usr/bin/memcached "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" root\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 9945bb68cac2\nSuccessfully built 9945bb68cac2\nSuccessfully tagged blog-memcached:v1.0\n")])])]),t("h4",{attrs:{id:"_3-容器化部署mariadb"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-容器化部署mariadb"}},[s._v("#")]),s._v(" 3. 容器化部署MariaDB")]),s._v(" "),t("h5",{attrs:{id:"_1-编写dockerfile-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-编写dockerfile-2"}},[s._v("#")]),s._v(" （1）编写Dockerfile")]),s._v(" "),t("p",[s._v("编写数据库初始化脚本：")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master DjangoBlog"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vi mysql_init.sh ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/bin/bash")]),s._v("\nmysql_install_db "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--user")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root\nmysqld_safe "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--user")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\nmysqladmin "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" root password "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'root'")]),s._v("\nmysql "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-uroot")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-proot")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"grant all on *.* to 'root'@'%' identified by 'root';flush privileges;\"")]),s._v("\nmysql "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-uroot")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-proot")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"create database djangoblog;use djangoblog;source /opt/sqlfile.sql;"')]),s._v("\n")])])]),t("p",[s._v("编写Dockerfile文件：")]),s._v(" "),t("div",{staticClass:"language-dockerfile extra-class"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[s._v("[root@master DjangoBlog]# vi Dockerfile-mariadb \n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" centos:centos7.9.2009")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("MAINTAINER")]),s._v(" Chinaskills")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" rm -rf /etc/yum.repos.d/*")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" local.repo /etc/yum.repos.d/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" yum /root/yum")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" LC_ALL en_US.UTF-8")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" yum -y install mariadb-server")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" mysql_init.sh /opt/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" sqlfile.sql /opt")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" bash /opt/mysql_init.sh")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 3306")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" ["),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mysqld_safe"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--user=root"')]),s._v("]")]),s._v("\n")])])]),t("h5",{attrs:{id:"_2-构建镜像-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-构建镜像-2"}},[s._v("#")]),s._v(" （2）构建镜像")]),s._v(" "),t("p",[s._v("构建镜像：")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master DjangoBlog"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker build -t blog-mysql:v1.0 -f Dockerfile-mariadb .")]),s._v("\nSending build context to Docker daemon    606MB\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/12 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" FROM centos:centos7.9.2009\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" eeb6ee3f44bd\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/12 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" MAINTAINER Chinaskills\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 815a4a5f2242\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("/12 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" RUN "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rf")]),s._v(" /etc/yum.repos.d/*\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 6afa0315cb5b\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("/12 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" COPY local.repo /etc/yum.repos.d/\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("140618900604")]),s._v("\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("/12 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" COPY yum /root/yum\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ad30591b1d15\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("/12 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" ENV "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("LC_ALL")]),s._v(" en_US.UTF-8\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 026865489eec\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("/12 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" RUN yum "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" mariadb-server\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" c691328d736e\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("/12 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" COPY mysql_init.sh /opt/\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 34b4926a933f\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("/12 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" COPY sqlfile.sql /opt\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ad9022ea65b5\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("/12 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" RUN "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v(" /opt/mysql_init.sh\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" c5aee98993f5\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("/12 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" EXPOSE "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 0a4e28e2bcdb\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("/12 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" CMD "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mysqld_safe"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--user=root"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 387f6dcb21bb\nSuccessfully built 387f6dcb21bb\nSuccessfully tagged blog-mysql:v1.0\n")])])]),t("h4",{attrs:{id:"_4-容器化部署前端服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-容器化部署前端服务"}},[s._v("#")]),s._v(" 4. 容器化部署前端服务")]),s._v(" "),t("h5",{attrs:{id:"_1-编写dockerfile-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-编写dockerfile-3"}},[s._v("#")]),s._v(" （1）编写Dockerfile")]),s._v(" "),t("p",[s._v("编写Dockerfile:")]),s._v(" "),t("div",{staticClass:"language-dockerfile extra-class"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[s._v("[root@master DjangoBlog]# vi Dockerfile-nginx \n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" centos:centos7.9.2009")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("MAINTAINER")]),s._v(" Chinaskills")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" rm -rf /etc/yum.repos.d/*")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" local.repo /etc/yum.repos.d/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" yum /root/yum")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" yum -y install nginx")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" nginx.conf /etc/nginx/nginx.conf")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 80")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" ["),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-g"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"daemon off;"')]),s._v("]")]),s._v("\n")])])]),t("h5",{attrs:{id:"_2-构建镜像-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-构建镜像-3"}},[s._v("#")]),s._v(" （2）构建镜像")]),s._v(" "),t("p",[s._v("构建镜像：")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master DjangoBlog"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker build -t blog-nginx:v1.0 -f Dockerfile-nginx .")]),s._v("\nSending build context to Docker daemon    602MB\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/10 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" FROM centos:centos7.9.2009\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" eeb6ee3f44bd\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/10 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" MAINTAINER Chinaskills\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 815a4a5f2242\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("/10 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" RUN "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rf")]),s._v(" /etc/yum.repos.d/*\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 6afa0315cb5b\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("/10 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" COPY local.repo /etc/yum.repos.d/\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("140618900604")]),s._v("\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("/10 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" COPY yum /root/yum\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ad30591b1d15\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("/10 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" RUN yum "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" nginx\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 3bc6b5e4df75\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("/10 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" ADD nginx.conf /etc/nginx/nginx.conf\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" fb38e7925da7\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("/10 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" RUN /bin/bash "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'echo init ok'")]),s._v("\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ee92e1773b71\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("/10 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" EXPOSE "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 2decccbccd9c\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("/10 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" CMD "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-g"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"daemon off;"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 5d7be5d9469e\nSuccessfully built 5d7be5d9469e\nSuccessfully tagged blog-nginx:v1.0\n")])])]),t("h4",{attrs:{id:"_5-容器化部署博客系统"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-容器化部署博客系统"}},[s._v("#")]),s._v(" 5. 容器化部署博客系统")]),s._v(" "),t("h5",{attrs:{id:"_1-编写dockerfile-4"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-编写dockerfile-4"}},[s._v("#")]),s._v(" （1）编写Dockerfile")]),s._v(" "),t("p",[s._v("编写Dockerfile")]),s._v(" "),t("div",{staticClass:"language-dockerfile extra-class"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[s._v("[root@master DjangoBlog]# vi Dockerfile-blog\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" centos:centos7.9.2009")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("MAINTAINER")]),s._v(" Chinaskills")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" rm -rfv /etc/yum.repos.d/*")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" local.repo /etc/yum.repos.d/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" yum /root/yum")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" yum install -y make openssl-devel bzip2-devel expat-devel gdbm-devel readline-devel sqlite-devel gcc gcc-devel python-devel mysql-devel")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" Python-3.6.5.tgz /usr/local")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" cd /usr/local/Python-3.6.5/ && ./configure && make && make install "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    && ln -s /usr/local/python3/bin/python3 /usr/bin/python3 \\ ")]),s._v("\n    && ln -s /usr/local/python3/bin/pip3 /usr/bin/pip3\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" requirements.txt requirements.txt")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" Python-pip /opt")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" pip3 install --upgrade pip --no-index --find-links=/opt \\ ")]),s._v("\n    &&  pip3 install -r requirements.txt --no-index --find-links=/opt \\ \n    &&  pip3 install gunicorn[gevent] --no-index --find-links=/opt \\ \n    &&  pip3 cache purge \\ \n    &&  mkdir -p /code/djangoBlog\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" . /code/djangoBlog/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" chmod +x /code/djangoBlog/bin/docker_start.sh")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENTRYPOINT")]),s._v(" ["),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/code/djangoBlog/bin/docker_start.sh"')]),s._v("]")]),s._v("\n")])])]),t("h5",{attrs:{id:"_2-构建镜像-4"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-构建镜像-4"}},[s._v("#")]),s._v(" （2）构建镜像")]),s._v(" "),t("p",[s._v("构建镜像：")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master DjangoBlog"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker build -t blog-service:v1.0 -f Dockerfile-blog .")]),s._v("\nSending build context to Docker daemon  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("813")]),s._v(".6MB\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/22 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" FROM centos:centos7.9.2009\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" eeb6ee3f44bd\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/22 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" MAINTAINER Chinaskills\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 815a4a5f2242\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("/22 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" RUN "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rfv")]),s._v(" /etc/yum.repos.d/*\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" df5e97651f07\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("/22 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" COPY local.repo /etc/yum.repos.d/\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 5298caa9d188\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("/22 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" COPY yum /root/yum\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 14dfec50f5fe\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("/22 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" RUN yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" openssl-devel bzip2-devel expat-devel gdbm-devel readline-devel sqlite-devel gcc gcc-devel python-devel mysql-devel\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 353a069506ac\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("/22 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" COPY Python-3.6.5.tgz /opt\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 40c96717fe6e\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("/22 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" RUN "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-zxvf")]),s._v(" /opt/Python-3.6.5.tgz\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 4ef942409499\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("/22 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" RUN "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" Python-3.6.5 /usr/local\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" efd5b09e9357\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("/22 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" RUN "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/Python-3.6.5/ "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" ./configure "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" e2e5e2a6655e\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("/22 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" RUN "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" /usr/local/python3/bin/python3 /usr/bin/python3\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 5f8b69775493\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("/22 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" RUN "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" /usr/local/python3/bin/pip3 /usr/bin/pip3\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 67d7f52d161b\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("/22 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" ADD requirements.txt requirements.txt\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" f97574de7b0d\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v("/22 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" COPY Python-pip /opt\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 951fc0487f4a\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("/22 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" RUN pip3 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--upgrade")]),s._v(" pip --no-index --find-links"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/opt\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 04d166c02033\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("/22 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" RUN pip3 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),s._v(" requirements.txt --no-index --find-links"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/opt\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" b2cf9dc57d52\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v("/22 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" RUN pip3 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" gunicorn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("gevent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" --no-index --find-links"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/opt\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 56116a3d4c59\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("/22 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" RUN pip3 cache purge\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 65be1f06e0fb\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v("/22 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" RUN "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /code/djangoBlog\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 92634eb552ee\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("/22 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" ADD "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" /code/djangoBlog/\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 94cbf96a41cf\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v("/22 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" RUN "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x /code/djangoBlog/bin/docker_start.sh\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 1c263f74eff1\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("/22 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" ENTRYPOINT "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/code/djangoBlog/bin/docker_start.sh"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 21355b648ae1\nSuccessfully built 21355b648ae1\nSuccessfully tagged blog-service:v1.0\n")])])]),t("h4",{attrs:{id:"_6-编排部署djangoblog"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-编排部署djangoblog"}},[s._v("#")]),s._v(" 6. 编排部署DjangoBlog")]),s._v(" "),t("h5",{attrs:{id:"_1-编写docker-compose-yaml"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-编写docker-compose-yaml"}},[s._v("#")]),s._v(" （1）编写docker-compose.yaml")]),s._v(" "),t("p",[s._v("编写docker-compose.yaml编排文件：")]),s._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("master"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node1 DjangoBlog"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vi docker-compose.yaml ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("memcached")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" always\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" blog"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("memcached"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("v1.0\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" blog"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("memcached\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"11211:11211"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("db")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" blog"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("mysql"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("v1.0\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" always\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" MYSQL_DATABASE=djangoblog\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" MYSQL_ROOT_PASSWORD=root\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 3306"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("depends_on")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" memcached\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" blog"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("mysql\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("djangoblog")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" blog"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("service"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("v1.0\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" always\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8000:8000"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" DJANGO_MYSQL_DATABASE=djangoblog\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" DJANGO_MYSQL_USER=root\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" DJANGO_MYSQL_PASSWORD=root\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" DJANGO_MYSQL_HOST=db\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" DJANGO_MYSQL_PORT=3306\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" DJANGO_MEMCACHED_LOCATION=memcached"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11211")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ./collectedstatic"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/code/djangoBlog/collectedstatic\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("links")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" db\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" memcached\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("depends_on")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" db\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" blog"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("service\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nginx")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" always\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" blog"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("nginx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("v1.0\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ./collectedstatic"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/code/djangoblog/collectedstatic\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8888:80"')]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"443:443"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("links")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" djangoblog"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("djangoblog\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" blog"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("nginx\n")])])]),t("h5",{attrs:{id:"_2-部署服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-部署服务"}},[s._v("#")]),s._v(" （2）部署服务")]),s._v(" "),t("p",[s._v("部署服务：")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master-node1 DjangoBlog"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker-compose up -d")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("+"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Running "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("/5\n ⠿ Network djangoblog_default   Created                          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(".2s\n ⠿ Container blog-memcached    Started                           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".9s\n ⠿ Container blog-mysql         Started                           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".3s\n ⠿ Container blog-service        Started                           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(".7s\n ⠿ Container blog-nginx         Started                            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(".4s\n \n \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master DjangoBlog"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker-compose ps ")]),s._v("\nNAME                COMMAND                  SERVICE             STATUS              PORTS\nblog-memcached      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/sh -c \'/usr/bi…"')]),s._v("   memcached           running             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:11211-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11211")]),s._v("/tcp, :::11211-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11211")]),s._v("/tcp\nblog-mysql          "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mysqld_safe --user=…"')]),s._v("   db                  running             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:3306-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("/tcp, :::3306-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("/tcp\nblog-nginx          "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx -g \'daemon of…"')]),s._v("   nginx               running             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:8888-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/tcp, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:443-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("/tcp, :::8888-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/tcp, :::443-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("/tcp\nblog-service        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/code/djangoBlog/bi…"')]),s._v("   djangoblog          running             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:8000-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),s._v("/tcp, :::8000-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),s._v("/tcp\n")])])]),t("p",[s._v("查看服务：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202205080952758.png",alt:"图1.png"}}),s._v("\n图1")]),s._v(" "),t("p",[s._v("在浏览器上通过http://IP:8888访问服务，如图所示：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202205080952071.png",alt:"图2.png"}}),s._v("\n图2")]),s._v(" "),t("p",[s._v("登录系统（admin/123456），如图所示：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202205080952119.png",alt:"图3.png"}}),s._v("\n图3")]),s._v(" "),t("p",[s._v("点击“管理站点”，如图所示：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202205080952425.png",alt:"图4.png"}})])])}),[],!1,null,null,null);t.default=e.exports}}]);