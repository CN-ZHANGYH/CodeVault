(window.webpackJsonp=window.webpackJsonp||[]).push([[117],{431:function(s,t,a){"use strict";a.r(t);var e=a(7),n=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"nginx相关概念"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx相关概念"}},[s._v("#")]),s._v(" Nginx相关概念")]),s._v(" "),t("h2",{attrs:{id:"nginx的基本内容"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx的基本内容"}},[s._v("#")]),s._v(" Nginx的基本内容")]),s._v(" "),t("h3",{attrs:{id:"_1、nginx基本概念"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、nginx基本概念"}},[s._v("#")]),s._v(" 1、nginx基本概念")]),s._v(" "),t("p",[s._v("（1）nginx是什么？做什么事情？")]),s._v(" "),t("p",[s._v("（2）反向代理")]),s._v(" "),t("p",[s._v("（3）负载均衡")]),s._v(" "),t("p",[s._v("（4）动静分离")]),s._v(" "),t("h3",{attrs:{id:"_2、nginx安装、常用命令和配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、nginx安装、常用命令和配置"}},[s._v("#")]),s._v(" 2、nginx安装、常用命令和配置")]),s._v(" "),t("p",[s._v("（1）在linux系统中的安装nginx")]),s._v(" "),t("p",[s._v("（2）nginx常用的命令")]),s._v(" "),t("p",[s._v("（3）nginx配置文件")]),s._v(" "),t("h2",{attrs:{id:"nginx简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx简介"}},[s._v("#")]),s._v(" Nginx简介")]),s._v(" "),t("h3",{attrs:{id:"什么是nginx"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#什么是nginx"}},[s._v("#")]),s._v(" 什么是nginx？")]),s._v(" "),t("ul",[t("li",[s._v("Nginx (engine x)是一个高性能的HTTP和反向代理web服务器，同时也提供了IMAP/POP3/SMTP（邮件）服务。Nginx是由伊戈尔·赛索耶夫为俄罗斯访问量第二的Rambler.ru站点（俄文：Pam6Πep）开发的，第一个公开的版本0.1.0发布于2004年6月1日。2011年6月1日，nginx 1.0.4发布。")]),s._v(" "),t("li",[s._v("其特点是占有内存少，并发能力强，事实上nginx的并发能力在同类型的网页服务器中表现较好，中国大陆使用nginx网站用户有：百度、京东、新浪、网页等。在全球活跃的网站中有12.18%的使用比例，大约为2220万个网站。")]),s._v(" "),t("li",[s._v("Nginx是一个安装非常简单、配置文件非常简洁（且能支持perl语法）、Bug非常少的服务。Nginx 启动特别容易，并且几乎可以做到7*24不间断运行，即使运行数个月也不需要重新启动。你还能不间断服务的情况下进行软件版本的升级。")]),s._v(" "),t("li",[s._v("nginx的代码是完全使用C语言开发。官方数据测试表明能够支持高达 50,000 个并发连接数的响应。")])]),s._v(" "),t("h3",{attrs:{id:"nginx作用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx作用"}},[s._v("#")]),s._v(" Nginx作用？")]),s._v(" "),t("blockquote",[t("p",[s._v("Http代理，反向代理：作为web服务器最常用的功能之一，尤其是方向代理。")])]),s._v(" "),t("p",[s._v("正向代理：代理客户端")]),s._v(" "),t("p",[s._v("正向代理类似一个跳板机，代理访问外部资源\n比如我们国内访问谷歌，直接访问访问不到，我们可以通过一个正向代理服务器，请求发到代理服，代理服务器能够访问谷歌，这样由代理去谷歌取到返回数据，再返回给我们，这样我们就能访问谷歌了")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2022/01/20/kuangstudya55c98f3-6b82-4258-85b4-7e6e2828145c.png",alt:"img"}})]),s._v(" "),t("p",[s._v("正向代理的用途：")]),s._v(" "),t("p",[t("code",[s._v("（1）访问原来无法访问的资源，如google")])]),s._v(" "),t("p",[t("code",[s._v("(2) 可以做缓存，加速访问资源")])]),s._v(" "),t("p",[t("code",[s._v("（3）对客户端访问授权，上网进行认证")])]),s._v(" "),t("p",[t("code",[s._v("（4）代理可以记录用户访问记录（上网行为管理），对外隐藏用户信息")])]),s._v(" "),t("p",[s._v("反向代理：代理服务器")]),s._v(" "),t("p",[s._v("反向代理（Reverse Proxy）实际运行方式是指以代理服务器来接受internet上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给internet上请求连接的客户端，此时代理服务器对外就表现为一个服务器")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2022/01/20/kuangstudyf01094d0-2478-4d36-a90a-990a4c6f2239.png",alt:"img"}})]),s._v(" "),t("p",[s._v("反向代理的作用：")]),s._v(" "),t("p",[t("code",[s._v("（1）保证内网的安全，阻止web攻击，大型网站，通常将反向代理作为公网访问地址，Web服务器是内网")]),s._v(" "),t("code",[s._v("（2）负载均衡，通过反向代理服务器来优化网站的负载")])]),s._v(" "),t("blockquote",[t("p",[s._v("一句话总结正向代理与方向代理的区别：")]),s._v(" "),t("p",[s._v("Nginx提供的负载均衡策略有两种：内置策略和拓展策略。内置策略为轮询，Ip hash。拓展策略，就天马行空没有你想不到，没有他做不到。")])]),s._v(" "),t("h3",{attrs:{id:"轮询"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#轮询"}},[s._v("#")]),s._v(" 轮询")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2022/01/20/kuangstudy9c1a924a-a6ad-4258-9034-7a9870842ba7.png",alt:"img"}})]),s._v(" "),t("p",[s._v("加权轮询")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2022/01/20/kuangstudy8d0e8d9a-ea56-4613-9564-f8e674035d19.png",alt:"img"}})]),s._v(" "),t("p",[s._v("iphash 对客户端请求的ip进行hash操作，然后根据hash结果来将同一个客户端的ip请求分发给同一台服务器进行处理，可以解决session不共享的问题。（redis也能实现，也推荐使用redis）")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2022/01/20/kuangstudy0238cd37-ade9-42a7-a9aa-5babc0238a7a.png",alt:"img"}})]),s._v(" "),t("p",[s._v("动静分离，在我们的软件开发中，有一些请求需要后台处理，有些请求不需要经过后台处理的（如：css、html、jsp、js等等文件），这些不需要经过后台处理的文件称之为静态文件。让动态网站里的动态网页根据一定规则把不变的资源和经常变的资源区分开来，动静资源做好了拆分以后，我们就可以根据静态资源的特点将其做缓存操作。提高资源响应的速度。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2022/01/20/kuangstudy12cda839-fead-4295-8884-ee3430e10319.png",alt:"img"}})]),s._v(" "),t("p",[s._v("目前，通过使用nginx大大提高了我们网站的响应速度，优化了用户体验，让网站的健壮更上一层楼！")]),s._v(" "),t("h2",{attrs:{id:"linux安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#linux安装"}},[s._v("#")]),s._v(" Linux安装")]),s._v(" "),t("h3",{attrs:{id:"_1、下载nginx"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、下载nginx"}},[s._v("#")]),s._v(" 1、下载nginx")]),s._v(" "),t("p",[s._v("http://nginx.org/en/download.html 下载稳定版")]),s._v(" "),t("h3",{attrs:{id:"_2、上传到linux"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、上传到linux"}},[s._v("#")]),s._v(" 2、上传到linux")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2022/01/20/kuangstudy08066f90-adae-48d3-9afe-9b001bc080df.png",alt:"img"}})]),s._v(" "),t("h3",{attrs:{id:"_3、解压nginx"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、解压nginx"}},[s._v("#")]),s._v(" 3、解压nginx")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost nginx-1.20.2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tar -zxvf nginx-1.20.2.tar.gz")]),s._v("\n")])])]),t("h3",{attrs:{id:"_4、配置configure"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、配置configure"}},[s._v("#")]),s._v(" 4、配置configure")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost nginx-1.20.2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./configure --prefix=/usr/local/nginx")]),s._v("\n")])])]),t("blockquote",[t("p",[t("img",{attrs:{src:"https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2022/01/20/kuangstudy7496a348-ca24-4ee5-b8cc-f413a2c3fb57.png",alt:"img"}})]),s._v(" "),t("p",[s._v("不加—prefix=/usr/local/nginx 的错误（make时也会出错【 make make: *** 没有规则可以创建“default”需要的目标“build”。 停止。】）：")])]),s._v(" "),t("h3",{attrs:{id:"_5、执行make"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5、执行make"}},[s._v("#")]),s._v(" 5、执行make")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost nginx-1.20.2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# make")]),s._v("\n")])])]),t("h3",{attrs:{id:"_6、执行make-install"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6、执行make-install"}},[s._v("#")]),s._v(" 6、执行make install")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost nginx-1.20.2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# make install")]),s._v("\n")])])]),t("h3",{attrs:{id:"_7、查看安装编译目录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7、查看安装编译目录"}},[s._v("#")]),s._v(" 7、查看安装编译目录")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost nginx-1.20.2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# whereis nginx")]),s._v("\nnginx: /usr/local/nginx\n")])])]),t("h3",{attrs:{id:"_8、启动nginx"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8、启动nginx"}},[s._v("#")]),s._v(" 8、启动nginx")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost nginx-1.20.2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /usr/local/nginx/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost nginx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls")]),s._v("\nconf  html  logs  sbin\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost nginx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd sbin/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost sbin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls")]),s._v("\nnginx  nginx.old\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost sbin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./nginx")]),s._v("\n")])])]),t("h3",{attrs:{id:"_9、测试nginx-访问默认端口-80"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9、测试nginx-访问默认端口-80"}},[s._v("#")]),s._v(" 9、测试nginx ，访问默认端口：80")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost sbin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl http://localhost")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("DOCTYPE html"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("html"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("head"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("title"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("Welcome to nginx"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/title"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("style"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    body "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        width: 35em"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        margin: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" auto"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        font-family: Tahoma, Verdana, Arial, sans-serif"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/style"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/head"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("body"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("h"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v("Welcome to nginx"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/h"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("p"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("If you see this page, the nginx web server is successfully installed and\nworking. Further configuration is required."),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/p"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("p"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("For online documentation and support please refer to\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("href")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://nginx.org/"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("nginx.org"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/a"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("."),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("br/"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nCommercial support is available at\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("href")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://nginx.com/"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("nginx.com"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/a"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("."),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/p"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("p"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("em"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("Thank you "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" using nginx."),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/em"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/p"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/body"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/html"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),t("blockquote",[t("h3",{attrs:{id:"nginx常用命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx常用命令"}},[s._v("#")]),s._v(" Nginx常用命令")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/bin/sbin/\n./nginx     启动\n./nginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" stop        停止\n./nginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" quit        安全退出\n./nginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" reload    重新加载配置文件\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" aux"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" nginx    查看nginx进程\n")])])]),t("blockquote",[t("h3",{attrs:{id:"nginx-conf配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx-conf配置文件"}},[s._v("#")]),s._v(" nginx.conf配置文件")])]),s._v(" "),t("p",[s._v("1.全局块：\n主要设置一些影响nginx 服务器整体运行的配置指令。如：用户（组），生成worker process 数，日志存放路径，配置文件引入，pid文件路径\n2.events 块\n影响nginx 服务器与用户的网络连接。如：每个worker processs 的最大连接数，事件驱动模型")]),s._v(" "),t("p",[s._v("3.http块\nnginx 配置中的重要部分，代理，缓存等功能都可以在此配置。如：文件引入，mime-type 定义，连接超时，单连接请求数上限")]),s._v(" "),t("p",[s._v("4.server 块\n与“虚拟主机”的概念有密切关系。每个server 块相当于一台虚拟主机，最常见的两个配置项是监听配置和虚拟主机的名称或IP配置")]),s._v(" "),t("p",[s._v("5.location 块\n在server 块中，可以有多个。地址定向，数据缓存，和应答控制等功能都是在这部分实现。")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("listen address[:port]; #配置网络监听\nlisten "),t("em",[s._v(":80 |")]),s._v(" :8080 | 8080; #监听所有的80 和 8080 端口\nlisten 192.168.1.1:8080; #监听192.168.1.1地址的8080端口\nlisten 192.168.1.11; #监听192.168.1.11 的所有端口")])]),s._v(" "),t("li",[t("p",[s._v("server_name name ….; #虚拟主机配置\nserver_name www.xx.com yy.com; #虚拟主机名为www.xx.com 和 yy.com\nserver_name "),t("em",[s._v("xx.com www.yy.")]),s._v("; #可以使用通配符，但只能放在首段或尾段\nserver_name ~^www\\d+.xx.com$ #可以使用正则表达式,但必须使用 ~ 开头\n匹配规则按：准确匹配，通配符（开始）匹配 ，通配符（结尾）匹配，正则匹配")])]),s._v(" "),t("li",[t("p",[s._v("location [ = | ~ | ~ "),t("em",[s._v("| ^~ ] uri {…} #位置配置\n在一不使用 =、~、~")]),s._v("、^~ 时的匹配规则：先搜索【标准的uri】如果有多个可以匹配，那么就记录匹配度最高的一个。然后再搜索【正则uri】，当第一个【正则uri】匹配成功时就结束搜索并使用它。如果【正则uri】都没有匹配到，就使用【标准uri】就是刚搜索的那个。\n【=】 ： 只能用在【标准uri】前，如果匹配成功了，就停止搜索并使用它。\n【~ | ~*】：只能用在【正则uri】前，前面区分大小写，后面不区分大小写\n【^~】: 只能用在【标准uri】前，搜索所有【标准uri】找到匹配度最高的一个结束搜索并使用它")])]),s._v(" "),t("li",[t("p",[s._v("root path; 配置请求的根目录\npath 为服务器资源的根目录路径,如：\nlocation /data/ {\nroot /usr/local/web;\n}\n当请求为 /data/index.htm 时， 将映射至 /usr/local/web/data/index.hm")])]),s._v(" "),t("li",[t("p",[s._v("alias path; 更改location 的URI\nlocation ~ ^/data/(.+.(htm|htm))${\nalias /usr/local/app/$1;\n}\n当请求为 /data/index.htm 时， 将映射至 /usr/local/app/index.htm")])]),s._v(" "),t("li",[t("p",[s._v("index file …; 设置网站的默认首页")])]),s._v(" "),t("li",[t("p",[s._v("error_page code … uri #设置网站的错误页面\nerror_page 404 /404.htm\nerror_page 403 http://www.xx.com/403.htm\nerror_page 410 =301 /fes.htm # 当服务器产生410时，返回 fes.htm ，并客户端http status 为 301")])]),s._v(" "),t("li",[t("p",[s._v("allow address | CIDR | all; # 基于ip配置nginx 的访问权限 - 允许")])]),s._v(" "),t("li",[t("p",[s._v("deny address | CIDR | all; # 基于ip配置nginx 的访问权限 - 拒绝\nlocation / {\ndeny 192.168.1.10;\nallow 192.168.2.45;\nallow 192.168.3.78;\ndeny all;\n}\n遇到 deny 或 allow 指定是按顺序对当前客户端的连接进行访问权限检查")])]),s._v(" "),t("li",[t("p",[s._v("auth_basic string | off; 基于密码配置nginx 的访问权限")])]),s._v(" "),t("li",[t("p",[s._v("auth_basic_user_file file; 使用文件来配置用户名和密码")])])]),s._v(" "),t("div",{staticClass:"language-nginx extra-class"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# =========================全局块============================")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# user user [grop];        # 指定可以运行nginx 服务器的用户及组。只被设置的用户及组才有权限管理")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# user nobody nobody;      # 所用用户可用，默认配置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" nginx nginx")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# worker_processes number | auto;   # 控制并发处理，值越大，支持的并发数越多")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# worker_processes 1;               # 默认值 ，最多产生1个worker_processes")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("worker_processes")]),s._v(" auto")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pid file;                  # pid 存放路径.相对或绝对路径")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pid logs/nginx.pid;        # 默认在安装目录logs/nginx.pid")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pid")]),s._v(" /var/run/nginx.pid")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# error_log file | stder [debug | info | notice | warn | error | crit | alert | emerg];  #错误日志存放路径")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# error_log logs/error.log error;  # 可在 全局块，http 块 ,serveer 块，location 块中配置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("error_log")]),s._v(" /data/wwwlogs/error_nginx.log crit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# include file;      # 配置文件引入，可以是相对/绝对路径。指令可以放在配置文件的任意地方(任意块中)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("worker_rlimit_nofile")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("51200")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ===========================events 块===============================")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("events")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#accept_mutex on|off;      # 网络连接序列化。解决“惊群”问题")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("accept_mutex")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认为开启状态")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#multi_accept on|off;      # 是否允许worker process同时接收多个网络连接，")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("multi_accept")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("off")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认为关闭")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#use method;               # 事件驱动模型选择，select 、 poll 、 kqueue 、 epoll 、 rtsig 、 /dev/poll 、 eventport")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" epoll")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#worker_connections number; # worker process 的最大连接数。 ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("worker_connections")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("512")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认值为512。注意设置不能大于操作系统支持打开的最大文件句柄数量。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ==========================http块============================")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义 mime-type (网络资源的媒体类型)。  指定能识别前端请求的资源类型 ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),s._v(" mime.types")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 引入外部文件 ，在外部文件中有定义types 块")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default_type")]),s._v(" application/octet-stream")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认为 text/plain 。 http块、server块、location块中可配置")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# access_log path [format[buffer=size]];  # 定义服务日志，记录前端的请求日志")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# access_log logs/access.log combined;    # combined 是默认定义的日志格式字符串名称")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("access_log")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("off")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("                          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭日志")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# log_format name stirng      # 定义了日志格式，以便access_log 使用")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# log_format  combined  '$remote_addr - $remote_user [$time_local] \"$request\" '")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#                  '$status $body_bytes_sent \"$http_referer\" '")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#                  \'"$http_user_agent" "$http_x_forwarded_for"\';')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sendfile on|off;       # 配置允许 sendfile 方式传输文件")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sendfile")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("off")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认关闭，可在http块、server块、location块 中定义")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sendfile_max_chunk size;    # 配置worker process 每次调用sendfile()传输的数据最最大值")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sendfile_max_chunk 0;        # 默认为0 不限制。  可在http块、server块、location块 中定义")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sendfile_max_chunk")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("128k")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# keepalive_timeout timeout [header_timeout];    # 配置连接超时时间, 可在http块、server块、location块 中定义")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# keepalive_timeout 75s;        # 默认为75秒，与用户建立会话连接后，nginx 服务器可以保持这些连接打开的时间。")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("keepalive_timeout")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("120")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100s")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在服务器端保持连接的时间设置为120s,发给用户端的应答报文头部中keep-alive 域的设置为100s")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# keepalive_requests number;    # 单连接请求数上限")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("keepalive_requests")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认为 100")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_names_hash_bucket_size")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("client_header_buffer_size")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32k")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("large_client_header_buffers")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32k")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("client_max_body_size")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024m")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tcp_nopush")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_tokens")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("off")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tcp_nodelay")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fastcgi_connect_timeout")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fastcgi_send_timeout")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fastcgi_read_timeout")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fastcgi_buffer_size")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64k")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fastcgi_buffers")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64k")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fastcgi_busy_buffers_size")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("128k")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fastcgi_temp_file_write_size")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("128k")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Gzip Compression")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_buffers")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8k")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_comp_level")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_http_version")]),s._v(" 1.1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_min_length")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("256")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_proxied")]),s._v(" any")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_vary")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_types")]),s._v("\n        text/xml application/xml application/atom+xml application/rss+xml application/xhtml+xml image/svg+xml\n        text/javascript application/javascript application/x-javascript\n        text/x-json application/json application/x-web-app-manifest+json\n        text/css text/plain text/x-component\n        font/opentype application/x-font-ttf application/vnd.ms-fontobject\n        image/x-icon")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("gzip_disable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MSIE [1-6]\\.(?!.*SV1)"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# If you have a lot of static files to serve through Nginx then caching of the files' metadata (not the actual files' contents) can save some latency.")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("open_file_cache")]),s._v(" max=1000 inactive=20s")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("open_file_cache_valid")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30s")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("open_file_cache_min_uses")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("open_file_cache_errors")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("######################## default ############################")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    server {")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    listen 8067;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    server_name _;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    access_log /data/wwwlogs/access_nginx.log combined;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    root /data/wwwroot/default;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    index index.html index.htm index.jsp;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    location /nginx_status {")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        stub_status on;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        access_log off;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        allow 127.0.0.1;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        deny all;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        }")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    location ~ .*\\.(gif|jpg|jpeg|png|bmp|swf|flv|ico)$ {")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        expires 30d;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        access_log off;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        }")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    location ~ .*\\.(js|css)?$ {")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        expires 7d;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        access_log off;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        }")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    location ~ {")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        proxy_pass http://127.0.0.1:8080;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        include proxy.conf;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        }")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    }")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    server{")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     listen 8087;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    server_name _;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     root /home/wwwroot/default;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     location / {")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#      }")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    }")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" backend")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 127.0.0.1:8080 weight=1 max_fails=2 fail_timeout=2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 139.224.209.104:8080 backup")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(" ssl")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" wmcenter.xy-asia.com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ssl on;")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default_type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'text/html'")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("charset")]),s._v(" utf-8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_certificate")]),s._v("   /usr/local/cert/1634560_wmcenter.xy-asia.com.pem")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_certificate_key")]),s._v("  /usr/local/cert/1634560_wmcenter.xy-asia.com.key")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_session_timeout")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5m")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_ciphers")]),s._v(" ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_protocols")]),s._v(" TLSv1 TLSv1.1 TLSv1.2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_prefer_server_ciphers")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" index.html index.htm")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ~ .*\\.(js|css)?$")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("expires")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1h")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v("   http://backend")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v("  http://backend")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" backendIP "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$upstream_addr")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# proxy_next_upstream error timeout invalid_header http_500 http_502 http_503;")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# proxy_set_header Host $host;")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# proxy_set_header X-Real-IP $remote_addr;")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# proxy_set_header X-Forwarded-Proto https;")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# proxy_redirect http://http://127.0.0.1:8080 $scheme://127.0.0.1:8080;")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# port_in_redirect on;")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# proxy_redirect     off;")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),s._v(" proxy.conf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# error_log /home/wwwlogs/xywm.log;")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 缓存配置")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_temp_file_write_size")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("264k")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_temp_path")]),s._v(" /data/wwwlogs/nginx_temp")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_cache_path")]),s._v(" /data/wwwlogs/nginx_cache levels=1:2 keys_zone=prc:200m inactive=5d max_size=400m")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_ignore_headers")]),s._v(" X-Accel-Expires Expires Cache-Control Set-Cookie")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("########################## vhost #############################")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),s._v(" vhost/*.conf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);