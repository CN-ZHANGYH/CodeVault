(window.webpackJsonp=window.webpackJsonp||[]).push([[132],{445:function(a,t,s){"use strict";s.r(t);var e=s(7),r=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"prometheus-grafana-docker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#prometheus-grafana-docker"}},[a._v("#")]),a._v(" Prometheus+Grafana+Docker")]),a._v(" "),t("h2",{attrs:{id:"搭建docker环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#搭建docker环境"}},[a._v("#")]),a._v(" 搭建Docker环境")]),a._v(" "),t("h3",{attrs:{id:"_1-安装yum工具包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装yum工具包"}},[a._v("#")]),a._v(" 1.安装yum工具包")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("$ yum "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" yum-utils device-mapper-persistent-data lvm2\n")])])]),t("h3",{attrs:{id:"_2-拉取docker的repo源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-拉取docker的repo源"}},[a._v("#")]),a._v(" 2.拉取Docker的repo源")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("$ yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\n")])])]),t("h3",{attrs:{id:"_3-安装-docker-ce"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-安装-docker-ce"}},[a._v("#")]),a._v(" 3.安装 DOCKER CE")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("$ yum "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" docker-ce\n\n启动 "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v("\n$ systemctl start "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("enable")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v("\n")])])]),t("h3",{attrs:{id:"_4-配置镜像仓库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-配置镜像仓库"}},[a._v("#")]),a._v(" 4.配置镜像仓库")]),a._v(" "),t("p",[a._v("阿里云镜像加速地址： https://ably8t50.mirror.aliyuncs.com")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v("  /etc/docker/daemon.json\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"registry-mirrors"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"https://ably8t50.mirror.aliyuncs.com"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n加载配置重启服务\n$ systemctl daemon-reload\n$ systemctl restart "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v("\n")])])]),t("h2",{attrs:{id:"prometheus"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#prometheus"}},[a._v("#")]),a._v(" Prometheus")]),a._v(" "),t("h3",{attrs:{id:"_1-基础准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-基础准备"}},[a._v("#")]),a._v(" 1.基础准备")]),a._v(" "),t("p",[a._v("创建prometheus文件夹里面存放prometheus.yml的配置文件，"),t("code",[a._v("然后需要添加基础的配置")]),a._v("。")]),a._v(" "),t("p",[t("code",[a._v("prometheus的默认是支持http和metrics结尾的")]),a._v("，所以不需要加前缀和后缀。")]),a._v(" "),t("p",[t("code",[a._v("job就是创建一个作业")]),a._v("，需要创建一个job_name,然后指定你的configs，"),t("code",[a._v("目标就是指定你的targets需要监控的客户端地址")]),a._v("。")]),a._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# mkdir /root/prometheus/ ")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# vim /root/prometheus/prometheus.yml")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("global")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("scrape_interval")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 15s\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("evaluation_interval")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 15s\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("scrape_configs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("job_name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"prometheus"')]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("static_configs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" \n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("targets")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"localhost:9090"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("  \n")])])]),t("h3",{attrs:{id:"_2-启动prometheus的容器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-启动prometheus的容器"}},[a._v("#")]),a._v(" 2.启动Prometheus的容器")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@localhost prometheus"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker run -d \\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("9090")]),a._v(":9090 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--restart")]),a._v(" always "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" prometheus "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /root/prometheus/prometheus.yml:/etc/prometheus/prometheus.yml "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("TZ")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("Asia/Shanghai "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /etc/localtime:/etc/localtime "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\nprom/prometheus\nd98bf61589ed68dcabe175bd54e26f0545aad4c9407e27a43f2cd5e92078c294\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@localhost prometheus"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker ps")]),a._v("\nCONTAINER ID   IMAGE             COMMAND                  CREATED         STATUS        PORTS                                       NAMES\nd98bf61589ed   prom/prometheus   "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/bin/prometheus --c…"')]),a._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" seconds ago   Up "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" second   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0")]),a._v(".0.0:9090-"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("9090")]),a._v("/tcp, :::9090-"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("9090")]),a._v("/tcp   prometheus\n")])])]),t("h3",{attrs:{id:"_3-访问prometheus"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-访问prometheus"}},[a._v("#")]),a._v(" 3.访问Prometheus")]),a._v(" "),t("p",[a._v("使用http://ip:9090访问默认页面即可")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204111235825.png",alt:"image-20211210091845499"}})]),a._v(" "),t("h2",{attrs:{id:"cadvisor"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cadvisor"}},[a._v("#")]),a._v(" Cadvisor")]),a._v(" "),t("p",[a._v("cadvisor监控指标和prometheus集成融合，Prometheus就可以支持监控docker的性能指标。")]),a._v(" "),t("h3",{attrs:{id:"_1-启动cadvisor容器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-启动cadvisor容器"}},[a._v("#")]),a._v(" 1.启动cadvisor容器")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker run -d \\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--volume")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/:/rootfs:ro "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--volume")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/var/run:/var/run:rw "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--volume")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/sys:/sys:ro "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--volume")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/var/lib/docker/:/var/lib/docker:ro "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--volume")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/dev/disk/:/dev/disk:ro "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8080")]),a._v(":8080 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--detach")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("cadvisor \ngoogle/cadvisor:latest\ned1afcab2ecd83217d5c6b46dc8d595d349bb24cf431f8ba7d64c7d877a3ac5d\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker ps")]),a._v("\nCONTAINER ID   IMAGE                    COMMAND                  CREATED          STATUS          PORTS                                       NAMES\ned1afcab2ecd   google/cadvisor:latest   "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/usr/bin/cadvisor -…"')]),a._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" seconds ago    Up "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v(" seconds    "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0")]),a._v(".0.0:8080-"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8080")]),a._v("/tcp, :::8080-"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8080")]),a._v("/tcp   cadvisor\nd98bf61589ed   prom/prometheus          "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/bin/prometheus --c…"')]),a._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("18")]),a._v(" minutes ago   Up "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("18")]),a._v(" minutes   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0")]),a._v(".0.0:9090-"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("9090")]),a._v("/tcp, :::9090-"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("9090")]),a._v("/tcp   prometheus\n")])])]),t("h3",{attrs:{id:"_2-访问cadvisor"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-访问cadvisor"}},[a._v("#")]),a._v(" 2.访问cadvisor")]),a._v(" "),t("p",[a._v("使用默认端口访问http://ip:8080和http://ip:8080/metrics")]),a._v(" "),t("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204111235632.png",alt:"image-20211210092344331"}}),a._v(" "),t("p",[a._v("如何查看该节点的监控指标，可以访问/metrics的")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204111235625.png",alt:"image-20211210092456894"}})]),a._v(" "),t("h3",{attrs:{id:"_3-配置prometheus"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-配置prometheus"}},[a._v("#")]),a._v(" 3.配置Prometheus")]),a._v(" "),t("p",[a._v("能够成功查看到"),t("code",[a._v("docker的监控指标")]),a._v("，然后需要更改Prometheus的配置文件，我们需要添加如下内容")]),a._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[a._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("job_name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"container"')]),a._v("      \t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#创建一个container的job")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("static_configs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("targets")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"192.168.1.104:8080"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#我添加了一个docker的metrics性能指标的地址")]),a._v("\n")])])]),t("p",[a._v("添加在配置文件后如下：")]),a._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# cat /root/prometheus/prometheus.yml")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("global")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("scrape_interval")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 15s\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("evaluation_interval")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 15s\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("scrape_configs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("job_name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"prometheus"')]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("static_configs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("targets")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"localhost:9090"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("job_name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"container"')]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("static_configs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("targets")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"192.168.1.104:8080"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n")])])]),t("p",[a._v("这时候需要"),t("code",[a._v("重新启动我们的Prometheus")])]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker restart  prometheus")]),a._v("\nprometheus\n")])])]),t("p",[a._v("该节点全部起来之后访问如下：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204111236481.png",alt:""}})]),a._v(" "),t("h2",{attrs:{id:"grafana"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#grafana"}},[a._v("#")]),a._v(" Grafana")]),a._v(" "),t("h3",{attrs:{id:"_1-创建数据卷"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-创建数据卷"}},[a._v("#")]),a._v(" 1.创建数据卷")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# mkdir /root/grafana && chmod 777 grafana/")]),a._v("\n")])])]),t("h3",{attrs:{id:"_2-启动grafana容器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-启动grafana容器"}},[a._v("#")]),a._v(" 2.启动Grafana容器")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker run -d \\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3000")]),a._v(":3000 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--restart")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("always "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("grafana "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /root/grafana:/var/lib/grafana "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("TZ")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("Asia/Shanghai "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /etc/localtim:/etc/localtime "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\ngrafana/grafana\nbdbe72abdac4ce96f4aeb90361e93607573652a73cc906b091369df49e184fc2\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker ps")]),a._v("\nCONTAINER ID   IMAGE                    COMMAND                  CREATED          STATUS          PORTS                                       NAMES\nbdbe72abdac4   grafana/grafana          "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/run.sh"')]),a._v("                "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v(" minutes ago    Up "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v(" minutes    "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0")]),a._v(".0.0:3000-"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3000")]),a._v("/tcp, :::3000-"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3000")]),a._v("/tcp   grafana\ned1afcab2ecd   google/cadvisor:latest   "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/usr/bin/cadvisor -…"')]),a._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" seconds ago    Up "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v(" seconds    "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0")]),a._v(".0.0:8080-"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8080")]),a._v("/tcp, :::8080-"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8080")]),a._v("/tcp   cadvisor\nd98bf61589ed   prom/prometheus          "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/bin/prometheus --c…"')]),a._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("18")]),a._v(" minutes ago   Up "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("18")]),a._v(" minutes   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0")]),a._v(".0.0:9090-"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("9090")]),a._v("/tcp, :::9090-"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("9090")]),a._v("/tcp   prometheus\n")])])]),t("h3",{attrs:{id:"_3-配置grafana"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-配置grafana"}},[a._v("#")]),a._v(" 3.配置Grafana")]),a._v(" "),t("blockquote",[t("p",[t("strong",[a._v("这里需要添加prometheus的源")])])]),a._v(" "),t("p",[a._v("访问grafana的地址，http://ip:3000")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204111236112.png",alt:"image-20211210093359808"}})]),a._v(" "),t("p",[a._v("添加一个"),t("code",[a._v("data")]),a._v("，点击"),t("code",[a._v("DATA SOURCE")])]),a._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204111236928.png",alt:"image-20211210093543609"}})]),a._v(" "),t("p",[a._v("选择Prometheus，然后添加"),t("code",[a._v("url和name")])]),a._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204111236552.png",alt:"image-20211210093623733"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204111236000.png",alt:"image-20211210093746364"}})]),a._v(" "),t("h3",{attrs:{id:"_4-导入模板"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-导入模板"}},[a._v("#")]),a._v(" 4.导入模板")]),a._v(" "),t("p",[a._v("从上面的cadvisor可以看到，我们的数据源已经过来了，所以需要导入模板。")]),a._v(" "),t("p",[t("strong",[a._v("模板编号："),t("code",[a._v("395 13631 14841")])])]),a._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204111236776.png",alt:"image-20211210094137443"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204111236361.png",alt:"image-20211210094157976"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204111236784.png",alt:"image-20211210094228647"}})]),a._v(" "),t("h2",{attrs:{id:"node-exporter"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#node-exporter"}},[a._v("#")]),a._v(" Node_exporter")]),a._v(" "),t("p",[a._v("用于监控Linux的服务器。")]),a._v(" "),t("h3",{attrs:{id:"_1-启动容器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-启动容器"}},[a._v("#")]),a._v(" 1.启动容器")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker run -d \\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" node_exporter "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--restart")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("always "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--net")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"host"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--pid")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"host"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/proc:/host/proc:ro"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/sys:/host/sys:ro"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/:/rootfs:ro"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("TZ")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("Asia/Shanghai "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /etc/localtime:/etc/localtime "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\nprom/node-exporter "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--path.procfs")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/host/proc "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--path.rootfs")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/rootfs "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--path.sysfs")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/host/sys "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--collector.filesystem.ignored-mount-points"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'^/(sys|proc|dev|host|etc)($$|/)'")]),a._v("\n")])])]),t("h3",{attrs:{id:"_2-与prometheus集成"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-与prometheus集成"}},[a._v("#")]),a._v(" 2.与Prometheus集成")]),a._v(" "),t("p",[a._v("在Prometheus的配置文件后面再添加一个监控端")]),a._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# cat  /root/prometheus/prometheus.yml")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("global")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("scrape_interval")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 15s\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("evaluation_interval")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 15s\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("scrape_configs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("job_name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"prometheus"')]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("static_configs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("targets")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"localhost:9090"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("job_name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"container"')]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("static_configs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("targets")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"192.168.1.104:8080"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("job_name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"node"')]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("static_configs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("targets")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"192.168.1.104:9100"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n")])])]),t("p",[a._v("重启容器")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker restart prometheus")]),a._v("\nprometheus\n")])])]),t("h3",{attrs:{id:"_3-查看访问"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-查看访问"}},[a._v("#")]),a._v(" 3.查看访问")]),a._v(" "),t("p",[a._v("可以查看到当前已经有两个地址了。")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204111236103.png",alt:"image-20211210095502858"}})]),a._v(" "),t("h3",{attrs:{id:"_4-配置grafana"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-配置grafana"}},[a._v("#")]),a._v(" 4.配置Grafana")]),a._v(" "),t("p",[a._v("然后一样的导入需要的模板")]),a._v(" "),t("p",[t("strong",[a._v("模板编号："),t("code",[a._v("9276 8919 1860")])])]),a._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204111236232.png",alt:"image-20211210095719632"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204111236769.png",alt:"image-20211210095729543"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204111236032.png",alt:"image-20211210095827736"}})])])}),[],!1,null,null,null);t.default=r.exports}}]);