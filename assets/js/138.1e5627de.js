(window.webpackJsonp=window.webpackJsonp||[]).push([[138],{452:function(a,t,s){"use strict";s.r(t);var e=s(7),n=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"docker-swarm集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-swarm集群"}},[a._v("#")]),a._v(" Docker swarm集群")]),a._v(" "),t("p",[a._v("1.Docker Swarm简介及集群的作用。")]),a._v(" "),t("p",[a._v("2.实施部署Swarm集群。")]),a._v(" "),t("h2",{attrs:{id:"docker-swarm"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-swarm"}},[a._v("#")]),a._v(" Docker Swarm")]),a._v(" "),t("p",[t("strong",[a._v("Swarm是Docker公司推出的用来管理docker集群的平台，几乎全部用GO语言来完成的开发的，代码开源在点击这里， 它是将一群Docker宿主机变成一个单一的虚拟主机，Swarm使用标准的Docker API接口作为其前端的访问入口，换言之，各种形式的Docker。")])]),a._v(" "),t("p",[a._v("Docker Swarm 和 Docker Compose 一样，都是 Docker 官方容器编排项目，但不同的是，Docker Compose 是一个在单个服务器或主机上创建多个容器的工具，而 Docker Swarm 则可以在多个服务器或主机上创建容器集群服务，对于微服务的部署，显然 Docker Swarm 会更加适合。")]),a._v(" "),t("p",[a._v("从 Docker 1.12.0 版本开始，Docker Swarm 已经包含在 Docker 引擎中（docker swarm），并且已经内置了服务发现工具，我们就不需要像之前一样，再配置 Etcd 或者 Consul 来进行服务发现配置了。")]),a._v(" "),t("h2",{attrs:{id:"swarm集群中的角色"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#swarm集群中的角色"}},[a._v("#")]),a._v(" Swarm集群中的角色")]),a._v(" "),t("ul",[t("li",[t("code",[a._v("Swarm")]),a._v("：作用于运行docker engine（引擎）的多个主机组成的集群。")]),a._v(" "),t("li",[t("code",[a._v("node")]),a._v("：每一个docker engine都是一个node（节点），分为manager和worker。")]),a._v(" "),t("li",[t("code",[a._v("manager node")]),a._v("：负责执行容器的编排和集群的管理工作，保持并维护swarm处于期望的状态。swarm可以有多个manager node，它们会自动协调并选举出一个Leader执行编排任务。但相反，不能没有manager node。")]),a._v(" "),t("li",[t("code",[a._v("worker node")]),a._v("：接受并执行由manager node派发的任务，并且默认manager node也是一个work node，不过可以将它设置为manager-only node，让它只负责编排和管理工作。")]),a._v(" "),t("li",[t("code",[a._v("service")]),a._v("：用来定义worker上执行的命令。")])]),a._v(" "),t("h2",{attrs:{id:"部署docker-swarm"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#部署docker-swarm"}},[a._v("#")]),a._v(" "),t("strong",[a._v("部署Docker Swarm")])]),a._v(" "),t("h3",{attrs:{id:"部署前准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#部署前准备"}},[a._v("#")]),a._v(" 部署前准备")]),a._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"left"}},[a._v("Docker01")]),a._v(" "),t("th",{staticStyle:{"text-align":"left"}},[a._v("Docker02")]),a._v(" "),t("th",{staticStyle:{"text-align":"left"}},[a._v("Docker03")])])]),a._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"left"}},[a._v("Node01")]),a._v(" "),t("td",{staticStyle:{"text-align":"left"}},[a._v("Node02")]),a._v(" "),t("td",{staticStyle:{"text-align":"left"}},[a._v("Node03")])]),a._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[a._v("192.168.2.60")]),a._v(" "),t("td",{staticStyle:{"text-align":"left"}},[a._v("192.168.2.50")]),a._v(" "),t("td",{staticStyle:{"text-align":"left"}},[a._v("192.168.2.80")])])])]),a._v(" "),t("p",[a._v("关闭防火墙、禁用selinux、三台dockerhost区别主机名、时间同步。")]),a._v(" "),t("p",[a._v("Docker版本必须是：v1.12版本开始。")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("$ ntpdate time1.aliyun.com  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#与阿里云的时间同步，可以使用ntpdate 192.168.2.60与主机时间同步。")]),a._v("\n\nsystemctl stop firewalld\nsystemctl disable firewalld\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-F")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-X")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-Z")]),a._v("\nsetenforce "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\n")])])]),t("p",[a._v("安装docker")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("docker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("docker\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("baseurl")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("file:///opt/Docker\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("gpgcheck")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("enabled")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n\n$ yum "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" docker-ce\n")])])]),t("h3",{attrs:{id:"开始部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开始部署"}},[a._v("#")]),a._v(" "),t("strong",[a._v("开始部署")])]),a._v(" "),t("p",[a._v("1.初始化集群，Docker01上：")]),a._v(" "),t("ul",[t("li",[t("code",[a._v("--token")]),a._v("：令牌，密钥，默认保存24小时。只有24小时有效期。")]),a._v(" "),t("li",[t("code",[a._v("--advertise-addr")]),a._v("：指定其他node通信的地址。")])]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@node01 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" swarm init --advertise-addr "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".2.60 \t\t\nSwarm initialized: current "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("node")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("pjortjrcrucuihbz6uphl8qnu"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" is now a manager.\nTo "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),a._v(" a worker to this swarm, run the following command:\n\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" swarm "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("join")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--token")]),a._v(" SWMTKN-1-4zz7hmub1du7b9xtpc57tdo9rd74dci0ly7eaj8fmyjluvurr5-41wghyxhgc8bg9ipctcmw75bx "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".2.60:2377\n\nTo "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),a._v(" a manager to this swarm, run "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'docker swarm join-token manager'")]),a._v(" and follow the instructions.\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#当执行完上面的命令时，会返回上面的信息，这些信息提示信息给出的是，如果其他节点需要加入此节点，需要执行的命令，直接复制，对其主机执行即可加入集群。如果想要添加work节点运行下面的命令：")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" swarm "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("join")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--token")]),a._v(" SWMTKN-1-4zz7hmub1du7b9xtpc57tdo9rd74dci0ly7eaj8fmyjluvurr5-41wghyxhgc8bg9ipctcmw75bx "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".2.60:2377\n\n如果想要添加manager节点：运行下面的命令：\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@node01 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$  "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" swarm join-token manager\n")])])]),t("h3",{attrs:{id:"加入集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#加入集群"}},[a._v("#")]),a._v(" 加入集群")]),a._v(" "),t("p",[a._v("2.两台docker02和docker03加入集群：")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("Docker02：\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@node02 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" swarm "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("join")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--token")]),a._v(" SWMTKN-1-4zz7hmub1du7b9xtpc57tdo9rd74dci0ly7eaj8fmyjluvurr5-41wghyxhgc8bg9ipctcmw75bx "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".2.60:2377\n\nThis "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("node")]),a._v(" joined a swarm as a worker.\n\nDocker03：\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@node03 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" swarm "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("join")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--token")]),a._v(" SWMTKN-1-4zz7hmub1du7b9xtpc57tdo9rd74dci0ly7eaj8fmyjluvurr5-41wghyxhgc8bg9ipctcmw75bx "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".2.60:2377\n\nThis "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("node")]),a._v(" joined a swarm as a worker.\n")])])]),t("p",[a._v("当其他两个节点加入成功之后，我们可以在manager node上执行docker node ls 查看节点详情（master节点）")]),a._v(" "),t("ul",[t("li",[a._v("#这里的*号代表当前所在的节点。")]),a._v(" "),t("li",[a._v("可以看出，node01是leader（领导者嘛）")])]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@node01 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("node")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v("\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#这条命令只有manager node可以执行，worker node不可以执行。")]),a._v("\nID                           "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("HOSTNAME")]),a._v("    STATUS   AVAILABILITY  MANAGER STATUS   ENGINE VERSION\npjortjrcrucuihbz6uphl8qnu *  node01      Ready    Active        Leader           "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("18.09")]),a._v(".0\n045waz9m9j9xfuk3p21nnyl17    node02      Ready    Active                         "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("18.09")]),a._v(".0\njtkz4zp2tp3f9ote21ohwhmgs    node03      Ready    Active                         "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("18.09")]),a._v(".0\n\n--------------------------------------------------------------------------\n")])])]),t("h3",{attrs:{id:"添加工作节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#添加工作节点"}},[a._v("#")]),a._v(" 添加工作节点")]),a._v(" "),t("p",[a._v("3.将docker02和docker03提升为manager node，然后再将02和03恢复到worker node。")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@node01 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("node")]),a._v(" promote node02\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@node01 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("node")]),a._v(" promote node03\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@node01 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("node")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v("\nID                            "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("HOSTNAME")]),a._v("   STATUS    AVAILABILITY    MANAGER STATUS   ENGINE VERSION\npjortjrcrucuihbz6uphl8qnu *   node01     Ready     Active          Leader              "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("18.09")]),a._v(".0\n1emp6dh2iawsgy8700fdswk5d     node02     Ready     Active          Reachable           "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("18.09")]),a._v(".0\n39yu0s3ykz21gcphr53j7lp1y     node03     Ready     Active          Reachable           "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("18.09")]),a._v(".0\n")])])]),t("p",[a._v("这时候docker02和docker03也是manager node了，也可以使用另一种方法：")]),a._v(" "),t("p",[a._v("首先docker02和docker03申请离开集群：")]),a._v(" "),t("blockquote",[t("p",[a._v("申请离开一个集群，之后查看节点状态会变成down，然后可以通过manager node将其删除。")])]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("Docker02：\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@node02 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" swarm leave \t\nNode left the swarm.\n\nDocker03：\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@node03 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" swarm leave \nNode left the swarm.\n\n--------------------------------------------------------------------------\n回到docker01的leader上，删除节点：\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@node01 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("node")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" node02\nnode02\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@node01 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("node")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" node03\nnode03\n")])])]),t("p",[a._v("重新生成令牌：docker01上：")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@node01 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" swarm join-token manager\nTo "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),a._v(" a manager to this swarm, run the following command:\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" swarm "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("join")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--token")]),a._v(" SWMTKN-1-4zz7hmub1du7b9xtpc57tdo9rd74dci0ly7eaj8fmyjluvurr5-c6ccobdctfzuit8mue3zafe60 "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".2.60:2377\n")])])]),t("h3",{attrs:{id:"部署网络"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#部署网络"}},[a._v("#")]),a._v(" 部署网络")]),a._v(" "),t("p",[a._v("4.部署docker swarm集群网络：")]),a._v(" "),t("p",[t("code",[a._v("overlay")]),a._v("：覆盖型网络")]),a._v(" "),t("p",[t("code",[a._v("--attachable")]),a._v("：这个参数必须要加，否则不能用于容器。在创建网络的时候，我们并没有部署一个存储服务，比如consul，那是因为docker swarm自带存储。")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@node01 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" network create "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" overlay "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--attachable")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v("\n")])])]),t("h3",{attrs:{id:"swarm可视化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#swarm可视化"}},[a._v("#")]),a._v(" swarm可视化")]),a._v(" "),t("p",[a._v("5.部署一个图形化 webUI 界面")]),a._v(" "),t("p",[a._v("镜像可以通过docker pull下载镜像")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@node01 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" images\nREPOSITORY \t\t\t\tTAG \tIMAGE ID      CREATED          SIZE\ndockersamples/visualizer latest   f6411ebd974c  "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("11")]),a._v(" months ago    166MB\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@node01 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8080")]),a._v(":8080 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("HOST")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".2.60 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("PORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8080")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /var/run/docker.sock:/var/run/docker.sock "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" visualizer "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\ndockersamples/visualizer\n")])])]),t("p",[a._v("然后可以通过浏览器访问验证：IP:8080")]),a._v(" "),t("p",[a._v("这样就可以很清楚的看清节点的信息及状态。")]),a._v(" "),t("p",[a._v("如果访问不到网页，需要开启路由转发，执行下面两条命令：")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" net.ipv4.ip_forward "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">>")]),a._v(" /etc/sysctl.conf\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sysctl")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v("\n")])])]),t("h3",{attrs:{id:"services使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#services使用"}},[a._v("#")]),a._v(" Services使用")]),a._v(" "),t("p",[a._v("6.创建services：")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@node01 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("service")]),a._v(" create "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--replicas")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--network")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" web1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")]),a._v(" nginx:latest\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#--replicas：副本数量。")]),a._v("\n大概可以理解为：一个副本等于一个容器。\n")])])]),t("p",[a._v("查看service：")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@node01 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("service")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v("\nID            NAME        MODE         REPLICAS      IMAGE              PORTS\nj0a5resb13r6  web1        replicated   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),a._v("/5           nginx:latest       *:30003-"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")]),a._v("/tcp\n")])])]),t("p",[a._v("回到网页查看详情：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://pic.imgdb.cn/item/61ebfab12ab3f51d912169ad.png",alt:""}})]),a._v(" "),t("p",[a._v("设置manager node不参加工作：")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@node01 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("node")]),a._v(" update node01 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--availability")]),a._v(" drain \nnode01\n")])])]),t("p",[t("img",{attrs:{src:"https://pic.imgdb.cn/item/61ebface2ab3f51d91218946.png",alt:""}})]),a._v(" "),t("p",[a._v("查看service信息：")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@node01 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("service")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ps")]),a._v(" web1\n")])])]),t("p",[a._v("当然还可以增加容器的数量和减少容器的数量：")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("增加容器：\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@node01 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("service")]),a._v(" scale "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("web1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8")]),a._v("\n\n减少容器：\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@node01 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("service")]),a._v(" scale "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("web1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v("\n")])])]),t("p",[t("img",{attrs:{src:"https://pic.imgdb.cn/item/61ebfae52ab3f51d9121a238.png",alt:""}})]),a._v(" "),t("p",[t("img",{attrs:{src:"https://pic.imgdb.cn/item/61ebfae52ab3f51d9121a23c.png",alt:""}})]),a._v(" "),t("h3",{attrs:{id:"总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[a._v("#")]),a._v(" 总结")]),a._v(" "),t("p",[a._v("Docker Swarm基础命令总结：")]),a._v(" "),t("div",{staticClass:"language-erlang extra-class"},[t("pre",{pre:!0,attrs:{class:"language-erlang"}},[t("code",[a._v("离开集群：\n"),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("docker")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("swarm")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("leave")]),a._v("\n\n删除节点：\n"),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("docker")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("node")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("rm")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("node02")]),a._v("\t\t\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("#")]),a._v("这里注意，只有申请离开集群的"),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("node")]),a._v("才可以删除。\n\n生成令牌，可以是"),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("manager")]),a._v("身份或"),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("worker")]),a._v("身份：\n"),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("docker")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("swarm")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("join")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("token")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("manager")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("worker")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n\n降级为"),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("work")]),a._v("与升级为"),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("manager")]),a._v("：\n"),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("docker")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("node")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("demote")]),a._v("（降级）：将"),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("swarm")]),a._v("节点的"),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("manager")]),a._v("降级为"),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("work")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("docker")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("node")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("promote")]),a._v("（升级）：将"),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("swarm")]),a._v("节点的"),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("work")]),a._v("升级为"),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("manager")]),a._v("\n\n\n\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("Service")]),a._v("基础命令：\n查看"),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("service")]),a._v("列表：\n"),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("docker")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("service")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("ls")]),a._v("\n\n查看"),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("service")]),a._v("信息：\n"),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("docker")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("service")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("ps")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("xxx")]),a._v("\n\n增加容器与减少容器：\n"),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("docker")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("service")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("scale")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("web1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("docker")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("service")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("scale")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("web1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v("\t\t\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("#")]),a._v("等号后接容器的数量。\n\n\n设置"),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("manager")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("node")]),a._v("不参加工作：\n"),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("docker")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("node")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("update")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("node01")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("availability")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("drain")]),a._v(" \n可以设置三个参数：\n"),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("active")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"|"')]),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("pause")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"|"')]),t("span",{pre:!0,attrs:{class:"token atom"}},[a._v("drain")]),a._v("\t\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("#")]),a._v("活跃”"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("|")]),a._v("“暂停”"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("|")]),a._v("“不工作\n")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);