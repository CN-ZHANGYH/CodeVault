(window.webpackJsonp=window.webpackJsonp||[]).push([[155],{465:function(t,s,a){"use strict";a.r(s);var e=a(7),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"glusterfs对接k8s"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#glusterfs对接k8s"}},[t._v("#")]),t._v(" GlusterFs对接K8S")]),t._v(" "),s("h2",{attrs:{id:"什么是glusterfs"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#什么是glusterfs"}},[t._v("#")]),t._v(" 什么是glusterfs")]),t._v(" "),s("p",[t._v("glusterfs是一个开源分布式文件系统，具有强大的横向扩展能力，可支持数pb存储容量和数千客户端，通过网络互联成一个并行的网络文件系统，具有可扩展性、高性能、高可用等特点。")]),t._v(" "),s("p",[s("strong",[t._v("常用资源：")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("pool 存储资源池")])]),t._v(" "),s("li",[s("p",[t._v("peer 节点")])]),t._v(" "),s("li",[s("p",[t._v("volume 卷 必须处于start才可用")])]),t._v(" "),s("li",[s("p",[t._v("brick存储单元（硬盘），可增，可减")])]),t._v(" "),s("li",[s("p",[t._v("gluster")])]),t._v(" "),s("li",[s("p",[t._v("glusterfs添加节点是默认本机是localhost，只需要添加其他机器即可，每个节点都是主")])]),t._v(" "),s("li",[s("p",[t._v("glusterfs默认监听49152端口")])])]),t._v(" "),s("h2",{attrs:{id:"安装glusterfs"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装glusterfs"}},[t._v("#")]),t._v(" 安装glusterfs")]),t._v(" "),s("p",[t._v("我在本地直接用Kubernetes集群做测试，已经搭建好了三个节点的Kubernetes集群之后，并没有配置后端的存储。")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("主机名")]),t._v(" "),s("th",[t._v("ip地址")]),t._v(" "),s("th",[t._v("环境")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("master")]),t._v(" "),s("td",[t._v("192.168.0.128")]),t._v(" "),s("td",[t._v("centos7.6，增加两块20G硬盘")])]),t._v(" "),s("tr",[s("td",[t._v("node1")]),t._v(" "),s("td",[t._v("192.168.0.37")]),t._v(" "),s("td",[t._v("centos7.6，增加两块20G硬盘")])]),t._v(" "),s("tr",[s("td",[t._v("node2")]),t._v(" "),s("td",[t._v("192.168.0.112")]),t._v(" "),s("td",[t._v("centos7.6，增加两块20G硬盘")])])])]),t._v(" "),s("p",[s("strong",[s("code",[t._v("//所有节点执行")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# yum install centos-release-gluster -y ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# yum install install glusterfs-server -y ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# systemctl start glusterd.service ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# systemctk enable glusterd.service ")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#创建两个目录代替添加的硬盘")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mkdir -p /test1 ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mkdir -p /test2 ")]),t._v("\n")])])]),s("h2",{attrs:{id:"添加glusterfs资源池"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#添加glusterfs资源池"}},[t._v("#")]),t._v(" 添加glusterfs资源池：")]),t._v(" "),s("p",[s("strong",[s("code",[t._v("//master节点执行")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看当前的gluster存储池")]),t._v("\nroot@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# gluster pool list ")]),t._v("\nUUID                                    Hostname        State\nbc6a2d93-6cca-4b4d-a414-2a19e45a46f3    localhost       Connected \n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#添加gluster资源池")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# gluster peer probe node1 ")]),t._v("\npeer probe: success\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# gluster peer probe node2 ")]),t._v("\npeer probe: success\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# gluster pool list ")]),t._v("\nUUID                                    Hostname        State\n2cb0d9ef-57c4-40ac-9805-f363209e2bf0    node1           Connected \n60c6c251-6d1e-44aa-8192-e8278a1fc274    node2           Connected \nbc6a2d93-6cca-4b4d-a414-2a19e45a46f3    localhost       Connected \n")])])]),s("h2",{attrs:{id:"glusterfs卷管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#glusterfs卷管理"}},[t._v("#")]),t._v(" glusterfs卷管理")]),t._v(" "),s("p",[t._v("分布式复制卷可以设置复制的数量，如replica设置的是2，那么就表示上传的文件会复制2份，比如上传10个文件实际上是上传了20个文件，起到一定的备份作用，这20个文件会随机分布在各个节点。")]),t._v(" "),s("h3",{attrs:{id:"创建分布式复制卷"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建分布式复制卷"}},[t._v("#")]),t._v(" 创建分布式复制卷")]),t._v(" "),s("p",[t._v("常用的卷类型是分布式复制卷，加上force参数是强制少于3个创建")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# gluster volume create k8s replica 2 master:/test1 master:/test2  node1:/test1 node1:/test2 force")]),t._v("\n")])])]),s("h3",{attrs:{id:"启动卷"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动卷"}},[t._v("#")]),t._v(" 启动卷")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# gluster volume start k8s")]),t._v("\nvolume start: k8s: success\n")])])]),s("h3",{attrs:{id:"查看卷"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看卷"}},[t._v("#")]),t._v(" 查看卷")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# gluster volume info k8s ")]),t._v("\n\nVolume Name: k8s\nType: Distributed-Replicate\nVolume ID: d47aad4d-eca7-474f-9c97-8776689a31ad\nStatus: Started\nSnapshot Count: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\nNumber of Bricks: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" x "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("\nTransport-type: tcp\nBricks:\nBrick1: master:/test1\nBrick2: master:/test2\nBrick3: node1:/test1\nBrick4: node1:/test2\nOptions Reconfigured:\ncluster.granular-entry-heal: on\nstorage.fips-mode-rchecksum: on\ntransport.address-family: inet\nnfs.disable: on\nperformance.client-io-threads: off\n")])])]),s("h3",{attrs:{id:"挂载卷"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#挂载卷"}},[t._v("#")]),t._v(" 挂载卷")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mount -t glusterfs 192.168.0.128:/k8s /mnt")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# df -h | grep mnt")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.128:/k8s   40G  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(".6G   34G  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v("% /mnt\n")])])]),s("h2",{attrs:{id:"分部署复制卷扩容"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#分部署复制卷扩容"}},[t._v("#")]),t._v(" 分部署复制卷扩容")]),t._v(" "),s("h3",{attrs:{id:"扩容前查看容量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#扩容前查看容量"}},[t._v("#")]),t._v(" 扩容前查看容量")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# df -h | grep mnt")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.128:/k8s   40G  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(".6G   34G  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v("% /mntdf "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-h")]),t._v("\n")])])]),s("h3",{attrs:{id:"扩容的命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#扩容的命令"}},[t._v("#")]),t._v(" 扩容的命令")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# gluster volume add-brick k8s node2:/test1 node2:/test2  force ")]),t._v("\nvolume add-brick: success\n")])])]),s("h3",{attrs:{id:"扩容后查看容量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#扩容后查看容量"}},[t._v("#")]),t._v(" 扩容后查看容量")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# df -h | grep mnt")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.128:/k8s   59G  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v(".6G   50G  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v("% /mnt\n")])])]),s("h2",{attrs:{id:"glusterfs做k8s的后端存储"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#glusterfs做k8s的后端存储"}},[t._v("#")]),t._v(" glusterfs做K8s的后端存储")]),t._v(" "),s("h3",{attrs:{id:"创建endpoint"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建endpoint"}},[t._v("#")]),t._v(" 创建endpoint")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("$ vim glusterfs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ep.yaml \n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Endpoints\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" glusterfs\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" default\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subsets")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("addresses")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ip")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 192.168.0.128\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ip")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 192.168.0.37\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ip")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 192.168.0.112\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("49152")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" TCP\n    \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master glusterfs_py"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f glusterfs-ep.yaml ")]),t._v("\nendpoints/glusterfs created\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master glusterfs_py"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get endpoints")]),t._v("\nNAME         ENDPOINTS                                                    AGE\nglusterfs    192.168.0.128"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("49152")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("192.168.0.37"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("49152")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("192.168.0.112"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("49152   12s\nkubernetes   192.168.0.128"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6443")]),t._v("                                \n")])])]),s("h3",{attrs:{id:"创建service"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建service"}},[t._v("#")]),t._v(" 创建service")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master glusterfs_py"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat  glusterfs-service.yaml ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Service\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" glusterfs\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("49152")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" TCP\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targetPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("49152")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClusterIP\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master glusterfs_py"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f glusterfs-service.yaml ")]),t._v("\nservice/glusterfs created\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master glusterfs_py"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get svc ")]),t._v("\nNAME         TYPE        CLUSTER"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("IP      EXTERNAL"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("IP   PORT(S)     AGE\nglusterfs    ClusterIP   10.106.51.139   <none"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("        49152/TCP   4s\nkubernetes   ClusterIP   10.96.0.1       <none"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("        443/TCP     85mkube\n")])])]),s("h3",{attrs:{id:"创建glusterfs类型pv验证"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建glusterfs类型pv验证"}},[t._v("#")]),t._v(" 创建glusterfs类型pv验证")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master glusterfs_py"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat  glusterfs-service.yaml ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Service\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" glusterfs\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("49152")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" TCP\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targetPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("49152")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClusterIP\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master glusterfs_py"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f glusterfs-service.yaml ")]),t._v("\nservice/glusterfs created\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master glusterfs_py"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get svc ")]),t._v("\nNAME         TYPE        CLUSTER"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("IP      EXTERNAL"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("IP   PORT(S)     AGE\nglusterfs    ClusterIP   10.106.51.139   <none"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("        49152/TCP   4s\nkubernetes   ClusterIP   10.96.0.1       <none"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("        443/TCP     85mkube\n")])])]),s("h3",{attrs:{id:"使用pvc"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用pvc"}},[t._v("#")]),t._v(" 使用pvc")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master glusterfs_py"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat pvc.yaml ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PersistentVolumeClaim\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" glusterfs \n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("accessModes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ReadWriteMany\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("requests")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("storage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 50Gi\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master glusterfs_py"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f pvc.yaml ")]),t._v("\npersistentvolumeclaim/glusterfs created\n")])])]),s("h3",{attrs:{id:"创建pod使用glusterfs存储"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建pod使用glusterfs存储"}},[t._v("#")]),t._v(" 创建Pod使用glusterfs存储")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master glusterfs_py"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat pod.yaml ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Pod\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostPath")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 映射宿主机的外部端口")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumeMounts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" glusterfs\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPath")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /usr/share/nginx/html \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" glusterfs \n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("persistentVolumeClaim")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("claimName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" glusterfs\n      \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master glusterfs_py"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f pod.yaml ")]),t._v("\npod/nginx created\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master glusterfs_py"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get pods ")]),t._v("\nNAME    READY   STATUS    RESTARTS   AGE\nnginx   1/1     Running   0          109s\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master glusterfs_py"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get pods -o wide ")]),t._v("\nNAME    READY   STATUS    RESTARTS   AGE     IP               NODE    NOMINATED NODE   READINESS GATES\nnginx   1/1     Running   0          2m51s   10.244.166.129   node1   <none"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("           <none"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master glusterfs_py"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# curl 10.244.166.129")]),t._v("\nHello Word\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);