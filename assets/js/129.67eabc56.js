(window.webpackJsonp=window.webpackJsonp||[]).push([[129],{451:function(t,s,a){"use strict";a.r(s);var e=a(7),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"istioç”±æµ…å…¥æ·±"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#istioç”±æµ…å…¥æ·±"}},[t._v("#")]),t._v(" Istioç”±æµ…å…¥æ·±")]),t._v(" "),s("h2",{attrs:{id:"istioç®€ä»‹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#istioç®€ä»‹"}},[t._v("#")]),t._v(" Istioç®€ä»‹")]),t._v(" "),s("h4",{attrs:{id:"ä»€ä¹ˆæ˜¯istio"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä»€ä¹ˆæ˜¯istio"}},[t._v("#")]),t._v(" ä»€ä¹ˆæ˜¯Istio?")]),t._v(" "),s("p",[t._v("åœ¨ä¼ä¸šæ™®ééƒ½åšäº‘å¹³å°çš„æ—¶ä»£èƒŒæ™¯ä¸‹ï¼Œäº‘å¹³å°æ¶æ„å¸¦æ¥çš„è¯¸å¤šå¥½å¤„ï¼Œä½†æ˜¯ï¼Œä¸å¯å¦è®¤çš„æ˜¯ï¼Œé‡‡ç”¨äº‘æŠ€æœ¯æ¶æ„ä¼šå¯¹DevOpså›¢é˜Ÿé€ æˆå¾ˆå¤§çš„å‹åŠ›ã€‚ å¼€å‘äººå‘˜ä¹Ÿå¿…é¡»ä½¿ç”¨å¾®æœåŠ¡æ¥æ„å»ºå¯ç§»æ¤æ€§ï¼ŒåŒæ—¶å„å¤§è¿è¥å•†æ­£åœ¨ç®¡ç†è¶…å¤§å‹æ··åˆå’Œå¤šäº‘éƒ¨ç½²ã€‚è€ŒIstioä½¿å¾—æ‚¨å¯ä»¥è¿æ¥ï¼Œå®‰å…¨ï¼Œæ§åˆ¶å’Œç›‘æ§è¿™äº›æœåŠ¡ã€‚")]),t._v(" "),s("p",[t._v("ä»æ›´é«˜çš„ç»´åº¦æ¥çœ‹ï¼ŒIstioæœ‰åŠ©äºé™ä½éƒ¨ç½²çš„å¤æ‚æ€§ï¼Œå‡è½»å¼€å‘å›¢é˜Ÿçš„è´Ÿæ‹…ã€‚"),s("code",[t._v("Istioæ˜¯ä¸€ä¸ªå®Œå…¨å¼€æºçš„æœåŠ¡ç½‘æ ¼ï¼ˆservice meshï¼‰ï¼Œå¯ä»¥é€æ˜åœ°åˆ†å±‚åˆ°ç°æœ‰çš„åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºä¸Šã€‚åŒæ—¶ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªå¹³å°ï¼Œé€šè¿‡å…¶æä¾›çš„APIï¼Œå¯å°†å…¶é›†æˆåˆ°ä»»ä½•æ—¥å¿—å¹³å°ï¼Œtelemetryæˆ–ç­–ç•¥ç³»ç»Ÿä¸­ã€‚")])]),t._v(" "),s("p",[t._v("Istioçš„å¤šæ ·åŒ–åŠŸèƒ½é›†ä½¿æ‚¨èƒ½å¤Ÿé«˜æ•ˆåœ°è¿è¡Œåˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„ï¼Œå¹¶æä¾›ç»Ÿä¸€çš„æ–¹å¼æ¥ä¿æŠ¤ï¼Œè¿æ¥å’Œç›‘è§†å¾®æœåŠ¡ã€‚")]),t._v(" "),s("h4",{attrs:{id:"ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘æ ¼-serivce-mesh"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘æ ¼-serivce-mesh"}},[t._v("#")]),t._v(" ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘æ ¼ï¼ˆserivce meshï¼‰ï¼Ÿ")]),t._v(" "),s("p",[t._v("å½“æ•´ä½“åº”ç”¨ç¨‹åºå‘åˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„è¿‡æ¸¡æ—¶ï¼ŒIstioè§£å†³äº†å¼€å‘äººå‘˜å’Œè¿è¥å•†é¢ä¸´çš„æŒ‘æˆ˜ã€‚")]),t._v(" "),s("p",[s("code",[t._v("æœåŠ¡ç½‘æ ¼")]),t._v("æœ¯è¯­ç”¨äºæè¿°ç»„æˆæ­¤ç±»åº”ç”¨ç¨‹åºçš„å¾®æœåŠ¡ç½‘ç»œåŠå…¶ä¹‹é—´çš„äº¤äº’ã€‚éšç€æœåŠ¡ç½‘æ ¼çš„å¤§å°å’Œå¤æ‚æ€§çš„å¢é•¿ï¼Œå®ƒå˜å¾—è¶Šæ¥è¶Šéš¾ä»¥ç†è§£å’Œç®¡ç†ã€‚å®ƒçš„è¦æ±‚å¯ä»¥åŒ…æ‹¬å‘ç°ï¼Œè´Ÿè½½å¹³è¡¡ï¼Œæ•…éšœæ¢å¤ï¼ŒæŒ‡æ ‡å’Œç›‘æ§ã€‚æœåŠ¡ç½‘æ ¼é€šå¸¸è¿˜å…·æœ‰æ›´å¤æ‚çš„æ“ä½œè¦æ±‚ï¼Œä¾‹å¦‚A/Bæµ‹è¯•ï¼Œé‡‘ä¸é›€ï¼Œç½‘é€Ÿé™åˆ¶ï¼Œè®¿é—®æ§åˆ¶å’Œç«¯åˆ°ç«¯çš„èº«ä»½éªŒè¯ã€‚")]),t._v(" "),s("p",[t._v("Istioæä¾›äº†æ•´ä¸ªæœåŠ¡ç½‘æ ¼ä¸Šçš„è¡Œä¸ºæ´å¯ŸåŠ›å’Œæ“ä½œæ§åˆ¶ï¼Œä»è€Œæä¾›äº†å®Œæ•´çš„è§£å†³æ–¹æ¡ˆæ¥æ»¡è¶³å¾®æœåŠ¡åº”ç”¨ç¨‹åºçš„å„ç§éœ€æ±‚ã€‚")]),t._v(" "),s("h4",{attrs:{id:"ä¸ºä»€ä¹ˆä½¿ç”¨istio"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä¸ºä»€ä¹ˆä½¿ç”¨istio"}},[t._v("#")]),t._v(" ä¸ºä»€ä¹ˆä½¿ç”¨Istioï¼Ÿ")]),t._v(" "),s("p",[t._v("Istioå¯ä»¥è½»æ¾åœ¨å·²éƒ¨ç½²æœåŠ¡ç½‘ç»œä¸Šåˆ›å»ºå¸¦æœ‰è´Ÿè½½å¹³è¡¡ï¼ŒæœåŠ¡åˆ°æœåŠ¡çš„èº«ä»½éªŒè¯ï¼Œç›‘æ§ç­‰åŠŸèƒ½ï¼Œå¹¶ä¸”æœåŠ¡ä»£ç ä¸­çš„ä»£ç æ— éœ€å˜åŠ¨ï¼ˆæˆ–å˜åŠ¨å¾ˆå°‘ï¼‰ã€‚é€šè¿‡åœ¨æ•´ä¸ªç¯å¢ƒä¸­éƒ¨ç½²ä¸€ä¸ªç‰¹æ®Šçš„sidecarä»£ç†æ¥æ‹¦æˆªå¾®æœåŠ¡ä¹‹é—´çš„æ‰€æœ‰ç½‘ç»œé€šä¿¡ï¼Œç„¶åä½¿ç”¨å…¶å¹³å°æ§åˆ¶åŠŸèƒ½é…ç½®å’Œç®¡ç†Istioï¼ŒåŒ…æ‹¬ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("è‡ªåŠ¨ä¸ºHTTPï¼ŒgRPCï¼ŒWebSocketå’ŒTCPæµé‡è´Ÿè½½å¹³è¡¡ã€‚")]),t._v(" "),s("li",[t._v("é€šè¿‡ä¸°å¯Œçš„è·¯ç”±è§„åˆ™ï¼Œé‡è¯•ï¼Œæ•…éšœè½¬ç§»å’Œæ•…éšœæ³¨å…¥å¯¹æµé‡è¡Œä¸ºè¿›è¡Œç»†ç²’åº¦æ§åˆ¶ã€‚")]),t._v(" "),s("li",[t._v("å¯æ’æ‹”çš„ç­–ç•¥å±‚å’Œé…ç½®APIï¼Œæ”¯æŒè®¿é—®æ§åˆ¶ï¼Œé€Ÿç‡é™åˆ¶å’Œé…é¢ã€‚")]),t._v(" "),s("li",[t._v("é›†ç¾¤å†…æ‰€æœ‰æµé‡çš„è‡ªåŠ¨åº¦é‡ï¼Œæ—¥å¿—å’Œè·Ÿè¸ªï¼ŒåŒ…æ‹¬é›†ç¾¤çš„å…¥å£å’Œå‡ºå£ã€‚")]),t._v(" "),s("li",[t._v("é€šè¿‡å¼ºå¤§çš„åŸºäºèº«ä»½çš„èº«ä»½éªŒè¯å’Œæˆæƒï¼Œåœ¨é›†ç¾¤ä¸­è¿›è¡Œå®‰å…¨çš„æœåŠ¡ä¹‹é—´é€šä¿¡ã€‚")])]),t._v(" "),s("p",[t._v("Istioä¸“ä¸ºå¯æ‰©å±•æ€§è€Œè®¾è®¡ï¼Œå¯æ»¡è¶³å¤šç§éƒ¨ç½²éœ€æ±‚ã€‚")]),t._v(" "),s("h4",{attrs:{id:"æ ¸å¿ƒåŠŸèƒ½"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ ¸å¿ƒåŠŸèƒ½"}},[t._v("#")]),t._v(" æ ¸å¿ƒåŠŸèƒ½")]),t._v(" "),s("p",[t._v("Istioåœ¨æœåŠ¡ç½‘ç»œä¸­ç»Ÿä¸€æä¾›äº†è®¸å¤šå…³é”®åŠŸèƒ½ï¼š")]),t._v(" "),s("h4",{attrs:{id:"æµé‡ç®¡ç†"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æµé‡ç®¡ç†"}},[t._v("#")]),t._v(" æµé‡ç®¡ç†")]),t._v(" "),s("p",[t._v("Istioè§„åˆ™é…ç½®å’Œæµé‡è·¯ç”±ä½¿æ‚¨å¯ä»¥å¾ˆå®¹æ˜“çš„æ§åˆ¶æœåŠ¡ä¹‹é—´çš„æµé‡å’ŒAPIè°ƒç”¨çš„æµé‡ã€‚Istioç®€åŒ–äº†è¯¸å¦‚æ–­è·¯å™¨ï¼Œè¶…æ—¶å’Œé‡è¯•ä¹‹ç±»çš„æœåŠ¡çº§åˆ«å±æ€§çš„é…ç½®ï¼Œå¹¶ä½¿å…¶è½»è€Œæ˜“ä¸¾åœ°è®¾ç½®é‡è¦ä»»åŠ¡ï¼Œå¦‚A/Bæµ‹è¯•ï¼Œé‡‘ä¸é›€éƒ¨ç½²å’ŒåŸºäºç™¾åˆ†æ¯”çš„æµé‡æ‹†åˆ†ã€‚")]),t._v(" "),s("p",[t._v("å€ŸåŠ©å¯¹æµé‡çš„æ›´å¥½å¯è§æ€§å’Œå¼€ç®±å³ç”¨çš„æ•…éšœæ¢å¤åŠŸèƒ½ï¼Œæ— è®ºé‡åˆ°ä»€ä¹ˆæƒ…å†µï¼Œæ‚¨éƒ½å¯ä»¥åœ¨é—®é¢˜å¼•èµ·æ•…éšœä¹‹å‰åŠæ—¶å‘ç°é—®é¢˜ï¼Œä½¿å¾—è°ƒç”¨æ›´åŠ å¯é ï¼Œç½‘ç»œä¹Ÿæ›´åŠ å¼ºå¤§ã€‚")]),t._v(" "),s("h4",{attrs:{id:"å®‰å…¨"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å®‰å…¨"}},[t._v("#")]),t._v(" å®‰å…¨")]),t._v(" "),s("p",[t._v("Istioçš„å®‰å…¨åŠŸèƒ½ä½¿å¼€å‘äººå‘˜å¯ä»¥å°†ç²¾åŠ›é›†ä¸­åœ¨åº”ç”¨ç¨‹åºçº§åˆ«ã€‚Istioæä¾›åŸºç¡€å®‰å…¨é€šä¿¡é€šé“ï¼Œå¹¶å¤§è§„æ¨¡ç®¡ç†æœåŠ¡é€šä¿¡çš„èº«ä»½éªŒè¯ï¼Œæˆæƒå’ŒåŠ å¯†ã€‚ å€ŸåŠ©Istioï¼Œé»˜è®¤æƒ…å†µä¸‹å¯ä»¥ä¿æŠ¤æœåŠ¡é€šä¿¡çš„å®‰å…¨ï¼Œä»è€Œä½¿æ‚¨èƒ½å¤Ÿåœ¨å„ç§åè®®å’Œè¿è¡Œæ—¶ä¹‹é—´ä¸€è‡´åœ°æ‰§è¡Œç­–ç•¥ - æ‰€æœ‰è¿™äº›æ“ä½œå‡ ä¹ä¸éœ€è¦æ›´æ”¹åº”ç”¨ç¨‹åºã€‚")]),t._v(" "),s("p",[t._v("è™½ç„¶Istioæ˜¯ç‹¬ç«‹äºå¹³å°çš„ï¼Œä½†å°†å…¶ä¸Kubernetesï¼ˆæˆ–åŸºç¡€æ¶æ„ï¼‰ç½‘ç»œç­–ç•¥é…åˆä½¿ç”¨ï¼Œåˆ™å¥½å¤„æ›´å¤§ï¼ŒåŒ…æ‹¬èƒ½å¤Ÿåœ¨ç½‘ç»œå’Œåº”ç”¨ç¨‹åºå±‚ä¿æŠ¤Podåˆ°Podæˆ–æœåŠ¡åˆ°æœåŠ¡çš„é€šä¿¡çš„èƒ½åŠ›ã€‚")]),t._v(" "),s("h4",{attrs:{id:"å¯è§‚å¯Ÿæ€§-observability"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å¯è§‚å¯Ÿæ€§-observability"}},[t._v("#")]),t._v(" å¯è§‚å¯Ÿæ€§(Observability)")]),t._v(" "),s("p",[t._v("Istioå¼ºå¤§çš„è·Ÿè¸ªï¼Œç›‘æ§å’Œæ—¥å¿—è®°å½•åŠŸèƒ½ä½¿æ‚¨å¯ä»¥æ·±å…¥äº†è§£æœåŠ¡ç½‘æ ¼éƒ¨ç½²ã€‚å€ŸåŠ©Istioçš„ç›‘è§†åŠŸèƒ½ï¼Œæ‚¨å¯ä»¥çœŸæ­£äº†è§£æœåŠ¡æ€§èƒ½å¦‚ä½•å½±å“ä¸Šæ¸¸å’Œä¸‹æ¸¸äº‹ç‰©ï¼Œè€Œå…¶è‡ªå®šä¹‰dashboardsï¼ˆä»ªè¡¨ç›˜ï¼‰åˆ™å¯ä»¥æä¾›å¯¹æ‰€æœ‰æœåŠ¡æ€§èƒ½çš„å¯è§†æ€§ï¼Œå¹¶è®©æ‚¨äº†è§£è¯¥æ€§èƒ½å¦‚ä½•å½±å“æ‚¨çš„å…¶ä»–çš„ç¨‹åºçš„ã€‚")]),t._v(" "),s("p",[t._v("Istioçš„Mixerç»„ä»¶è´Ÿè´£ç­–ç•¥æ§åˆ¶å’Œé¥æµ‹(telemetry)é‡‡é›†ã€‚å®ƒæä¾›äº†åç«¯æŠ½è±¡å’Œä¸­ä»‹ï¼Œä½¿Istioçš„å…¶ä½™éƒ¨åˆ†ä¸å„ä¸ªåŸºç¡€æ¶æ„åç«¯çš„å®ç°ç»†èŠ‚éš”ç¦»å¼€æ¥ï¼Œå¹¶ä¸ºæ“ä½œå‘˜æä¾›äº†å¯¹ç½‘æ ¼å’ŒåŸºç¡€æ¶æ„åç«¯ä¹‹é—´æ‰€æœ‰äº¤äº’çš„ç²¾ç»†æ§åˆ¶ã€‚")]),t._v(" "),s("p",[t._v("æ‰€æœ‰è¿™äº›åŠŸèƒ½ä½¿æ‚¨å¯ä»¥æ›´æœ‰æ•ˆåœ°è®¾ç½®ï¼Œç›‘æ§å’Œæ‰§è¡ŒæœåŠ¡ä¸Šçš„SLOã€‚å½“ç„¶ï¼Œæœ€é‡è¦çš„æ˜¯æ‚¨å¯ä»¥å¿«é€Ÿæœ‰æ•ˆåœ°æ£€æµ‹å’Œä¿®å¤æ•…éšœã€‚")]),t._v(" "),s("h4",{attrs:{id:"å¹³å°æ”¯æŒ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å¹³å°æ”¯æŒ"}},[t._v("#")]),t._v(" å¹³å°æ”¯æŒ")]),t._v(" "),s("p",[t._v("Istioæ˜¯ç‹¬ç«‹äºå¹³å°çš„ï¼Œæ—¨åœ¨åœ¨å¤šç§ç¯å¢ƒä¸­è¿è¡Œï¼ŒåŒ…æ‹¬è·¨Cloudï¼Œæœ¬åœ°ï¼ŒKubernetesï¼ŒMesosç­‰çš„ç¯å¢ƒã€‚æ‚¨å¯ä»¥åœ¨Kubernetesæˆ–Consulçš„Nomadä¸Šéƒ¨ç½²Istioã€‚Istioå½“å‰æ”¯æŒï¼š")]),t._v(" "),s("ul",[s("li",[t._v("Kubernetesä¸Šéƒ¨ç½²Service")]),t._v(" "),s("li",[t._v("å‘Consulæ³¨å†ŒServices")]),t._v(" "),s("li",[t._v("åœ¨å•ä¸ªè™šæ‹Ÿæœºä¸Šè¿è¡ŒServices")])]),t._v(" "),s("h4",{attrs:{id:"é›†æˆå’Œè‡ªå®šä¹‰"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#é›†æˆå’Œè‡ªå®šä¹‰"}},[t._v("#")]),t._v(" é›†æˆå’Œè‡ªå®šä¹‰")]),t._v(" "),s("p",[t._v("Istioçš„ç­–ç•¥æ‰§è¡Œç»„ä»¶å¯ä»¥æ‰©å±•å’Œè‡ªå®šä¹‰ï¼Œä»¥ä¸ç°æœ‰çš„ACLï¼Œæ—¥å¿—è®°å½•ï¼Œç›‘è§†ï¼Œé…é¢ï¼Œå®¡æ ¸ç­‰é›†æˆã€‚")]),t._v(" "),s("h4",{attrs:{id:"æ¶æ„"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ¶æ„"}},[t._v("#")]),t._v(" æ¶æ„")]),t._v(" "),s("p",[t._v("IstioæœåŠ¡ç½‘æ ¼åœ¨é€»è¾‘ä¸Šåˆ†ä¸ºæ•°æ®å¹³é¢å’Œæ§åˆ¶å¹³é¢ã€‚")]),t._v(" "),s("ul",[s("li",[t._v("æ•°æ®planeç”±éƒ¨ç½²ä¸ºsidecarçš„ä¸€ç»„æ™ºèƒ½ä»£ç†ï¼ˆEnvoyï¼‰ç»„æˆã€‚è¿™äº›ä»£ç†ä¸­ä»‹å’Œæ§åˆ¶å¾®æœåŠ¡ä¸Mixerã€é€šç”¨ç­–ç•¥å’Œé¥æµ‹é›†çº¿å™¨ä¹‹é—´çš„æ‰€æœ‰ç½‘ç»œé€šä¿¡ã€‚")]),t._v(" "),s("li",[t._v("æ§åˆ¶å¹³é¢ç®¡ç†å¹¶å°†ä»£ç†é…ç½®ä¸ºè·¯ç”±æµé‡ã€‚å¦å¤–ï¼Œæ§åˆ¶å¹³é¢é…ç½®Mixersæ¥æ‰§è¡Œç­–ç•¥å’Œé‡‡é›†é¥æµ‹æ•°æ®ã€‚")])]),t._v(" "),s("p",[t._v("ä¸‹å›¾æ˜¾ç¤ºäº†ç»„æˆæ¯ä¸ªå¹³é¢çš„ä¸åŒç»„ä»¶:")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202205062326606.jpeg",alt:"screenshot"}})]),t._v(" "),s("h4",{attrs:{id:"envoy"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#envoy"}},[t._v("#")]),t._v(" Envoy")]),t._v(" "),s("p",[t._v("Istioä½¿ç”¨Envoyä»£ç†çš„æ‰©å±•ç‰ˆæœ¬ã€‚Envoyæ˜¯ä½¿ç”¨"),s("code",[t._v("C++")]),t._v("å¼€å‘çš„é«˜æ€§èƒ½ä»£ç†ï¼Œå¯ä¸ºæœåŠ¡ç½‘æ ¼ä¸­çš„æ‰€æœ‰æœåŠ¡è°ƒè§£æ‰€æœ‰å…¥ç«™å’Œå‡ºç«™æµé‡ã€‚Istioåˆ©ç”¨Envoyçš„è®¸å¤šå†…ç½®åŠŸèƒ½ï¼Œå¦‚ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("åŠ¨æ€æœåŠ¡å‘ç°")]),t._v(" "),s("li",[t._v("è´Ÿè½½å‡è¡¡")]),t._v(" "),s("li",[t._v("TLS termination")]),t._v(" "),s("li",[t._v("HTTP/2å’ŒgRPCä»£ç†")]),t._v(" "),s("li",[t._v("ç†”æ–­ï¼ˆCircuit breakersï¼‰")]),t._v(" "),s("li",[t._v("å¥åº·æ£€æŸ¥")]),t._v(" "),s("li",[t._v("åˆ†é˜¶æ®µæ¨å‡ºï¼ŒæŒ‰ç™¾åˆ†æ¯”åˆ†é…æµé‡")]),t._v(" "),s("li",[t._v("æ•…éšœæ³¨å…¥")]),t._v(" "),s("li",[t._v("ä¸°å¯Œçš„æŒ‡æ ‡")])]),t._v(" "),s("p",[t._v("Sidecarä»£ç†æ¨¡å‹è¿˜å…è®¸ä½ å°†IstioåŠŸèƒ½æ·»åŠ åˆ°ç°æœ‰éƒ¨ç½²ä¸­ï¼Œè€Œæ— éœ€é‡æ–°æ„é€ æˆ–é‡å†™ä»£ç ã€‚ä½ å¯ä»¥é˜…è¯»æ›´å¤šå…³äºä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨è®¾è®¡ç›®æ ‡ä¸­é€‰æ‹©è¿™ç§æ–¹æ³•çš„ä¿¡æ¯ã€‚")]),t._v(" "),s("h4",{attrs:{id:"mixer"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mixer"}},[t._v("#")]),t._v(" Mixer")]),t._v(" "),s("p",[t._v("Mixeræ˜¯ä¸€ä¸ªä¸å¹³å°æ— å…³çš„ç»„ä»¶ã€‚Mixerè·¨æœåŠ¡ç½‘æ ¼å®æ–½è®¿é—®æ§åˆ¶å’Œä½¿ç”¨ç­–ç•¥ï¼Œå¹¶ä»Envoyä»£ç†å’Œå…¶ä»–æœåŠ¡æ”¶é›†é¥æµ‹æ•°æ®ã€‚ ä»£ç†æå–è¯·æ±‚çº§åˆ«å±æ€§ï¼Œå¹¶å°†å…¶å‘é€åˆ°Mixerè¿›è¡Œè¯„ä¼°ã€‚æ‚¨å¯ä»¥åœ¨æˆ‘ä»¬çš„â€œMixeré…ç½®â€æ–‡æ¡£ä¸­æ‰¾åˆ°æœ‰å…³æ­¤å±æ€§æå–å’Œç­–ç•¥è¯„ä¼°çš„æ›´å¤šä¿¡æ¯ã€‚")]),t._v(" "),s("p",[t._v("MixeråŒ…å«ä¸€ä¸ªçµæ´»çš„æ’ä»¶æ¨¡å‹ã€‚è¯¥æ¨¡å‹ä½¿Istioå¯ä»¥ä¸å„ç§ä¸»æœºç¯å¢ƒå’ŒåŸºç¡€æ¶æ„åç«¯äº¤äº’ã€‚å› æ­¤ï¼ŒIstioä»è¿™äº›ç»†èŠ‚ä¸­æŠ½è±¡äº†Envoyä»£ç†å’ŒIstioç®¡ç†çš„æœåŠ¡ã€‚")]),t._v(" "),s("h4",{attrs:{id:"pilot"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pilot"}},[t._v("#")]),t._v(" Pilot")]),t._v(" "),s("p",[t._v("Pilotæä¾›äº†Envoy sidecarçš„æœåŠ¡å‘ç°ï¼Œæ™ºèƒ½è·¯ç”±çš„æµé‡ç®¡ç†åŠŸèƒ½ï¼ˆä¾‹å¦‚ A/Bæµ‹è¯•ï¼Œé‡‘ä¸é›€ç­‰ï¼‰å’Œå¼¹æ€§ï¼ˆè¶…æ—¶ï¼Œé‡è¯•ï¼Œæ–­è·¯å™¨ç­‰ï¼‰ã€‚")]),t._v(" "),s("p",[t._v("Pilotå°†æ§åˆ¶æµé‡è¡Œä¸ºçš„é«˜çº§è·¯ç”±è§„åˆ™è½¬æ¢ä¸ºEnvoyç‰¹å®šçš„é…ç½®ï¼Œå¹¶åœ¨è¿è¡Œæ—¶å°†å…¶ä¼ é€åˆ°sidecarã€‚Pilotæå–äº†ç‰¹å®šäºå¹³å°çš„æœåŠ¡å‘ç°æœºåˆ¶ï¼Œå¹¶å°†å®ƒä»¬åˆæˆä¸ºæ ‡å‡†æ ¼å¼ï¼Œä»»ä½•ç¬¦åˆEnvoyæ•°æ®å¹³é¢APIçš„Sidecaréƒ½å¯ä»¥ä½¿ç”¨ã€‚è¿™ç§æ¾æ•£çš„è€¦åˆä½¿å¾—Istioå¯ä»¥åœ¨Kubernetesï¼ŒConsulæˆ–Nomadç­‰å¤šç§ç¯å¢ƒä¸­è¿è¡Œï¼ŒåŒæ—¶ä¸ºæµé‡ç®¡ç†ä¿ç•™ç›¸åŒçš„æ“ä½œå‘˜ç•Œé¢ã€‚")]),t._v(" "),s("h4",{attrs:{id:"citadel"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#citadel"}},[t._v("#")]),t._v(" Citadel")]),t._v(" "),s("p",[t._v("Citadelé€šè¿‡å†…ç½®çš„èº«ä»½å’Œå‡­æ®ç®¡ç†å®ç°äº†å¼ºå¤§çš„æœåŠ¡åˆ°æœåŠ¡å’Œç»ˆç«¯ç”¨æˆ·çš„èº«ä»½éªŒè¯ã€‚å¯ä»¥ä½¿ç”¨Citadelæ¥å‡çº§æœåŠ¡ç½‘æ ¼ä¸­çš„æœªåŠ å¯†æµé‡ã€‚ä½¿ç”¨Citadelï¼Œè¿è¥å•†å¯ä»¥åŸºäºæœåŠ¡èº«ä»½è€Œä¸æ˜¯ç›¸å¯¹ä¸ç¨³å®šçš„3å±‚æˆ–4å±‚ç½‘ç»œè¯†åˆ«ç æ¥å®æ–½ç­–ç•¥ã€‚ä»ç‰ˆæœ¬0.5å¼€å§‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨Istioçš„æˆæƒåŠŸèƒ½æ¥æ§åˆ¶è°å¯ä»¥è®¿é—®æ‚¨çš„æœåŠ¡ã€‚")]),t._v(" "),s("h4",{attrs:{id:"galley"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#galley"}},[t._v("#")]),t._v(" Galley")]),t._v(" "),s("p",[t._v("Galleyæ˜¯Istioçš„é…ç½®éªŒè¯ï¼Œæå–ï¼Œå¤„ç†å’Œåˆ†å‘ç»„ä»¶ã€‚å®ƒè´Ÿè´£å°†å…¶ä½™Istioç»„ä»¶ä¸ä»åº•å±‚å¹³å°ï¼ˆä¾‹å¦‚Kubernetesï¼‰è·å–ç”¨æˆ·é…ç½®çš„ç»†èŠ‚éš”ç¦»å¼€æ¥ã€‚")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("æœ€å¤§åŒ–é€æ˜åº¦")]),t._v("ï¼šè¦é‡‡ç”¨Istioï¼Œè¦æ±‚æ“ä½œå‘˜æˆ–å¼€å‘äººå‘˜è¿›è¡Œå°½å¯èƒ½å°‘çš„å·¥ä½œï¼Œä»¥ä»ç³»ç»Ÿä¸­è·å¾—çœŸæ­£çš„ä»·å€¼ã€‚ä¸ºæ­¤ï¼ŒIstioå¯ä»¥è‡ªåŠ¨å°†å…¶è‡ªèº«æ’å…¥æœåŠ¡ä¹‹é—´çš„æ‰€æœ‰ç½‘ç»œè·¯å¾„ä¸­ã€‚Istioä½¿ç”¨Sidecarä»£ç†æ¥æ•è·æµé‡ï¼Œå¹¶åœ¨å¯èƒ½çš„æƒ…å†µä¸‹è‡ªåŠ¨å¯¹ç½‘ç»œå±‚è¿›è¡Œç¼–ç¨‹ï¼Œä»¥é€šè¿‡è¿™äº›ä»£ç†è·¯ç”±æµé‡ï¼Œè€Œæ— éœ€æ›´æ”¹å·²éƒ¨ç½²çš„åº”ç”¨ç¨‹åºä»£ç ã€‚ åœ¨Kubernetesä¸­ï¼Œä»£ç†è¢«æ³¨å…¥åˆ°Podä¸­ï¼Œå¹¶é€šè¿‡å¯¹iptablesè§„åˆ™è¿›è¡Œç¼–ç¨‹æ¥æ•è·æµé‡ã€‚ ä¸€æ—¦æ³¨å…¥äº†sidecarä»£ç†å¹¶ä¸”å¯¹æµé‡è·¯ç”±è¿›è¡Œäº†ç¼–ç¨‹ï¼ŒIstioå°±å¯ä»¥è°ƒè§£æ‰€æœ‰æµé‡ã€‚æ­¤åŸåˆ™ä¹Ÿé€‚ç”¨äºæ€§èƒ½ã€‚å°†Istioåº”ç”¨äºéƒ¨ç½²æ—¶ï¼Œè¿è¥å•†ä¼šå‘ç°æ‰€æä¾›åŠŸèƒ½çš„èµ„æºæˆæœ¬å¢åŠ æœ€å°ã€‚ç»„ä»¶å’ŒAPIå¿…é¡»åœ¨è®¾è®¡æ—¶å……åˆ†è€ƒè™‘æ€§èƒ½å’Œè§„æ¨¡ã€‚")]),t._v(" "),s("li",[s("code",[t._v("å¯æ‰©å±•æ€§")]),t._v("ï¼šéšç€è¿è¥å•†å’Œå¼€å‘äººå‘˜è¶Šæ¥è¶Šä¾èµ–Istioæä¾›çš„åŠŸèƒ½ï¼Œç³»ç»Ÿä¹Ÿå¿…é¡»éšç€ä»–ä»¬çš„éœ€æ±‚è€Œå¢é•¿ã€‚åœ¨æˆ‘ä»¬ç»§ç»­æ·»åŠ æ–°åŠŸèƒ½çš„åŒæ—¶ï¼Œæœ€å¤§çš„éœ€æ±‚æ˜¯æ‰©å±•ç­–ç•¥ç³»ç»Ÿï¼Œä¸å…¶ä»–ç­–ç•¥å’Œæ§åˆ¶æºé›†æˆä»¥åŠå°†æœ‰å…³ç½‘æ ¼è¡Œä¸ºçš„ä¿¡å·ä¼ é€åˆ°çš„å…¶ä»–ç³»ç»Ÿä»¥è¿›è¡Œåˆ†æã€‚ç­–ç•¥è¿è¡Œæ—¶æ”¯æŒæ’å…¥å…¶ä»–æœåŠ¡çš„æ ‡å‡†æ‰©å±•æœºåˆ¶ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜å…è®¸æ‰©å±•å…¶è¯æ±‡è¡¨ï¼Œä»è€Œå¯ä»¥æ ¹æ®ç½‘æ ¼ç”Ÿæˆçš„æ–°ä¿¡å·æ¥å®æ–½ç­–ç•¥ã€‚")]),t._v(" "),s("li",[s("code",[t._v("å¯ç§»æ¤æ€§")]),t._v("ï¼šä½¿ç”¨Istioçš„ç”Ÿæ€ç³»ç»Ÿåœ¨è®¸å¤šæ–¹é¢éƒ½ä¸åŒã€‚Istioå¿…é¡»èƒ½åœ¨ä»»ä½•äº‘ç«¯æˆ–æœ¬åœ°ç¯å¢ƒä¸­è¿è¡Œï¼Œåªéœ€æœ€å°‘çš„åŠªåŠ›ã€‚å°†åŸºäºIstioçš„æœåŠ¡ç§»æ¤åˆ°æ–°ç¯å¢ƒçš„ä»»åŠ¡å¿…é¡»å¾ˆç®€å•ã€‚ä½¿ç”¨Istioï¼Œæ‚¨å¯ä»¥æ“ä½œéƒ¨ç½²åˆ°å¤šä¸ªç¯å¢ƒä¸­çš„å•ä¸ªæœåŠ¡ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åœ¨å¤šä¸ªäº‘ä¸Šéƒ¨ç½²ä»¥å®ç°å†—ä½™ã€‚")]),t._v(" "),s("li",[s("code",[t._v("ç­–ç•¥ç»Ÿä¸€æ€§")]),t._v("ï¼šå°†ç­–ç•¥åº”ç”¨äºæœåŠ¡ä¹‹é—´çš„APIè°ƒç”¨æä¾›äº†å¯¹ç½‘æ ¼è¡Œä¸ºçš„å¤§é‡æ§åˆ¶ã€‚ä½†æ˜¯ï¼Œå°†ç­–ç•¥åº”ç”¨äºä¸ä¸€å®šåœ¨APIçº§åˆ«è¡¨è¾¾çš„èµ„æºä¹ŸåŒæ ·é‡è¦ã€‚ä¾‹å¦‚ï¼Œå¯¹MLè®­ç»ƒä»»åŠ¡æ¶ˆè€—çš„CPUæ•°é‡åº”ç”¨quotaæ¯”å¯¹å¯åŠ¨wrokçš„è°ƒç”¨åº”ç”¨quotaæ›´æœ‰ç”¨ã€‚ä¸ºæ­¤ï¼ŒIstioå°†ç­–ç•¥ç³»ç»Ÿä½œä¸ºå…·æœ‰å…¶è‡ªå·±çš„APIçš„ç‹¬ç‰¹æœåŠ¡æ¥ç»´æŠ¤ï¼Œè€Œä¸æ˜¯å°†ç­–ç•¥ç³»ç»Ÿçƒ˜ç„™åˆ°ä»£ç†Sidecarä¸­ï¼Œä»è€Œä½¿å¾—æœåŠ¡æ ¹æ®éœ€è¦ç›´æ¥ä¸å…¶é›†æˆã€‚")])]),t._v(" "),s("h2",{attrs:{id:"istioçš„å®‰è£…"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#istioçš„å®‰è£…"}},[t._v("#")]),t._v(" Istioçš„å®‰è£…")]),t._v(" "),s("h3",{attrs:{id:"ä½¿ç”¨-istioctl-å®‰è£…"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä½¿ç”¨-istioctl-å®‰è£…"}},[t._v("#")]),t._v(" ä½¿ç”¨ Istioctl å®‰è£…")]),t._v(" "),s("h4",{attrs:{id:"_1-æ‹‰å–istioçš„å®‰è£…åŒ…"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-æ‹‰å–istioçš„å®‰è£…åŒ…"}},[t._v("#")]),t._v(" 1.æ‹‰å–Istioçš„å®‰è£…åŒ…")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-O")]),t._v(" http://192.168.1.110/file/istio-1.9.5-linux-amd64.tar.gz\n\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v(" \nistio-1.9.5-linux-amd64.tar.gz\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-zxvf")]),t._v(" istio-1.9.5-linux-amd64.tar.gz\n")])])]),s("h4",{attrs:{id:"_2-å¤åˆ¶istioctlå·¥å…·"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-å¤åˆ¶istioctlå·¥å…·"}},[t._v("#")]),t._v(" 2.å¤åˆ¶istioctlå·¥å…·")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" istio-1.9.5/\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" bin/istioctl  /usr/local/bin/\n")])])]),s("h4",{attrs:{id:"_3-ä½¿ç”¨é»˜è®¤é…ç½®æ–‡ä»¶å®‰è£…-istio"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-ä½¿ç”¨é»˜è®¤é…ç½®æ–‡ä»¶å®‰è£…-istio"}},[t._v("#")]),t._v(" 3.ä½¿ç”¨é»˜è®¤é…ç½®æ–‡ä»¶å®‰è£… Istio")]),t._v(" "),s("p",[t._v("æœ€ç®€å•çš„é€‰æ‹©æ˜¯ ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…"),s("code",[t._v("default")]),t._v("Istio "),s("a",{attrs:{href:"https://istio.io/latest/docs/setup/additional-setup/config-profiles/",target:"_blank",rel:"noopener noreferrer"}},[t._v("é…ç½®æ–‡ä»¶"),s("OutboundLink")],1),t._v("ï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ istioctl "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n")])])]),s("h4",{attrs:{id:"_4-å®‰è£…ä¸åŒçš„é…ç½®æ–‡ä»¶"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-å®‰è£…ä¸åŒçš„é…ç½®æ–‡ä»¶"}},[t._v("#")]),t._v(" 4.å®‰è£…ä¸åŒçš„é…ç½®æ–‡ä»¶")]),t._v(" "),s("p",[t._v("é€šè¿‡åœ¨å‘½ä»¤è¡Œä¸Šä¼ é€’é…ç½®æ–‡ä»¶åç§°ï¼Œå¯ä»¥å°†å…¶ä»– Istio é…ç½®æ–‡ä»¶å®‰è£…åˆ°é›†ç¾¤ä¸­ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹å‘½ä»¤å¯ç”¨äºå®‰è£…"),s("code",[t._v("demo")]),t._v("é…ç½®æ–‡ä»¶ï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl  create  ns istio-system\n$ istioctl "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--set")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("profile")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("demo "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v("\nâœ” Istio core installed                                                   \nâœ” Istiod installed                                                  \nâœ” Egress gateways installed                                                        \nâœ” Ingress gateways installed                                                        \nâœ” Installation complete     \n")])])]),s("h4",{attrs:{id:"_5-æ£€æŸ¥å®‰è£…äº†ä»€ä¹ˆ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-æ£€æŸ¥å®‰è£…äº†ä»€ä¹ˆ"}},[t._v("#")]),t._v(" 5.æ£€æŸ¥å®‰è£…äº†ä»€ä¹ˆ")]),t._v(" "),s("p",[t._v("è¯¥"),s("code",[t._v("istioctl")]),t._v("å‘½ä»¤å°†"),s("code",[t._v("IstioOperator")]),t._v("ç”¨äºå®‰è£… Istioçš„CRä¿å­˜åœ¨åä¸º"),s("code",[t._v("installed-state")]),t._v(". è€Œä¸æ˜¯æ£€æŸ¥ Istio å®‰è£…çš„éƒ¨ç½²ã€podã€æœåŠ¡å’Œå…¶ä»–èµ„æºï¼Œä¾‹å¦‚ï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" istio-system get deploy\nNAME                   READY   UP-TO-DATE   AVAILABLE   AGE\nistio-egressgateway    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("            "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("           25s\nistio-ingressgateway   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("            "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("           24s\nistiod                 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("            "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("           20s\n")])])]),s("h4",{attrs:{id:"_6-æ³¨å…¥é»˜è®¤å˜é‡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-æ³¨å…¥é»˜è®¤å˜é‡"}},[t._v("#")]),t._v(" 6.æ³¨å…¥é»˜è®¤å˜é‡")]),t._v(" "),s("p",[t._v("å°†ç›®å½•æ›´æ”¹ä¸º Istio å®‰è£…çš„æ ¹ç›®å½•ã€‚")]),t._v(" "),s("p",[t._v("é»˜è®¤çš„ Istio å®‰è£…ä½¿ç”¨"),s("a",{attrs:{href:"https://istio.io/latest/docs/setup/additional-setup/sidecar-injection/#automatic-sidecar-injection",target:"_blank",rel:"noopener noreferrer"}},[t._v("è‡ªåŠ¨è¾¹è½¦æ³¨å…¥"),s("OutboundLink")],1),t._v("ã€‚æ ‡è®°å°†æ‰˜ç®¡åº”ç”¨ç¨‹åºçš„å‘½åç©ºé—´"),s("code",[t._v("istio-injection=enabled")]),t._v("ï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl label namespace default istio-injection"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("enabled \n")])])]),s("h4",{attrs:{id:"_7-å¸è½½-istio"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-å¸è½½-istio"}},[t._v("#")]),t._v(" 7.å¸è½½ Istio")]),t._v(" "),s("p",[t._v("è¦ä»é›†ç¾¤ä¸­å®Œå…¨å¸è½½ Istioï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ istioctl x uninstall "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--purge")]),t._v("\n")])])]),s("p",[t._v("å¯é€‰"),s("code",[t._v("--purge")]),t._v("æ ‡å¿—å°†åˆ é™¤æ‰€æœ‰ Istio èµ„æºï¼ŒåŒ…æ‹¬å¯èƒ½ä¸å…¶ä»– Istio æ§åˆ¶å¹³é¢å…±äº«çš„é›†ç¾¤èŒƒå›´çš„èµ„æºã€‚")]),t._v(" "),s("h3",{attrs:{id:"æµ‹è¯•ä¸€ä¸ªå®ä¾‹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æµ‹è¯•ä¸€ä¸ªå®ä¾‹"}},[t._v("#")]),t._v(" æµ‹è¯•ä¸€ä¸ªå®ä¾‹")]),t._v(" "),s("h4",{attrs:{id:"bookinfo"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#bookinfo"}},[t._v("#")]),t._v(" Bookinfo")]),t._v(" "),s("p",[s("strong",[t._v("Bookinfo åº”ç”¨ç¨‹åºåˆ†ä¸ºå››ä¸ªç‹¬ç«‹çš„å¾®æœåŠ¡ï¼š")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("productpage")]),t._v(". è¯¥"),s("code",[t._v("productpage")]),t._v("å¾®æœåŠ¡è°ƒç”¨"),s("code",[t._v("details")]),t._v("å’Œ"),s("code",[t._v("reviews")]),t._v("å¾®æœåŠ¡æ¥å¡«å……é¡µé¢ã€‚")]),t._v(" "),s("li",[s("code",[t._v("details")]),t._v(". è¯¥"),s("code",[t._v("details")]),t._v("å¾®æœåŠ¡åŒ…å«å›¾ä¹¦ä¿¡æ¯ã€‚")]),t._v(" "),s("li",[s("code",[t._v("reviews")]),t._v(". è¯¥"),s("code",[t._v("reviews")]),t._v("å¾®æœåŠ¡åŒ…å«äº†ä¹¦è¯„ã€‚å®ƒè¿˜è°ƒç”¨"),s("code",[t._v("ratings")]),t._v("å¾®æœåŠ¡ã€‚")]),t._v(" "),s("li",[s("code",[t._v("ratings")]),t._v(". è¯¥"),s("code",[t._v("ratings")]),t._v("å¾®æœåŠ¡åŒ…å«é¢„å®šä¼´éšä¹¦è¯„æ’åä¿¡æ¯ã€‚")])]),t._v(" "),s("p",[s("strong",[s("code",[t._v("reviews")]),t._v("å¾®æœåŠ¡æœ‰ 3 ä¸ªç‰ˆæœ¬ï¼š")])]),t._v(" "),s("ul",[s("li",[t._v("ç‰ˆæœ¬ v1 ä¸è°ƒç”¨è¯¥"),s("code",[t._v("ratings")]),t._v("æœåŠ¡ã€‚")]),t._v(" "),s("li",[t._v("ç‰ˆæœ¬ v2 è°ƒç”¨è¯¥"),s("code",[t._v("ratings")]),t._v("æœåŠ¡ï¼Œå¹¶å°†æ¯ä¸ªè¯„çº§æ˜¾ç¤ºä¸º 1 åˆ° 5 é¢—é»‘æ˜Ÿã€‚")]),t._v(" "),s("li",[t._v("ç‰ˆæœ¬ v3 è°ƒç”¨è¯¥"),s("code",[t._v("ratings")]),t._v("æœåŠ¡ï¼Œå¹¶å°†æ¯ä¸ªè¯„çº§æ˜¾ç¤ºä¸º 1 åˆ° 5 é¢—çº¢æ˜Ÿã€‚")])]),t._v(" "),s("p",[t._v("è¯¥åº”ç”¨ç¨‹åºçš„ç«¯åˆ°ç«¯æ¶æ„å¦‚ä¸‹æ‰€ç¤ºã€‚")]),t._v(" "),s("img",{staticStyle:{zoom:"80%"},attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202205062326474.png",alt:"image-20211214154321190"}}),t._v(" "),s("h4",{attrs:{id:"ä½¿ç”¨istioéƒ¨ç½²åº”ç”¨ç¨‹åºğŸš€"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä½¿ç”¨istioéƒ¨ç½²åº”ç”¨ç¨‹åºğŸš€"}},[t._v("#")]),t._v(" ä½¿ç”¨Istioéƒ¨ç½²åº”ç”¨ç¨‹åºğŸš€")]),t._v(" "),s("p",[t._v("ä½¿ç”¨ Istio è¿è¡Œç¤ºä¾‹ä¸éœ€è¦æ›´æ”¹åº”ç”¨ç¨‹åºæœ¬èº«ã€‚ç›¸åï¼Œæ‚¨åªéœ€è¦åœ¨æ”¯æŒ Istio çš„ç¯å¢ƒä¸­é…ç½®å’Œè¿è¡ŒæœåŠ¡ï¼Œå¹¶åœ¨æ¯ä¸ªæœåŠ¡æ—è¾¹æ³¨å…¥ Envoy sidecarã€‚ç”Ÿæˆçš„éƒ¨ç½²å°†å¦‚ä¸‹æ‰€ç¤ºï¼š")]),t._v(" "),s("img",{staticStyle:{zoom:"80%"},attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202205062326222.png",alt:"image-20211214154410424"}}),t._v(" "),s("h4",{attrs:{id:"å¯åŠ¨åº”ç”¨æœåŠ¡ğŸš€"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å¯åŠ¨åº”ç”¨æœåŠ¡ğŸš€"}},[t._v("#")]),t._v(" å¯åŠ¨åº”ç”¨æœåŠ¡ğŸš€")]),t._v(" "),s("p",[t._v("ä½¿ç”¨ä»¥ä¸‹"),s("code",[t._v("kubectl")]),t._v("å‘½ä»¤éƒ¨ç½²æ‚¨çš„åº”ç”¨ç¨‹åºï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" samples/bookinfo/platform/kube/bookinfo.yaml\n")])])]),s("h4",{attrs:{id:"æŸ¥çœ‹æ‰€æœ‰æœåŠ¡ğŸš€"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æŸ¥çœ‹æ‰€æœ‰æœåŠ¡ğŸš€"}},[t._v("#")]),t._v(" æŸ¥çœ‹æ‰€æœ‰æœåŠ¡ğŸš€")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master istio-1.9.5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get svc ")]),t._v("\nNAME          TYPE        CLUSTER-IP       EXTERNAL-IP   PORT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("S"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("    AGE\ndetails       ClusterIP   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.104")]),t._v(".17.202    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9080")]),t._v("/TCP   21m\nkubernetes    ClusterIP   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.96")]),t._v(".0.1        "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("/TCP    41m\nproductpage   ClusterIP   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.110")]),t._v(".235.179   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9080")]),t._v("/TCP   21m\nratings       ClusterIP   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.104")]),t._v(".53.51     "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9080")]),t._v("/TCP   21m\nreviews       ClusterIP   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.101")]),t._v(".21.63     "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9080")]),t._v("/TCP   21m\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master istio-1.9.5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get pods ")]),t._v("\nNAME                              READY   STATUS    RESTARTS   AGE\ndetails-v1-79f774bdb9-gwhkf       "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("/2     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          21m\nproductpage-v1-6b746f74dc-6dtg8   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("/2     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          21m\nratings-v1-b6994bb9-9h2wn         "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("/2     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          21m\nreviews-v1-545db77b95-6cmmv       "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("/2     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          21m\nreviews-v2-7bf8c9648f-m2k9d       "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("/2     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          21m\nreviews-v3-84779c7bbc-vd86b       "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("/2     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          21m\n")])])]),s("h4",{attrs:{id:"é€šè¿‡curlè¯·æ±‚æµ‹è¯•ğŸš€"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#é€šè¿‡curlè¯·æ±‚æµ‹è¯•ğŸš€"}},[t._v("#")]),t._v(" é€šè¿‡Curlè¯·æ±‚æµ‹è¯•ğŸš€")]),t._v(" "),s("p",[t._v("è¦ç¡®è®¤ Bookinfo åº”ç”¨ç¨‹åºæ­£åœ¨è¿è¡Œï¼Œè¯·é€šè¿‡"),s("code",[t._v("curl")]),t._v("æ¥è‡ªæŸä¸ª podçš„å‘½ä»¤å‘å…¶å‘é€è¯·æ±‚ï¼Œä¾‹å¦‚æ¥è‡ª"),s("code",[t._v("ratings")]),t._v("ï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master istio-1.9.5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# kubectl exec "$(kubectl get pod -l app=ratings -o jsonpath=\'{.items[0].metadata.name}\')" -c ratings -- curl -sS productpage:9080/productpage | grep -o "<title>.*</title>"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("title"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("Simple Bookstore App"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("/title"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),s("h4",{attrs:{id:"ç¡®å®šå…¥å£ipå’Œç«¯å£ğŸš€"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç¡®å®šå…¥å£ipå’Œç«¯å£ğŸš€"}},[t._v("#")]),t._v(" ç¡®å®šå…¥å£IPå’Œç«¯å£ğŸš€")]),t._v(" "),s("p",[t._v("ç°åœ¨ Bookinfo æœåŠ¡å·²å¯åŠ¨å¹¶è¿è¡Œï¼Œæ‚¨éœ€è¦ä½¿åº”ç”¨ç¨‹åºå¯ä» Kubernetes é›†ç¾¤å¤–éƒ¨è®¿é—®ï¼Œä¾‹å¦‚ä»æµè§ˆå™¨è®¿é—®ã€‚ä¸€ä¸ª"),s("a",{attrs:{href:"https://istio.io/latest/docs/concepts/traffic-management/#gateways",target:"_blank",rel:"noopener noreferrer"}},[t._v("Istioç½‘å…³"),s("OutboundLink")],1),t._v(" ç”¨äºæ­¤ç›®çš„ã€‚")]),t._v(" "),s("ol",[s("li",[s("strong",[s("code",[t._v("ä¸ºåº”ç”¨å®šä¹‰å…¥å£ç½‘å…³")])])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master istio-1.9.5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f samples/bookinfo/networking/bookinfo-gateway.yaml ")]),t._v("\ngateway.networking.istio.io/bookinfo-gateway created\nvirtualservice.networking.istio.io/bookinfo created\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[s("strong",[s("code",[t._v("ç¡®è®¤ç½‘å…³å·²åˆ›å»º")])])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master istio-1.9.5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get gateway ")]),t._v("\nNAME               AGE\nbookinfo-gateway   61s\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[s("strong",[s("code",[t._v("æ”¹ä¸ºNodePort")])])])]),t._v(" "),s("p",[t._v("æ­¤å¤„æˆ‘ä»¬å¹¶æ²¡æœ‰å¤–éƒ¨è´Ÿè½½ï¼Œæ‰€ä»¥è¦å°†svcä¿®æ”¹æˆNodePortçš„æ–¹å¼ã€‚")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master istio-1.9.5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get svc -n istio-system ")]),t._v("\nNAME                   TYPE         CLUSTER-IP      EXTERNAL-IP   PORT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("S"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("                                                                      AGE\nistio-egressgateway    ClusterIP    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.102")]),t._v(".197.30   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("/TCP,443/TCP,15443/TCP                                                     89m\nistio-ingressgateway   LoadBalancer "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.109")]),t._v(".71.35    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15021")]),t._v(":31964/TCP,80:31467/TCP,443:31845/TCP,31400:31077/TCP,15443:30757/TCP   89m\nistiod                 ClusterIP    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.111")]),t._v(".156.86   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15010")]),t._v("/TCP,15012/TCP,443/TCP,15014/TCP                                        90m\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#è®¿é—®masterIP+80ç«¯å£å¯¹åº”æš´éœ²çš„31962")]),t._v("\n")])])]),s("blockquote",[s("p",[s("code",[t._v("æ³¨æ„ï¼š å¦‚æœ EXTERNAL-IP è®¾ç½®äº†è¯¥å€¼ï¼Œåˆ™è¦æ±‚æ‚¨çš„ç¯å¢ƒå…·æœ‰å¯ç”¨äº Ingress ç½‘å…³çš„å¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨ã€‚å¦‚æœ EXTERNAL-IP å€¼æ˜¯ <none>ï¼ˆæˆ–ä¸€ç›´æ˜¯ <pending> ï¼‰ï¼Œåˆ™è¯´æ˜å¯èƒ½æ‚¨çš„ç¯å¢ƒä¸æ”¯æŒä¸º ingress ç½‘å…³æä¾›å¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨çš„åŠŸèƒ½ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Service çš„ node port æ–¹å¼è®¿é—®ç½‘å…³ã€‚")])])]),t._v(" "),s("p",[t._v("ä½¿ç”¨ kubectl patch æ›´æ–° istio-ingressgateway æœåŠ¡ç½‘å…³ç±»å‹")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master istio-1.9.5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# kubectl patch service istio-ingressgateway -n istio-system -p \'{"spec":{"type":"NodePort"}}\'')]),t._v("\n")])])]),s("p",[t._v("è®¾ç½®å…¥å£ç«¯å£")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("INGRESS_PORT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("kubectl "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" istio-system get "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" istio-ingressgateway "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("jsonpath")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{.spec.ports[?(@.name==\"http2\")].nodePort}'")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("SECURE_INGRESS_PORT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("kubectl "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" istio-system get "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" istio-ingressgateway "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("jsonpath")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{.spec.ports[?(@.name==\"https\")].nodePort}'")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("TCP_INGRESS_PORT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("kubectl "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" istio-system get "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" istio-ingressgateway "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("jsonpath")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{.spec.ports[?(@.name==\"tcp\")].nodePort}'")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n")])])]),s("p",[t._v("è·å–ingress ipåœ°å€")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("INGRESS_HOST")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("kubectl get po "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-l")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("istio")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ingressgateway "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" istio-system "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("jsonpath")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{.items[0].status.hostIP}'")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n")])])]),s("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202205062327570.png",alt:"image-20211214170233622"}}),t._v(" "),s("h4",{attrs:{id:"åº”ç”¨é»˜è®¤ç›®æ ‡è§„åˆ™ğŸš€"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#åº”ç”¨é»˜è®¤ç›®æ ‡è§„åˆ™ğŸš€"}},[t._v("#")]),t._v(" åº”ç”¨é»˜è®¤ç›®æ ‡è§„åˆ™ğŸš€")]),t._v(" "),s("p",[t._v("åœ¨ä½¿ç”¨ Istio æ§åˆ¶ Bookinfo ç‰ˆæœ¬è·¯ç”±ä¹‹å‰ï¼Œæ‚¨éœ€è¦åœ¨"),s("a",{attrs:{href:"https://istio.io/latest/docs/concepts/traffic-management/#destination-rules",target:"_blank",rel:"noopener noreferrer"}},[t._v("ç›®æ ‡è§„åˆ™ä¸­"),s("OutboundLink")],1),t._v("å®šä¹‰å¯ç”¨ç‰ˆæœ¬ï¼Œç§°ä¸ºå­é›†ã€‚")]),t._v(" "),s("p",[t._v("è¿è¡Œä»¥ä¸‹å‘½ä»¤ä¸º Bookinfo æœåŠ¡åˆ›å»ºé»˜è®¤ç›®æ ‡è§„åˆ™ï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" samples/bookinfo/networking/destination-rule-all.yaml\n")])])]),s("blockquote",[s("p",[t._v("åœ¨"),s("code",[t._v("default")]),t._v("ä¸"),s("code",[t._v("demo")]),t._v(" "),s("a",{attrs:{href:"https://istio.io/latest/docs/setup/additional-setup/config-profiles/",target:"_blank",rel:"noopener noreferrer"}},[t._v("é…ç½®è½®å»“"),s("OutboundLink")],1),t._v("å…·æœ‰"),s("a",{attrs:{href:"https://istio.io/latest/docs/tasks/security/authentication/authn-policy/#auto-mutual-tls",target:"_blank",rel:"noopener noreferrer"}},[t._v("è‡ªåŠ¨ç›¸äº’TLS"),s("OutboundLink")],1),t._v("å¯ç”¨é»˜è®¤æƒ…å†µä¸‹ã€‚è¦å¼ºåˆ¶å®æ–½åŒå‘ TLSï¼Œè¯·ä½¿ç”¨"),s("code",[t._v("samples/bookinfo/networking/destination-rule-all-mtls.yaml")]),t._v(".")])]),t._v(" "),s("h4",{attrs:{id:"æ¸…ç†ğŸš€"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ¸…ç†ğŸš€"}},[t._v("#")]),t._v(" æ¸…ç†ğŸš€")]),t._v(" "),s("p",[t._v("å½“æ‚¨å®Œæˆ Bookinfo ç¤ºä¾‹çš„è¯•éªŒåï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹è¯´æ˜å¸è½½å¹¶æ¸…ç†å®ƒï¼š")]),t._v(" "),s("p",[t._v("åˆ é™¤è·¯ç”±è§„åˆ™å¹¶ç»ˆæ­¢åº”ç”¨ç¨‹åº Pod")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ samples/bookinfo/platform/kube/cleanup.sh\n")])])]),s("p",[t._v("ç¡®è®¤å…³æœº")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl get virtualservices   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#-- there should be no virtual services")]),t._v("\n$ kubectl get destinationrules  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#-- there should be no destination rules")]),t._v("\n$ kubectl get gateway           "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#-- there should be no gateway")]),t._v("\n$ kubectl get pods              "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#-- the Bookinfo pods should be deleted")]),t._v("\n")])])]),s("h2",{attrs:{id:"ä»‹ç»istioæµé‡ç®¡ç†"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä»‹ç»istioæµé‡ç®¡ç†"}},[t._v("#")]),t._v(" ä»‹ç»Istioæµé‡ç®¡ç†")]),t._v(" "),s("h4",{attrs:{id:"é¦–å…ˆæ˜¯istioå¦‚ä½•åœ¨ç½‘æ ¼ç§å¼•å¯¼æµé‡çš„"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#é¦–å…ˆæ˜¯istioå¦‚ä½•åœ¨ç½‘æ ¼ç§å¼•å¯¼æµé‡çš„"}},[t._v("#")]),t._v(" é¦–å…ˆæ˜¯Istioå¦‚ä½•åœ¨ç½‘æ ¼ç§å¼•å¯¼æµé‡çš„ï¼Ÿ")]),t._v(" "),s("ol",[s("li",[t._v("é¦–å…ˆè¦çŸ¥é“æ‰€åœ¨çš„ç«¯ç‚¹åœ¨å“ªé‡Œï¼Ÿ")]),t._v(" "),s("li",[t._v("ä»¥åŠå®ƒä»¬å±äºå“ªäº›æœåŠ¡ï¼Ÿ")]),t._v(" "),s("li",[t._v("å¡«å……è‡ªå·±çš„æœåŠ¡æ³¨å†Œï¼ˆå°±æ˜¯å†…éƒ¨çš„æ³¨å†Œè¡¨ï¼Œç”¨æ¥ç”Ÿæˆä¸€äº›Envoyé…ç½®ï¼‰è¿æ¥åˆ°æœåŠ¡å‘ç°ç³»ç»Ÿã€‚")]),t._v(" "),s("li",[t._v("åœ¨Kubernetesä¸­å®‰è£…Istioï¼Œé‚£ä¹ˆIstioä¼šè‡ªåŠ¨æ£€æµ‹é›†ç¾¤ä¸­çš„æœåŠ¡å’Œç«¯ç‚¹ã€‚")])]),t._v(" "),s("h4",{attrs:{id:"åœ¨kubernetesä¸­å¦‚ä½•ä½¿ç”¨istio"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#åœ¨kubernetesä¸­å¦‚ä½•ä½¿ç”¨istio"}},[t._v("#")]),t._v(" åœ¨Kubernetesä¸­å¦‚ä½•ä½¿ç”¨istioï¼Ÿ")]),t._v(" "),s("p",[t._v("1.é€šè¿‡Kuberneteså®‰è£…istioä¹‹åå¯¹"),s("code",[t._v("K8Sä½¿ç”¨CRDæ‰©å±•ï¼Œ ä¹Ÿå°±æ˜¯Kubernetesçš„ APIæ‰©å±•")]),t._v("ï¼Œistioä¹Ÿèƒ½åƒå…¶ä»– çš„resoucesä¸€æ ·ä½¿ç”¨ã€‚\n2.é€šè¿‡ä½¿ç”¨Kubrenetes APIçš„æ‰©å±•ï¼Œå¯ä»¥ä½¿ç”¨èµ„æºæœ‰ è™šæ‹ŸæœåŠ¡ã€ç›®çš„è§„åˆ™ã€ç½‘å…³ã€æœåŠ¡æ¡ç›®ã€è¾¹è½¦ã€‚")]),t._v(" "),s("h4",{attrs:{id:"åœ¨istioä¸­èƒ½å­¦åˆ°ä»€ä¹ˆ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#åœ¨istioä¸­èƒ½å­¦åˆ°ä»€ä¹ˆ"}},[t._v("#")]),t._v(" åœ¨istioä¸­èƒ½å­¦åˆ°ä»€ä¹ˆï¼Ÿ")]),t._v(" "),s("p",[t._v("1.å¯ä»¥å­¦ä¹ åˆ°æµé‡çš„ç®¡ç†ã€å…¥å£å‡ºå£æµé‡ç®¡ç†ã€‚")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("è¯·æ±‚è·¯ç”±")])]),t._v(" "),s("li",[s("code",[t._v("æ•…éšœæ³¨å…¥")])]),t._v(" "),s("li",[s("code",[t._v("äº¤é€šè½¬ç§»")])]),t._v(" "),s("li",[s("code",[t._v("TCPæµé‡è½¬ç§»")])]),t._v(" "),s("li",[s("code",[t._v("è¯·æ±‚è¶…æ—¶")])]),t._v(" "),s("li",[s("code",[t._v("ç†”æ–­")])]),t._v(" "),s("li",[s("code",[t._v("é•œåƒ")])]),t._v(" "),s("li",[s("code",[t._v("å±€éƒ¨è´Ÿè½½å‡è¡¡")])]),t._v(" "),s("li",[s("code",[t._v("å…¥å£çš„ç½‘å…³")])]),t._v(" "),s("li",[s("code",[t._v("å‡ºå£çš„è®¿é—®å¤–éƒ¨æœåŠ¡")])])]),t._v(" "),s("h4",{attrs:{id:"ä»€ä¹ˆæ˜¯è™šæ‹ŸæœåŠ¡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä»€ä¹ˆæ˜¯è™šæ‹ŸæœåŠ¡"}},[t._v("#")]),t._v(" ä»€ä¹ˆæ˜¯è™šæ‹ŸæœåŠ¡ï¼Ÿ")]),t._v(" "),s("p",[t._v("è™šæ‹ŸæœåŠ¡ä»¥åŠç›®æ ‡è§„åˆ™æ˜¯Istioæµé‡è·¯ç”±åŠŸèƒ½çš„å…³é”®æ„å»ºå—ã€‚è™šæ‹ŸæœåŠ¡å…è®¸æ‚¨é…ç½®å¦‚ä½•å°†è¯·æ±‚çš„è·¯ç”±åˆ°Istioçš„æœåŠ¡ç½‘æ ¼ä¸­çš„æœåŠ¡ã€‚ å»ºç«‹åœ¨Istioå’Œæ‚¨çš„å¹³å°æä¾›åŸºæœ¬çš„è¿æ¥å’Œå‘ç°ä¹‹ä¸Šã€‚æ¯ä¸€ä¸ªè™šæ‹ŸæœåŠ¡éƒ½åŒ…å«äº†ä¸€ç»„æŒ‰é¡ºåºè¯„ä¼°çš„è·¯ç”±è§„åˆ™ï¼Œè®©Istioå°†æ¯ä¸€ä¸ªç»™å®šçš„è™šæ‹ŸæœåŠ¡è¯·æ±‚åŒ¹é…åˆ°ç½‘æ ¼ä¸­ç‰¹å®šçœŸå®çš„ç›®çš„åœ°ã€‚")]),t._v(" "),s("h4",{attrs:{id:"ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è™šæ‹ŸæœåŠ¡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è™šæ‹ŸæœåŠ¡"}},[t._v("#")]),t._v(" ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è™šæ‹ŸæœåŠ¡ï¼Ÿ")]),t._v(" "),s("p",[t._v("1.é€šè¿‡å°†å®¢æˆ·ç«¯ä»å®é™…å®ç°å®ƒä»¬çš„ç›®æ ‡å·¥ä½œè´Ÿè½½å‘é€è¯·æ±‚çš„ä½ç½®å¼ºè§£è€¦æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚è™šæ‹ŸæœåŠ¡è¿˜æä¾›ä¸€ç§ä¸°å¯Œçš„æ–¹å¼æ¥æŒ‡å®šä¸åŒçš„æµé‡è·¯ç”±è§„åˆ™ï¼Œä»¥å°†æµé‡å‘é€åˆ°è¿™äº›å·¥ä½œè´Ÿè½½ã€‚")]),t._v(" "),s("p",[t._v("2.ä¸ºä»€ä¹ˆè¯´è¿™å¾ˆæœ‰ç”¨ï¼Ÿ Envoyåœ¨æ‰€æœ‰æœåŠ¡å®ä¾‹ä¹‹é—´ä½¿ç”¨å¾ªç¯è´Ÿè½½å¹³è¡¡æ¥åˆ†é…æµé‡ï¼Œå¯¹æ­¤è¿›è¡Œäº†æ”¹è¿›ï¼Œå¯ä»¥é’ˆå¯¹ç™¾åˆ†æ¯”è¿›è¡Œç‰¹å®šçš„æµé‡å¼•å¯¼ã€‚")]),t._v(" "),s("p",[t._v("3.å¯ä»¥ä¸€ä¸ªæˆ–è€…å¤šä¸ªæŒ‡å®šä¸»æœºåæŒ‡å®šæµé‡è¡Œä¸ºã€‚ åœ¨è™šæ‹ŸæœåŠ¡ä¸­ï¼Œä½¿ç”¨è·¯ç”±è§„åˆ™æ¥å‘Šè¯‰Envoyå¦‚ä½•å°†è™šæ‹ŸæœåŠ¡çš„æµé‡å‘é€åˆ°åˆé€‚çš„åœ°æ–¹ã€‚")]),t._v(" "),s("p",[t._v("4.è¿˜å¯ä»¥å°†å•ä¸ªè™šæ‹ŸæœåŠ¡å¤„ç†å¤šä¸ªåº”ç”¨ç¨‹åºã€‚ ç»“åˆç½‘å…³çš„æµé‡è§„åˆ™ï¼Œæ§åˆ¶æµé‡è¿›å‡ºã€‚")]),t._v(" "),s("h4",{attrs:{id:"è™šæ‹ŸæœåŠ¡å®ä¾‹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#è™šæ‹ŸæœåŠ¡å®ä¾‹"}},[t._v("#")]),t._v(" è™šæ‹ŸæœåŠ¡å®ä¾‹")]),t._v(" "),s("p",[t._v("ä»¥ä¸‹çš„è™šæ‹ŸæœåŠ¡æ ¹æ®è¯·æ±‚æ˜¯å¦æ¥è‡ªç‰¹å®šçš„ç”¨æˆ·ï¼Œå°†è¯·æ±‚è·¯ç”±åˆ°ä¸åŒç‰ˆæœ¬çš„æœåŠ¡ã€‚")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" VirtualService\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" reviews\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" reviews\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("match")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("headers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("end-user")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("exact")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" jason\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" reviews\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subset")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v2\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" reviews\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subset")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v3\n")])])]),s("h4",{attrs:{id:"ä¸»æœºå­—æ®µ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä¸»æœºå­—æ®µ"}},[t._v("#")]),t._v(" ä¸»æœºå­—æ®µ")]),t._v(" "),s("p",[t._v("1."),s("code",[t._v("hostså­—æ®µ")]),t._v("åˆ—å‡ºäº†è™šæ‹ŸæœåŠ¡çš„ä¸»æœºï¼Œè¿™äº›è·¯ç”±è§„åˆ™é€‚ç”¨çš„ç”¨æˆ·å¯ä»¥å¯»å€ç›®çš„æˆ–ç›®çš„åœ°ã€‚è¿™æ˜¯å®¢æˆ·ç«¯åœ¨å‘ æœåŠ¡å‘é€è¯·æ±‚æ—¶ä½¿ç”¨çš„åœ°å€ã€‚\n2.ä¸»æœºåå¯ä»¥æ˜¯"),s("code",[t._v("IPåœ°å€")]),t._v("ï¼Œä¹Ÿå¯ä»¥æ˜¯"),s("code",[t._v("DNSåç§°")]),t._v("ä»¥åŠè§£æçš„ã€‚")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" reviews\n")])])]),s("h4",{attrs:{id:"è·¯ç”±è§„åˆ™"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#è·¯ç”±è§„åˆ™"}},[t._v("#")]),t._v(" è·¯ç”±è§„åˆ™")]),t._v(" "),s("p",[t._v("1.è¯¥httpéƒ¨åˆ†åŒ…å«è™šæ‹ŸæœåŠ¡çš„è·¯ç”±è§„åˆ™ï¼Œæè¿°äº†å°†"),s("code",[t._v("HTTP/1.1 HTTP2å’ŒgRPCæµé‡")]),t._v("è·¯ç”±åˆ°hostså­—æ®µä¸­æŒ‡å®šçš„ ç›®æ ‡çš„åŒ¹é…æ¡ä»¶å’Œæ“ä½œã€‚\n2.åŒ¹é…æ¡ä»¶ï¼ˆç¤ºä¾‹ä¸­çš„ç¬¬ä¸€ä¸ªè·¯ç”±æœ‰ä¸€ä¸ªæ¡ä»¶ï¼Œå› æ­¤ä»¥matchå­—æ®µå¼€å¤´ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¸Œæœ›æ­¤è·¯ç”±é€‚ ç”¨äºæ¥è‡ªç”¨æˆ·â€˜jasonâ€™çš„æ‰€æœ‰è¯·æ±‚ï¼Œå› æ­¤æ‚¨ä½¿ç”¨headersã€end-userå’Œexactå­—æ®µæ¥é€‰æ‹©é€‚å½“çš„è¯·æ±‚ã€‚ï¼‰")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("match")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("headers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n       "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("end-user")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n         "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("exact")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" jason\n")])])]),s("h4",{attrs:{id:"ç›®çš„åœ°"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç›®çš„åœ°"}},[t._v("#")]),t._v(" ç›®çš„åœ°")]),t._v(" "),s("p",[t._v("è·¯ç”±éƒ¨åˆ†"),s("code",[t._v("destinationå­—æ®µ")]),t._v("æŒ‡å®šç¬¦åˆæ¡ä»¶çš„æµé‡å®é™…ç›®çš„åœ°ã€‚ ä¸è™šæ‹Ÿä¸»æœºä¸åŒï¼Œç›®æ ‡ä¸»æœºå¿…é¡»å­˜åœ¨äºistioæœåŠ¡æ³¨å†Œè¡¨ä¸­çœŸå®ç›®æ ‡ï¼Œå¦åˆ™Envoyå°†ä¸çŸ¥é“å°†æµé‡å‘é€åˆ°ä½•å¤„ã€‚")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("routeï¼š\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destintion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" reviews\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subnet")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v2\n")])])]),s("h4",{attrs:{id:"è·¯ç”±è§„åˆ™ä¼˜å…ˆçº§"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#è·¯ç”±è§„åˆ™ä¼˜å…ˆçº§"}},[t._v("#")]),t._v(" è·¯ç”±è§„åˆ™ä¼˜å…ˆçº§")]),t._v(" "),s("p",[t._v("è·¯ç”±è§„åˆ™æŒ‰ç…§ä¸Šåˆ°ä¸‹çš„é¡ºåºè¿›è¡Œè¯„ä¼°ï¼Œ"),s("code",[t._v("è™šæ‹ŸæœåŠ¡å®šä¹‰ä¸­çš„ç¬¬ä¸€ä¸ªè§„åˆ™è¢«èµ‹äºˆæœ€é«˜ä¼˜å…ˆçº§ã€‚")]),t._v(" åœ¨è¿™ç§æƒ…å†µä¸‹ ï¼Œæ‚¨å¸Œæœ›ä»»ä½•ç¬¬ä¸€æ¡è·¯ç”±è§„åˆ™ä¸åŒ¹é…çš„ä¸œè¥¿éƒ½è½¬åˆ°ç¬¬äºŒæ¡è§„åˆ™ä¸­æŒ‡å®šé»˜è®¤çš„ç›®çš„åœ°ã€‚ å› æ­¤ï¼Œç¬¬äºŒæ¡è§„åˆ™ æ²¡æœ‰åŒ¹é…æ¡ä»¶ï¼Œåªæ˜¯å°†æµé‡å®šå‘åˆ°v3å­é›†ã€‚")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" reviews\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subnet")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v3\n")])])]),s("h4",{attrs:{id:"æœ‰å…³è·¯ç”±çš„æ›´å¤šä¿¡æ¯"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æœ‰å…³è·¯ç”±çš„æ›´å¤šä¿¡æ¯"}},[t._v("#")]),t._v(" æœ‰å…³è·¯ç”±çš„æ›´å¤šä¿¡æ¯")]),t._v(" "),s("p",[t._v("è·¯ç”±è§„åˆ™æ˜¯å°†ç‰¹å®šæµé‡å­é›†è·¯ç”±åˆ°ç‰¹å®šç›®çš„åœ°çš„å¼ºå¤§å·¥å…·ã€‚"),s("code",[t._v("æ‚¨å¯ä»¥å¯¹æµé‡ç«¯å£ã€æ ‡å¤´å­—æ®µã€URLç­‰è®¾ç½®åŒ¹ é…æ¡ä»¶")]),t._v("ï¼Œä¾‹å¦‚ï¼šæ­¤è™šæ‹ŸæœåŠ¡å…è®¸ç”¨æˆ·å°†æµé‡å‘é€åˆ°ä¸¤ä¸ªå•ç‹¬çš„æœåŠ¡ï¼Œè¯„åˆ†å’Œè¯„è®ºï¼Œå°±å¥½åƒå®ƒä»¬æ˜¯æ›´å¤§çš„è™šæ‹ŸæœåŠ¡çš„ä¸€éƒ¨åˆ†ä¸€æ ·ã€‚è™šæ‹ŸæœåŠ¡è§„åˆ™æ ¹æ®è¯·æ±‚çš„URLåŒ¹é…æµé‡ï¼Œå¹¶å°†æµé‡è¯·æ±‚å®šå‘åˆ°åˆé€‚çš„æœåŠ¡ã€‚")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" VirtualService\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" bookinfo\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" bookinfo.com\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("match")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("prefix")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /reviews\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" reviews\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("match")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("prefix")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /ratings\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ratings\n")])])]),s("p",[t._v('é™¤äº†ä½¿ç”¨åŒ¹é…æ¡ä»¶å¤–ï¼Œæ‚¨è¿˜å¯ä»¥æŒ‰"æƒé‡"ç™¾åˆ†æ¯”åˆ†é…æµé‡ã€‚è¿™å¯¹äºA/Bæµ‹è¯•å’Œé‡‘ä¸é›€å‘å¸ƒå¾ˆæœ‰ç”¨ã€‚')]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" reviews\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" route\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" reviews\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subnet")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("weight")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("75")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" reviews\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subnet")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v2\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("weight")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),t._v("\n")])])]),s("p",[t._v("æ‚¨è¿˜å¯ä»¥ä½¿ç”¨è·¯ç”±è§„åˆ™å¯¹æµé‡æ‰§è¡Œä¸€äº›æ“ä½œï¼Œä¾‹å¦‚ï¼š")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("é™„åŠ æˆ–åˆ é™¤æ ‡é¢˜")])]),t._v(" "),s("li",[s("code",[t._v("é‡å†™ç½‘å€")])]),t._v(" "),s("li",[s("code",[t._v("ä¸ºå¯¹è¯¥ç›®çš„åœ°çš„è°ƒç”¨è®¾ç½®é‡è¯•ç­–ç•¥")])])]),t._v(" "),s("h4",{attrs:{id:"ç›®çš„åœ°è§„åˆ™"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç›®çš„åœ°è§„åˆ™"}},[t._v("#")]),t._v(" ç›®çš„åœ°è§„åˆ™")]),t._v(" "),s("p",[t._v('1.ç›®æ ‡è§„åˆ™æ˜¯Istioæµé‡è·¯ç”±åŠŸèƒ½çš„å…³é”®éƒ¨åˆ†ã€‚å¯ä»¥å°†è™šæ‹ŸæœåŠ¡è§†ä¸ºæµé‡å°†è·¯ç”±ç»™å®šç›® çš„åœ°çš„æ–¹å¼ï¼Œç›®æ ‡è§„åˆ™åœ¨è¯„ä¼°è™šæ‹ŸæœåŠ¡è·¯ç”±è§„åˆ™ååº”ç”¨ï¼Œå› æ­¤å®ƒä»¬é€‚ç”¨äºæµé‡çš„"çœŸå®"ç›®æ ‡ã€‚\n2.ç‰¹åˆ«æ˜¯ï¼Œæ‚¨ä½¿ç”¨ç›®æ ‡è§„åˆ™æ¥æŒ‡å®šå‘½åçš„æœåŠ¡å­é›†ï¼Œä¾‹å¦‚æŒ‰ç‰ˆæœ¬å¯¹æ‰€æœ‰ç»™å®šæœåŠ¡çš„å®ä¾‹è¿›è¡Œåˆ†ç»„ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥åœ¨è™šæ‹ŸæœåŠ¡çš„è·¯ç”±è§„åˆ™ä¸­ä½¿ç”¨è¿™äº›æœåŠ¡å­é›†æ¥æ§åˆ¶åˆ°ä¸åŒæœåŠ¡å®ä¾‹çš„æµé‡ã€‚\n3.ç›®æ ‡è§„åˆ™è¿˜å…è®¸æ‚¨åœ¨è°ƒç”¨æ•´ä¸ªç›®æ ‡æœåŠ¡æˆ–ç‰¹å®šæœåŠ¡å­é›†æ—¶è‡ªå®šä¹‰ Envoy çš„æµé‡ç­–ç•¥ï¼Œä¾‹å¦‚æ‚¨é¦–é€‰çš„è´Ÿ è½½å¹³è¡¡æ¨¡å‹ã€TLS å®‰å…¨æ¨¡å¼æˆ–æ–­è·¯å™¨è®¾ç½®ã€‚')]),t._v(" "),s("h4",{attrs:{id:"è´Ÿè½½å¹³è¡¡é€‰é¡¹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#è´Ÿè½½å¹³è¡¡é€‰é¡¹"}},[t._v("#")]),t._v(" è´Ÿè½½å¹³è¡¡é€‰é¡¹")]),t._v(" "),s("p",[t._v("é»˜è®¤æƒ…å†µä¸‹ï¼ŒIstio ä½¿ç”¨å¾ªç¯è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œå®ä¾‹æ± ä¸­çš„æ¯ä¸ªæœåŠ¡å®ä¾‹ä¾æ¬¡æ”¶åˆ°è¯·æ±‚ã€‚Istio è¿˜æ”¯æŒä»¥ä¸‹æ¨¡å‹ï¼Œæ‚¨å¯ä»¥åœ¨ç›®æ ‡è§„åˆ™ä¸­ä¸ºå¯¹ç‰¹å®šæœåŠ¡æˆ–æœåŠ¡å­é›†çš„è¯·æ±‚æŒ‡å®šè¿™äº›æ¨¡å‹ã€‚")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("éšæœºï¼š")]),t._v("è¯·æ±‚éšæœºè½¬å‘åˆ°æ± ä¸­çš„å®ä¾‹ã€‚")]),t._v(" "),s("li",[s("code",[t._v("åŠ æƒï¼š")]),t._v("æ ¹æ®ç‰¹å®šç™¾åˆ†æ¯”å°†è¯·æ±‚è½¬å‘åˆ°æ± ä¸­çš„å®ä¾‹ã€‚")]),t._v(" "),s("li",[s("code",[t._v("æœ€å°‘è¯·æ±‚ï¼š")]),t._v("è¯·æ±‚è¢«è½¬å‘åˆ°è¯·æ±‚æ•°é‡æœ€å°‘çš„å®ä¾‹ã€‚")])]),t._v(" "),s("h4",{attrs:{id:"ç›®æ ‡è§„åˆ™ç¤ºä¾‹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç›®æ ‡è§„åˆ™ç¤ºä¾‹"}},[t._v("#")]),t._v(" ç›®æ ‡è§„åˆ™ç¤ºä¾‹")]),t._v(" "),s("p",[t._v("ä»¥ä¸‹ç¤ºä¾‹ç›®æ ‡è§„åˆ™ä¸ºmy-svcç›®æ ‡æœåŠ¡é…ç½®äº†ä¸‰ä¸ªä¸åŒçš„å­é›†ï¼Œå…·æœ‰ä¸åŒçš„è´Ÿè½½å¹³è¡¡ç­–ç•¥ï¼š")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" DestinationRule\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("destination"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("rule\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("svc\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("trafficPolicy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("loadBalancer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("simple")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" RANDOM\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subsets")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v2\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v2\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("trafficPolicy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("loadBalancer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("simple")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ROUND_ROBIN\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v3\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v3\n")])])]),s("p",[t._v("æ¯ä¸ªå­é›†éƒ½æ˜¯åŸºäºä¸€ä¸ªæˆ–å¤šä¸ªå®šä¹‰çš„labelsï¼Œåœ¨Kubernetesä¸­ï¼Œå®ƒä»¬æ˜¯é™„åŠ åˆ°Podç­‰å¯¹è±¡çš„é”®/å€¼å¯¹ã€‚è¿™äº›æ ‡ç­¾åº”ç”¨äºKubernetesæœåŠ¡çš„éƒ¨ç½²ï¼Œmetadataä»¥è¯†åˆ«ä¸åŒçš„ç‰ˆæœ¬ã€‚")]),t._v(" "),s("p",[t._v("é™¤äº†å®šä¹‰å­é›†ä¹‹å¤–ï¼Œæ­¤ç›®æ ‡è§„åˆ™è¿˜å…·æœ‰é’ˆå¯¹æ­¤ç›®æ ‡ä¸­æ‰€æœ‰å­é›†çš„é»˜è®¤æµé‡ç­–ç•¥å’Œä»…é’ˆå¯¹è¯¥å­é›†è¦†ç›–å®ƒçš„å­é›†ç‰¹å®šç­–ç•¥ã€‚åœ¨è¯¥å­—æ®µä¸Šæ–¹å®šä¹‰çš„é»˜è®¤ç­–ç•¥ä¸ºå’Œå­é›†subsets è®¾ç½®ç®€å•çš„éšæœºè´Ÿè½½å‡è¡¡å™¨ã€‚åœ¨ ç­–ç•¥ä¸­ï¼Œ åœ¨ç›¸åº”å­é›†çš„å­—æ®µä¸­æŒ‡å®šäº†å¾ªç¯è´Ÿè½½å‡è¡¡å™¨ã€‚v1v3v2")]),t._v(" "),s("h4",{attrs:{id:"ç½‘å…³"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç½‘å…³"}},[t._v("#")]),t._v(" ç½‘å…³")]),t._v(" "),s("p",[t._v("1.æ‚¨ä½¿ç”¨ç½‘å…³æ¥ç®¡ç†ç½‘æ ¼çš„å…¥ç«™å’Œå‡ºç«™æµé‡ï¼Œè®©æ‚¨"),s("code",[t._v("æŒ‡å®šè¦è¿›å…¥æˆ–ç¦»å¼€ç½‘æ ¼çš„æµé‡")]),t._v("ã€‚ç½‘å…³é…ç½®åº”ç”¨äºåœ¨ç½‘æ ¼è¾¹ç¼˜è¿è¡Œçš„ç‹¬ç«‹ Envoy ä»£ç†ï¼Œè€Œä¸æ˜¯ä¸æœåŠ¡å·¥ä½œè´Ÿè½½ä¸€èµ·è¿è¡Œçš„ Sidecar Envoy ä»£ç†ã€‚\n2.ä¸æ§åˆ¶è¿›å…¥ç³»ç»Ÿçš„æµé‡çš„å…¶ä»–æœºåˆ¶ï¼ˆä¾‹å¦‚ Kubernetes Ingress APIï¼‰ä¸åŒï¼Œ"),s("code",[t._v("Istio ç½‘å…³è®©æ‚¨å¯ä»¥ä½¿ç”¨ Istio æµé‡è·¯ç”±çš„å…¨éƒ¨åŠŸèƒ½å’Œçµæ´»æ€§")]),t._v("ã€‚æ‚¨å¯ä»¥è¿™æ ·åšï¼Œå› ä¸º Istio çš„ç½‘å…³èµ„æºåªå…è®¸æ‚¨é…ç½® 4-6 å±‚è´Ÿè½½å¹³è¡¡å±æ€§ï¼Œä¾‹å¦‚è¦å…¬å¼€çš„ç«¯å£ã€TLS è®¾ç½®ç­‰ã€‚ç„¶åï¼Œæ‚¨æ— éœ€å°†åº”ç”¨å±‚æµé‡è·¯ç”± (L7) æ·»åŠ åˆ°åŒä¸€ API èµ„ æºï¼Œè€Œæ˜¯å°†å¸¸è§„ Istioè™šæ‹ŸæœåŠ¡ç»‘å®šåˆ°ç½‘å…³ã€‚è¿™ä½¿æ‚¨å¯ä»¥åƒç®¡ç† Istio ç½‘æ ¼ä¸­çš„ä»»ä½•å…¶ä»–æ•°æ®å¹³é¢æµé‡ ä¸€æ ·ç®¡ç†ç½‘å…³æµé‡ã€‚\n3."),s("code",[t._v("ç½‘å…³ä¸»è¦ç”¨äºç®¡ç†å…¥å£æµé‡ï¼Œä½†æ‚¨ä¹Ÿå¯ä»¥é…ç½®å‡ºå£ç½‘å…³")]),t._v("ã€‚ä¾‹å¦‚ï¼Œå‡ºå£ç½‘å…³å…è®¸æ‚¨ä¸ºç¦»å¼€ç½‘æ ¼çš„æµé‡é…ç½®ä¸“ç”¨å‡ºå£èŠ‚ç‚¹ï¼Œè®©æ‚¨é™åˆ¶å“ªäº›æœåŠ¡å¯ä»¥æˆ–åº”è¯¥è®¿é—®å¤–éƒ¨ç½‘ç»œï¼Œæˆ–è€…å¯ç”¨ å¯¹å‡ºå£æµé‡çš„å®‰å…¨æ§åˆ¶ ä»¥å¢åŠ ç½‘æ ¼çš„å®‰å…¨æ€§ã€‚æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ç½‘å…³æ¥é…ç½®çº¯å†…éƒ¨ä»£ç†ã€‚\n4.Istio æä¾›äº†ä¸€äº›æ‚¨å¯ä»¥ä½¿ç”¨çš„é¢„é…ç½®ç½‘å…³ä»£ç†éƒ¨ç½² (istio-ingressgatewayå’Œistio-egressgateway)å¦‚æœæ‚¨ä½¿ç”¨æˆ‘ä»¬çš„æ¼”ç¤ºå®‰è£…ï¼Œåˆ™ä¼šéƒ¨ç½²ä¸¤è€…ï¼Œè€Œä»…ä½¿ç”¨æˆ‘ä»¬çš„é»˜è®¤é…ç½®æ–‡ä»¶éƒ¨ç½²å…¥å£ç½‘å…³ ã€‚æ‚¨å¯ä»¥å°†è‡ª å·±çš„ç½‘å…³é…ç½®åº”ç”¨äºè¿™äº›éƒ¨ç½²ï¼Œæˆ–è€…éƒ¨ç½²å’Œé…ç½®è‡ªå·±çš„ç½‘å…³ä»£ç†ã€‚")]),t._v(" "),s("h4",{attrs:{id:"ç½‘å…³ç¤ºä¾‹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç½‘å…³ç¤ºä¾‹"}},[t._v("#")]),t._v(" ç½‘å…³ç¤ºä¾‹")]),t._v(" "),s("p",[t._v("ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¤–éƒ¨ HTTPS å…¥å£æµé‡çš„å¯èƒ½ç½‘å…³é…ç½®ï¼š\næ­¤ç½‘å…³é…ç½®"),s("code",[t._v("å…è®¸ HTTPS æµé‡")]),t._v("ä»"),s("code",[t._v("ext-host.example.comç«¯å£ 443 è¿›å…¥ç½‘æ ¼")]),t._v("ï¼Œä½†æ²¡æœ‰ä¸ºæµé‡æŒ‡å®šä»»ä½•è·¯ç”±ã€‚")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Gateway\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ext"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("host"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("gwy\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("gateway"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("controller\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("servers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("number")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" HTTPS\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ext"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("host.example.com\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tls")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" SIMPLE\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("credentialName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ext"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("host"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cert\n")])])]),s("p",[t._v("è¦æŒ‡å®šè·¯ç”±å¹¶ä½¿ç½‘å…³æŒ‰é¢„æœŸå·¥ä½œï¼Œæ‚¨è¿˜å¿…é¡»å°†ç½‘å…³ç»‘å®šåˆ°è™šæ‹ŸæœåŠ¡ã€‚æ‚¨å¯ä»¥ä½¿ç”¨è™šæ‹ŸæœåŠ¡çš„gatewayså­— æ®µæ‰§è¡Œæ­¤æ“ä½œï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" VirtualService\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" virtual"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("svc\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ext"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("host.example.com\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gateways")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ext"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("host"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("gwy\n")])])]),s("p",[t._v("ç„¶åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å¤–éƒ¨æµé‡çš„è·¯ç”±è§„åˆ™é…ç½®è™šæ‹ŸæœåŠ¡ã€‚")]),t._v(" "),s("h4",{attrs:{id:"æœåŠ¡æ¡ç›®"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æœåŠ¡æ¡ç›®"}},[t._v("#")]),t._v(" æœåŠ¡æ¡ç›®")]),t._v(" "),s("p",[t._v("æ‚¨å¯ä»¥ä½¿ç”¨æœåŠ¡æ¡ç›®å‘Istioå†…éƒ¨ç»´æŠ¤çš„æœåŠ¡æ³¨å†Œè¡¨æ·»åŠ ä¸€ä¸ªæ¡ç›®ã€‚æ·»åŠ æœåŠ¡æ¡ç›®ä¹‹åï¼ŒEnvoyä»£ç†å¯ä»¥å°†æµé‡å‘é€åˆ°æœåŠ¡ï¼Œå°±å¥½åƒå®ƒæ˜¯ç½‘æ ¼ä¸­çš„æœåŠ¡ä¸€æ ·ã€‚é…ç½®æœåŠ¡æ¡ç›®å…è®¸æ‚¨ç®¡ç†åœ¨ç½‘æ ¼ä¹‹å¤–å…è®¸çš„æœåŠ¡æµé‡ï¼ŒåŒ…æ‹¬ä»¥ä¸‹ä»»åŠ¡ï¼š")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("é‡å®šå‘å’Œè½¬å‘å¤–éƒ¨ç›®çš„åœ°çš„æµé‡")]),t._v("ï¼Œä¾‹å¦‚ä»webä½¿ç”¨çš„APIï¼Œæˆ–åˆ°æ—§åŸºç¡€è®¾æ–½ä¸­çš„æœåŠ¡æµé‡ã€‚")]),t._v(" "),s("li",[s("code",[t._v("ä¸ºå¤–éƒ¨ç›®æ ‡å®šä¹‰é‡è¯•ã€è¶…æ—¶å’Œæ•…éšœæ³¨å…¥ç­–ç•¥ã€‚")])]),t._v(" "),s("li",[s("code",[t._v("é€šè¿‡è™šæ‹Ÿæœºæ·»åŠ ç½‘æ ¼ä¸­ï¼Œåœ¨è™šæ‹Ÿæœºä¸­å…è®¸ç½‘æ ¼æœåŠ¡ã€‚")])])]),t._v(" "),s("p",[t._v("æ‚¨æ— éœ€å¸Œæœ›ç½‘æ ¼æœåŠ¡ä½¿ç”¨çš„æ¯ä¸ªå¤–éƒ¨æœåŠ¡æ·»åŠ æœåŠ¡æ¡ç›®ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒIstioå°†Envoyä»£ç†è®¾ç½®ä¸ºå°†è¯·æ±‚ä¼ é€’ç»™æœªçŸ¥æœåŠ¡ã€‚ä½†æ˜¯ï¼Œæ‚¨ä¸èƒ½ä½¿ç”¨IstioåŠŸèƒ½æ¥æ§åˆ¶åˆ°æœªæ¥åœ¨ç½‘æ ¼ä¸­æ³¨å†Œçš„ç›®çš„åœ°æµé‡ã€‚")]),t._v(" "),s("h4",{attrs:{id:"æœåŠ¡å…¥å£ç¤ºä¾‹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æœåŠ¡å…¥å£ç¤ºä¾‹"}},[t._v("#")]),t._v(" æœåŠ¡å…¥å£ç¤ºä¾‹")]),t._v(" "),s("p",[t._v("ä»¥ä¸‹ç¤ºä¾‹ç½‘æ ¼å¤–éƒ¨æœåŠ¡æ¡ç›®"),s("code",[t._v("å°†ext-svc.example.com å¤–éƒ¨ä¾èµ–é¡¹æ·»åŠ åˆ° Istio çš„æœåŠ¡æ³¨å†Œè¡¨")]),t._v("ï¼š\næ‚¨ä½¿ç”¨è¯¥hostså­—æ®µæŒ‡å®šå¤–éƒ¨èµ„æºã€‚æ‚¨å¯ä»¥å®Œå…¨é™å®šå®ƒæˆ–ä½¿ç”¨é€šé…ç¬¦å‰ç¼€çš„åŸŸåã€‚")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ServiceEntry\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" svc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("entry\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ext"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("svc.example.com\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("number")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" HTTPS\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("location")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" MESH_EXTERNAL\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resolution")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" DNS\n")])])]),s("p",[t._v("æ‚¨å¯ä»¥é…ç½®è™šæ‹ŸæœåŠ¡å’Œç›®æ ‡è§„åˆ™ï¼Œä»¥æ›´ç²¾ç»†çš„æ–¹å¼æ§åˆ¶æœåŠ¡æ¡ç›®çš„æµé‡ï¼Œå°±åƒä¸ºç½‘æ ¼ä¸­çš„ä»»ä½•å…¶ä»–æœåŠ¡é…ç½®æµé‡ä¸€æ ·ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹ç›®æ ‡è§„åˆ™å°†æµé‡è·¯ç”±é…ç½®ä¸ºä½¿ç”¨"),s("code",[t._v("åŒå‘ TLS æ¥ä¿æŠ¤ä¸ ext-svc.example.comæˆ‘ä»¬ ä½¿ç”¨æœåŠ¡æ¡ç›®é…ç½®çš„å¤–éƒ¨æœåŠ¡çš„è¿æ¥")]),t._v("ï¼š")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" DestinationRule\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ext"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dr\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ext"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("svc.example.com\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("trafficPolicy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tls")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" MUTUAL\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("clientCertificate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/certs/myclientcert.pem\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("privateKey")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/certs/client_private_key.pem\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("caCertificates")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/certs/rootcacerts.pem\n")])])]),s("h4",{attrs:{id:"è¾¹è½¦"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#è¾¹è½¦"}},[t._v("#")]),t._v(" è¾¹è½¦")]),t._v(" "),s("p",[t._v("é»˜è®¤æƒ…å†µä¸‹ï¼ŒIstioå°†æ¯ä¸ªEnvoä»£ç†é…ç½®ä¸ºæ¥å—å…¶ç›¸å…³å·¥ä½œè´Ÿè½½çš„æ‰€æœ‰ç«¯å£ä¸Šçš„æµé‡ï¼Œå¹¶åœ¨è½¬å‘æµé‡æ—¶åˆ° è¾¾ç½‘æ ¼ä¸­çš„æ¯ä¸ªå·¥ä½œè´Ÿè½½ã€‚æ‚¨å¯ä»¥ä½¿ç”¨sidecaré…ç½®æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("å¾®è°ƒEnvoyä»£ç†æ¥å—çš„ç«¯å£å’Œåè®®é›†")])]),t._v(" "),s("li",[s("code",[t._v("é™åˆ¶Envoyä»£ç†å¯ä»¥è®¿é—®çš„æœåŠ¡é›†")])])]),t._v(" "),s("p",[t._v("æ‚¨å¯èƒ½å¸Œæœ›åœ¨å¤§å‹çš„åº”ç”¨ç¨‹åºåƒè¿™æ ·é™åˆ¶sidecarçš„å¯è®¿é—®æ€§ï¼Œå…¶ä¸­å°†æ¯ä¸ªä»£ç†é…ç½®ä¸ºè®¿é—®ç½‘æ ¼ä¸­çš„æ‰€æœ‰ å…¶ä»–æœåŠ¡å¯èƒ½ä¼šç”±äºé«˜å†…å­˜çš„ä½¿ç”¨ç‡è€Œå½±å“ç½‘æ ¼çš„æ€§èƒ½ã€‚")]),t._v(" "),s("p",[t._v("æ‚¨å¯ä»¥æŒ‡å®šå¸Œæœ›å°† sidecar é…ç½®åº”ç”¨äºç‰¹å®šå‘½åç©ºé—´ä¸­çš„æ‰€æœ‰å·¥ä½œè´Ÿè½½ï¼Œæˆ–è€…ä½¿ç”¨ workloadSelector. ä¾‹å¦‚ï¼Œä»¥ä¸‹ sidecar é…ç½®å°†å‘½åç©ºé—´ä¸­çš„æ‰€æœ‰æœåŠ¡é…ç½®bookinfoä¸ºä»…è®¿é—®åœ¨åŒä¸€å‘½åç©ºé—´å’Œ Istio æ§åˆ¶å¹³é¢ä¸­è¿è¡Œçš„æœåŠ¡ï¼ˆIstio çš„å‡ºå£å’Œé¥æµ‹åŠŸèƒ½éœ€è¦ï¼‰ï¼š")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Sidecar\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" default\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" bookinfo\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("egress")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./*"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"istio-system/*"')]),t._v("\n")])])]),s("h4",{attrs:{id:"ç½‘ç»œå¼¹æ€§å’Œæµ‹è¯•"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç½‘ç»œå¼¹æ€§å’Œæµ‹è¯•"}},[t._v("#")]),t._v(" ç½‘ç»œå¼¹æ€§å’Œæµ‹è¯•")]),t._v(" "),s("p",[t._v("é™¤äº†å¸®åŠ©æ‚¨å¼•å¯¼ç½‘æ ¼å‘¨å›´çš„æµé‡å¤–ï¼ŒIstio è¿˜æä¾›äº†å¯é€‰çš„æ•…éšœæ¢å¤å’Œæ•…éšœæ³¨å…¥åŠŸèƒ½ï¼Œæ‚¨å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€é…ç½®è¿™äº›åŠŸèƒ½ã€‚ä½¿ç”¨è¿™äº›åŠŸèƒ½å¯ä»¥å¸®åŠ©æ‚¨çš„åº”ç”¨ç¨‹åºå¯é åœ°è¿è¡Œï¼Œç¡®ä¿æœåŠ¡ç½‘æ ¼å¯ä»¥å®¹å¿æ•…éšœèŠ‚ç‚¹å¹¶é˜²æ­¢å±€éƒ¨æ•…éšœçº§è”åˆ°å…¶ä»–èŠ‚ç‚¹ã€‚")]),t._v(" "),s("h4",{attrs:{id:"è¶…æ—¶"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#è¶…æ—¶"}},[t._v("#")]),t._v(" è¶…æ—¶")]),t._v(" "),s("p",[s("code",[t._v("è¶…æ—¶æ˜¯ Envoy ä»£ç†åº”è¯¥ç­‰å¾…æ¥è‡ªç»™å®šæœåŠ¡çš„å›å¤çš„æ—¶é—´é‡ï¼Œç¡®ä¿æœåŠ¡ä¸ä¼šæ— é™æœŸåœ°ç­‰å¾…å›å¤ï¼Œå¹¶ä¸”è°ƒç”¨ åœ¨å¯é¢„æµ‹çš„æ—¶é—´èŒƒå›´å†…æˆåŠŸæˆ–å¤±è´¥ã€‚")]),t._v("é»˜è®¤æƒ…å†µä¸‹ï¼ŒIstio ä¸­ç¦ç”¨äº† HTTP è¯·æ±‚çš„ Envoy è¶…æ—¶.")]),t._v(" "),s("p",[t._v("å¯¹äºæŸäº›åº”ç”¨ç¨‹åºå’ŒæœåŠ¡ï¼ŒIstio çš„é»˜è®¤è¶…æ—¶å¯èƒ½ä¸åˆé€‚ã€‚ä¾‹å¦‚ï¼Œè¿‡é•¿çš„è¶…æ—¶å¯èƒ½ä¼šå¯¼è‡´ç­‰å¾…æ¥è‡ªå¤±è´¥æœåŠ¡çš„å›å¤çš„å»¶è¿Ÿè¿‡é•¿ï¼Œè€Œè¿‡çŸ­çš„è¶…æ—¶å¯èƒ½ä¼šå¯¼è‡´è°ƒç”¨åœ¨ç­‰å¾…æ¶‰åŠå¤šä¸ªæœåŠ¡çš„æ“ä½œè¿”å›æ—¶ä¸å¿…è¦åœ°å¤±è´¥ã€‚ä¸ºäº†æ‰¾åˆ°å¹¶ä½¿ç”¨æ‚¨çš„æœ€ä½³è¶…æ—¶è®¾ç½®ï¼ŒIstio å…è®¸æ‚¨ä½¿ç”¨è™šæ‹ŸæœåŠ¡è½»æ¾åœ°åœ¨æ¯ä¸ªæœåŠ¡çš„åŸºç¡€ä¸ŠåŠ¨æ€è°ƒæ•´è¶…æ—¶ï¼Œè€Œæ— éœ€ç¼–è¾‘æ‚¨çš„æœåŠ¡ä»£ç ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªè™šæ‹ŸæœåŠ¡ï¼Œå®ƒä¸ºè°ƒç”¨ rating æœåŠ¡çš„ v1 å­é›†æŒ‡å®šäº† 10 ç§’çš„è¶…æ—¶æ—¶é—´ï¼š")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" VirtualService\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ratings\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ratings\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ratings\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subset")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("timeout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10s\n")])])]),s("h4",{attrs:{id:"é‡è¯•"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#é‡è¯•"}},[t._v("#")]),t._v(" é‡è¯•")]),t._v(" "),s("p",[s("code",[t._v("é‡è¯•è®¾ç½®æŒ‡å®š Envoy ä»£ç†åœ¨åˆå§‹è°ƒç”¨å¤±è´¥æ—¶å°è¯•è¿æ¥æœåŠ¡çš„æœ€å¤§æ¬¡æ•°ã€‚")]),t._v("é‡è¯•å¯ä»¥é€šè¿‡ç¡®ä¿è°ƒç”¨ä¸ä¼šå› ä¸º ä¸´æ—¶æ€§é—®é¢˜ï¼ˆä¾‹å¦‚ä¸´æ—¶è¿‡è½½çš„æœåŠ¡æˆ–ç½‘ç»œï¼‰è€Œæ°¸ä¹…å¤±è´¥ï¼Œä»è€Œæé«˜æœåŠ¡å¯ç”¨æ€§å’Œåº”ç”¨ç¨‹åºæ€§èƒ½ã€‚é‡è¯•é—´éš”ï¼ˆ25ms+ï¼‰æ˜¯å¯å˜çš„ï¼Œç”± Istio è‡ªåŠ¨ç¡®å®šï¼Œé˜²æ­¢è¢«è°ƒç”¨çš„æœåŠ¡è¢«è¯·æ±‚æ·¹æ²¡ã€‚HTTP è¯·æ±‚çš„é»˜è®¤é‡è¯•è¡Œä¸ºæ˜¯ åœ¨è¿”å›é”™è¯¯ä¹‹å‰é‡è¯•ä¸¤æ¬¡ã€‚")]),t._v(" "),s("p",[t._v("ä¸è¶…æ—¶ä¸€æ ·ï¼ŒIstio çš„é»˜è®¤é‡è¯•è¡Œä¸ºå¯èƒ½ä¸é€‚åˆæ‚¨çš„åº”ç”¨ç¨‹åºåœ¨å»¶è¿Ÿï¼ˆå¤±è´¥çš„æœåŠ¡é‡è¯•æ¬¡æ•°è¿‡å¤šå¯èƒ½ä¼šå‡æ…¢é€Ÿåº¦ï¼‰æˆ–å¯ç”¨æ€§æ–¹é¢çš„éœ€æ±‚ã€‚ä¹Ÿåƒè¶…æ—¶ä¸€æ ·ï¼Œæ‚¨å¯ä»¥åœ¨è™šæ‹ŸæœåŠ¡ä¸­åŸºäºæ¯ä¸ªæœåŠ¡è°ƒæ•´é‡è¯•è®¾ç½®ï¼Œè€Œæ— éœ€æ¥è§¦æ‚¨çš„æœåŠ¡ä»£ç ã€‚æ‚¨è¿˜å¯ä»¥é€šè¿‡æ·»åŠ æ¯æ¬¡é‡è¯•è¶…æ—¶æ¥è¿›ä¸€æ­¥ä¼˜åŒ–æ‚¨çš„é‡è¯•è¡Œä¸ºï¼ŒæŒ‡å®šæ‚¨å¸Œæœ›ç­‰å¾…æ¯æ¬¡é‡è¯•å°è¯•æˆåŠŸè¿æ¥åˆ°æœåŠ¡çš„æ—¶é—´é‡ã€‚ä»¥ä¸‹ç¤ºä¾‹åœ¨åˆå§‹è°ƒç”¨å¤±è´¥åé…ç½®æœ€å¤š 3 æ¬¡é‡è¯•ä»¥è¿æ¥åˆ°æ­¤æœåŠ¡å­é›†ï¼Œ æ¯æ¬¡é‡è¯•æ—¶é—´ä¸º 2 ç§’ã€‚")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" VirtualService\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ratings\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ratings\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ratings\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subset")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("retries")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("attempts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("perTryTimeout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 2s\n")])])]),s("h4",{attrs:{id:"ç†”æ–­"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç†”æ–­"}},[t._v("#")]),t._v(" ç†”æ–­")]),t._v(" "),s("p",[s("code",[t._v("ç†”æ–­æ˜¯ Istio æä¾›çš„å¦ä¸€ç§æœ‰ç”¨çš„æœºåˆ¶ï¼Œç”¨äºåˆ›å»ºåŸºäºå¾®æœåŠ¡çš„å¼¹æ€§åº”ç”¨ç¨‹åºã€‚")]),t._v("åœ¨æ–­è·¯å™¨ä¸­ï¼Œæ‚¨å¯ä»¥ è®¾ç½®å¯¹æœåŠ¡ä¸­å„ä¸ªä¸»æœºçš„è°ƒç”¨é™åˆ¶ï¼Œä¾‹å¦‚å¹¶å‘è¿æ¥æ•°æˆ–å¯¹è¯¥ä¸»æœºçš„è°ƒç”¨å¤±è´¥çš„æ¬¡æ•°ã€‚ä¸€æ—¦è¾¾åˆ°è¯¥é™åˆ¶ï¼Œæ–­è·¯å™¨å°±ä¼šâ€œè·³é—¸â€å¹¶åœæ­¢ä¸è¯¥ä¸»æœºçš„è¿›ä¸€æ­¥è¿æ¥ã€‚ä½¿ç”¨æ–­è·¯å™¨æ¨¡å¼å¯ä»¥å®ç°å¿«é€Ÿæ•…éšœï¼Œè€Œä¸æ˜¯å®¢æˆ·ç«¯å°è¯•è¿æ¥åˆ°è¿‡è½½æˆ–æ•…éšœä¸»æœºã€‚")]),t._v(" "),s("p",[t._v("ç”±äºæ–­è·¯å™¨é€‚ç”¨äºè´Ÿè½½å¹³è¡¡æ± ä¸­çš„â€œçœŸå®â€ç½‘æ ¼ç›®æ ‡ï¼Œæ‚¨å¯ä»¥åœ¨ç›®æ ‡è§„åˆ™ä¸­é…ç½®æ–­è·¯å™¨é˜ˆå€¼ ï¼Œå¹¶å°†è®¾ç½®åº” ç”¨äºæœåŠ¡ä¸­çš„æ¯ä¸ªå•ç‹¬çš„ä¸»æœºã€‚ä»¥ä¸‹ç¤ºä¾‹reviewså°† v1 å­é›†çš„æœåŠ¡å·¥ä½œè´Ÿè½½çš„å¹¶å‘è¿æ¥æ•°é™åˆ¶ä¸º 100ï¼š")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" DestinationRule\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" reviews\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" reviews\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subsets")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("trafficPolicy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("connectionPool")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tcp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("maxConnections")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("\n")])])]),s("h4",{attrs:{id:"æ•…éšœæ³¨å…¥"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ•…éšœæ³¨å…¥"}},[t._v("#")]),t._v(" æ•…éšœæ³¨å…¥")]),t._v(" "),s("p",[s("code",[t._v("é…ç½®å¥½ç½‘ç»œï¼ˆåŒ…æ‹¬æ•…éšœæ¢å¤ç­–ç•¥ï¼‰åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Istio çš„æ•…éšœæ³¨å…¥æœºåˆ¶æ¥æµ‹è¯•æ•´ä¸ªåº”ç”¨ç¨‹åºçš„æ•…éšœæ¢å¤èƒ½åŠ›ã€‚")]),t._v("æ•…éšœæ³¨å…¥æ˜¯ä¸€ç§å°†é”™è¯¯å¼•å…¥ç³»ç»Ÿä»¥ç¡®ä¿ç³»ç»Ÿèƒ½å¤Ÿæ‰¿å—å¹¶ä»é”™è¯¯æ¡ä»¶ä¸­æ¢å¤çš„æµ‹è¯•æ–¹æ³•ã€‚ä½¿ç”¨æ•…éšœæ³¨å…¥å¯¹äºç¡®ä¿æ‚¨çš„æ•…éšœæ¢å¤ç­–ç•¥ä¸ä¼šä¸å…¼å®¹æˆ–é™åˆ¶è¿‡å¤šï¼Œå¯èƒ½ä¼šå¯¼è‡´å…³é”®æœåŠ¡ä¸å¯ç”¨ç‰¹åˆ«æœ‰ç”¨ã€‚")]),t._v(" "),s("p",[t._v("ä¸å…¶ä»–å¼•å…¥é”™è¯¯çš„æœºåˆ¶ï¼ˆä¾‹å¦‚å»¶è¿Ÿæ•°æ®åŒ…æˆ–åœ¨ç½‘ç»œå±‚æ€æ­» podï¼‰ä¸åŒï¼ŒIstio å…è®¸æ‚¨åœ¨åº”ç”¨ç¨‹åºå±‚æ³¨å…¥æ•…éšœã€‚è¿™ä½¿æ‚¨å¯ä»¥æ³¨å…¥æ›´å¤šç›¸å…³æ•…éšœï¼Œä¾‹å¦‚ HTTP é”™è¯¯ä»£ç ï¼Œä»¥è·å¾—æ›´å¤šç›¸å…³ç»“æœã€‚")]),t._v(" "),s("p",[t._v("æ‚¨å¯ä»¥æ³¨å…¥ä¸¤ç§ç±»å‹çš„æ•…éšœï¼Œå‡ä½¿ç”¨ è™šæ‹ŸæœåŠ¡è¿›è¡Œé…ç½®ï¼š")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("å»¶è¿Ÿï¼š")]),t._v("å»¶è¿Ÿæ˜¯è®¡æ—¶å¤±è´¥ã€‚å®ƒä»¬æ¨¡ä»¿å¢åŠ çš„ç½‘ç»œå»¶è¿Ÿæˆ–è¿‡è½½çš„ä¸Šæ¸¸æœåŠ¡ã€‚")]),t._v(" "),s("li",[s("code",[t._v("ä¸­æ­¢ï¼š")]),t._v("ä¸­æ­¢æ˜¯å´©æºƒå¤±è´¥ã€‚å®ƒä»¬æ¨¡ä»¿ä¸Šæ¸¸æœåŠ¡ä¸­çš„æ•…éšœã€‚ä¸­æ­¢é€šå¸¸ä»¥ HTTP é”™è¯¯ä»£ç æˆ– TCP è¿æ¥å¤±è´¥çš„ å½¢å¼å‡ºç°ã€‚")])]),t._v(" "),s("p",[t._v("ä¾‹å¦‚ï¼Œæ­¤è™šæ‹ŸæœåŠ¡å¯¹ratingsæœåŠ¡çš„æ¯ 1000 ä¸ªè¯·æ±‚ä¸­çš„ 1 ä¸ªå¼•å…¥äº† 5 ç§’çš„å»¶è¿Ÿã€‚")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" VirtualService\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ratings\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ratings\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fault")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("delay")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("percentage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.1")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fixedDelay")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 5s\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ratings\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subset")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n")])])]),s("h2",{attrs:{id:"sidecaræ³¨å…¥"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sidecaræ³¨å…¥"}},[t._v("#")]),t._v(" Sidecaræ³¨å…¥")]),t._v(" "),s("h4",{attrs:{id:"å¯¹å·¥ä½œè´Ÿè½½çš„ä¸€äº›è¦æ±‚"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å¯¹å·¥ä½œè´Ÿè½½çš„ä¸€äº›è¦æ±‚"}},[t._v("#")]),t._v(" å¯¹å·¥ä½œè´Ÿè½½çš„ä¸€äº›è¦æ±‚")]),t._v(" "),s("p",[t._v("æ”¯æŒçš„å·¥ä½œè´Ÿè½½ç±»å‹ï¼š")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("Job")])]),t._v(" "),s("li",[s("code",[t._v("DaemonSet")])]),t._v(" "),s("li",[s("code",[t._v("ReplicaSet")])]),t._v(" "),s("li",[s("code",[t._v("Pod")])]),t._v(" "),s("li",[s("code",[t._v("Deployment")])])]),t._v(" "),s("p",[t._v("ç­‰ï¼Œå¯¹è¿™äº›å·¥ä½œè´Ÿè½½çš„è¦æ±‚å¦‚ä¸‹ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("è¦æ­£ç¡®å‘½åæœåŠ¡ç«¯å£ï¼š\n"),s("ul",[s("li",[s("code",[t._v("Service")]),t._v(" å¯¹è±¡ä¸­çš„ "),s("code",[t._v("Port")]),t._v(' éƒ¨åˆ†å¿…é¡»ä»¥ "åè®®å" ä¸ºå‰ç¼€ï¼Œç›®å‰æ”¯æŒçš„åè®®ååŒ…æ‹¬ '),s("code",[t._v("http")]),t._v("ï¼Œ"),s("code",[t._v("http2")]),t._v("ï¼Œ"),s("code",[t._v("mongo")]),t._v("ï¼Œ"),s("code",[t._v("redis")]),t._v(" ä¸ "),s("code",[t._v("grpc")]),t._v("ï¼›")]),t._v(" "),s("li",[t._v("istio ä¼šå‘½åæ¥ç¡®å®šä¸ºç«¯å£æä¾›ä»€ä¹ˆæ ·çš„æœåŠ¡ï¼Œä¸ç¬¦åˆå‘½åè§„èŒƒçš„ç«¯å£ä¼šè¢«å½“åš TCP æœåŠ¡å™¨ï¼Œå…¶åŠŸèƒ½æ”¯æŒèŒƒå›´ä¼šå¤§å¹…ç¼©å°ã€‚")])])]),t._v(" "),s("li",[t._v("å·¥ä½œè´Ÿè½½çš„ Pod å¿…é¡»æœ‰å…³è”çš„ Serviceï¼š\n"),s("ul",[s("li",[t._v("ä¸ºæ»¡è¶³æœåŠ¡å‘ç°çš„éœ€è¦ï¼Œæ‰€æœ‰ Pod éƒ½å¿…é¡»æœ‰å…³è”çš„æœåŠ¡ï¼›")]),t._v(" "),s("li",[t._v("å®˜æ–¹å»ºè®®ä¸º Pod æ¨¡æ¿åŠ å…¥ä¸¤ä¸ªæ ‡ç­¾ï¼š"),s("code",[t._v("app")]),t._v(" ä¸ "),s("code",[t._v("version")]),t._v("ï¼Œåˆ†åˆ«æ ‡æ³¨åº”ç”¨åç§°ä¸ç‰ˆæœ¬ï¼Œè™½ä»…æ˜¯ä¸ªå»ºè®®ï¼Œä½† istio å¾ˆå¤šé»˜è®¤ç­–ç•¥ä¼šå¼•ç”¨è¿™ä¸¤ä¸ªæ ‡ç­¾ï¼Œå¦‚æœæ²¡æœ‰ä¼šå¼•å‘å¾ˆå¤šä¸å¿…è¦çš„éº»çƒ¦ã€‚")])])])]),t._v(" "),s("h4",{attrs:{id:"æ‰‹å·¥æ³¨å…¥"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ‰‹å·¥æ³¨å…¥"}},[t._v("#")]),t._v(" æ‰‹å·¥æ³¨å…¥")]),t._v(" "),s("p",[t._v("åˆ›å»ºä¸€ä¸ªdeploymentåšnginxçš„podæ§åˆ¶å™¨ï¼Œå‰¯æœ¬ç»´æŒåœ¨2ä¸ªã€‚")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node1 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat deploymen.yaml  ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apps/v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deployment\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" test \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" test\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" test\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" test\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx \n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("imagePullPolicy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" IfNotPresent \n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n        \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node1 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f deploymen.yaml  ")]),t._v("\ndeployment.apps/test created\n")])])]),s("p",[t._v('istioctl kube-inject ä¼šå°† istio ç›¸å…³å®¹å™¨æ³¨å…¥åº”ç”¨ï¼Œ"-o" å‚æ•°å°†æ³¨å…¥ç»“æœç”Ÿæˆ yaml æ–‡ä»¶ ï¼Œæ–¹ä¾¿è§‚å¯Ÿä½¿ç”¨æ­¤å‘½ä»¤ä¸ "kubectl apply -f" çš„åŒºåˆ«ï¼›')]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 istio-work"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# istioctl kube-inject -f deployment.yaml -o deployment-inject.yaml  ")]),t._v("\n")])])]),s("p",[t._v('æ–°çš„ yaml æ–‡ä»¶ä¸­å¤šå‡ºäº† "Sidecar" å®¹å™¨ï¼Œ å¹¶ä¸”å‡ºç°äº†1ä¸ªåˆå§‹åŒ–å®¹å™¨ (initContainers) "istio-init" ï¼Œåˆå§‹åŒ–å®¹å™¨å³ç”¨æ¥åŠ«æŒåº”ç”¨é€šä¿¡åˆ° "Sidecar" å®¹å™¨çš„å·¥å…·ï¼›')]),t._v(" "),s("p",[t._v('å¯ç›´æ¥ "kubectl apply -f" ç”Ÿæˆçš„ yaml æ–‡ä»¶ï¼Œ'),s("code",[t._v("æ³¨å…¥å Nginx åº”ç”¨ ä¸ Istio-Proxy å…±äº«ç½‘ç»œå‘½åç©ºé—´")]),t._v(" ã€‚")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 istio-work"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# istioctl kube-inject  -f /root/deploymen.yaml | kubectl apply -f - -n test ")]),t._v("\ndeployment.apps/test configured\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 istio-work"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get pods -n test ")]),t._v("\nNAME                    READY   STATUS    RESTARTS   AGE\ntest-67b6d4d78c-jzzml   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("/2     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          20s\ntest-67b6d4d78c-sfxk8   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("/2     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          20s\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 istio-work"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl exec -it  -n test test-67b6d4d78c-jzzml -c istio-proxy -- netstat -ntlp")]),t._v("\nActive Internet connections "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("only servers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nProto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    \ntcp        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:15021           "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:*               LISTEN      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v("/envoy            \ntcp        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:15021           "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:*               LISTEN      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v("/envoy            \ntcp        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:80              "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:*               LISTEN      -                   \ntcp        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:15090           "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:*               LISTEN      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v("/envoy            \ntcp        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:15090           "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:*               LISTEN      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v("/envoy            \ntcp        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:15000         "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:*               LISTEN      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v("/envoy            \ntcp        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:15001           "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:*               LISTEN      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v("/envoy            \ntcp        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:15001           "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:*               LISTEN      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v("/envoy            \ntcp        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:15004         "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:*               LISTEN      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/pilot-agent       \ntcp        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:15006           "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:*               LISTEN      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v("/envoy            \ntcp        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:15006           "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:*               LISTEN      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v("/envoy            \ntcp6       "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" :::15020                :::*                    LISTEN      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/pilot-agent       \ntcp6       "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" :::80                   :::*                    LISTEN      -                   \n")])])]),s("h2",{attrs:{id:"è¯·æ±‚è·¯ç”±"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#è¯·æ±‚è·¯ç”±"}},[t._v("#")]),t._v(" è¯·æ±‚è·¯ç”±")]),t._v(" "),s("h4",{attrs:{id:"ç¯å¢ƒå‡†å¤‡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç¯å¢ƒå‡†å¤‡"}},[t._v("#")]),t._v(" ç¯å¢ƒå‡†å¤‡")]),t._v(" "),s("ul",[s("li",[t._v("éƒ¨ç½²"),s("a",{attrs:{href:"https://istio.io/latest/docs/examples/bookinfo/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Bookinfo"),s("OutboundLink")],1),t._v("ç¤ºä¾‹åº”ç”¨ç¨‹åºã€‚")]),t._v(" "),s("li",[t._v("äº†è§£äº†æµé‡ç®¡ç†çš„åŸºç¡€æ¦‚å¿µï¼Œä»¥åŠä¸“ä¸šè¯­æœ¯ã€‚")])]),t._v(" "),s("blockquote",[s("p",[t._v("æ³¨æ„ï¼š")]),t._v(" "),s("p",[t._v("Istio "),s("a",{attrs:{href:"https://istio.io/latest/docs/examples/bookinfo/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Bookinfo"),s("OutboundLink")],1),t._v("ç¤ºä¾‹ç”±å››ä¸ªç‹¬ç«‹çš„å¾®æœåŠ¡ç»„æˆï¼Œæ¯ä¸ªå¾®æœåŠ¡éƒ½æœ‰å¤šä¸ªç‰ˆæœ¬ã€‚å…¶ä¸­ä¸€ä¸ªå¾®æœåŠ¡çš„ä¸‰ä¸ªä¸åŒç‰ˆæœ¬"),s("code",[t._v("reviews")]),t._v("å·²éƒ¨ç½²å¹¶åŒæ—¶è¿è¡Œã€‚ä¸ºäº†è¯´æ˜è¿™å¯¼è‡´çš„é—®é¢˜ï¼Œè¯·"),s("code",[t._v("/productpage")]),t._v("åœ¨æµè§ˆå™¨ä¸­è®¿é—® Bookinfo åº”ç”¨ç¨‹åºå¹¶åˆ·æ–°å‡ æ¬¡ã€‚æ‚¨ä¼šæ³¨æ„åˆ°ï¼Œæœ‰æ—¶ä¹¦è¯„è¾“å‡ºåŒ…å«æ˜Ÿçº§ï¼Œæœ‰æ—¶åˆ™ä¸åŒ…å«ã€‚è¿™æ˜¯å› ä¸ºå¦‚æœæ²¡æœ‰æ˜ç¡®çš„é»˜è®¤æœåŠ¡ç‰ˆæœ¬æ¥è·¯ç”±ï¼ŒIstio ä¼šä»¥å¾ªç¯æ–¹å¼å°†è¯·æ±‚è·¯ç”±åˆ°æ‰€æœ‰å¯ç”¨ç‰ˆæœ¬ã€‚")])]),t._v(" "),s("h4",{attrs:{id:"åº”ç”¨è™šæ‹ŸæœåŠ¡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#åº”ç”¨è™šæ‹ŸæœåŠ¡"}},[t._v("#")]),t._v(" åº”ç”¨è™šæ‹ŸæœåŠ¡")]),t._v(" "),s("p",[t._v("è¦ä»…è·¯ç”±åˆ°ä¸€ä¸ªç‰ˆæœ¬ï¼Œæ‚¨å¯ä»¥åº”ç”¨ä¸ºå¾®æœåŠ¡è®¾ç½®é»˜è®¤ç‰ˆæœ¬çš„è™šæ‹ŸæœåŠ¡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè™šæ‹ŸæœåŠ¡ä¼šå°†æ‰€æœ‰æµé‡è·¯ç”±åˆ°"),s("code",[t._v("v1")]),t._v("æ¯ä¸ªå¾®æœåŠ¡ã€‚")]),t._v(" "),s("ol",[s("li",[t._v("è¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥åº”ç”¨è™šæ‹ŸæœåŠ¡ï¼š")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" samples/bookinfo/networking/virtual-service-all-v1.yaml\n")])])]),s("p",[t._v("å› ä¸ºé…ç½®ä¼ æ’­æœ€ç»ˆæ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥ç­‰å¾…å‡ ç§’é’Ÿè®©è™šæ‹ŸæœåŠ¡ç”Ÿæ•ˆã€‚")]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[t._v("ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ˜¾ç¤ºå®šä¹‰çš„è·¯ç”±ï¼š")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("$ cat istio"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("1.9.5/samples/bookinfo/networking/virtual"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("service"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("all"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v1.yaml \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" VirtualService\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" productpage\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" productpage\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" productpage\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subset")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" VirtualService\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" reviews\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" reviews\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" reviews\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subset")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" VirtualService\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ratings\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ratings\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ratings\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subset")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" VirtualService\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" details\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" details\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" details\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subset")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[t._v("æ‚¨è¿˜å¯ä»¥"),s("code",[t._v("subset")]),t._v("ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ˜¾ç¤ºç›¸åº”çš„å®šä¹‰ï¼š")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl get destinationrules "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" yaml\n")])])]),s("p",[t._v("æ‚¨å·²å°† Istio é…ç½®ä¸ºè·¯ç”±åˆ°"),s("code",[t._v("v1")]),t._v("Bookinfo å¾®æœåŠ¡çš„ç‰ˆæœ¬ï¼Œæœ€é‡è¦çš„æ˜¯"),s("code",[t._v("reviews")]),t._v("æœåŠ¡ç‰ˆæœ¬ 1ã€‚")]),t._v(" "),s("h4",{attrs:{id:"æµ‹è¯•æ–°çš„è·¯ç”±é…ç½®"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æµ‹è¯•æ–°çš„è·¯ç”±é…ç½®"}},[t._v("#")]),t._v(" æµ‹è¯•æ–°çš„è·¯ç”±é…ç½®")]),t._v(" "),s("p",[t._v("æ‚¨å¯ä»¥é€šè¿‡å†æ¬¡åˆ·æ–°"),s("code",[t._v("/productpage")]),t._v(" Bookinfo åº”ç”¨ç¨‹åºè½»æ¾æµ‹è¯•æ–°é…ç½®ã€‚")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ Bookinfo ç«™ç‚¹ã€‚URL æ˜¯"),s("code",[t._v("http://$GATEWAY_URL/productpage")]),t._v("ï¼Œå…¶ä¸­"),s("code",[t._v("$GATEWAY_URL")]),t._v("æ˜¯å…¥å£çš„å¤–éƒ¨ IP åœ°å€ï¼Œå¦‚"),s("a",{attrs:{href:"https://istio.io/latest/docs/examples/bookinfo/#determine-the-ingress-ip-and-port",target:"_blank",rel:"noopener noreferrer"}},[t._v("Bookinfo"),s("OutboundLink")],1),t._v("æ–‡æ¡£ä¸­æ‰€è¿°ã€‚")]),t._v(" "),s("p",[t._v("è¯·æ³¨æ„ï¼Œæ— è®ºæ‚¨åˆ·æ–°å¤šå°‘æ¬¡ï¼Œé¡µé¢çš„è¯„è®ºéƒ¨åˆ†éƒ½ä¸ä¼šæ˜¾ç¤ºè¯„åˆ†æ˜Ÿã€‚è¿™æ˜¯å› ä¸ºæ‚¨å°† Istio é…ç½®ä¸ºå°†è¯„è®ºæœåŠ¡çš„æ‰€æœ‰æµé‡è·¯ç”±åˆ°è¯¥ç‰ˆæœ¬"),s("code",[t._v("reviews:v1")]),t._v("ï¼Œå¹¶ä¸”è¯¥ç‰ˆæœ¬çš„æœåŠ¡ä¸è®¿é—®æ˜Ÿçº§è¯„åˆ†æœåŠ¡ã€‚")])])]),t._v(" "),s("p",[t._v("æ‚¨å·²æˆåŠŸå®Œæˆæ­¤ä»»åŠ¡çš„ç¬¬ä¸€éƒ¨åˆ†ï¼šå°†æµé‡è·¯ç”±åˆ°æœåŠ¡çš„ä¸€ä¸ªç‰ˆæœ¬")]),t._v(" "),s("h4",{attrs:{id:"åŸºäºç”¨æˆ·èº«ä»½çš„è·¯ç”±"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#åŸºäºç”¨æˆ·èº«ä»½çš„è·¯ç”±"}},[t._v("#")]),t._v(" åŸºäºç”¨æˆ·èº«ä»½çš„è·¯ç”±")]),t._v(" "),s("p",[t._v("æ¥ä¸‹æ¥ï¼Œæ‚¨å°†æ›´æ”¹è·¯ç”±é…ç½®ï¼Œä»¥ä¾¿å°†æ¥è‡ªç‰¹å®šç”¨æˆ·çš„æ‰€æœ‰æµé‡è·¯ç”±åˆ°ç‰¹å®šæœåŠ¡ç‰ˆæœ¬ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¥è‡ªåä¸º Jason çš„ç”¨æˆ·çš„æ‰€æœ‰æµé‡éƒ½å°†è·¯ç”±åˆ°æœåŠ¡"),s("code",[t._v("reviews:v2")]),t._v("ã€‚")]),t._v(" "),s("p",[t._v("è¯¥ç¤ºä¾‹çš„å¯ç”¨æ˜¯å› ä¸ºè¯¥"),s("code",[t._v("productpage")]),t._v("æœåŠ¡å°†è‡ªå®šä¹‰"),s("code",[t._v("end-user")]),t._v("æ ‡å¤´æ·»åŠ åˆ°æ‰€æœ‰åˆ°è¯„è®ºæœåŠ¡çš„å‡ºç«™ HTTP è¯·æ±‚ã€‚")]),t._v(" "),s("p",[t._v("Istio è¿˜æ”¯æŒåœ¨å…¥å£ç½‘å…³ä¸ŠåŸºäºå¼ºè®¤è¯ JWT çš„è·¯ç”±ï¼Œæœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… "),s("a",{attrs:{href:"https://istio.io/latest/docs/tasks/security/authentication/jwt-route",target:"_blank",rel:"noopener noreferrer"}},[t._v("åŸºäº JWT å£°æ˜çš„è·¯ç”±"),s("OutboundLink")],1),t._v("ã€‚")]),t._v(" "),s("p",[t._v("è¯·è®°ä½ï¼Œ"),s("code",[t._v("reviews:v2")]),t._v("æ˜¯åŒ…å«æ˜Ÿçº§è¯„åˆ†åŠŸèƒ½çš„ç‰ˆæœ¬ã€‚")]),t._v(" "),s("ol",[s("li",[t._v("è¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥å¯ç”¨åŸºäºç”¨æˆ·çš„è·¯ç”±ï¼š")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" samples/bookinfo/networking/virtual-service-reviews-test-v2.yaml\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[t._v("ç¡®è®¤è§„åˆ™å·²åˆ›å»ºï¼š")])]),t._v(" "),s("p",[t._v("åˆ›å»ºè§„åˆ™å…è®¸ç”¨æˆ·jasone")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node1 networking"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat virtual-service-reviews-test-v2.yaml")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" VirtualService\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" reviews\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" reviews\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("match")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("headers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("end-user")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("exact")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" jason\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" reviews\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subset")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v2\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" reviews\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subset")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[s("p",[t._v("åœ¨"),s("code",[t._v("/productpage")]),t._v("Bookinfo åº”ç”¨ç¨‹åºä¸Šï¼Œä»¥ user èº«ä»½ç™»å½•"),s("code",[t._v("jason")]),t._v("ã€‚åˆ·æ–°æµè§ˆå™¨ã€‚ä½ çœ‹åˆ°äº†ä»€ä¹ˆï¼Ÿæ˜Ÿçº§è¯„åˆ†æ˜¾ç¤ºåœ¨æ¯æ¡è¯„è®ºæ—è¾¹ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("ä»¥å…¶ä»–ç”¨æˆ·èº«ä»½ç™»å½•ï¼ˆé€‰æ‹©æ‚¨æƒ³è¦çš„ä»»ä½•åç§°ï¼‰ã€‚åˆ·æ–°æµè§ˆå™¨ã€‚ç°åœ¨æ˜Ÿæ˜Ÿä¸è§äº†ã€‚è¿™æ˜¯å› ä¸ºæµé‡è¢«è·¯ç”±åˆ°"),s("code",[t._v("reviews:v1")]),t._v("é™¤äº† Jason ä¹‹å¤–çš„æ‰€æœ‰ç”¨æˆ·ã€‚æ‚¨å·²æˆåŠŸé…ç½® Istio ä»¥æ ¹æ®ç”¨æˆ·èº«ä»½è·¯ç”±æµé‡ã€‚")])])]),t._v(" "),s("h4",{attrs:{id:"æ¸…ç†"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ¸…ç†"}},[t._v("#")]),t._v(" æ¸…ç†")]),t._v(" "),s("p",[t._v("åˆ é™¤åº”ç”¨ç¨‹åºè·¯ç”±è§„åˆ™ï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl delete "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" samples/bookinfo/networking/virtual-service-all-v1.yaml\n")])])]),s("h2",{attrs:{id:"æ•…éšœæ³¨å…¥-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ•…éšœæ³¨å…¥-2"}},[t._v("#")]),t._v(" æ•…éšœæ³¨å…¥")]),t._v(" "),s("h4",{attrs:{id:"ç¯å¢ƒå‡†å¤‡-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç¯å¢ƒå‡†å¤‡-2"}},[t._v("#")]),t._v(" ç¯å¢ƒå‡†å¤‡")]),t._v(" "),s("ul",[s("li",[t._v("éƒ¨ç½²"),s("a",{attrs:{href:"https://istio.io/latest/docs/examples/bookinfo/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Bookinfo"),s("OutboundLink")],1),t._v("ç¤ºä¾‹åº”ç”¨ç¨‹åºï¼Œåº”ç”¨ç›®æ ‡è§„åˆ™ã€‚")]),t._v(" "),s("li",[t._v("äº†è§£äº†æµé‡ç®¡ç†çš„åŸºç¡€æ¦‚å¿µï¼Œä»¥åŠä¸“ä¸šè¯­æœ¯ã€‚")])]),t._v(" "),s("blockquote",[s("p",[t._v("é€šè¿‡æ‰§è¡Œ "),s("a",{attrs:{href:"https://istio.io/latest/docs/tasks/traffic-management/request-routing/",target:"_blank",rel:"noopener noreferrer"}},[t._v("è¯·æ±‚è·¯ç”±"),s("OutboundLink")],1),t._v("ä»»åŠ¡æˆ–è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥åº”ç”¨åº”ç”¨ç¨‹åºç‰ˆæœ¬è·¯ç”±ï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" samples/bookinfo/networking/virtual-service-all-v1.yaml\n$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" samples/bookinfo/networking/virtual-service-reviews-test-v2.yaml\n")])])])]),t._v(" "),s("h4",{attrs:{id:"æ³¨å…¥httpå»¶è¿Ÿé”™è¯¯"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ³¨å…¥httpå»¶è¿Ÿé”™è¯¯"}},[t._v("#")]),t._v(" æ³¨å…¥HTTPå»¶è¿Ÿé”™è¯¯")]),t._v(" "),s("p",[t._v("è¦æµ‹è¯• Bookinfo åº”ç”¨ç¨‹åºå¾®æœåŠ¡çš„å¼¹æ€§ï¼Œè¯·åœ¨user"),s("code",[t._v("reviews:v2")]),t._v("å’Œå¾®æœåŠ¡ä¹‹é—´æ³¨å…¥ 7s å»¶è¿Ÿã€‚æ­¤æµ‹è¯•å°†å‘ç°ä¸€ä¸ªæœ‰æ„å¼•å…¥ Bookinfo åº”ç”¨ç¨‹åºçš„é”™è¯¯ã€‚"),s("code",[t._v("ratings jason")])]),t._v(" "),s("p",[t._v("è¯·æ³¨æ„ï¼Œè¯¥"),s("code",[t._v("reviews:v2")]),t._v("æœåŠ¡å¯¹æœåŠ¡çš„è°ƒç”¨æœ‰ 10 ç§’çš„ç¡¬ç¼–ç è¿æ¥è¶…æ—¶"),s("code",[t._v("ratings")]),t._v("ã€‚å³ä½¿æ‚¨å¼•å…¥äº† 7 ç§’å»¶è¿Ÿï¼Œæ‚¨ä»ç„¶å¸Œæœ›ç«¯åˆ°ç«¯æµç¨‹ç»§ç»­è¿›è¡Œè€Œä¸ä¼šå‡ºç°ä»»ä½•é”™è¯¯ã€‚")]),t._v(" "),s("ol",[s("li",[t._v("åˆ›å»ºæ•…éšœæ³¨å…¥è§„åˆ™ä»¥å»¶è¿Ÿæ¥è‡ªæµ‹è¯•ç”¨æˆ·çš„æµé‡ "),s("code",[t._v("jason")]),t._v("ã€‚")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" samples/bookinfo/networking/virtual-service-ratings-test-delay.yaml\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[t._v("ç¡®è®¤è§„åˆ™å·²åˆ›å»ºï¼š\n"),s("ul",[s("li",[s("code",[t._v("åˆ›å»ºè§„åˆ™é€šè¿‡jasonç”¨æˆ·ç™»å½•")])]),t._v(" "),s("li",[s("code",[t._v("åœ¨å¾®æœåŠ¡ä¹‹é—´æ³¨å…¥7sçš„å»¶è¿Ÿ")])])])])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("å‚æ•°è¯¦è§£ï¼š")])]),t._v(" "),s("p",[s("strong",[t._v("fault:")]),t._v("\t\t\t\t\t\t\t# è¦åº”ç”¨äºå®¢æˆ·ç«¯HTTPæµé‡çš„æ•…éšœæ³¨å…¥ç­–ç•¥ã€‚\n"),s("strong",[t._v("delay:")]),t._v("\t\t\t\t\t\t# å»¶è¿Ÿ\n"),s("strong",[t._v("percentage:")]),t._v("\t\t\t# ç™¾åˆ†ç‡\n"),s("strong",[t._v("value: 100.0")]),t._v("\t\t # é”®å€¼ä¸ºç™¾åˆ†ä¹‹ä¸€ç™¾\n"),s("strong",[t._v("fixedDelay: 7s")]),t._v("\t\t# å›ºå®šæ—¶é—´ä¸º7s")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node1 networking"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat virtual-service-ratings-test-delay.yaml")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" VirtualService\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ratings\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ratings\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("match")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("headers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("end-user")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("exact")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" jason\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fault")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\t\t\t\t\t\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("delay")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\t\t\t\t\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("percentage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\t\t\t\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100.0")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fixedDelay")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 7s\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ratings\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subset")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ratings\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subset")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n")])])]),s("p",[t._v("ç­‰å¾…å‡ ç§’é’Ÿï¼Œè®©æ–°è§„åˆ™ä¼ æ’­åˆ°æ‰€æœ‰ podã€‚")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202205062327994.png",alt:"image-20220316153536186"}})]),t._v(" "),s("h4",{attrs:{id:"æµ‹è¯•å»¶è¿Ÿé…ç½®"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æµ‹è¯•å»¶è¿Ÿé…ç½®"}},[t._v("#")]),t._v(" æµ‹è¯•å»¶è¿Ÿé…ç½®")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€"),s("a",{attrs:{href:"https://istio.io/latest/docs/examples/bookinfo",target:"_blank",rel:"noopener noreferrer"}},[t._v("Bookinfo Web åº”ç”¨ç¨‹åºã€‚"),s("OutboundLink")],1)])]),t._v(" "),s("li",[s("p",[t._v("åœ¨"),s("code",[t._v("/productpage")]),t._v("ç½‘é¡µä¸Šï¼Œä»¥ user èº«ä»½ç™»å½•"),s("code",[t._v("jason")]),t._v("ã€‚")]),t._v(" "),s("p",[t._v("æ‚¨å¸Œæœ› Bookinfo ä¸»é¡µåœ¨å¤§çº¦ 7 ç§’å†…åŠ è½½è€Œä¸ä¼šå‡ºç°é”™è¯¯ã€‚ä½†æ˜¯ï¼Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼šReviews éƒ¨åˆ†æ˜¾ç¤ºä¸€æ¡é”™è¯¯æ¶ˆæ¯ï¼š")]),t._v(" "),s("p",[s("code",[t._v("Sorry, product reviews are currently unavailable for this book.")])])]),t._v(" "),s("li",[s("p",[t._v("æŸ¥çœ‹ç½‘é¡µå“åº”æ—¶é—´ï¼š")]),t._v(" "),s("ol",[s("li",[t._v("åœ¨ Web æµè§ˆå™¨ä¸­æ‰“å¼€"),s("em",[t._v("å¼€å‘è€…å·¥å…·")]),t._v("èœå•ã€‚")]),t._v(" "),s("li",[t._v("æ‰“å¼€ç½‘ç»œé€‰é¡¹å¡")]),t._v(" "),s("li",[t._v("é‡æ–°åŠ è½½"),s("code",[t._v("/productpage")]),t._v("ç½‘é¡µã€‚æ‚¨å°†çœ‹åˆ°é¡µé¢å®é™…åŠ è½½å¤§çº¦éœ€è¦ 6 ç§’ã€‚")])])])]),t._v(" "),s("h4",{attrs:{id:"ä¿®å¤é”™è¯¯"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä¿®å¤é”™è¯¯"}},[t._v("#")]),t._v(" ä¿®å¤é”™è¯¯")]),t._v(" "),s("p",[t._v("æ‚¨é€šå¸¸ä¼šé€šè¿‡ä»¥ä¸‹æ–¹å¼è§£å†³é—®é¢˜ï¼š")]),t._v(" "),s("ol",[s("li",[t._v("å¢åŠ æœåŠ¡è¶…æ—¶æˆ–å‡å°‘"),s("code",[t._v("productpage")]),t._v("æœåŠ¡è¶…æ—¶"),s("code",[t._v("reviews reviews ratings")])]),t._v(" "),s("li",[t._v("åœæ­¢å’Œé‡å¯å›ºå®šçš„å¾®æœåŠ¡")]),t._v(" "),s("li",[t._v("ç¡®è®¤"),s("code",[t._v("/productpage")]),t._v("ç½‘é¡µè¿”å›å…¶å“åº”æ²¡æœ‰ä»»ä½•é”™è¯¯ã€‚")])]),t._v(" "),s("p",[t._v("ä½†æ˜¯ï¼Œæ‚¨å·²ç»åœ¨"),s("code",[t._v("reviews")]),t._v("æœåŠ¡çš„ v3 ä¸­è¿è¡Œäº†ä¸€ä¸ªä¿®å¤ç¨‹åºã€‚è¯¥"),s("code",[t._v("reviews:v3")]),t._v("æœåŠ¡å°†è¶…æ—¶æ—¶é—´ä» 10s å‡å°‘"),s("code",[t._v("reviews")]),t._v("åˆ°2.5sï¼Œä»¥ä¾¿ä¸ä¸‹æ¸¸è¯·æ±‚"),s("code",[t._v("ratings")]),t._v("çš„è¶…æ—¶æ—¶é—´å…¼å®¹ï¼ˆå°äºï¼‰ "),s("code",[t._v("productpage")]),t._v("ã€‚")]),t._v(" "),s("p",[t._v("å¦‚æœæ‚¨æŒ‰ç…§"),s("a",{attrs:{href:"https://istio.io/latest/docs/tasks/traffic-management/traffic-shifting/",target:"_blank",rel:"noopener noreferrer"}},[t._v("æµé‡è½¬ç§»"),s("OutboundLink")],1),s("code",[t._v("reviews:v3")]),t._v("ä»»åŠ¡ä¸­çš„æè¿° å°†æ‰€æœ‰æµé‡è¿ç§»åˆ°ï¼Œæ‚¨å¯ä»¥å°è¯•å°†å»¶è¿Ÿè§„åˆ™æ›´æ”¹ä¸ºå°äº 2.5s çš„ä»»æ„é‡ï¼Œä¾‹å¦‚ 2sï¼Œå¹¶ç¡®è®¤ç«¯åˆ°ç«¯æµç¨‹ç»§ç»­æ²¡æœ‰ä»»ä½•é”™è¯¯ã€‚")]),t._v(" "),s("h4",{attrs:{id:"æ³¨å…¥httpä¸­æ­¢é”™è¯¯"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ³¨å…¥httpä¸­æ­¢é”™è¯¯"}},[t._v("#")]),t._v(" æ³¨å…¥HTTPä¸­æ­¢é”™è¯¯")]),t._v(" "),s("p",[t._v("æµ‹è¯•å¾®æœåŠ¡å¼¹æ€§çš„å¦ä¸€ç§æ–¹æ³•æ˜¯å¼•å…¥ HTTP ä¸­æ­¢æ•…éšœã€‚"),s("code",[t._v("ratings")]),t._v("åœ¨æ­¤ä»»åŠ¡ä¸­ï¼Œæ‚¨å°†ä¸ºæµ‹è¯•ç”¨æˆ·çš„å¾®æœåŠ¡å¼•å…¥ HTTP ä¸­æ­¢"),s("code",[t._v("jason")]),t._v("ã€‚")]),t._v(" "),s("p",[t._v("åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¸Œæœ›é¡µé¢ç«‹å³åŠ è½½å¹¶æ˜¾ç¤º"),s("code",[t._v("Ratings service is currently unavailable")]),t._v("æ¶ˆæ¯ã€‚")]),t._v(" "),s("ol",[s("li",[t._v("åˆ›å»ºä¸€ä¸ªæ•…éšœæ³¨å…¥è§„åˆ™ï¼Œä¸ºç”¨æˆ·å‘é€ HTTP ä¸­æ­¢"),s("code",[t._v("jason")]),t._v("ï¼š")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" samples/bookinfo/networking/virtual-service-ratings-test-abort.yaml\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[t._v("ç¡®è®¤è§„åˆ™å·²åˆ›å»ºï¼š\n"),s("ul",[s("li",[s("code",[t._v("åˆ›å»ºè§„åˆ™é€šè¿‡jasonç”¨æˆ·æµé‡")])]),t._v(" "),s("li",[s("code",[t._v("åœ¨å¾®æœåŠ¡ä¹‹é—´ä¸­æ­¢jasonç”¨æˆ·ï¼Œhttpstatusæ˜¯500çŠ¶æ€ï¼Œç™¾åˆ†ç‡è®¾ç½®ä¸º100")])])])])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("å‚æ•°è¯¦è§£ï¼š")])]),t._v(" "),s("p",[s("strong",[t._v("fault:")]),t._v("\t\t\t\t\t\t\t# è¦åº”ç”¨äºå®¢æˆ·ç«¯HTTPæµé‡çš„æ•…éšœæ³¨å…¥ç­–ç•¥ã€‚\n"),s("strong",[t._v("abort:")]),t._v("\t\t\t\t\t\t# ä¸­æ­¢ç­–ç•¥\n"),s("strong",[t._v("percentage:")]),t._v("\t\t\t# ç™¾åˆ†ç‡\n"),s("strong",[t._v("value: 100.0")]),t._v("\t\t # é”®å€¼ä¸ºç™¾åˆ†ä¹‹ä¸€ç™¾\n"),s("strong",[t._v("httpStatus: 500")]),t._v("\t  # httpstatusè®¾ç½®ä¸º500æŠ¥é”™")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node1 networking"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat virtual-service-ratings-test-abort.yaml")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" VirtualService\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ratings\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ratings\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("match")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("headers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("end-user")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("exact")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" jason\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fault")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("abort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("percentage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100.0")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("httpStatus")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ratings\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subset")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ratings\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subset")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n")])])]),s("h4",{attrs:{id:"æµ‹è¯•ä¸­æ­¢é…ç½®"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æµ‹è¯•ä¸­æ­¢é…ç½®"}},[t._v("#")]),t._v(" æµ‹è¯•ä¸­æ­¢é…ç½®")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€"),s("a",{attrs:{href:"https://istio.io/latest/docs/examples/bookinfo",target:"_blank",rel:"noopener noreferrer"}},[t._v("Bookinfo Web åº”ç”¨ç¨‹åºã€‚"),s("OutboundLink")],1)])]),t._v(" "),s("li",[s("p",[t._v("åœ¨ ä¸Š"),s("code",[t._v("/productpage")]),t._v("ï¼Œä»¥ç”¨æˆ·èº«ä»½ç™»å½•"),s("code",[t._v("jason")]),t._v("ã€‚")]),t._v(" "),s("p",[t._v("å¦‚æœè§„åˆ™æˆåŠŸä¼ æ’­åˆ°æ‰€æœ‰ podï¼Œé¡µé¢ä¼šç«‹å³åŠ è½½å¹¶æ˜¾ç¤º"),s("code",[t._v("Ratings service is currently unavailable")]),t._v("æ¶ˆæ¯ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("å¦‚æœæ‚¨ä»ç”¨æˆ·æ³¨é”€"),s("code",[t._v("jason")]),t._v("æˆ–åœ¨åŒ¿åçª—å£ï¼ˆæˆ–å…¶ä»–æµè§ˆå™¨ï¼‰ä¸­æ‰“å¼€ Bookinfo åº”ç”¨ç¨‹åºï¼Œæ‚¨ å°†"),s("code",[t._v("/productpage")]),t._v("çœ‹åˆ°é™¤äº†. å› æ­¤ï¼Œæ‚¨ä¸ä¼šçœ‹åˆ°ä»»ä½•é”™è¯¯æ¶ˆæ¯ã€‚"),s("code",[t._v("reviews:v1 ratings jason")])])])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202205062327813.png",alt:"image-20220316155324788"}})]),t._v(" "),s("h4",{attrs:{id:"æ¸…ç†-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ¸…ç†-2"}},[t._v("#")]),t._v(" æ¸…ç†")]),t._v(" "),s("p",[t._v("åˆ é™¤åº”ç”¨ç¨‹åºè·¯ç”±è§„åˆ™ï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl delete "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" samples/bookinfo/networking/virtual-service-all-v1.yaml\n")])])]),s("h2",{attrs:{id:"æµé‡è½¬ç§»"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æµé‡è½¬ç§»"}},[t._v("#")]),t._v(" æµé‡è½¬ç§»")]),t._v(" "),s("h4",{attrs:{id:"ä»€ä¹ˆæ˜¯æµé‡è½¬ç§»"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä»€ä¹ˆæ˜¯æµé‡è½¬ç§»"}},[t._v("#")]),t._v(" ä»€ä¹ˆæ˜¯æµé‡è½¬ç§»ï¼Ÿ")]),t._v(" "),s("p",[t._v("æ­¤ä»»åŠ¡å‘æ‚¨å±•ç¤ºå¦‚ä½•å°†æµé‡ä»ä¸€ä¸ªå¾®æœåŠ¡ç‰ˆæœ¬è½¬ç§»åˆ°å¦ä¸€ä¸ªç‰ˆæœ¬ã€‚")]),t._v(" "),s("p",[t._v("ä¸€ä¸ªå¸¸è§çš„ç”¨ä¾‹æ˜¯å°†æµé‡ä»æ—§ç‰ˆæœ¬çš„å¾®æœåŠ¡é€æ¸è¿ç§»åˆ°æ–°ç‰ˆæœ¬ã€‚åœ¨ Istio ä¸­ï¼Œæ‚¨å¯ä»¥é€šè¿‡é…ç½®ä¸€ç³»åˆ—è·¯ç”±è§„åˆ™æ¥å®ç°è¿™ä¸€ç›®æ ‡ï¼Œè¿™äº›è§„åˆ™å°†ä¸€å®šæ¯”ä¾‹çš„æµé‡ä»ä¸€ä¸ªç›®çš„åœ°é‡å®šå‘åˆ°å¦ä¸€ä¸ªç›®çš„åœ°ã€‚")]),t._v(" "),s("p",[t._v("åœ¨æ­¤ä»»åŠ¡ä¸­ï¼Œæ‚¨å°†ä½¿ç”¨å°† 50% çš„æµé‡å‘é€åˆ°"),s("code",[t._v("reviews:v1")]),t._v("å’Œ 50% åˆ°"),s("code",[t._v("reviews:v3")]),t._v("ã€‚ç„¶åï¼Œæ‚¨å°†é€šè¿‡å°† 100% çš„æµé‡å‘é€åˆ° æ¥å®Œæˆè¿ç§»"),s("code",[t._v("reviews:v3")]),t._v("ã€‚")]),t._v(" "),s("h4",{attrs:{id:"ç¯å¢ƒå‡†å¤‡-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç¯å¢ƒå‡†å¤‡-3"}},[t._v("#")]),t._v(" ç¯å¢ƒå‡†å¤‡")]),t._v(" "),s("ul",[s("li",[t._v("éƒ¨ç½²"),s("a",{attrs:{href:"https://istio.io/latest/docs/examples/bookinfo/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Bookinfo"),s("OutboundLink")],1),t._v("ç¤ºä¾‹åº”ç”¨ç¨‹åºï¼Œåº”ç”¨ç›®æ ‡è§„åˆ™ã€‚")]),t._v(" "),s("li",[t._v("äº†è§£äº†æµé‡ç®¡ç†çš„åŸºç¡€æ¦‚å¿µï¼Œä»¥åŠä¸“ä¸šè¯­æœ¯ã€‚")])]),t._v(" "),s("blockquote",[s("p",[t._v("é¦–å…ˆï¼Œè¿è¡Œæ­¤å‘½ä»¤å°†æ‰€æœ‰æµé‡è·¯ç”±åˆ°"),s("code",[t._v("v1")]),t._v("æ¯ä¸ªå¾®æœåŠ¡çš„ç‰ˆæœ¬ã€‚")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" samples/bookinfo/networking/virtual-service-all-v1.yaml\n")])])])]),t._v(" "),s("h4",{attrs:{id:"åº”ç”¨åŸºäºæƒé‡çš„è·¯ç”±"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#åº”ç”¨åŸºäºæƒé‡çš„è·¯ç”±"}},[t._v("#")]),t._v(" åº”ç”¨åŸºäºæƒé‡çš„è·¯ç”±")]),t._v(" "),s("ol",[s("li",[s("code",[t._v("reviews:v1")]),t._v("ä½¿ç”¨"),s("code",[t._v("reviews:v3")]),t._v("ä»¥ä¸‹å‘½ä»¤ä¼ è¾“ 50% çš„æµé‡ï¼š")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" samples/bookinfo/networking/virtual-service-reviews-50-v3.yaml\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[t._v("ç¡®è®¤è§„åˆ™å·²è¢«æ›¿æ¢ï¼š\n"),s("ul",[s("li",[s("code",[t._v("åˆ›å»ºv1ç‰ˆæœ¬çš„æƒé‡ä¸º50")])]),t._v(" "),s("li",[s("code",[t._v("åˆ›å»ºv3ç‰ˆæœ¬çš„æƒé‡ä¸º50")])])])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node1 networking"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat virtual-service-reviews-50-v3.yaml")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" VirtualService\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" reviews\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" reviews\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" reviews\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subset")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("weight")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" reviews\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subset")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v3\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("weight")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[t._v("åœ¨æ‚¨çš„æµè§ˆå™¨ä¸­åˆ·æ–°"),s("code",[t._v("/productpage")]),t._v("ï¼Œæ‚¨ç°åœ¨å¤§çº¦æœ‰ 50% çš„æ—¶é—´ä¼šçœ‹åˆ°"),s("code",[t._v("çº¢è‰²")]),t._v("çš„æ˜Ÿçº§ã€‚è¿™æ˜¯å› ä¸º"),s("code",[t._v("v3")]),t._v("ç‰ˆæœ¬"),s("code",[t._v("reviews")]),t._v("è®¿é—®äº†æ˜Ÿçº§æœåŠ¡ï¼Œè€Œ"),s("code",[t._v("v1")]),t._v("ç‰ˆæœ¬æ²¡æœ‰ã€‚")])]),t._v(" "),s("blockquote",[s("p",[t._v("æ³¨æ„ï¼š")]),t._v(" "),s("p",[t._v("ä½¿ç”¨å½“å‰çš„ Envoy sidecar å®ç°ï¼Œæ‚¨å¯èƒ½éœ€è¦ "),s("code",[t._v("/productpage")]),t._v("å¤šæ¬¡åˆ·æ–°ï¼ˆå¯èƒ½ 15 æ¬¡æˆ–æ›´å¤šï¼‰æ‰èƒ½çœ‹åˆ°æ­£ç¡®çš„åˆ†å¸ƒã€‚æ‚¨å¯ä»¥ä¿®æ”¹è§„åˆ™ä»¥å°† 90% çš„æµé‡è·¯ç”±åˆ°"),s("code",[t._v("v3")]),t._v("æ›´é¢‘ç¹åœ°çœ‹åˆ°çº¢æ˜Ÿã€‚")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202205062327265.png",alt:"image-20220316160723199"}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202205062327027.png",alt:"image-20220316160736887"}})]),t._v(" "),s("ol",{attrs:{start:"4"}},[s("li",[t._v("å‡è®¾æ‚¨ç¡®å®š"),s("code",[t._v("reviews:v3")]),t._v("å¾®æœåŠ¡æ˜¯ç¨³å®šçš„ï¼Œæ‚¨å¯ä»¥"),s("code",[t._v("reviews:v3")]),t._v("é€šè¿‡åº”ç”¨æ­¤è™šæ‹ŸæœåŠ¡å°† 100% çš„æµé‡è·¯ç”±åˆ°ï¼š")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node1 networking"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat virtual-service-reviews-v3.yaml")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" VirtualService\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" reviews\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" reviews\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" reviews\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subset")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v3\n")])])]),s("p",[t._v("ç°åœ¨ï¼Œå½“æ‚¨åˆ·æ–°æ—¶ï¼Œ"),s("code",[t._v("/productpage")]),t._v("æ‚¨æ€»æ˜¯ä¼šçœ‹åˆ°æ¯æ¡è¯„è®ºå¸¦æœ‰"),s("code",[t._v("çº¢è‰²")]),t._v("æ˜Ÿçº§çš„ä¹¦è¯„ã€‚")]),t._v(" "),s("h4",{attrs:{id:"æ¸…ç†-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ¸…ç†-3"}},[t._v("#")]),t._v(" æ¸…ç†")]),t._v(" "),s("p",[t._v("åˆ é™¤åº”ç”¨ç¨‹åºè·¯ç”±è§„åˆ™ï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl delete "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" samples/bookinfo/networking/virtual-service-all-v1.yaml\n")])])]),s("h2",{attrs:{id:"tcp-æµé‡è½¬ç§»"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#tcp-æµé‡è½¬ç§»"}},[t._v("#")]),t._v(" TCP æµé‡è½¬ç§»")]),t._v(" "),s("h4",{attrs:{id:"ä»€ä¹ˆæ˜¯tcpæµé‡è½¬ç§»"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä»€ä¹ˆæ˜¯tcpæµé‡è½¬ç§»"}},[t._v("#")]),t._v(" ä»€ä¹ˆæ˜¯TCPæµé‡è½¬ç§»ï¼Ÿ")]),t._v(" "),s("p",[t._v("å°† TCP æµé‡ä»ä¸€ä¸ªå¾®æœåŠ¡ç‰ˆæœ¬è½¬ç§»åˆ°å¦ä¸€ä¸ªç‰ˆæœ¬ã€‚")]),t._v(" "),s("p",[t._v("ä¸€ä¸ªå¸¸è§çš„ç”¨ä¾‹æ˜¯å°† TCP æµé‡ä»æ—§ç‰ˆæœ¬çš„å¾®æœåŠ¡é€æ¸è¿ç§»åˆ°æ–°ç‰ˆæœ¬ã€‚åœ¨ Istio ä¸­ï¼Œæ‚¨å¯ä»¥é€šè¿‡é…ç½®ä¸€ç³»åˆ—è·¯ç”±è§„åˆ™æ¥å®ç°è¿™ä¸€ç›®æ ‡ï¼Œè¿™äº›è§„åˆ™å°†ä¸€å®šç™¾åˆ†æ¯”çš„ TCP æµé‡ä»ä¸€ä¸ªç›®çš„åœ°é‡å®šå‘åˆ°å¦ä¸€ä¸ªç›®çš„åœ°ã€‚åœ¨æ­¤ä»»åŠ¡ä¸­ï¼Œæ‚¨å°† 100% çš„ TCP æµé‡å‘é€åˆ°"),s("code",[t._v("tcp-echo:v1")]),t._v(". ç„¶åï¼Œæ‚¨å°†"),s("code",[t._v("tcp-echo:v2")]),t._v("ä½¿ç”¨ Istio çš„åŠ æƒè·¯ç”±åŠŸèƒ½è·¯ç”± 20% çš„ TCP æµé‡ã€‚")]),t._v(" "),s("h4",{attrs:{id:"åŸºç¡€ç¯å¢ƒ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#åŸºç¡€ç¯å¢ƒ"}},[t._v("#")]),t._v(" åŸºç¡€ç¯å¢ƒ")]),t._v(" "),s("blockquote",[s("ol",[s("li",[t._v("é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªç”¨äºæµ‹è¯• TCP æµé‡è½¬ç§»çš„å‘½åç©ºé—´å¹¶å°†å…¶æ ‡è®°ä¸ºå¯ç”¨è‡ªåŠ¨è¾¹è½¦æ³¨å…¥ã€‚")]),t._v(" "),s("li",[t._v("éƒ¨ç½²"),s("a",{attrs:{href:"https://github.com/istio/istio/tree/release-1.13/samples/sleep",target:"_blank",rel:"noopener noreferrer"}},[t._v("sleep"),s("OutboundLink")],1),t._v("ç¤ºä¾‹åº”ç”¨ç¨‹åºä»¥ç”¨ä½œå‘é€è¯·æ±‚çš„æµ‹è¯•æºã€‚")]),t._v(" "),s("li",[t._v("éƒ¨ç½²å¾®æœåŠ¡çš„"),s("code",[t._v("v1")]),t._v("å’Œ"),s("code",[t._v("v2")]),t._v("ç‰ˆæœ¬"),s("code",[t._v("tcp-echo")]),t._v("ã€‚")]),t._v(" "),s("li",[t._v("æŒ‰ç…§ "),s("a",{attrs:{href:"https://istio.io/latest/docs/tasks/traffic-management/ingress/ingress-control/#determining-the-ingress-ip-and-ports",target:"_blank",rel:"noopener noreferrer"}},[t._v("ç¡®å®šå…¥å£ IP å’Œç«¯å£"),s("OutboundLink")],1),s("code",[t._v("TCP_INGRESS_PORT")]),t._v("ä¸­ çš„è¯´æ˜å®šä¹‰"),s("code",[t._v("INGRESS_HOST")]),t._v("ç¯å¢ƒå˜é‡ã€‚")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl create namespace istio-io-tcp-traffic-shifting\n$ kubectl label namespace istio-io-tcp-traffic-shifting istio-injection"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("enabled\n$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" samples/sleep/sleep.yaml "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" istio-io-tcp-traffic-shifting\n$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" samples/tcp-echo/tcp-echo-services.yaml "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" istio-io-tcp-traffic-shifting\n")])])])]),t._v(" "),s("h4",{attrs:{id:"åº”ç”¨åŸºäºæƒé‡çš„tcpè·¯ç”±"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#åº”ç”¨åŸºäºæƒé‡çš„tcpè·¯ç”±"}},[t._v("#")]),t._v(" åº”ç”¨åŸºäºæƒé‡çš„TCPè·¯ç”±")]),t._v(" "),s("ol",[s("li",[t._v("å°†æ‰€æœ‰ TCP æµé‡è·¯ç”±åˆ°å¾®æœåŠ¡çš„"),s("code",[t._v("v1")]),t._v("ç‰ˆæœ¬"),s("code",[t._v("tcp-echo")]),t._v("ã€‚")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node1 samples"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f samples/tcp-echo/tcp-echo-all-v1.yaml -n istio-io-tcp-traffic-shifting")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node1 samples"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat tcp-echo/tcp-echo-all-v1.yaml")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Gateway\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" tcp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("echo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("gateway\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("istio")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ingressgateway\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("servers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("number")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("31400")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" tcp\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" TCP\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" DestinationRule\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" tcp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("echo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("destination\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" tcp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("echo\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subsets")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v2\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v2\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" VirtualService\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" tcp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("echo\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gateways")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" tcp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("echo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("gateway\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tcp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("match")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("31400")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" tcp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("echo\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# è¿™é‡Œä¿®æ”¹æˆä½¿ç”¨ç«¯å£çš„æ–¹å¼")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("number")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9000")]),t._v("\t\t "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ç«¯å£å·æ˜¯9000")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subset")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ç‰ˆæœ¬ä½¿ç”¨V1ç‰ˆæœ¬")]),t._v("\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[s("code",[t._v("tcp-echo")]),t._v("é€šè¿‡ä»å®¢æˆ·ç«¯å‘é€ä¸€äº› TCP æµé‡æ¥ç¡®è®¤æœåŠ¡å·²å¯åŠ¨å¹¶æ­£åœ¨è¿è¡Œ"),s("code",[t._v("sleep")]),t._v("ã€‚")])]),t._v(" "),s("blockquote",[s("p",[t._v("ä¸‹é¢çš„ "),s("code",[t._v("$INGRESS_HOST")]),t._v(" å˜é‡æ˜¯ ingress çš„å¤–éƒ¨ IP åœ°å€ï¼Œ"),s("code",[t._v("$TCP_INGRESS_PORT")]),t._v("æ˜¯ingressçš„ç«¯å£")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("INGRESS_PORT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("kubectl "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" istio-system get "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" istio-ingressgateway "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("jsonpath")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{.spec.ports[?(@.name==\"http2\")].nodePort}'")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("SECURE_INGRESS_PORT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("kubectl "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" istio-system get "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" istio-ingressgateway "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("jsonpath")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{.spec.ports[?(@.name==\"https\")].nodePort}'")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("TCP_INGRESS_PORT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("kubectl "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" istio-system get "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" istio-ingressgateway "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("jsonpath")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{.spec.ports[?(@.name==\"tcp\")].nodePort}'")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("INGRESS_HOST")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("worker-node-address\n")])])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 samples"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# for i in {1..20}; do \\")]),t._v("\nkubectl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("kubectl get pod "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-l")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("sleep "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" istio-io-tcp-traffic-shifting "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("jsonpath")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(".items"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("metadata.name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" istio-io-tcp-traffic-shifting -- "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sh")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"(date; sleep 1) | nc '),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$INGRESS_HOST")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$TCP_INGRESS_PORT")]),t._v('"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v("\none Mon Nov "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(":24:57 UTC "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2018")]),t._v("\none Mon Nov "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(":25:00 UTC "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2018")]),t._v("\none Mon Nov "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(":25:02 UTC "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2018")]),t._v("\none Mon Nov "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(":25:05 UTC "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2018")]),t._v("\none Mon Nov "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(":25:07 UTC "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2018")]),t._v("\none Mon Nov "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(":25:10 UTC "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2018")]),t._v("\none Mon Nov "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(":25:12 UTC "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2018")]),t._v("\none Mon Nov "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(":25:15 UTC "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2018")]),t._v("\none Mon Nov "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(":25:17 UTC "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2018")]),t._v("\none Mon Nov "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(":25:19 UTC "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2018")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])])]),s("p",[t._v("æ‚¨åº”è¯¥æ³¨æ„åˆ°æ‰€æœ‰æ—¶é—´æˆ³çš„å‰ç¼€éƒ½æ˜¯"),s("em",[t._v("one")]),t._v("ï¼Œè¿™æ„å‘³ç€æ‰€æœ‰æµé‡éƒ½è¢«è·¯ç”±åˆ°æœåŠ¡çš„"),s("code",[t._v("v1")]),t._v("ç‰ˆæœ¬"),s("code",[t._v("tcp-echo")]),t._v("ã€‚")]),t._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[s("code",[t._v("tcp-echo:v1")]),t._v("ä½¿ç”¨"),s("code",[t._v("tcp-echo:v2")]),t._v("ä»¥ä¸‹å‘½ä»¤ä¼ è¾“ 20% çš„æµé‡ï¼š")])]),t._v(" "),s("blockquote",[s("p",[t._v("é€šè¿‡ä¿®æ”¹"),s("code",[t._v("weightçš„å€¼")]),t._v("æ¥ç¡®å®šæµé‡çš„åˆ†å¸ƒæ§åˆ¶ã€‚")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node1 istio"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("1.9.5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f samples/tcp-echo/tcp-echo-20-v2.yaml")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node1 istio"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("1.9.5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat samples/tcp-echo/tcp-echo-20-v2.yaml")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" VirtualService\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" tcp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("echo\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gateways")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" tcp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("echo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("gateway\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tcp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("match")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("31400")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" tcp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("echo\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("number")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9000")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subset")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("weight")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" tcp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("echo\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("number")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9000")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subset")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v2\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("weight")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v("\n")])])]),s("ol",{attrs:{start:"4"}},[s("li",[s("p",[t._v("å‘å¾®æœåŠ¡å‘é€æ›´å¤š TCP æµé‡"),s("code",[t._v("tcp-echo")]),t._v("ã€‚")]),t._v(" "),s("p",[t._v("æ‚¨ç°åœ¨åº”è¯¥æ³¨æ„åˆ°å¤§çº¦ 20% çš„æ—¶é—´æˆ³å…·æœ‰å‰ç¼€"),s("em",[t._v("2")]),t._v("ï¼Œè¿™æ„å‘³ç€ 80% çš„ TCP æµé‡è¢«è·¯ç”±åˆ°æœåŠ¡"),s("code",[t._v("v1")]),t._v("ç‰ˆæœ¬"),s("code",[t._v("tcp-echo")]),t._v("ï¼Œè€Œ 20% è¢«è·¯ç”±åˆ°"),s("code",[t._v("v2")]),t._v(".")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 istio-1.9.5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  for i in {1..20}; do \\")]),t._v("\nkubectl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("kubectl get pod "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-l")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("sleep "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" istio-io-tcp-traffic-shifting "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("jsonpath")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(".items"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("metadata.name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" istio-io-tcp-traffic-shifting -- "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sh")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"(date; sleep 1) | nc '),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$INGRESS_HOST")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$TCP_INGRESS_PORT")]),t._v('"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v("\none Mon Nov "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(":38:45 UTC "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2018")]),t._v("\ntwo Mon Nov "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(":38:47 UTC "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2018")]),t._v("\none Mon Nov "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(":38:50 UTC "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2018")]),t._v("\none Mon Nov "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(":38:52 UTC "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2018")]),t._v("\none Mon Nov "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(":38:55 UTC "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2018")]),t._v("\ntwo Mon Nov "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(":38:57 UTC "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2018")]),t._v("\none Mon Nov "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(":39:00 UTC "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2018")]),t._v("\none Mon Nov "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(":39:02 UTC "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2018")]),t._v("\none Mon Nov "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(":39:05 UTC "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2018")]),t._v("\none Mon Nov "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(":39:07 UTC "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2018")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])])]),s("h4",{attrs:{id:"æ¸…ç†-4"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ¸…ç†-4"}},[t._v("#")]),t._v(" æ¸…ç†")]),t._v(" "),s("p",[t._v("åˆ é™¤"),s("code",[t._v("sleep")]),t._v("ç¤ºä¾‹ã€"),s("code",[t._v("tcp-echo")]),t._v("åº”ç”¨ç¨‹åºå’Œè·¯ç”±è§„åˆ™ï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl delete "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" samples/tcp-echo/tcp-echo-all-v1.yaml "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" istio-io-tcp-traffic-shifting\n$ kubectl delete "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" samples/tcp-echo/tcp-echo-services.yaml "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" istio-io-tcp-traffic-shifting\n$ kubectl delete "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" samples/sleep/sleep.yaml "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" istio-io-tcp-traffic-shifting\n$ kubectl delete namespace istio-io-tcp-traffic-shifting\n")])])]),s("h2",{attrs:{id:"è¯·æ±‚è¶…æ—¶"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#è¯·æ±‚è¶…æ—¶"}},[t._v("#")]),t._v(" è¯·æ±‚è¶…æ—¶")]),t._v(" "),s("h4",{attrs:{id:"ç¯å¢ƒå‡†å¤‡-4"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç¯å¢ƒå‡†å¤‡-4"}},[t._v("#")]),t._v(" ç¯å¢ƒå‡†å¤‡")]),t._v(" "),s("ul",[s("li",[t._v("éƒ¨ç½²"),s("a",{attrs:{href:"https://istio.io/latest/docs/examples/bookinfo/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Bookinfo"),s("OutboundLink")],1),t._v("ç¤ºä¾‹åº”ç”¨ç¨‹åºï¼Œåº”ç”¨ç›®æ ‡è§„åˆ™ã€‚")]),t._v(" "),s("li",[t._v("äº†è§£äº†æµé‡ç®¡ç†çš„åŸºç¡€æ¦‚å¿µï¼Œä»¥åŠä¸“ä¸šè¯­æœ¯ã€‚")])]),t._v(" "),s("blockquote",[s("p",[t._v("é¦–å…ˆï¼Œè¿è¡Œæ­¤å‘½ä»¤å°†æ‰€æœ‰æµé‡è·¯ç”±åˆ°"),s("code",[t._v("v1")]),t._v("æ¯ä¸ªå¾®æœåŠ¡çš„ç‰ˆæœ¬ã€‚")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" samples/bookinfo/networking/virtual-service-all-v1.yaml\n")])])])]),t._v(" "),s("h4",{attrs:{id:"è¯·æ±‚è¶…æ—¶-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#è¯·æ±‚è¶…æ—¶-2"}},[t._v("#")]),t._v(" è¯·æ±‚è¶…æ—¶")]),t._v(" "),s("p",[t._v("å¯ä»¥ä½¿ç”¨"),s("a",{attrs:{href:"https://istio.io/latest/docs/reference/config/networking/virtual-service/#HTTPRoute",target:"_blank",rel:"noopener noreferrer"}},[t._v("è·¯ç”±è§„åˆ™çš„"),s("OutboundLink")],1),s("em",[t._v("timeout")]),t._v("å­—æ®µæŒ‡å®š HTTP è¯·æ±‚çš„è¶…æ—¶æ—¶é—´ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯·æ±‚è¶…æ—¶è¢«ç¦ç”¨ï¼Œä½†åœ¨æ­¤ä»»åŠ¡ä¸­ï¼Œæ‚¨å°†æœåŠ¡è¶…æ—¶è¦†ç›–ä¸º 1 ç§’ã€‚ä½†æ˜¯ï¼Œè¦æŸ¥çœ‹å…¶æ•ˆæœï¼Œæ‚¨è¿˜å¯ä»¥åœ¨è°ƒç”¨æœåŠ¡æ—¶äººä¸ºåœ°å¼•å…¥ 2 ç§’å»¶è¿Ÿã€‚")]),t._v(" "),s("ol",[s("li",[t._v("å°†è¯·æ±‚è·¯ç”±åˆ°"),s("code",[t._v("reviews")]),t._v("æœåŠ¡çš„ v2ï¼Œå³è°ƒç”¨"),s("code",[t._v("ratings")]),t._v("æœåŠ¡çš„ç‰ˆæœ¬ï¼š")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" <<EOF\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" VirtualService\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" reviews\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" reviews\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" reviews\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subset")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v2\nEOF\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[t._v("å¯¹æœåŠ¡çš„è°ƒç”¨æ·»åŠ  2 ç§’å»¶è¿Ÿ"),s("code",[t._v("ratings")]),t._v("ï¼š\n"),s("ul",[s("li",[s("code",[t._v("ä½¿ç”¨httpè§„åˆ™é…ç½®ç›®çš„åœ°ç‰ˆæœ¬ä¸ºv1ä¸»æœºæ˜¯ratings")])]),t._v(" "),s("li",[s("code",[t._v("é…ç½®ç™¾åˆ†æ¯”ä¸º100çš„2ç§’å›ºå®šæ—¶é—´å»¶è¿Ÿ")])])])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" <<EOF\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" VirtualService\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ratings\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ratings\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fault")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("delay")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("percent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fixedDelay")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 2s\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ratings\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subset")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\nEOF\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[s("code",[t._v("http://$GATEWAY_URL/productpage")]),t._v("åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ Bookinfo URL ã€‚")])]),t._v(" "),s("p",[t._v("æ‚¨åº”è¯¥ä¼šçœ‹åˆ° Bookinfo åº”ç”¨ç¨‹åºæ­£å¸¸å·¥ä½œï¼ˆæ˜¾ç¤ºè¯„çº§æ˜Ÿï¼‰ï¼Œä½†æ˜¯æ¯å½“æ‚¨åˆ·æ–°é¡µé¢æ—¶éƒ½ä¼šæœ‰ 2 ç§’çš„å»¶è¿Ÿã€‚")]),t._v(" "),s("ol",{attrs:{start:"4"}},[s("li",[t._v("ç°åœ¨ä¸ºå¯¹æœåŠ¡çš„è°ƒç”¨æ·»åŠ åŠç§’è¯·æ±‚è¶…æ—¶"),s("code",[t._v("reviews")]),t._v("ï¼š")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" <<EOF\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" VirtualService\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" reviews\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" reviews\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" reviews\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subset")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v2\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("timeout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 0.5s\nEOF\n")])])]),s("ol",{attrs:{start:"5"}},[s("li",[t._v("åˆ·æ–° Bookinfo ç½‘é¡µã€‚")])]),t._v(" "),s("p",[t._v("æ‚¨ç°åœ¨åº”è¯¥çœ‹åˆ°å®ƒåœ¨å¤§çº¦ 1 ç§’å†…è¿”å›ï¼Œè€Œä¸æ˜¯ 2 ç§’ï¼Œå¹¶ä¸”è¯„è®ºä¸å¯ç”¨ã€‚")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202205062327037.png",alt:"image-20220318111010285"}})]),t._v(" "),s("blockquote",[s("p",[t._v("æ³¨æ„ï¼š")]),t._v(" "),s("p",[t._v("å“åº”éœ€è¦1ç§’çš„åŸå› ï¼Œå³ä½¿è¶…æ—¶é…ç½®ä¸ºåŠç§’ï¼Œä¹Ÿæ˜¯å› ä¸ºæœåŠ¡ä¸­æœ‰ç¡¬ç¼–ç çš„é‡è¯•ï¼Œæ‰€ä»¥å®ƒåœ¨è¿”å›ä¹‹å‰è°ƒç”¨äº†ä¸¤æ¬¡"),s("code",[t._v("productpage")]),t._v("è¶…æ—¶æœåŠ¡ã€‚"),s("code",[t._v("reviews")])])]),t._v(" "),s("h4",{attrs:{id:"æ¸…ç†-5"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ¸…ç†-5"}},[t._v("#")]),t._v(" æ¸…ç†")]),t._v(" "),s("p",[t._v("åˆ é™¤åº”ç”¨ç¨‹åºè·¯ç”±è§„åˆ™ï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl delete "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" samples/bookinfo/networking/virtual-service-all-v1.yaml\n")])])]),s("h2",{attrs:{id:"ç†”æ–­-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç†”æ–­-2"}},[t._v("#")]),t._v(" ç†”æ–­")]),t._v(" "),s("h4",{attrs:{id:"ç†”æ–­çš„æ–¹å¼"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç†”æ–­çš„æ–¹å¼"}},[t._v("#")]),t._v(" ç†”æ–­çš„æ–¹å¼")]),t._v(" "),s("p",[t._v("æ­¤ä»»åŠ¡å‘æ‚¨å±•ç¤ºå¦‚ä½•ä¸ºè¿æ¥ã€è¯·æ±‚å’Œå¼‚å¸¸å€¼æ£€æµ‹é…ç½®æ–­è·¯ã€‚")]),t._v(" "),s("p",[t._v("æ–­è·¯æ˜¯åˆ›å»ºå¼¹æ€§å¾®æœåŠ¡åº”ç”¨ç¨‹åºçš„é‡è¦æ¨¡å¼ã€‚æ–­è·¯å…è®¸æ‚¨ç¼–å†™é™åˆ¶æ•…éšœã€å»¶è¿Ÿå³°å€¼å’Œç½‘ç»œç‰¹æ€§çš„å…¶ä»–ä¸è‰¯å½±å“çš„å½±å“çš„åº”ç”¨ç¨‹åºã€‚")]),t._v(" "),s("p",[t._v("åœ¨æ­¤ä»»åŠ¡ä¸­ï¼Œæ‚¨å°†é…ç½®æ–­è·¯å™¨è§„åˆ™ï¼Œç„¶åé€šè¿‡æœ‰æ„â€œè·³é—¸â€æ–­è·¯å™¨æ¥æµ‹è¯•é…ç½®ã€‚")]),t._v(" "),s("h4",{attrs:{id:"ç¯å¢ƒå‡†å¤‡-5"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç¯å¢ƒå‡†å¤‡-5"}},[t._v("#")]),t._v(" ç¯å¢ƒå‡†å¤‡")]),t._v(" "),s("p",[t._v("å¯åŠ¨"),s("a",{attrs:{href:"https://github.com/istio/istio/tree/release-1.13/samples/httpbin",target:"_blank",rel:"noopener noreferrer"}},[t._v("httpbin"),s("OutboundLink")],1),t._v("ç¤ºä¾‹ã€‚")]),t._v(" "),s("p",[t._v("å¦‚æœæ‚¨å¯ç”¨äº†"),s("a",{attrs:{href:"https://istio.io/latest/docs/setup/additional-setup/sidecar-injection/#automatic-sidecar-injection",target:"_blank",rel:"noopener noreferrer"}},[t._v("è‡ªåŠ¨è¾¹è½¦æ³¨å…¥"),s("OutboundLink")],1),t._v("ï¼Œè¯·éƒ¨ç½²è¯¥"),s("code",[t._v("httpbin")]),t._v("æœåŠ¡ï¼š")]),t._v(" "),s("p",[t._v("å¦åˆ™ï¼Œæ‚¨å¿…é¡»åœ¨éƒ¨ç½²åº”ç”¨ç¨‹åºä¹‹å‰æ‰‹åŠ¨æ³¨å…¥ sidecar "),s("code",[t._v("httpbin")]),t._v("ï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" samples/httpbin/httpbin.yaml\n$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("istioctl kube-inject "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" samples/httpbin/httpbin.yaml"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h4",{attrs:{id:"é…ç½®æ–­è·¯å™¨"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#é…ç½®æ–­è·¯å™¨"}},[t._v("#")]),t._v(" é…ç½®æ–­è·¯å™¨")]),t._v(" "),s("ol",[s("li",[t._v("åˆ›å»º"),s("a",{attrs:{href:"https://istio.io/latest/docs/reference/config/networking/destination-rule/",target:"_blank",rel:"noopener noreferrer"}},[t._v("ç›®æ ‡è§„åˆ™"),s("OutboundLink")],1),t._v("ä»¥åœ¨è°ƒç”¨æœåŠ¡æ—¶åº”ç”¨æ–­è·¯è®¾ç½®"),s("code",[t._v("httpbin")]),t._v("ï¼š\n"),s("ul",[s("li",[s("code",[t._v("é…ç½®äº¤é€šæ”¿ç­–çš„è¿æ¥æ± å’Œå¼‚å¸¸æ£€æµ‹")])]),t._v(" "),s("li",[s("code",[t._v("é…ç½®è¿æ¥æ± çš„tcpè§„åˆ™åˆ°ç›®æ ‡ä¸»æœºçš„æœ€å¤§HTTP1/TCPè¿æ¥æ•°ä¸º 1")])]),t._v(" "),s("li",[s("code",[t._v("é…ç½®è¿æ¥æ± çš„httpè§„åˆ™å¯¹ç›®æ ‡çš„æœ€å¤§æŒ‚èµ·HTTPè¯·æ±‚æ•°ä¸º 1")])]),t._v(" "),s("li",[s("code",[t._v("é…ç½®è¿æ¥æ± çš„httpè§„åˆ™æ¯ä¸ªåç«¯è¿æ¥çš„æœ€å¤§è¯·æ±‚æ•°ä¸º 1")])]),t._v(" "),s("li",[s("code",[t._v("é…ç½®å¼‚å¸¸æ£€æµ‹ä»è¿æ¥æ± ä¸­å¼¹å‡ºä¸»æœºä¹‹å‰çš„5xxé”™è¯¯æ•°ä¸º 1")])]),t._v(" "),s("li",[s("code",[t._v("é…ç½®å¼‚å¸¸æ£€æµ‹å¼¹å°„æ‰«æåˆ†æä¹‹é—´çš„æ—¶é—´é—´éš”ä¸º 1ç§’")])]),t._v(" "),s("li",[s("code",[t._v("é…ç½®å¼‚å¸¸æ£€æµ‹æœ€çŸ­å¼¹å°„æ—¶é—´ä¸º 3åˆ†é’Ÿ")])]),t._v(" "),s("li",[s("code",[t._v("é…ç½®å¼‚å¸¸æ£€æµ‹æœ€å¤§å¼¹å°„ç™¾åˆ†æ¯”ä¸º 100")])])])])]),t._v(" "),s("blockquote",[s("p",[t._v("å¦‚æœæ‚¨å®‰è£…/é…ç½®äº†å¯ç”¨åŒå‘ TLS èº«ä»½éªŒè¯çš„ Istioï¼Œåˆ™å¿…é¡»åœ¨åº”ç”¨ä¹‹å‰æ·»åŠ  TLS æµé‡"),s("code",[t._v("mode: ISTIO_MUTUAL")]),t._v("ç­–ç•¥"),s("code",[t._v("DestinationRule")]),t._v("ã€‚å¦åˆ™è¯·æ±‚å°†äº§ç”Ÿ 503 é”™è¯¯ï¼Œå¦‚æ­¤"),s("a",{attrs:{href:"https://istio.io/latest/docs/ops/common-problems/network-issues/#503-errors-after-setting-destination-rule",target:"_blank",rel:"noopener noreferrer"}},[t._v("å¤„"),s("OutboundLink")],1),t._v("æ‰€è¿°ã€‚")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" <<EOF\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" DestinationRule\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" httpbin\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" httpbin\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("trafficPolicy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("connectionPool")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tcp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("maxConnections")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http1MaxPendingRequests")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("maxRequestsPerConnection")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("outlierDetection")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("consecutive5xxErrors")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("interval")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 1s\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("baseEjectionTime")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 3m\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("maxEjectionPercent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("\nEOF\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[t._v("éªŒè¯ç›®æ ‡è§„åˆ™æ˜¯å¦å·²æ­£ç¡®åˆ›å»ºï¼š")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 istio-1.9.5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get destinationrules")]),t._v("\nNAME                   HOST          AGE\ndetails                details       4h41m\nhttpbin                httpbin       64m\n")])])]),s("h4",{attrs:{id:"æ·»åŠ å®¢æˆ·ç«¯"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ·»åŠ å®¢æˆ·ç«¯"}},[t._v("#")]),t._v(" æ·»åŠ å®¢æˆ·ç«¯")]),t._v(" "),s("p",[t._v("åˆ›å»ºå®¢æˆ·ç«¯ä»¥å°†æµé‡å‘é€åˆ°"),s("code",[t._v("httpbin")]),t._v("æœåŠ¡ã€‚"),s("a",{attrs:{href:"https://github.com/istio/fortio",target:"_blank",rel:"noopener noreferrer"}},[t._v("è¯¥å®¢æˆ·ç«¯æ˜¯ä¸€ä¸ªåä¸ºfortio"),s("OutboundLink")],1),t._v("çš„ç®€å•è´Ÿè½½æµ‹è¯•å®¢æˆ·ç«¯ã€‚Fortio å…è®¸æ‚¨æ§åˆ¶ä¼ å‡º HTTP è°ƒç”¨çš„è¿æ¥æ•°ã€å¹¶å‘æ€§å’Œå»¶è¿Ÿã€‚æ‚¨å°†ä½¿ç”¨æ­¤å®¢æˆ·ç«¯â€œè·³é—¸â€æ‚¨åœ¨"),s("code",[t._v("DestinationRule")]),t._v(".")]),t._v(" "),s("ol",[s("li",[t._v("ä½¿ç”¨ Istio sidecar ä»£ç†æ³¨å…¥å®¢æˆ·ç«¯ï¼Œä»¥ä¾¿ç½‘ç»œäº¤äº’ç”± Istio ç®¡ç†ã€‚å¦‚æœæ‚¨å¯ç”¨äº†"),s("a",{attrs:{href:"https://istio.io/latest/docs/setup/additional-setup/sidecar-injection/#automatic-sidecar-injection",target:"_blank",rel:"noopener noreferrer"}},[t._v("è‡ªåŠ¨è¾¹è½¦æ³¨å…¥"),s("OutboundLink")],1),t._v("ï¼Œè¯·éƒ¨ç½²è¯¥"),s("code",[t._v("fortio")]),t._v("æœåŠ¡ï¼š")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" samples/httpbin/sample-client/fortio-deploy.yaml\n")])])]),s("p",[t._v("å¦åˆ™ï¼Œæ‚¨å¿…é¡»åœ¨éƒ¨ç½²åº”ç”¨ç¨‹åºä¹‹å‰æ‰‹åŠ¨æ³¨å…¥ sidecar "),s("code",[t._v("fortio")]),t._v("ï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("istioctl kube-inject "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" samples/httpbin/sample-client/fortio-deploy.yaml"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[t._v("ç™»å½•å®¢æˆ·ç«¯podï¼Œä½¿ç”¨fortioå·¥å…·è°ƒç”¨"),s("code",[t._v("httpbin")]),t._v(". ä¼ å…¥"),s("code",[t._v("curl")]),t._v("è¡¨ç¤ºä½ åªæƒ³æ‰“ä¸€ä¸ªç”µè¯ï¼š")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("FORTIO_POD")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("kubectl get pods "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-l")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("fortio "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'jsonpath={.items[0].metadata.name}'")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n$ kubectl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$FORTIO_POD")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" fortio -- /usr/bin/fortio "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-quiet")]),t._v(" http://httpbin:8000/get\nHTTP/1.1 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" OK\nserver: envoy\ndate: Tue, "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),t._v(" Feb "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(":25:52 GMT\ncontent-type: application/json\ncontent-length: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("586")]),t._v("\naccess-control-allow-origin: *\naccess-control-allow-credentials: "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\nx-envoy-upstream-service-time: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("36")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"args"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"headers"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Content-Length"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0"')]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Host"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"httpbin:8000"')]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"User-Agent"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fortio.org/fortio-1.3.1"')]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"X-B3-Parentspanid"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"8fc453fb1dec2c22"')]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"X-B3-Sampled"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"X-B3-Spanid"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"071d7f06bc94943c"')]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"X-B3-Traceid"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"86a929a0e76cda378fc453fb1dec2c22"')]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"X-Forwarded-Client-Cert"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"By=spiffe://cluster.local/ns/default/sa/httpbin;Hash=68bbaedefe01ef4cb99e17358ff63e92d04a4ce831a35ab9a31d3c8e06adb038;Subject='),s("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[t._v('\\"')]),s("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[t._v('\\"')]),t._v(';URI=spiffe://cluster.local/ns/default/sa/default"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"origin"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"127.0.0.1"')]),t._v(",\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"url"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://httpbin:8000/get"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h4",{attrs:{id:"ä½¿æ–­è·¯å™¨è·³é—¸"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä½¿æ–­è·¯å™¨è·³é—¸"}},[t._v("#")]),t._v(" ä½¿æ–­è·¯å™¨è·³é—¸")]),t._v(" "),s("p",[t._v("åœ¨"),s("code",[t._v("DestinationRule")]),t._v("è®¾ç½®ä¸­ï¼Œæ‚¨æŒ‡å®šäº†"),s("code",[t._v("maxConnections: 1")]),t._v("å’Œ "),s("code",[t._v("http1MaxPendingRequests: 1")]),t._v("ã€‚è¿™äº›è§„åˆ™è¡¨æ˜ï¼Œå¦‚æœæ‚¨è¶…è¿‡ä¸€ä¸ªè¿æ¥å¹¶åŒæ—¶è¯·æ±‚ï¼Œåˆ™å½“ "),s("code",[t._v("istio-proxy")]),t._v("æ‰“å¼€æ›´å¤šè¯·æ±‚å’Œè¿æ¥çš„ç”µè·¯æ—¶ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä¸€äº›å¤±è´¥ã€‚")]),t._v(" "),s("ol",[s("li",[t._v("ä½¿ç”¨ä¸¤ä¸ªå¹¶å‘è¿æ¥ ( "),s("code",[t._v("-c 2")]),t._v(") è°ƒç”¨æœåŠ¡å¹¶å‘é€ 20 ä¸ªè¯·æ±‚ ( "),s("code",[t._v("-n 20")]),t._v(")ï¼š")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 istio-1.9.5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# kubectl exec "$FORTIO_POD" -c fortio -- /usr/bin/fortio load -c 2 -qps 0 -n 20 -loglevel Warning http://httpbin:8000/get')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":42:53 I logger.go:12"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("7")]),t._v(">")]),t._v(" Log level is now "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" Warning "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("was "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" Info"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nFortio "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.17")]),t._v(".1 running at "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" queries per second, "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" procs, "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" calls: http://httpbin:8000/get\nStarting at max qps with "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" thread"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("gomax "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" exactly "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" calls "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" per thread + "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":42:53 W http_client.go:80"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("6")]),t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Non ok http code "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("HTTP/1.1 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":42:53 W http_client.go:80"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("6")]),t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Non ok http code "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("HTTP/1.1 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":42:53 W http_client.go:80"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("6")]),t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Non ok http code "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("HTTP/1.1 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":42:53 W http_client.go:80"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("6")]),t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Non ok http code "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("HTTP/1.1 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":42:53 W http_client.go:80"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("6")]),t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Non ok http code "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("HTTP/1.1 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":42:53 W http_client.go:80"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("6")]),t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Non ok http code "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("HTTP/1.1 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nEnded after "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("90")]),t._v(".508623ms "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" calls. "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("qps")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("220.97")]),t._v("\nAggregated Function Time "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" count "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" avg "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0081634006")]),t._v(" +/- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.006652")]),t._v(" min "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.000929244")]),t._v(" max "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.027135759")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sum")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.163268012")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# range, mid point, percentile, count")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.000929244")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.001")]),t._v(" , "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.000964622")]),t._v(" , "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5.00")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.001")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.002")]),t._v(" , "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0015")]),t._v(" , "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("25.00")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.002")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.003")]),t._v(" , "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0025")]),t._v(" , "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("30.00")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.005")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.006")]),t._v(" , "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0055")]),t._v(" , "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("40.00")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.006")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.007")]),t._v(" , "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0065")]),t._v(" , "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("50.00")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.007")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.008")]),t._v(" , "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0075")]),t._v(" , "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("60.00")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.008")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.009")]),t._v(" , "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0085")]),t._v(" , "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("65.00")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.009")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.01")]),t._v(" , "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0095")]),t._v(" , "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80.00")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.014")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.016")]),t._v(" , "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.015")]),t._v(" , "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("85.00")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.018")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.02")]),t._v(" , "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.019")]),t._v(" , "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("95.00")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.025")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0271358")]),t._v(" , "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0260679")]),t._v(" , "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100.00")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# target 50% 0.007")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# target 75% 0.00966667")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# target 90% 0.019")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# target 99% 0.0267086")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# target 99.9% 0.027093")]),t._v("\nSockets used: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("for perfect keepalive, would be "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nJitter: "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\nCode "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("70.0")]),t._v(" %"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nCode "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("30.0")]),t._v(" %"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nResponse Header Sizes "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" count "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" avg "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("161.15")]),t._v(" +/- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("105.5")]),t._v(" min "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" max "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("231")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sum")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3223")]),t._v("\nResponse Body/Total Sizes "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" count "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" avg "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("649.25")]),t._v(" +/- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("267.3")]),t._v(" min "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("241")]),t._v(" max "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("825")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sum")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12985")]),t._v("\nAll "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" calls "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("plus "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" warmup"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8.163")]),t._v(" ms avg, "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("221.0")]),t._v(" qps\n")])])]),s("p",[t._v("æœ‰è¶£çš„æ˜¯ï¼Œå‡ ä¹æ‰€æœ‰è¯·æ±‚éƒ½é€šè¿‡äº†ï¼"),s("code",[t._v("istio-proxy")]),t._v(" ç¡®å®ç•™æœ‰ä½™åœ°ã€‚")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("Code 200 : 14 (70.0 %)\nCode 503 : 6 (30.0 %)\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[t._v("å°†å¹¶å‘è¿æ¥æ•°å¢åŠ åˆ° 3ï¼š")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 istio-1.9.5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# kubectl exec "$FORTIO_POD" -c fortio -- /usr/bin/fortio load -c 3 -qps 0 -n 20 -loglevel Warning http://httpbin:8000/get')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":44:49 I logger.go:12"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("7")]),t._v(">")]),t._v(" Log level is now "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" Warning "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("was "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" Info"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nFortio "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.17")]),t._v(".1 running at "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" queries per second, "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" procs, "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" calls: http://httpbin:8000/get\nStarting at max qps with "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" thread"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("gomax "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" exactly "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" calls "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v(" per thread + "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":44:49 W http_client.go:80"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("6")]),t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Non ok http code "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("HTTP/1.1 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":44:49 W http_client.go:80"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("6")]),t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Non ok http code "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("HTTP/1.1 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":44:49 W http_client.go:80"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("6")]),t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Non ok http code "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("HTTP/1.1 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":44:49 W http_client.go:80"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("6")]),t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Non ok http code "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("HTTP/1.1 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":44:49 W http_client.go:80"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("6")]),t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Non ok http code "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("HTTP/1.1 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":44:49 W http_client.go:80"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("6")]),t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Non ok http code "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("HTTP/1.1 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":44:49 W http_client.go:80"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("6")]),t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Non ok http code "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("HTTP/1.1 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":44:49 W http_client.go:80"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("6")]),t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Non ok http code "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("HTTP/1.1 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":44:49 W http_client.go:80"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("6")]),t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Non ok http code "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("HTTP/1.1 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":44:49 W http_client.go:80"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("6")]),t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Non ok http code "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("HTTP/1.1 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":44:49 W http_client.go:80"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("6")]),t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Non ok http code "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("HTTP/1.1 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":44:49 W http_client.go:80"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("6")]),t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Non ok http code "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("HTTP/1.1 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":44:49 W http_client.go:80"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("6")]),t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Non ok http code "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("HTTP/1.1 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":44:49 W http_client.go:80"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("6")]),t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Non ok http code "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("HTTP/1.1 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":44:49 W http_client.go:80"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("6")]),t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Non ok http code "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("HTTP/1.1 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nEnded after "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("32")]),t._v(".522699ms "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" calls. "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("qps")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("614.96")]),t._v("\nAggregated Function Time "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" count "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" avg "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0029114787")]),t._v(" +/- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.003681")]),t._v(" min "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.000447652")]),t._v(" max "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.016532305")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sum")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.058229575")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# range, mid point, percentile, count")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.000447652")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.001")]),t._v(" , "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.000723826")]),t._v(" , "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("30.00")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.001")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.002")]),t._v(" , "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0015")]),t._v(" , "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("60.00")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.002")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.003")]),t._v(" , "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0025")]),t._v(" , "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("70.00")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.004")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.005")]),t._v(" , "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0045")]),t._v(" , "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("90.00")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.008")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.009")]),t._v(" , "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0085")]),t._v(" , "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("95.00")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.016")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0165323")]),t._v(" , "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0162662")]),t._v(" , "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100.00")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# target 50% 0.00166667")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# target 75% 0.00425")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# target 90% 0.005")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# target 99% 0.0164258")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# target 99.9% 0.0165217")]),t._v("\nSockets used: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("for perfect keepalive, would be "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nJitter: "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\nCode "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("25.0")]),t._v(" %"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nCode "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("75.0")]),t._v(" %"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nResponse Header Sizes "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" count "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" avg "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("57.55")]),t._v(" +/- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("99.68")]),t._v(" min "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" max "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("231")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sum")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1151")]),t._v("\nResponse Body/Total Sizes "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" count "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" avg "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("386.8")]),t._v(" +/- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("252.5")]),t._v(" min "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("241")]),t._v(" max "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("825")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sum")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7736")]),t._v("\nAll "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" calls "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("plus "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" warmup"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.911")]),t._v(" ms avg, "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("615.0")]),t._v(" qps\n")])])]),s("p",[t._v("ç°åœ¨æ‚¨å¼€å§‹çœ‹åˆ°é¢„æœŸçš„æ–­è·¯è¡Œä¸ºã€‚åªæœ‰ 36.7% çš„è¯·æ±‚æˆåŠŸï¼Œå…¶ä½™çš„åˆ™è¢«ç†”æ–­æœºåˆ¶å›°ä½ï¼š")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("Code 200 : 5 (25.0 %)\nCode 503 : 15 (75.0 %)\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[s("p",[t._v("æŸ¥è¯¢"),s("code",[t._v("istio-proxy")]),t._v("ç»Ÿè®¡ä¿¡æ¯ä»¥æŸ¥çœ‹æ›´å¤šä¿¡æ¯ï¼š")]),t._v(" "),s("p",[t._v("æ‚¨å¯ä»¥æŸ¥çœ‹"),s("code",[t._v("21")]),t._v("è¯¥"),s("code",[t._v("upstream_rq_pending_overflow")]),t._v("å€¼ï¼Œè¿™æ„å‘³ç€"),s("code",[t._v("21")]),t._v(" åˆ°ç›®å‰ä¸ºæ­¢çš„è°ƒç”¨å·²è¢«æ ‡è®°ä¸ºæ–­è·¯ã€‚")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 istio-1.9.5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# kubectl exec "$FORTIO_POD" -c istio-proxy -- pilot-agent request GET stats | grep httpbin | grep pending')]),t._v("\ncluster.outbound"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8000")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v("httpbin.default.svc.cluster.local.circuit_breakers.default.remaining_pending: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\ncluster.outbound"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8000")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v("httpbin.default.svc.cluster.local.circuit_breakers.default.rq_pending_open: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\ncluster.outbound"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8000")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v("httpbin.default.svc.cluster.local.circuit_breakers.high.rq_pending_open: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\ncluster.outbound"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8000")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v("httpbin.default.svc.cluster.local.upstream_rq_pending_active: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\ncluster.outbound"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8000")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v("httpbin.default.svc.cluster.local.upstream_rq_pending_failure_eject: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\ncluster.outbound"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8000")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v("httpbin.default.svc.cluster.local.upstream_rq_pending_overflow: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("40")]),t._v("\ncluster.outbound"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8000")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v("httpbin.default.svc.cluster.local.upstream_rq_pending_total: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("41")]),t._v("\n")])])]),s("h4",{attrs:{id:"æ¸…ç†-6"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ¸…ç†-6"}},[t._v("#")]),t._v(" æ¸…ç†")]),t._v(" "),s("p",[t._v("åˆ é™¤è§„åˆ™ï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl delete destinationrule httpbin\n")])])]),s("p",[t._v("å…³é—­"),s("a",{attrs:{href:"https://github.com/istio/istio/tree/release-1.13/samples/httpbin",target:"_blank",rel:"noopener noreferrer"}},[t._v("httpbin"),s("OutboundLink")],1),t._v("æœåŠ¡å’Œå®¢æˆ·ç«¯ï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl delete deploy httpbin fortio-deploy\n$ kubectl delete svc httpbin fortio\n")])])]),s("h2",{attrs:{id:"é•œåƒ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#é•œåƒ"}},[t._v("#")]),t._v(" é•œåƒ")]),t._v(" "),s("h4",{attrs:{id:"æµé‡é•œåƒ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æµé‡é•œåƒ"}},[t._v("#")]),t._v(" æµé‡é•œåƒ")]),t._v(" "),s("p",[t._v("æ­¤ä»»åŠ¡æ¼”ç¤ºäº† Istio çš„æµé‡é•œåƒåŠŸèƒ½ã€‚")]),t._v(" "),s("p",[t._v("æµé‡é•œåƒï¼Œä¹Ÿç§°ä¸ºé˜´å½±ï¼Œæ˜¯ä¸€ä¸ªå¼ºå¤§çš„æ¦‚å¿µï¼Œå®ƒå…è®¸åŠŸèƒ½å›¢é˜Ÿä»¥å°½å¯èƒ½å°çš„é£é™©å°†æ›´æ”¹å¸¦å…¥ç”Ÿäº§ç¯å¢ƒã€‚é•œåƒå°†å®æ—¶æµé‡çš„å‰¯æœ¬å‘é€åˆ°é•œåƒæœåŠ¡ã€‚é•œåƒæµé‡å‘ç”Ÿåœ¨ä¸»æœåŠ¡çš„å…³é”®è¯·æ±‚è·¯å¾„çš„å¸¦å¤–ã€‚")]),t._v(" "),s("p",[t._v("åœ¨æ­¤ä»»åŠ¡ä¸­ï¼Œæ‚¨å°†é¦–å…ˆå¼ºåˆ¶æ‰€æœ‰æµé‡æµå‘"),s("code",[t._v("v1")]),t._v("æµ‹è¯•æœåŠ¡ã€‚ç„¶åï¼Œæ‚¨å°†åº”ç”¨è§„åˆ™å°†ä¸€éƒ¨åˆ†æµé‡é•œåƒåˆ°"),s("code",[t._v("v2")]),t._v(".")]),t._v(" "),s("h4",{attrs:{id:"åŸºç¡€ç¯å¢ƒ-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#åŸºç¡€ç¯å¢ƒ-2"}},[t._v("#")]),t._v(" åŸºç¡€ç¯å¢ƒ")]),t._v(" "),s("p",[t._v("é¦–å…ˆéƒ¨ç½²ä¸¤ä¸ªå¯ç”¨äº†è®¿é—®æ—¥å¿—è®°å½•çš„"),s("a",{attrs:{href:"https://github.com/istio/istio/tree/release-1.13/samples/httpbin",target:"_blank",rel:"noopener noreferrer"}},[t._v("httpbinæœåŠ¡ç‰ˆæœ¬ï¼š"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("strong",[t._v("httpbin-v1ï¼š")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("$ cat <<EOF "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" istioctl kube"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("inject "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" kubectl create "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apps/v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deployment\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" httpbin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" httpbin\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" httpbin\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" docker.io/kennethreitz/httpbin\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("imagePullPolicy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" IfNotPresent\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" httpbin\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"gunicorn"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--access-logfile"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-b"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0.0.0.0:80"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"httpbin:app"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\nEOF\n")])])]),s("p",[s("strong",[t._v("httpbin-v2ï¼š")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("EOF"),s("span",{pre:!0,attrs:{class:"token bash punctuation"}},[t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" istioctl kube-inject "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" - "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" kubectl create "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" -")]),t._v('\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: httpbin-v2\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: httpbin\n      version: v2\n  template:\n    metadata:\n      labels:\n        app: httpbin\n        version: v2\n    spec:\n      containers:\n      - image: docker.io/kennethreitz/httpbin\n        imagePullPolicy: IfNotPresent\n        name: httpbin\n        command: ["gunicorn", "--access-logfile", "-", "-b", "0.0.0.0:80", "httpbin:app"]\n        ports:\n        - containerPort: 80\nEOF')]),t._v("\n")])])]),s("p",[s("strong",[t._v("httpbin Kubernetes æœåŠ¡ï¼š")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("$ kubectl create "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" <<EOF\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Service\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" httpbin\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" httpbin\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8000")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targetPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" httpbin\nEOF\n")])])]),s("p",[t._v("å¯åŠ¨"),s("code",[t._v("sleep")]),t._v("æœåŠ¡ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥ä½¿ç”¨å®ƒ"),s("code",[t._v("curl")]),t._v("æ¥æä¾›è´Ÿè½½ï¼š")]),t._v(" "),s("p",[s("strong",[t._v("ç¡çœ æœåŠ¡ï¼š")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("$ cat <<EOF "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" istioctl kube"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("inject "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" kubectl create "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apps/v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deployment\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" sleep\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" sleep\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" sleep\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" sleep\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" curlimages/curl\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/bin/sleep"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3650d"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("imagePullPolicy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" IfNotPresent\nEOF\n")])])]),s("h4",{attrs:{id:"åˆ›å»ºé»˜è®¤è·¯ç”±ç­–ç•¥"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#åˆ›å»ºé»˜è®¤è·¯ç”±ç­–ç•¥"}},[t._v("#")]),t._v(" åˆ›å»ºé»˜è®¤è·¯ç”±ç­–ç•¥")]),t._v(" "),s("p",[t._v("é»˜è®¤æƒ…å†µä¸‹ï¼ŒKubernetes ä¼šåœ¨"),s("code",[t._v("httpbin")]),t._v("æœåŠ¡çš„ä¸¤ä¸ªç‰ˆæœ¬ä¹‹é—´è¿›è¡Œè´Ÿè½½å¹³è¡¡ã€‚åœ¨æ­¤æ­¥éª¤ä¸­ï¼Œæ‚¨å°†æ›´æ”¹è¯¥è¡Œä¸ºï¼Œä»¥ä¾¿æ‰€æœ‰æµé‡éƒ½è½¬åˆ°"),s("code",[t._v("v1")]),t._v(".")]),t._v(" "),s("ol",[s("li",[t._v("åˆ›å»ºé»˜è®¤è·¯ç”±è§„åˆ™ä»¥å°†æ‰€æœ‰æµé‡è·¯ç”±åˆ°"),s("code",[t._v("v1")]),t._v("æœåŠ¡ï¼Œç°åœ¨æ‰€æœ‰æµé‡éƒ½æµå‘"),s("code",[t._v("httpbin:v1")]),t._v("æœåŠ¡ã€‚ï¼š")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" <<EOF\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" VirtualService\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" httpbin\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" httpbin\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" httpbin\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subset")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("weight")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" DestinationRule\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" httpbin\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" httpbin\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subsets")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v2\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v2\nEOF\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[t._v("å‘æœåŠ¡å‘é€ä¸€äº›æµé‡ï¼š")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("SLEEP_POD")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("kubectl get pod "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-l")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("sleep "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("jsonpath")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(".items"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("metadata.name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n$ kubectl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${SLEEP_POD}")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),t._v(" -- "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-sS")]),t._v(" http://httpbin:8000/headers\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"headers"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Accept"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*/*"')]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Content-Length"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0"')]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Host"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"httpbin:8000"')]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"User-Agent"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"curl/7.35.0"')]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"X-B3-Parentspanid"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"57784f8bff90ae0b"')]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"X-B3-Sampled"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"X-B3-Spanid"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3289ae7257c3f159"')]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"X-B3-Traceid"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"b56eebd279a76f0b57784f8bff90ae0b"')]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"X-Envoy-Attempt-Count"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"X-Forwarded-Client-Cert"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"By=spiffe://cluster.local/ns/default/sa/default;Hash=20afebed6da091c850264cc751b8c9306abac02993f80bdb76282237422bd098;Subject='),s("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[t._v('\\"')]),s("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[t._v('\\"')]),t._v(';URI=spiffe://cluster.local/ns/default/sa/default"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[t._v("æ£€æŸ¥pod"),s("code",[t._v("v1")]),t._v("çš„æ—¥å¿—"),s("code",[t._v("v2")]),t._v("ã€‚"),s("code",[t._v("httpbin")]),t._v("æ‚¨åº”è¯¥çœ‹åˆ°ä»¥ä¸‹çš„è®¿é—®æ—¥å¿—æ¡ç›®ï¼Œ"),s("code",[t._v("v1")]),t._v("å¹¶ä¸”æ²¡æœ‰"),s("code",[t._v("v2")]),t._v("ï¼š")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("V1_POD")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("kubectl get pod "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-l")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("httpbin,version"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("v1 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("jsonpath")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(".items"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("metadata.name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n$ kubectl logs "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$V1_POD")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" httpbin\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-03-18 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":20:47 +0000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Starting gunicorn "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19.9")]),t._v(".0\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-03-18 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":20:47 +0000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Listening at: http://0.0.0.0:80 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-03-18 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":20:47 +0000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Using worker: "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sync")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-03-18 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":20:47 +0000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Booting worker with pid: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.6 - - "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v("/Mar/2022:16:30:43 +0000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET /headers HTTP/1.1"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("529")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"curl/7.81.0-DEV"')]),t._v("\n\n\n$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("V2_POD")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("kubectl get pod "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-l")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("httpbin,version"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("v2 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("jsonpath")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(".items"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("metadata.name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n$ kubectl logs "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$V2_POD")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" httpbin\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-03-18 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":20:53 +0000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Starting gunicorn "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19.9")]),t._v(".0\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-03-18 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":20:53 +0000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Listening at: http://0.0.0.0:80 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-03-18 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":20:53 +0000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Using worker: "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sync")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-03-18 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":20:53 +0000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Booting worker with pid: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n")])])]),s("h4",{attrs:{id:"å°†æµé‡é•œåƒåˆ°v2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å°†æµé‡é•œåƒåˆ°v2"}},[t._v("#")]),t._v(" å°†æµé‡é•œåƒåˆ°v2")]),t._v(" "),s("p",[s("strong",[t._v("æ›´æ”¹è·¯ç”±è§„åˆ™ä»¥å°†æµé‡é•œåƒåˆ° v2ï¼š")])]),t._v(" "),s("p",[t._v("æ­¤è·¯ç”±è§„åˆ™å°† 100% çš„æµé‡å‘é€åˆ°"),s("code",[t._v("v1")]),t._v(". æœ€åä¸€èŠ‚æŒ‡å®šæ‚¨å¸Œæœ›å°† 100% çš„ç›¸åŒæµé‡é•œåƒï¼ˆå³ï¼Œä¹Ÿå‘é€ï¼‰åˆ° "),s("code",[t._v("httpbin:v2")]),t._v("æœåŠ¡ã€‚")]),t._v(" "),s("p",[t._v("å½“æµé‡è¢«é•œåƒæ—¶ï¼Œè¯·æ±‚è¢«å‘é€åˆ°é•œåƒæœåŠ¡ï¼Œå…¶ Host/Authority æ ‡å¤´é™„åŠ "),s("code",[t._v("-shadow")]),t._v(". ä¾‹å¦‚ï¼Œ"),s("code",[t._v("cluster-1")]),t._v("å˜æˆ"),s("code",[t._v("cluster-1-shadow")]),t._v("ã€‚")]),t._v(" "),s("p",[t._v("æ­¤å¤–ï¼Œé‡è¦çš„æ˜¯è¦æ³¨æ„è¿™äº›è¯·æ±‚è¢«é•œåƒä¸ºâ€œå³å‘å³å¼ƒâ€ï¼Œè¿™æ„å‘³ç€å“åº”è¢«ä¸¢å¼ƒã€‚æ‚¨å¯ä»¥ä½¿ç”¨è¯¥"),s("code",[t._v("value")]),t._v("å­—æ®µä¸‹çš„"),s("code",[t._v("mirrorPercentage")]),t._v("å­—æ®µæ¥é•œåƒä¸€éƒ¨åˆ†æµé‡ï¼Œè€Œä¸æ˜¯é•œåƒæ‰€æœ‰è¯·æ±‚ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸ªå­—æ®µï¼Œæ‰€æœ‰çš„æµé‡éƒ½ä¼šè¢«é•œåƒã€‚")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" <<EOF\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" VirtualService\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" httpbin\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" httpbin\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" httpbin\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subset")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("weight")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mirror")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" httpbin\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subset")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v2\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mirrorPercentage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100.0")]),t._v("\nEOF\n")])])]),s("h4",{attrs:{id:"å‘é€æµé‡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å‘é€æµé‡"}},[t._v("#")]),t._v(" å‘é€æµé‡")]),t._v(" "),s("p",[t._v("é€šè¿‡å‘é€æµé‡å†æ¬¡è¿›è¡Œæµ‹è¯•ï¼Œæƒ…å†µå¦‚ä¸‹ï¼š")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("v1")]),t._v("ç°åœ¨ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°å’Œçš„è®¿é—®è®°å½•")]),t._v(" "),s("li",[s("code",[t._v("v2")]),t._v("ä¸­åˆ›å»ºçš„è®¿é—®æ—¥å¿—"),s("code",[t._v("v2")]),t._v("æ˜¯å®é™…å°†è¦è®¿é—®çš„é•œåƒè¯·æ±‚"),s("code",[t._v("v1")]),t._v("ã€‚")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 istio-work"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# kubectl exec "${SLEEP_POD}" -c sleep -- curl -sS http://httpbin:8000/headers')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"headers"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Accept"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*/*"')]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Host"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"httpbin:8000"')]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"User-Agent"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"curl/7.81.0-DEV"')]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"X-B3-Parentspanid"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"a422ba4aefe02440"')]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"X-B3-Sampled"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"X-B3-Spanid"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"acd7163f70c9aa89"')]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"X-B3-Traceid"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"f7ca9fb1e0581d6ba422ba4aefe02440"')]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"X-Envoy-Attempt-Count"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"X-Forwarded-Client-Cert"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"By=spiffe://cluster.local/ns/default/sa/default;Hash=ab53dec650eb79f2aa9dc051ed27a2b4b698ee40ffd557cd885495105916a139;Subject='),s("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[t._v('\\"')]),s("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[t._v('\\"')]),t._v(';URI=spiffe://cluster.local/ns/default/sa/default"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 istio-work"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# kubectl logs "$V1_POD" -c httpbin')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-03-18 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":20:47 +0000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Starting gunicorn "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19.9")]),t._v(".0\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-03-18 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":20:47 +0000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Listening at: http://0.0.0.0:80 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-03-18 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":20:47 +0000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Using worker: "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sync")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-03-18 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":20:47 +0000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Booting worker with pid: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.6 - - "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v("/Mar/2022:16:30:43 +0000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET /headers HTTP/1.1"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("529")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"curl/7.81.0-DEV"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.6 - - "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v("/Mar/2022:16:33:03 +0000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET /headers HTTP/1.1"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("529")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"curl/7.81.0-DEV"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.6 - - "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v("/Mar/2022:16:33:48 +0000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET /headers HTTP/1.1"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("529")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"curl/7.81.0-DEV"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.6 - - "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v("/Mar/2022:16:33:52 +0000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET /headers HTTP/1.1"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("529")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"curl/7.81.0-DEV"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.6 - - "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v("/Mar/2022:16:34:05 +0000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET /headers HTTP/1.1"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("529")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"curl/7.81.0-DEV"')]),t._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 istio-work"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# kubectl logs "$V2_POD" -c httpbin')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-03-18 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":20:53 +0000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Starting gunicorn "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19.9")]),t._v(".0\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-03-18 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":20:53 +0000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Listening at: http://0.0.0.0:80 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-03-18 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":20:53 +0000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Using worker: "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sync")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-03-18 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":20:53 +0000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Booting worker with pid: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.6 - - "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v("/Mar/2022:16:33:03 +0000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET /headers HTTP/1.1"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("569")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"curl/7.81.0-DEV"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.6 - - "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v("/Mar/2022:16:33:48 +0000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET /headers HTTP/1.1"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("569")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"curl/7.81.0-DEV"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.6 - - "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v("/Mar/2022:16:33:52 +0000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET /headers HTTP/1.1"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("569")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"curl/7.81.0-DEV"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.6 - - "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v("/Mar/2022:16:34:05 +0000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET /headers HTTP/1.1"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("569")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"curl/7.81.0-DEV"')]),t._v("\n")])])]),s("h4",{attrs:{id:"æ¸…ç†-7"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ¸…ç†-7"}},[t._v("#")]),t._v(" æ¸…ç†")]),t._v(" "),s("p",[t._v("åˆ é™¤è§„åˆ™ï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl delete virtualservice httpbin\n$ kubectl delete destinationrule httpbin\n")])])]),s("p",[t._v("å…³é—­"),s("a",{attrs:{href:"https://github.com/istio/istio/tree/release-1.13/samples/httpbin",target:"_blank",rel:"noopener noreferrer"}},[t._v("httpbin"),s("OutboundLink")],1),t._v("æœåŠ¡å’Œå®¢æˆ·ç«¯ï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl delete deploy httpbin-v1 httpbin-v2 "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),t._v("\n$ kubectl delete svc httpbin\n")])])]),s("h2",{attrs:{id:"å…¥å£ç½‘å…³"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å…¥å£ç½‘å…³"}},[t._v("#")]),t._v(" å…¥å£ç½‘å…³")]),t._v(" "),s("h4",{attrs:{id:"å…¥å£ç½‘å…³ç®€è¦"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å…¥å£ç½‘å…³ç®€è¦"}},[t._v("#")]),t._v(" å…¥å£ç½‘å…³ç®€è¦")]),t._v(" "),s("p",[t._v("é™¤äº†æ”¯æŒ Kubernetes "),s("a",{attrs:{href:"https://istio.io/latest/docs/tasks/traffic-management/ingress/kubernetes-ingress/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Ingress"),s("OutboundLink")],1),t._v("ï¼ŒIstio è¿˜æä¾›äº†å¦ä¸€ç§é…ç½®æ¨¡å‹ï¼Œ"),s("a",{attrs:{href:"https://istio.io/latest/docs/reference/config/networking/gateway/",target:"_blank",rel:"noopener noreferrer"}},[t._v("å³ Istio Gateway"),s("OutboundLink")],1),t._v("ã€‚A"),s("code",[t._v("Gateway")]),t._v("æä¾›äº†æ¯” æ›´å¹¿æ³›çš„è‡ªå®šä¹‰å’Œçµæ´»æ€§"),s("code",[t._v("Ingress")]),t._v("ï¼Œå¹¶å…è®¸å°†ç›‘æ§å’Œè·¯ç”±è§„åˆ™ç­‰ Istio åŠŸèƒ½åº”ç”¨äºè¿›å…¥é›†ç¾¤çš„æµé‡ã€‚")]),t._v(" "),s("p",[t._v("æ­¤ä»»åŠ¡æè¿°äº†å¦‚ä½•é…ç½® Istio ä»¥ä½¿ç”¨ Istio åœ¨æœåŠ¡ç½‘æ ¼ä¹‹å¤–å…¬å¼€æœåŠ¡"),s("code",[t._v("Gateway")]),t._v("ã€‚")]),t._v(" "),s("h4",{attrs:{id:"ç¯å¢ƒå‡†å¤‡-6"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç¯å¢ƒå‡†å¤‡-6"}},[t._v("#")]),t._v(" ç¯å¢ƒå‡†å¤‡")]),t._v(" "),s("ul",[s("li",[t._v("ç¡®ä¿æ‚¨çš„å½“å‰ç›®å½•æ˜¯è¯¥"),s("code",[t._v("istio")]),t._v("ç›®å½•ã€‚")]),t._v(" "),s("li",[t._v("å¯åŠ¨"),s("a",{attrs:{href:"https://github.com/istio/istio/tree/release-1.13/samples/httpbin",target:"_blank",rel:"noopener noreferrer"}},[t._v("httpbin"),s("OutboundLink")],1),t._v("ç¤ºä¾‹ã€‚")])]),t._v(" "),s("p",[t._v("â€‹\t\tå¦‚æœæ‚¨å¯ç”¨äº†"),s("a",{attrs:{href:"https://istio.io/latest/docs/setup/additional-setup/sidecar-injection/#automatic-sidecar-injection",target:"_blank",rel:"noopener noreferrer"}},[t._v("è‡ªåŠ¨è¾¹è½¦æ³¨å…¥"),s("OutboundLink")],1),t._v("ï¼Œè¯·éƒ¨ç½²è¯¥"),s("code",[t._v("httpbin")]),t._v("æœåŠ¡ï¼š")]),t._v(" "),s("p",[t._v("â€‹\t\tå¦åˆ™ï¼Œæ‚¨å¿…é¡»åœ¨éƒ¨ç½²åº”ç”¨ç¨‹åºä¹‹å‰æ‰‹åŠ¨æ³¨å…¥ sidecar "),s("code",[t._v("httpbin")]),t._v("ï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" samples/httpbin/httpbin.yaml\n$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("istioctl kube-inject "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" samples/httpbin/httpbin.yaml"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h4",{attrs:{id:"ç¡®å®šå…¥å£ipå’Œç«¯å£"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç¡®å®šå…¥å£ipå’Œç«¯å£"}},[t._v("#")]),t._v(" ç¡®å®šå…¥å£IPå’Œç«¯å£")]),t._v(" "),s("p",[t._v("æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥ç¡®å®šæ‚¨çš„ Kubernetes é›†ç¾¤æ˜¯å¦åœ¨æ”¯æŒå¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨çš„ç¯å¢ƒä¸­è¿è¡Œï¼ˆ"),s("code",[t._v("è¿™é‡Œæ²¡æœ‰è´Ÿè½½å‡è¡¡å™¨æ”¹ä¸ºNodePortæ¨¡å¼")]),t._v("ï¼‰ï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get svc -n istio-system istio-ingressgateway")]),t._v("\nNAME                   TYPE       CLUSTER-IP     EXTERNAL-IP   PORT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("S"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("                                                                    AGE\nistio-ingressgateway   NodePort   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.96")]),t._v(".88.217   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15021")]),t._v(":28214/TCP,80:27007/TCP,443:9673/TCP,31400:3938/TCP,15443:41053/TCP   4d2h\n")])])]),s("p",[t._v("å¦‚æœ"),s("code",[t._v("EXTERNAL-IP")]),t._v("è®¾ç½®äº†è¯¥å€¼ï¼Œåˆ™æ‚¨çš„ç¯å¢ƒå…·æœ‰å¯ç”¨äºå…¥å£ç½‘å…³çš„å¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨ã€‚å¦‚æœ"),s("code",[t._v("EXTERNAL-IP")]),t._v("å€¼ä¸º"),s("code",[t._v("<none>")]),t._v("æˆ–æ°¸ä¹…"),s("code",[t._v("<pending>")]),t._v("ï¼Œåˆ™æ‚¨çš„ç¯å¢ƒä¸ä¸ºå…¥å£ç½‘å…³æä¾›å¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨ã€‚"),s("a",{attrs:{href:"https://kubernetes.io/docs/concepts/services-networking/service/#nodeport",target:"_blank",rel:"noopener noreferrer"}},[t._v("åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æœåŠ¡çš„èŠ‚ç‚¹ç«¯å£"),s("OutboundLink")],1),t._v("è®¿é—®ç½‘å…³ã€‚")]),t._v(" "),s("h4",{attrs:{id:"æ·»åŠ ç¯å¢ƒè¯´æ˜"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ·»åŠ ç¯å¢ƒè¯´æ˜"}},[t._v("#")]),t._v(" æ·»åŠ ç¯å¢ƒè¯´æ˜")]),t._v(" "),s("p",[t._v("å¦‚æœæ‚¨ç¡®å®šæ‚¨çš„ç¯å¢ƒæ²¡æœ‰å¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨ï¼Œè¯·æŒ‰ç…§è¿™äº›è¯´æ˜è¿›è¡Œæ“ä½œï¼Œå› æ­¤æ‚¨éœ€è¦æ”¹ç”¨èŠ‚ç‚¹ç«¯å£ã€‚")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("INGRESS_PORT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("kubectl "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" istio-system get "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" istio-ingressgateway "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("jsonpath")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{.spec.ports[?(@.name==\"http2\")].nodePort}'")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("SECURE_INGRESS_PORT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("kubectl "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" istio-system get "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" istio-ingressgateway "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("jsonpath")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{.spec.ports[?(@.name==\"https\")].nodePort}'")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("TCP_INGRESS_PORT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("kubectl "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" istio-system get "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" istio-ingressgateway "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("jsonpath")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{.spec.ports[?(@.name==\"tcp\")].nodePort}'")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n")])])]),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202205062328622.png",alt:"image-20220318172145022"}})]),t._v(" "),s("h4",{attrs:{id:"ä½¿ç”¨istioç½‘å…³é…ç½®å…¥å£"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä½¿ç”¨istioç½‘å…³é…ç½®å…¥å£"}},[t._v("#")]),t._v(" ä½¿ç”¨Istioç½‘å…³é…ç½®å…¥å£")]),t._v(" "),s("p",[t._v("å…¥å£"),s("a",{attrs:{href:"https://istio.io/latest/docs/reference/config/networking/gateway/",target:"_blank",rel:"noopener noreferrer"}},[t._v("ç½‘å…³"),s("OutboundLink")],1),t._v("æè¿°äº†åœ¨ç½‘æ ¼è¾¹ç¼˜è¿è¡Œçš„è´Ÿè½½å‡è¡¡å™¨ï¼Œç”¨äºæ¥æ”¶ä¼ å…¥çš„ HTTP/TCP è¿æ¥ã€‚å®ƒé…ç½®æš´éœ²çš„ç«¯å£ã€åè®®ç­‰ï¼Œä½†ä¸"),s("a",{attrs:{href:"https://kubernetes.io/docs/concepts/services-networking/ingress/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Kubernetes Ingress Resources"),s("OutboundLink")],1),t._v("ä¸åŒï¼Œå®ƒä¸åŒ…æ‹¬ä»»ä½•æµé‡è·¯ç”±é…ç½®ã€‚å…¥å£æµé‡çš„æµé‡è·¯ç”±æ˜¯ä½¿ç”¨ Istio è·¯ç”±è§„åˆ™é…ç½®çš„ï¼Œä¸å†…éƒ¨æœåŠ¡è¯·æ±‚çš„æ–¹å¼å®Œå…¨ç›¸åŒã€‚")]),t._v(" "),s("p",[t._v("è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•"),s("code",[t._v("Gateway")]),t._v("ä¸º HTTP æµé‡é…ç½®ç«¯å£ 80ã€‚")]),t._v(" "),s("ol",[s("li",[t._v("åˆ›å»ºä¸€ä¸ª Istio "),s("code",[t._v("Gateway")]),t._v("ï¼š\n"),s("ul",[s("li",[s("code",[t._v("ä½¿ç”¨é»˜è®¤çš„ingressgatewayç½‘å…³")])]),t._v(" "),s("li",[s("code",[t._v("åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨è§„èŒƒåˆ—è¡¨ï¼Œåˆ†åˆ«æ˜¯ä¸»æœºå’Œç«¯å£")])]),t._v(" "),s("li",[s("code",[t._v("é…ç½®httpæœåŠ¡çš„80ç«¯å£ä»¥åŠä¸»æœºhttpbin.example.com")])])])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("kubectl apply "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" <<EOF\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Gateway\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" httpbin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("gateway\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("istio")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ingressgateway "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# use Istio default gateway implementation")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("servers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("number")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" HTTP\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"httpbin.example.com"')]),t._v("\nEOF\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[t._v("ä¸ºé€šè¿‡ä»¥ä¸‹æ–¹å¼è¿›å…¥çš„æµé‡é…ç½®è·¯ç”±"),s("code",[t._v("Gateway")]),t._v("ï¼š\n"),s("ul",[s("li",[s("code",[t._v("é…ç½®è™šæ‹ŸæœåŠ¡å…è®¸ä¸»æœºhttpbin.example.com")])]),t._v(" "),s("li",[s("code",[t._v("é…è¿½httpçš„è§„åˆ™ä¸ºä¸¤ä¸ªuriçš„ä¸¤ä¸ªå…è®¸è·¯å¾„ã€åˆ†åˆ«æ˜¯statuså’Œdelay")])]),t._v(" "),s("li",[s("code",[t._v("é…ç½®ç›®çš„åœ°è§„åˆ™ä¸ºä¸»æœºæ˜¯httpbinç«¯å£ä¸º8080çš„")])]),t._v(" "),s("li",[s("code",[t._v("ç½‘å…³åˆ—è¡¨æŒ‡å®šåªå…è®¸é€šè¿‡æ‚¨çš„è¯·æ±‚httpbin-gatewayã€‚æ‰€æœ‰å…¶ä»–å¤–éƒ¨è¯·æ±‚éƒ½å°†è¢« 404 å“åº”æ‹’ç»ã€‚")])])])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" <<EOF\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" VirtualService\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" httpbin\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"httpbin.example.com"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gateways")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" httpbin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("gateway\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("match")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("prefix")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /status\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("prefix")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /delay\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("number")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8000")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" httpbin\nEOF\n")])])]),s("blockquote",[s("p",[t._v("æ³¨æ„ï¼š")]),t._v(" "),s("p",[t._v("ç½‘æ ¼ä¸­å…¶ä»–æœåŠ¡çš„å†…éƒ¨è¯·æ±‚ä¸å—è¿™äº›è§„åˆ™çš„çº¦æŸï¼Œè€Œæ˜¯é»˜è®¤ä½¿ç”¨å¾ªç¯è·¯ç”±ã€‚è¦å°†è¿™äº›è§„åˆ™ä¹Ÿåº”ç”¨äºå†…éƒ¨è°ƒç”¨ï¼Œæ‚¨å¯ä»¥å°†ç‰¹æ®Šå€¼æ·»åŠ "),s("code",[t._v("mesh")]),t._v("åˆ°"),s("code",[t._v("gateways")]),t._v(". ç”±äºæœåŠ¡çš„å†…éƒ¨ä¸»æœºåå¯èƒ½ä¸å¤–éƒ¨ä¸»æœºåä¸åŒï¼ˆä¾‹å¦‚ï¼Œ"),s("code",[t._v("httpbin.default.svc.cluster.local")]),t._v("ï¼‰ï¼Œå› æ­¤æ‚¨è¿˜éœ€è¦å°†å…¶æ·»åŠ åˆ°"),s("code",[t._v("hosts")]),t._v("åˆ—è¡¨ä¸­ã€‚")])]),t._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[s("em",[t._v("ä½¿ç”¨curl")]),t._v("è®¿é—®"),s("em",[t._v("httpbin")]),t._v("æœåŠ¡ï¼š")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# curl -s -I -HHost:httpbin.example.com "http://$INGRESS_HOST:$INGRESS_PORT/status/200"')]),t._v("\nHTTP/1.1 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" OK\nserver: istio-envoy\ndate: Sun, "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" Mar "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":05:09 GMT\ncontent-type: text/html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("charset")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf-8\naccess-control-allow-origin: *\naccess-control-allow-credentials: "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\ncontent-length: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\nx-envoy-upstream-service-time: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),t._v("\n")])])]),s("p",[t._v("è¯·æ³¨æ„ï¼Œæ‚¨ä½¿ç”¨è¯¥"),s("code",[t._v("-H")]),t._v("æ ‡å¿—å°†"),s("em",[t._v("Host")]),t._v(" HTTP æ ‡å¤´è®¾ç½®ä¸ºâ€œhttpbin.example.comâ€ã€‚è¿™æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºæ‚¨çš„å…¥å£"),s("code",[t._v("Gateway")]),t._v("é…ç½®ä¸ºå¤„ç†â€œhttpbin.example.comâ€ï¼Œä½†åœ¨æ‚¨çš„æµ‹è¯•ç¯å¢ƒä¸­ï¼Œæ‚¨æ²¡æœ‰è¯¥ä¸»æœºçš„ DNS ç»‘å®šï¼Œåªæ˜¯å°†æ‚¨çš„è¯·æ±‚å‘é€åˆ°å…¥å£ IPã€‚")]),t._v(" "),s("ol",{attrs:{start:"4"}},[s("li",[t._v("è®¿é—®å°šæœªæ˜ç¡®å…¬å¼€çš„ä»»ä½•å…¶ä»– URLã€‚æ‚¨åº”è¯¥ä¼šçœ‹åˆ° HTTP 404 é”™è¯¯ï¼š")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# curl -s -I -HHost:httpbin.example.com "http://$INGRESS_HOST:$INGRESS_PORT/headers"')]),t._v("\nHTTP/1.1 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("404")]),t._v(" Not Found\ndate: Sun, "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" Mar "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":29:26 GMT\nserver: istio-envoy\ntransfer-encoding: chunked\n")])])]),s("h4",{attrs:{id:"ä½¿ç”¨æµè§ˆå™¨è®¿é—®å…¥å£æœåŠ¡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä½¿ç”¨æµè§ˆå™¨è®¿é—®å…¥å£æœåŠ¡"}},[t._v("#")]),t._v(" ä½¿ç”¨æµè§ˆå™¨è®¿é—®å…¥å£æœåŠ¡")]),t._v(" "),s("p",[t._v("åœ¨æµè§ˆå™¨ä¸­è¾“å…¥"),s("code",[t._v("httpbin")]),t._v("æœåŠ¡ URL å°†ä¸èµ·ä½œç”¨ï¼Œå› ä¸ºæ‚¨æ— æ³•å°†"),s("em",[t._v("Host")]),t._v("æ ‡å¤´ä¼ é€’ç»™æµè§ˆå™¨ï¼Œå°±åƒä½¿ç”¨"),s("code",[t._v("curl")]),t._v(". åœ¨ç°å®ä¸–ç•Œçš„æƒ…å†µä¸‹ï¼Œè¿™ä¸æ˜¯é—®é¢˜ï¼Œå› ä¸ºæ‚¨æ­£ç¡®é…ç½®äº†è¯·æ±‚çš„ä¸»æœºå¹¶ä¸” DNS å¯è§£æã€‚å› æ­¤ï¼Œæ‚¨åœ¨ URL ä¸­ä½¿ç”¨ä¸»æœºçš„åŸŸåï¼Œä¾‹å¦‚"),s("code",[t._v("https://httpbin.example.com/status/200")]),t._v(".")]),t._v(" "),s("p",[t._v("è¦ä¸ºç®€å•çš„æµ‹è¯•å’Œæ¼”ç¤ºè§£å†³æ­¤é—®é¢˜ï¼Œè¯·åœ¨ å’Œé…ç½®"),s("code",[t._v("*")]),t._v("ä¸­ä¸ºä¸»æœºä½¿ç”¨é€šé…ç¬¦å€¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨å°†å…¥å£é…ç½®æ›´æ”¹ä¸ºä»¥ä¸‹å†…å®¹ï¼š"),s("code",[t._v("Gateway VirtualService")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("kubectl apply "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" <<EOF\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Gateway\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" httpbin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("gateway\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("istio")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ingressgateway "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# use Istio default gateway implementation")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("servers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("number")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" HTTP\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" VirtualService\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" httpbin\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gateways")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" httpbin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("gateway\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("match")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("prefix")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /headers\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("number")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8000")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" httpbin\nEOF\n")])])]),s("p",[t._v("åœ¨æœ¬æœºçš„hosts"),s("code",[t._v("é…ç½®192.168.1.6:44526/headers httpbin.example.com")]),t._v("æ˜ å°„ï¼Œç„¶åé€šè¿‡æµè§ˆå™¨è®¿é—®ã€‚")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202205062328976.png",alt:"image-20220320230630481"}})]),t._v(" "),s("h4",{attrs:{id:"æ¸…ç†-8"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ¸…ç†-8"}},[t._v("#")]),t._v(" æ¸…ç†")]),t._v(" "),s("p",[t._v("åˆ é™¤"),s("code",[t._v("Gateway")]),t._v("and"),s("code",[t._v("VirtualService")]),t._v("é…ç½®ï¼Œå…³é—­"),s("a",{attrs:{href:"https://github.com/istio/istio/tree/release-1.13/samples/httpbin",target:"_blank",rel:"noopener noreferrer"}},[t._v("httpbin"),s("OutboundLink")],1),t._v("æœåŠ¡ï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl delete gateway httpbin-gateway\n$ kubectl delete virtualservice httpbin\n$ kubectl delete --ignore-not-found"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" samples/httpbin/httpbin.yaml\n")])])]),s("h2",{attrs:{id:"å®‰å…¨ç½‘å…³"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å®‰å…¨ç½‘å…³"}},[t._v("#")]),t._v(" å®‰å…¨ç½‘å…³")]),t._v(" "),s("h4",{attrs:{id:"å®‰å…¨ç½‘å…³çš„ä½œç”¨"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å®‰å…¨ç½‘å…³çš„ä½œç”¨"}},[t._v("#")]),t._v(" å®‰å…¨ç½‘å…³çš„ä½œç”¨")]),t._v(" "),s("p",[t._v("æ§åˆ¶å…¥å£"),s("a",{attrs:{href:"https://istio.io/latest/docs/tasks/traffic-management/ingress/ingress-control",target:"_blank",rel:"noopener noreferrer"}},[t._v("æµé‡ä»»åŠ¡"),s("OutboundLink")],1),t._v(" æè¿°äº†å¦‚ä½•é…ç½®å…¥å£ç½‘å…³ä»¥å°† HTTP æœåŠ¡å…¬å¼€ç»™å¤–éƒ¨æµé‡ã€‚æ­¤ä»»åŠ¡æ˜¾ç¤ºå¦‚ä½•ä½¿ç”¨ç®€å•æˆ–åŒå‘ TLS å…¬å¼€å®‰å…¨çš„ HTTPS æœåŠ¡ã€‚")]),t._v(" "),s("h4",{attrs:{id:"ç¯å¢ƒå‡†å¤‡-7"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç¯å¢ƒå‡†å¤‡-7"}},[t._v("#")]),t._v(" ç¯å¢ƒå‡†å¤‡")]),t._v(" "),s("ul",[s("li",[t._v("ç¡®ä¿æ‚¨çš„å½“å‰ç›®å½•æ˜¯è¯¥"),s("code",[t._v("istio")]),t._v("ç›®å½•ã€‚")]),t._v(" "),s("li",[t._v("å¯åŠ¨"),s("a",{attrs:{href:"https://github.com/istio/istio/tree/release-1.13/samples/httpbin",target:"_blank",rel:"noopener noreferrer"}},[t._v("httpbin"),s("OutboundLink")],1),t._v("ç¤ºä¾‹ã€‚")])]),t._v(" "),s("p",[t._v("â€‹\t\tå¦‚æœæ‚¨å¯ç”¨äº†"),s("a",{attrs:{href:"https://istio.io/latest/docs/setup/additional-setup/sidecar-injection/#automatic-sidecar-injection",target:"_blank",rel:"noopener noreferrer"}},[t._v("è‡ªåŠ¨è¾¹è½¦æ³¨å…¥"),s("OutboundLink")],1),t._v("ï¼Œè¯·éƒ¨ç½²è¯¥"),s("code",[t._v("httpbin")]),t._v("æœåŠ¡ï¼š")]),t._v(" "),s("p",[t._v("â€‹\t\tå¦åˆ™ï¼Œæ‚¨å¿…é¡»åœ¨éƒ¨ç½²åº”ç”¨ç¨‹åºä¹‹å‰æ‰‹åŠ¨æ³¨å…¥ sidecar "),s("code",[t._v("httpbin")]),t._v("ï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" samples/httpbin/httpbin.yaml\n$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("istioctl kube-inject "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" samples/httpbin/httpbin.yaml"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h4",{attrs:{id:"ç”Ÿæˆè¯ä¹¦å’Œå¯†é’¥"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç”Ÿæˆè¯ä¹¦å’Œå¯†é’¥"}},[t._v("#")]),t._v(" ç”Ÿæˆè¯ä¹¦å’Œå¯†é’¥")]),t._v(" "),s("p",[t._v("å¯¹äºæ­¤ä»»åŠ¡ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ‚¨å–œæ¬¢çš„å·¥å…·æ¥ç”Ÿæˆè¯ä¹¦å’Œå¯†é’¥ã€‚ä¸‹é¢çš„å‘½ä»¤ä½¿ç”¨ "),s("a",{attrs:{href:"https://man.openbsd.org/openssl.1",target:"_blank",rel:"noopener noreferrer"}},[t._v("openssl"),s("OutboundLink")],1)]),t._v(" "),s("ol",[s("li",[t._v("åˆ›å»ºæ ¹è¯ä¹¦å’Œç§é’¥æ¥ä¸ºæ‚¨çš„æœåŠ¡ç­¾ç½²è¯ä¹¦ï¼š")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ openssl req "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-x509")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-sha256")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-nodes")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-days")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("365")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-newkey")]),t._v(" rsa:2048 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-subj")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/O=example Inc./CN=example.com'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-keyout")]),t._v(" example.com.key "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-out")]),t._v(" example.com.crt\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[t._v("åˆ›å»ºè¯ä¹¦å’Œç§é’¥"),s("code",[t._v("httpbin.example.com")]),t._v("ï¼š")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ openssl req "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-out")]),t._v(" httpbin.example.com.csr "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-newkey")]),t._v(" rsa:2048 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-nodes")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-keyout")]),t._v(" httpbin.example.com.key "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-subj")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/CN=httpbin.example.com/O=httpbin organization"')]),t._v("\n$ openssl x509 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-req")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-sha256")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-days")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("365")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-CA")]),t._v(" example.com.crt "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-CAkey")]),t._v(" example.com.key "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-set_serial")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-in")]),t._v(" httpbin.example.com.csr "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-out")]),t._v(" httpbin.example.com.crt\n")])])]),s("h4",{attrs:{id:"ä¸ºå•ä¸ªä¸»æœºé…ç½®tlså…¥å£ç½‘å…³"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä¸ºå•ä¸ªä¸»æœºé…ç½®tlså…¥å£ç½‘å…³"}},[t._v("#")]),t._v(" ä¸ºå•ä¸ªä¸»æœºé…ç½®TLSå…¥å£ç½‘å…³")]),t._v(" "),s("ol",[s("li",[t._v("ä¸ºå…¥å£ç½‘å…³åˆ›å»ºä¸€ä¸ªå¯†é’¥ï¼š")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl create "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" istio-system secret tls httpbin-credential "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--key")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("httpbin.example.com.key "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--cert")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("httpbin.example.com.crt\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[t._v("ä½¿ç”¨ç«¯å£ 443çš„éƒ¨åˆ†å®šä¹‰ç½‘å…³"),s("code",[t._v("servers:")]),t._v("ï¼Œå¹¶æŒ‡å®š "),s("code",[t._v("credentialName")]),t._v("to beçš„å€¼"),s("code",[t._v("httpbin-credential")]),t._v("ã€‚è¿™äº›å€¼ä¸å¯†é’¥çš„åç§°ç›¸åŒã€‚TLS æ¨¡å¼çš„å€¼åº”ä¸º"),s("code",[t._v("SIMPLE")]),t._v(".")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("$ cat <<EOF "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" kubectl apply "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Gateway\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mygateway\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("istio")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ingressgateway "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# use istio default ingress gateway")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("servers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("number")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" HTTPS\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tls")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" SIMPLE\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("credentialName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" httpbin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("credential "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# must be the same as secret")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" httpbin.example.com\nEOF\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[t._v("é…ç½®ç½‘å…³çš„å…¥å£æµé‡è·¯ç”±ã€‚å®šä¹‰ç›¸åº”çš„è™šæ‹ŸæœåŠ¡ã€‚")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("$ cat <<EOF "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" kubectl apply "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" VirtualService\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" httpbin\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"httpbin.example.com"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gateways")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" mygateway\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("match")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("prefix")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /status\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("prefix")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /delay\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("number")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8000")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" httpbin\nEOF\n")])])]),s("ol",{attrs:{start:"4"}},[s("li",[t._v("å‘é€ HTTPS è¯·æ±‚ä»¥"),s("code",[t._v("httpbin")]),t._v("é€šè¿‡ HTTPS è®¿é—®æœåŠ¡ï¼Œè¯¥"),s("code",[t._v("httpbin")]),t._v("æœåŠ¡å°†è¿”å› "),s("a",{attrs:{href:"https://tools.ietf.org/html/rfc7168#section-2.3.3",target:"_blank",rel:"noopener noreferrer"}},[t._v("418 I'm a Teapot"),s("OutboundLink")],1),t._v("ä»£ç ã€‚")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-HHost:httpbin.example.com")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--resolve")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"httpbin.example.com:'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SECURE_INGRESS_PORT")]),t._v(":"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$INGRESS_HOST")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--cacert")]),t._v(" example.com.crt "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://httpbin.example.com:'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SECURE_INGRESS_PORT")]),t._v('/status/418"')]),t._v("\n* Added httpbin.example.com:7339:192.168.1.6 to DNS cache\n* About to connect"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" to httpbin.example.com port "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7339")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#0)")]),t._v("\n*   Trying "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.6"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n* Connected to httpbin.example.com "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.6"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" port "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7339")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#0)")]),t._v("\n* Initializing NSS with certpath: sql:/etc/pki/nssdb\n*   CAfile: example.com.crt\n  CApath: none\n* SSL connection using TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256\n* Server certificate:\n*       subject: "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("O")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("httpbin organization,CN"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("httpbin.example.com\n*       start date: Mar "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":18:42 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v(" GMT\n*       expire date: Mar "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":18:42 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2023")]),t._v(" GMT\n*       common name: httpbin.example.com\n*       issuer: "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("CN")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("example.com,O"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("example Inc.\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" GET /status/418 HTTP/1.1\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" User-Agent: curl/7.29.0\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" Accept: */*\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" Host:httpbin.example.com\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" HTTP/1.1 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("418")]),t._v(" Unknown\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" server: istio-envoy\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" date: Sun, "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" Mar "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":41:25 GMT\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" x-more-info: http://tools.ietf.org/html/rfc2324\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" access-control-allow-origin: *\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" access-control-allow-credentials: "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" content-length: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("135")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" x-envoy-upstream-service-time: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("\n\n    -"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" teapot "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("-\n\n       _"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("_\n     .'  _ _ "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(' ."'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v(" ^ "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v('". _,\n    '),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("_"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"---"')]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("//\n      "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("       "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("/\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("_     _/\n        "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v('"`\n* Connection '),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#0 to host httpbin.example.com left intact")]),t._v("\n")])])]),s("ol",{attrs:{start:"5"}},[s("li",[t._v("åˆ é™¤ç½‘å…³çš„å¯†ç å¹¶åˆ›å»ºä¸€ä¸ªæ–°å¯†ç ä»¥æ›´æ”¹å…¥å£ç½‘å…³çš„å‡­æ®ã€‚")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" istio-system delete secret httpbin-credential\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" new_certificates\n$ openssl req "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-x509")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-sha256")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-nodes")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-days")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("365")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-newkey")]),t._v(" rsa:2048 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-subj")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/O=example Inc./CN=example.com'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-keyout")]),t._v(" new_certificates/example.com.key "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-out")]),t._v(" new_certificates/example.com.crt\n$ openssl req "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-out")]),t._v(" new_certificates/httpbin.example.com.csr "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-newkey")]),t._v(" rsa:2048 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-nodes")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-keyout")]),t._v(" new_certificates/httpbin.example.com.key "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-subj")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/CN=httpbin.example.com/O=httpbin organization"')]),t._v("\n$ openssl x509 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-req")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-sha256")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-days")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("365")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-CA")]),t._v(" new_certificates/example.com.crt "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-CAkey")]),t._v(" new_certificates/example.com.key "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-set_serial")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-in")]),t._v(" new_certificates/httpbin.example.com.csr "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-out")]),t._v(" new_certificates/httpbin.example.com.crt\n$ kubectl create "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" istio-system secret tls httpbin-credential "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--key")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("new_certificates/httpbin.example.com.key "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--cert")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("new_certificates/httpbin.example.com.crt\n")])])]),s("ol",{attrs:{start:"6"}},[s("li",[t._v("ä½¿ç”¨æ–°çš„è¯ä¹¦é“¾è®¿é—®"),s("code",[t._v("httpbin")]),t._v("æœåŠ¡ï¼š"),s("code",[t._v("curl")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-HHost:httpbin.example.com")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--resolve")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"httpbin.example.com:'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SECURE_INGRESS_PORT")]),t._v(":"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$INGRESS_HOST")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--cacert")]),t._v(" new_certificates/example.com.crt "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://httpbin.example.com:'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SECURE_INGRESS_PORT")]),t._v('/status/418"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nHTTP/2 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("418")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n    -"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" teapot "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("-\n\n       _"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("_\n     .'  _ _ "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(' ."'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v(" ^ "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v('". _,\n    '),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("_"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"---"')]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("//\n      "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("       "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("/\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("_     _/\n        "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v('"`\n        \n')])])]),s("ol",{attrs:{start:"7"}},[s("li",[t._v("å¦‚æœæ‚¨å°è¯•ä½¿ç”¨"),s("code",[t._v("httpbin")]),t._v("ä»¥å‰çš„è¯ä¹¦é“¾è¿›è¡Œè®¿é—®ï¼Œåˆ™ç°åœ¨å°è¯•å¤±è´¥ã€‚")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-HHost:httpbin.example.com")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--resolve")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"httpbin.example.com:'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SECURE_INGRESS_PORT")]),t._v(":"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$INGRESS_HOST")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--cacert")]),t._v(" example.com.crt "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://httpbin.example.com:'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SECURE_INGRESS_PORT")]),t._v('/status/418"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n* TLSv1.2 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("OUT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(", TLS handshake, Client hello "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(":\n* TLSv1.2 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("IN"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(", TLS handshake, Server hello "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(":\n* TLSv1.2 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("IN"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(", TLS handshake, Certificate "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(":\n* TLSv1.2 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("OUT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(", TLS alert, Server hello "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(":\n* curl: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("35")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" error:04FFF06A:rsa routines:CRYPTO_internal:block "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("type")]),t._v(" is not 01\n")])])]),s("h4",{attrs:{id:"ä¸ºå¤šä¸ªä¸»æœºé…ç½®tlså…¥å£ç½‘å…³"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä¸ºå¤šä¸ªä¸»æœºé…ç½®tlså…¥å£ç½‘å…³"}},[t._v("#")]),t._v(" ä¸ºå¤šä¸ªä¸»æœºé…ç½®TLSå…¥å£ç½‘å…³")]),t._v(" "),s("p",[t._v("æ‚¨å¯ä»¥ä¸ºå¤šä¸ªä¸»æœºé…ç½®ä¸€ä¸ªå…¥å£ç½‘å…³ "),s("code",[t._v("httpbin.example.com")]),t._v("ï¼Œ"),s("code",[t._v("helloworld-v1.example.com")]),t._v("ä¾‹å¦‚ã€‚å…¥å£ç½‘å…³æ£€ç´¢ä¸ç‰¹å®š"),s("code",[t._v("credentialName")]),t._v(".")]),t._v(" "),s("ol",[s("li",[t._v("è¦æ¢å¤ çš„å‡­æ®"),s("code",[t._v("httpbin")]),t._v("ï¼Œè¯·åˆ é™¤å…¶å¯†é’¥å¹¶é‡æ–°åˆ›å»ºã€‚")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" istio-system delete secret httpbin-credential\n$ kubectl create "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" istio-system secret tls httpbin-credential "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--key")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("httpbin.example.com.key "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--cert")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("httpbin.example.com.crt\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[t._v("å¯åŠ¨"),s("code",[t._v("helloworld-v1")]),t._v("ç¤ºä¾‹")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("$ cat <<EOF "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" kubectl apply "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Service\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" helloworld"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v1\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" helloworld"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5000")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" helloworld"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v1\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apps/v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deployment\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" helloworld"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" helloworld"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v1\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" helloworld"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v1\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" helloworld\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" istio/examples"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("helloworld"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v1\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("requests")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cpu")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"100m"')]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("imagePullPolicy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" IfNotPresent "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#Always")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5000")]),t._v("\nEOF\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[t._v("ç”Ÿæˆè¯ä¹¦å’Œç§é’¥"),s("code",[t._v("helloworld-v1.example.com")]),t._v("ï¼š")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ openssl req "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-out")]),t._v(" helloworld-v1.example.com.csr "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-newkey")]),t._v(" rsa:2048 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-nodes")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-keyout")]),t._v(" helloworld-v1.example.com.key "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-subj")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/CN=helloworld-v1.example.com/O=helloworld organization"')]),t._v("\n$ openssl x509 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-req")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-sha256")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-days")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("365")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-CA")]),t._v(" example.com.crt "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-CAkey")]),t._v(" example.com.key "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-set_serial")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-in")]),t._v(" helloworld-v1.example.com.csr "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-out")]),t._v(" helloworld-v1.example.com.crt\n")])])]),s("ol",{attrs:{start:"4"}},[s("li",[t._v("åˆ›å»º"),s("code",[t._v("helloworld-credential")]),t._v("å¯†é’¥ï¼š")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl create "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" istio-system secret tls helloworld-credential "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--key")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("helloworld-v1.example.com.key "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--cert")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("helloworld-v1.example.com.crt\n")])])]),s("ol",{attrs:{start:"5"}},[s("li",[t._v("ä¸ºç«¯å£ 443 å®šä¹‰ä¸€ä¸ªå…·æœ‰ä¸¤ä¸ªæœåŠ¡å™¨éƒ¨åˆ†çš„ç½‘å…³ã€‚å°† "),s("code",[t._v("credentialName")]),t._v("æ¯ä¸ªç«¯å£ä¸Šçš„å€¼åˆ†åˆ«è®¾ç½®ä¸º"),s("code",[t._v("httpbin-credential")]),t._v("å’Œ"),s("code",[t._v("helloworld-credential")]),t._v(" ã€‚\n"),s("ul",[s("li",[t._v("å°† TLS æ¨¡å¼è®¾ç½®ä¸º"),s("code",[t._v("SIMPLE")]),t._v("æ˜¯å•å‘TLSå…¥å£ç½‘å…³.")]),t._v(" "),s("li",[t._v("å°† TLS æ¨¡å¼è®¾ç½®ä¸º"),s("code",[t._v("MUTUAL")]),t._v("æ˜¯åŒå‘TLSå…¥å£ç½‘å…³")])])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("$ cat <<EOF "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" kubectl apply "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Gateway\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mygateway\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("istio")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ingressgateway "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# use istio default ingress gateway")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("servers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("number")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("httpbin\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" HTTPS\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tls")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" SIMPLE\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("credentialName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" httpbin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("credential\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" httpbin.example.com\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("number")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("helloworld\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" HTTPS\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tls")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" SIMPLE\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("credentialName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" helloworld"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("credential\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" helloworld"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v1.example.com\nEOF\n")])])]),s("ol",{attrs:{start:"6"}},[s("li",[t._v("é…ç½®ç½‘å…³çš„æµé‡è·¯ç”±ã€‚å®šä¹‰ç›¸åº”çš„è™šæ‹ŸæœåŠ¡ã€‚")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("$ cat <<EOF "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" kubectl apply "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" VirtualService\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" helloworld"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" helloworld"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v1.example.com\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gateways")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" mygateway\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("match")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("exact")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /hello\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" helloworld"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v1\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("number")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5000")]),t._v("\nEOF\n")])])]),s("ol",{attrs:{start:"7"}},[s("li",[t._v("å‘é€ HTTPS è¯·æ±‚åˆ°"),s("code",[t._v("helloworld-v1.example.com")]),t._v("ï¼š")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-HHost:httpbin.example.com")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--resolve")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"httpbin.example.com:'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SECURE_INGRESS_PORT")]),t._v(":"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$INGRESS_HOST")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--cacert")]),t._v(" example.com.crt "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://httpbin.example.com:'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SECURE_INGRESS_PORT")]),t._v('/status/418"')]),t._v("\n* Added httpbin.example.com:7339:192.168.1.6 to DNS cache\n* About to connect"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" to httpbin.example.com port "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7339")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#0)")]),t._v("\n*   Trying "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.6"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n* Connected to httpbin.example.com "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.6"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" port "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7339")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#0)")]),t._v("\n* Initializing NSS with certpath: sql:/etc/pki/nssdb\n*   CAfile: example.com.crt\n  CApath: none\n* SSL connection using TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256\n* Server certificate:\n*       subject: "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("O")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("httpbin organization,CN"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("httpbin.example.com\n*       start date: Mar "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":18:42 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v(" GMT\n*       expire date: Mar "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":18:42 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2023")]),t._v(" GMT\n*       common name: httpbin.example.com\n*       issuer: "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("CN")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("example.com,O"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("example Inc.\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" GET /status/418 HTTP/1.1\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" User-Agent: curl/7.29.0\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" Accept: */*\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" Host:httpbin.example.com\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" HTTP/1.1 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("418")]),t._v(" Unknown\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" server: istio-envoy\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" date: Mon, "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v(" Mar "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v(" 00:58:24 GMT\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" x-more-info: http://tools.ietf.org/html/rfc2324\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" access-control-allow-origin: *\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" access-control-allow-credentials: "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" content-length: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("135")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" x-envoy-upstream-service-time: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("\n\n    -"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" teapot "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("-\n\n       _"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("_\n     .'  _ _ "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(' ."'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v(" ^ "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v('". _,\n    '),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("_"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"---"')]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("//\n      "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("       "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("/\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("_     _/\n        "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v('"`\n* Connection '),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#0 to host httpbin.example.com left intact")]),t._v("\n")])])]),s("ol",{attrs:{start:"8"}},[s("li",[t._v("å‘é€ä¸€ä¸ª HTTPS è¯·æ±‚"),s("code",[t._v("httpbin.example.com")]),t._v("å¹¶ä»ç„¶å¾—åˆ°ä¸€ä¸ªèŒ¶å£¶ä½œä¸ºå›æŠ¥ï¼š")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-HHost:httpbin.example.com")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--resolve")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"httpbin.example.com:'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SECURE_INGRESS_PORT")]),t._v(":"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$INGRESS_HOST")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--cacert")]),t._v(" example.com.crt "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://httpbin.example.com:'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SECURE_INGRESS_PORT")]),t._v('/status/418"')]),t._v("\n* Added httpbin.example.com:7339:192.168.1.6 to DNS cache\n* About to connect"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" to httpbin.example.com port "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7339")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#0)")]),t._v("\n*   Trying "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.6"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n* Connected to httpbin.example.com "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.6"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" port "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7339")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#0)")]),t._v("\n* Initializing NSS with certpath: sql:/etc/pki/nssdb\n*   CAfile: example.com.crt\n  CApath: none\n* SSL connection using TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256\n* Server certificate:\n*       subject: "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("O")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("httpbin organization,CN"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("httpbin.example.com\n*       start date: Mar "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":18:42 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v(" GMT\n*       expire date: Mar "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":18:42 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2023")]),t._v(" GMT\n*       common name: httpbin.example.com\n*       issuer: "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("CN")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("example.com,O"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("example Inc.\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" GET /status/418 HTTP/1.1\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" User-Agent: curl/7.29.0\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" Accept: */*\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" Host:httpbin.example.com\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" HTTP/1.1 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("418")]),t._v(" Unknown\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" server: istio-envoy\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" date: Mon, "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v(" Mar "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v(" 01:13:48 GMT\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" x-more-info: http://tools.ietf.org/html/rfc2324\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" access-control-allow-origin: *\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" access-control-allow-credentials: "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" content-length: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("135")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" x-envoy-upstream-service-time: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("\n\n    -"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" teapot "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("-\n\n       _"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("_\n     .'  _ _ "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(' ."'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v(" ^ "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v('". _,\n    '),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("_"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"---"')]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("//\n      "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("       "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("/\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("_     _/\n        "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v('"`\n* Connection '),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#0 to host httpbin.example.com left intact")]),t._v("\n")])])]),s("h4",{attrs:{id:"å¯†é’¥æ ¼å¼"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å¯†é’¥æ ¼å¼"}},[t._v("#")]),t._v(" å¯†é’¥æ ¼å¼")]),t._v(" "),s("p",[t._v("Istio æ”¯æŒè¯»å–å‡ ç§ä¸åŒçš„ Secret æ ¼å¼ï¼Œä»¥æ”¯æŒä¸å„ç§å·¥å…·çš„é›†æˆï¼Œä¾‹å¦‚"),s("a",{attrs:{href:"https://istio.io/latest/docs/ops/integrations/certmanager/",target:"_blank",rel:"noopener noreferrer"}},[t._v("cert-manager"),s("OutboundLink")],1),t._v("ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("ä¸€ä¸ª TLS å¯†é’¥ï¼Œå¸¦æœ‰"),s("code",[t._v("tls.key")]),t._v("å’Œ"),s("code",[t._v("tls.crt")]),t._v("ï¼Œå¦‚ä¸Šæ‰€è¿°ã€‚å¯¹äºåŒå‘ TLSï¼Œ"),s("code",[t._v("ca.crt")]),t._v("å¯ä»¥ä½¿ç”¨å¯†é’¥ã€‚")]),t._v(" "),s("li",[t._v("å¸¦æœ‰é”®çš„é€šç”¨ Secret"),s("code",[t._v("key")]),t._v("å’Œ"),s("code",[t._v("cert")]),t._v(". å¯¹äºåŒå‘ TLSï¼Œ"),s("code",[t._v("cacert")]),t._v("å¯ä»¥ä½¿ç”¨å¯†é’¥ã€‚")]),t._v(" "),s("li",[t._v("å¸¦æœ‰é”®çš„é€šç”¨ Secret"),s("code",[t._v("key")]),t._v("å’Œ"),s("code",[t._v("cert")]),t._v(". å¯¹äºåŒå‘ TLSï¼Œä¸€ä¸ªåä¸º çš„å•ç‹¬é€šç”¨ Secret"),s("code",[t._v("<secret>-cacert")]),t._v("å¸¦æœ‰ä¸€ä¸ª"),s("code",[t._v("cacert")]),t._v("å¯†é’¥ã€‚ä¾‹å¦‚ï¼Œ"),s("code",[t._v("httpbin-credential")]),t._v("æœ‰"),s("code",[t._v("key")]),t._v("å’Œ"),s("code",[t._v("cert")]),t._v("ï¼Œå¹¶ä¸”"),s("code",[t._v("httpbin-credential-cacert")]),t._v("æœ‰"),s("code",[t._v("cacert")]),t._v("ã€‚")]),t._v(" "),s("li",[s("code",[t._v("cacert")]),t._v("é”®å€¼å¯ä»¥æ˜¯ä¸€ä¸ª CA æ†ç»‘åŒ…ï¼Œç”±ä¸²è”çš„å„ä¸ª CA è¯ä¹¦ç»„æˆã€‚")])]),t._v(" "),s("h4",{attrs:{id:"æ¸…ç†-9"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ¸…ç†-9"}},[t._v("#")]),t._v(" æ¸…ç†")]),t._v(" "),s("p",[t._v("åˆ é™¤ç½‘å…³é…ç½®ã€è™šæ‹ŸæœåŠ¡å®šä¹‰å’Œæœºå¯†ï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl delete gateway mygateway\n$ kubectl delete virtualservice httpbin\n$ kubectl delete --ignore-not-found"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" istio-system secret httpbin-credential "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\nhelloworld-credential\n$ kubectl delete --ignore-not-found"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true virtualservice helloworld-v1\n")])])]),s("p",[t._v("åˆ é™¤è¯ä¹¦å’Œå¯†é’¥ï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-rf")]),t._v(" example.com.crt example.com.key httpbin.example.com.crt httpbin.example.com.key httpbin.example.com.csr helloworld-v1.example.com.crt helloworld-v1.example.com.key helloworld-v1.example.com.csr client.example.com.crt client.example.com.csr client.example.com.key ./new_certificates\n")])])]),s("p",[t._v("å…³é—­"),s("code",[t._v("httpbin")]),t._v("å’Œ"),s("code",[t._v("helloworld-v1")]),t._v("æœåŠ¡ï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl delete deployment --ignore-not-found"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true httpbin helloworld-v1\n$ kubectl delete "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" --ignore-not-found"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true httpbin helloworld-v1\n")])])]),s("h2",{attrs:{id:"å‡ºå£tlså‘èµ·"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å‡ºå£tlså‘èµ·"}},[t._v("#")]),t._v(" å‡ºå£TLSå‘èµ·")]),t._v(" "),s("h4",{attrs:{id:"ä»€ä¹ˆæ˜¯tlså‘èµ·"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä»€ä¹ˆæ˜¯tlså‘èµ·"}},[t._v("#")]),t._v(" ä»€ä¹ˆæ˜¯TLSå‘èµ·")]),t._v(" "),s("p",[t._v("ç”¨äºé…ç½® Istio ä»¥å—æ§æ–¹å¼è®¿é—®å¤–éƒ¨æœåŠ¡ã€‚è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•é…ç½® Istio æ¥æ‰§è¡Œ"),s("a",{attrs:{href:"https://istio.io/latest/docs/reference/config/networking/service-entry/",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("ServiceEntry")]),s("OutboundLink")],1),t._v("TLS å‘èµ· ç”¨äºåˆ°å¤–éƒ¨æœåŠ¡çš„æµé‡ã€‚å½“åŸå§‹æµé‡ä¸º HTTP æ—¶ï¼ŒIstio å°†æ‰“å¼€ä¸å¤–éƒ¨æœåŠ¡çš„ HTTPS è¿æ¥ã€‚")]),t._v(" "),s("p",[t._v("è€ƒè™‘ä¸€ä¸ªå¯¹å¤–éƒ¨ç«™ç‚¹æ‰§è¡Œ HTTP è°ƒç”¨çš„é—ç•™åº”ç”¨ç¨‹åºã€‚å‡è®¾è¿è¡Œåº”ç”¨ç¨‹åºçš„ç»„ç»‡æ”¶åˆ°ä¸€ä¸ªæ–°è¦æ±‚ï¼Œè¦æ±‚æ‰€æœ‰å¤–éƒ¨æµé‡éƒ½å¿…é¡»åŠ å¯†ã€‚ä½¿ç”¨ Istioï¼Œåªéœ€é…ç½®å³å¯å®ç°æ­¤è¦æ±‚ï¼Œæ— éœ€æ›´æ”¹åº”ç”¨ç¨‹åºä¸­çš„ä»»ä½•ä»£ç ã€‚åº”ç”¨ç¨‹åºå¯ä»¥å‘é€æœªåŠ å¯†çš„ HTTP è¯·æ±‚ï¼Œç„¶å Istio å°†ä¸ºåº”ç”¨ç¨‹åºåŠ å¯†å®ƒä»¬ã€‚")]),t._v(" "),s("p",[t._v("ä»æºå‘é€æœªåŠ å¯†çš„ HTTP è¯·æ±‚å¹¶è®© Istio æ‰§è¡Œ TLS å‡çº§çš„å¦ä¸€ä¸ªå¥½å¤„æ˜¯ Istio å¯ä»¥ç”Ÿæˆæ›´å¥½çš„é¥æµ‹æ•°æ®å¹¶ä¸ºæœªåŠ å¯†çš„è¯·æ±‚æä¾›æ›´å¤šçš„è·¯ç”±æ§åˆ¶ã€‚")]),t._v(" "),s("h4",{attrs:{id:"ç¯å¢ƒå‡†å¤‡-8"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç¯å¢ƒå‡†å¤‡-8"}},[t._v("#")]),t._v(" ç¯å¢ƒå‡†å¤‡")]),t._v(" "),s("p",[t._v("å¯åŠ¨å°†ç”¨ä½œå¤–éƒ¨è°ƒç”¨æµ‹è¯•æºçš„"),s("a",{attrs:{href:"https://github.com/istio/istio/tree/release-1.13/samples/sleep",target:"_blank",rel:"noopener noreferrer"}},[t._v("ç¡çœ æ ·æœ¬ã€‚"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("å¦‚æœæ‚¨å¯ç”¨äº†"),s("a",{attrs:{href:"https://istio.io/latest/docs/setup/additional-setup/sidecar-injection/#automatic-sidecar-injection",target:"_blank",rel:"noopener noreferrer"}},[t._v("è‡ªåŠ¨è¾¹è½¦æ³¨å…¥"),s("OutboundLink")],1),t._v("ï¼Œè¯·éƒ¨ç½²"),s("code",[t._v("sleep")]),t._v("åº”ç”¨ç¨‹åºï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" samples/sleep/sleep.yaml\n$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("istioctl kube-inject "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" samples/sleep/sleep.yaml"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("è¯·æ³¨æ„ï¼Œæ‚¨å¯ä»¥"),s("code",[t._v("exec")]),t._v("å’Œ"),s("code",[t._v("curl")]),t._v("æ¥è‡ªçš„ä»»ä½• pod éƒ½å°†æ‰§è¡Œä»¥ä¸‹è¿‡ç¨‹ã€‚")]),t._v(" "),s("p",[t._v("åˆ›å»ºä¸€ä¸ª shell å˜é‡æ¥ä¿å­˜ç”¨äºå‘å¤–éƒ¨æœåŠ¡å‘é€è¯·æ±‚çš„æº pod çš„åç§°ã€‚å¦‚æœæ‚¨ä½¿ç”¨äº†"),s("a",{attrs:{href:"https://github.com/istio/istio/tree/release-1.13/samples/sleep",target:"_blank",rel:"noopener noreferrer"}},[t._v("sleep"),s("OutboundLink")],1),t._v("ç¤ºä¾‹ï¼Œè¯·è¿è¡Œï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("SOURCE_POD")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("kubectl get pod "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-l")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("sleep "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("jsonpath")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(".items"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("metadata.name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n")])])]),s("h4",{attrs:{id:"é…ç½®å¯¹å¤–éƒ¨æœåŠ¡çš„è®¿é—®"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#é…ç½®å¯¹å¤–éƒ¨æœåŠ¡çš„è®¿é—®"}},[t._v("#")]),t._v(" é…ç½®å¯¹å¤–éƒ¨æœåŠ¡çš„è®¿é—®")]),t._v(" "),s("p",[t._v("é¦–å…ˆä½¿ç”¨"),s("a",{attrs:{href:"https://istio.io/latest/docs/tasks/traffic-management/egress/egress-control",target:"_blank",rel:"noopener noreferrer"}},[t._v("è®¿é—®å¤–éƒ¨æœåŠ¡"),s("OutboundLink")],1),t._v("ä»»åŠ¡"),s("code",[t._v("edition.cnn.com")]),t._v("ä¸­æ˜¾ç¤ºçš„ç›¸åŒæŠ€æœ¯é…ç½®å¯¹å¤–éƒ¨æœåŠ¡çš„è®¿é—®ã€‚ä½†æ˜¯ï¼Œè¿™ä¸€æ¬¡ä½¿ç”¨å•ä¸ªæ¥å¯ç”¨å¯¹æœåŠ¡çš„ HTTP å’Œ HTTPS è®¿é—®ã€‚"),s("code",[t._v("ServiceEntry")])]),t._v(" "),s("ol",[s("li",[t._v("åˆ›å»ºä¸€ä¸ª"),s("code",[t._v("ServiceEntry")]),t._v("ä»¥å¯ç”¨å¯¹"),s("code",[t._v("edition.cnn.com")]),t._v("ï¼š")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" <<EOF\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ServiceEntry\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" edition"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cnn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("com\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" edition.cnn.com\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("number")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("port\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" HTTP\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("number")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("port\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" HTTPS\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resolution")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" DNS\nEOF\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[t._v("å‘å¤–éƒ¨ HTTP æœåŠ¡å‘å‡ºè¯·æ±‚ï¼š")])]),t._v(" "),s("blockquote",[s("p",[t._v("æ³¨æ„ curl çš„"),s("em",[t._v("æ ‡å¿—")]),s("code",[t._v("-L")]),t._v("ï¼Œå®ƒæŒ‡ç¤º"),s("em",[t._v("curl")]),t._v("éµå¾ªé‡å®šå‘ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨ä¸º HTTP è¯·æ±‚è¿”å›äº†é‡å®šå‘å“åº”ï¼ˆ"),s("a",{attrs:{href:"https://tools.ietf.org/html/rfc2616#section-10.3.2",target:"_blank",rel:"noopener noreferrer"}},[t._v("301 Moved Permanently"),s("OutboundLink")],1),t._v(" ï¼‰ ã€‚é‡å®šå‘å“åº”æŒ‡ç¤ºå®¢æˆ·ç«¯å‘é€ä¸€ä¸ªé¢å¤–çš„è¯·æ±‚ï¼Œè¿™æ¬¡ä½¿ç”¨ HTTPSï¼Œåˆ°. å¯¹äºç¬¬äºŒä¸ªè¯·æ±‚ï¼ŒæœåŠ¡å™¨è¿”å›è¯·æ±‚çš„å†…å®¹å’Œ"),s("em",[t._v("200 OK")]),t._v("çŠ¶æ€ç ã€‚"),s("code",[t._v("http://edition.cnn.com/politics``https://edition.cnn.com/politics")])]),t._v(" "),s("p",[t._v("å°½ç®¡"),s("em",[t._v("curl")]),t._v("å‘½ä»¤é€æ˜åœ°å¤„ç†äº†é‡å®šå‘ï¼Œä½†è¿™é‡Œæœ‰ä¸¤ä¸ªé—®é¢˜ã€‚ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯å†—ä½™è¯·æ±‚ï¼Œå®ƒä½¿è·å–"),s("code",[t._v("http://edition.cnn.com/politics")]),t._v(". ç¬¬äºŒä¸ªé—®é¢˜æ˜¯ URL çš„è·¯å¾„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯"),s("em",[t._v("æ”¿æ²»")]),t._v("ï¼Œæ˜¯ä»¥æ˜æ–‡å½¢å¼å‘é€çš„ã€‚å¦‚æœæœ‰æ”»å‡»è€…å—…æ¢ä½ çš„åº”ç”¨ç¨‹åºå’Œ ä¹‹é—´çš„é€šä¿¡"),s("code",[t._v("edition.cnn.com")]),t._v("ï¼Œæ”»å‡»è€…å°±ä¼šçŸ¥é“"),s("code",[t._v("edition.cnn.com")]),t._v("åº”ç”¨ç¨‹åºè·å–äº†å“ªäº›ç‰¹å®šä¸»é¢˜ã€‚å‡ºäºéšç§åŸå› ï¼Œæ‚¨å¯èƒ½å¸Œæœ›é˜»æ­¢æ­¤ç±»æŠ«éœ²ã€‚")]),t._v(" "),s("p",[s("strong",[t._v("è¿™ä¸¤ä¸ªé—®é¢˜éƒ½å¯ä»¥é€šè¿‡é…ç½® Istio æ¥æ‰§è¡Œ TLS å‘èµ·æ¥è§£å†³ã€‚")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${SOURCE_POD}")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),t._v(" -- "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-sSL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" /dev/null "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-D")]),t._v(" - http://edition.cnn.com/politics\nHTTP/1.1 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("301")]),t._v(" Moved Permanently\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nlocation: https://edition.cnn.com/politics\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n\nHTTP/2 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])])]),s("h4",{attrs:{id:"å‡ºå£æµé‡çš„tlså‘èµ·"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å‡ºå£æµé‡çš„tlså‘èµ·"}},[t._v("#")]),t._v(" å‡ºå£æµé‡çš„TLSå‘èµ·")]),t._v(" "),s("ol",[s("li",[t._v("é‡æ–°å®šä¹‰"),s("code",[t._v("ServiceEntry")]),t._v("ä¸Šä¸€èŠ‚ä¸­çš„å°† HTTP è¯·æ±‚é‡å®šå‘åˆ°ç«¯å£ 443 å¹¶æ·»åŠ ä¸€ä¸ª"),s("code",[t._v("DestinationRule")]),t._v("ä»¥æ‰§è¡Œ TLS å‘èµ·ï¼š\n"),s("ul",[s("li",[s("code",[t._v("é…ç½®æœåŠ¡å…¥å£çš„httpé‡å®šå‘åˆ°443ç«¯å£")])]),t._v(" "),s("li",[s("code",[t._v("é…ç½®äº¤é€šç­–ç•¥é’ˆå¯¹80ç«¯å£ä½¿ç”¨æ¨¡å¼ä¸ºSIMPLEçš„tls")])])])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" <<EOF\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ServiceEntry\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" edition"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cnn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("com\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" edition.cnn.com\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("number")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("port\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" HTTP\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targetPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("number")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("port\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" HTTPS\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resolution")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" DNS\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" DestinationRule\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" edition"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cnn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("com\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" edition.cnn.com\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("trafficPolicy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("portLevelSettings")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("number")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tls")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" SIMPLE "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# initiates HTTPS when accessing edition.cnn.com")]),t._v("\nEOF\n")])])]),s("p",[t._v("ä»¥ä¸Š"),s("code",[t._v("DestinationRule")]),t._v("å°†ä¸ºç«¯å£ 80 ä¸Šçš„ HTTP è¯·æ±‚æ‰§è¡Œ TLS å‘èµ·ï¼Œ"),s("code",[t._v("ServiceEntry")]),t._v(" ç„¶åå°†ç«¯å£ 80 ä¸Šçš„è¯·æ±‚é‡å®šå‘åˆ°ç›®æ ‡ç«¯å£ 443ã€‚")]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[t._v("å‘ å‘é€ HTTP è¯·æ±‚"),s("code",[t._v("http://edition.cnn.com/politics")]),t._v("ï¼Œå¦‚ä¸Šä¸€èŠ‚æ‰€è¿°ï¼š")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${SOURCE_POD}")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),t._v(" -- "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-sSL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" /dev/null "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-D")]),t._v(" - http://edition.cnn.com/politics\nHTTP/1.1 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" OK\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])])]),s("p",[t._v("è¿™æ¬¡æ‚¨æ”¶åˆ°"),s("em",[t._v("200 OK")]),t._v("ä½œä¸ºç¬¬ä¸€ä¸ªä¹Ÿæ˜¯å”¯ä¸€çš„å“åº”ã€‚Istio ä¸º"),s("em",[t._v("curl")]),t._v("æ‰§è¡Œ TLS å‘èµ·ï¼Œå› æ­¤åŸå§‹ HTTP è¯·æ±‚è¢«è½¬å‘"),s("code",[t._v("edition.cnn.com")]),t._v("ä¸º HTTPSã€‚æœåŠ¡å™¨ç›´æ¥è¿”å›å†…å®¹ï¼Œæ— éœ€é‡å®šå‘ã€‚æ‚¨æ¶ˆé™¤äº†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„åŒé‡å¾€è¿”ï¼Œå¹¶ä¸”è¯·æ±‚ä½¿ç½‘æ ¼åŠ å¯†ï¼Œè€Œæ²¡æœ‰æŠ«éœ²æ‚¨çš„åº”ç”¨ç¨‹åº"),s("em",[t._v("è·å–")]),t._v("."),s("code",[t._v("edition.cnn.com")])]),t._v(" "),s("p",[t._v("è¯·æ³¨æ„ï¼Œæ‚¨ä½¿ç”¨äº†ä¸ä¸Šä¸€èŠ‚ä¸­ç›¸åŒçš„å‘½ä»¤ã€‚å¯¹äºä»¥ç¼–ç¨‹æ–¹å¼è®¿é—®å¤–éƒ¨æœåŠ¡çš„åº”ç”¨ç¨‹åºï¼Œæ— éœ€æ›´æ”¹ä»£ç ã€‚æ‚¨å¯ä»¥é€šè¿‡é…ç½® Istio è·å¾— TLS å‘èµ·çš„å¥½å¤„ï¼Œè€Œæ— éœ€æ›´æ”¹ä¸€è¡Œä»£ç ã€‚")]),t._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[t._v("è¯·æ³¨æ„ï¼Œä½¿ç”¨ HTTPS è®¿é—®å¤–éƒ¨æœåŠ¡çš„åº”ç”¨ç¨‹åºç»§ç»­åƒä»¥å‰ä¸€æ ·å·¥ä½œï¼š")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${SOURCE_POD}")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),t._v(" -- "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-sSL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" /dev/null "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-D")]),t._v(" - https://edition.cnn.com/politics\nHTTP/2 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])])]),s("h4",{attrs:{id:"æ¸…ç†-10"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ¸…ç†-10"}},[t._v("#")]),t._v(" æ¸…ç†")]),t._v(" "),s("p",[t._v("åˆ é™¤æ‚¨åˆ›å»ºçš„ Istio é…ç½®é¡¹ã€å…³é—­"),s("a",{attrs:{href:"https://github.com/istio/istio/tree/release-1.13/samples/sleep",target:"_blank",rel:"noopener noreferrer"}},[t._v("ç¡çœ "),s("OutboundLink")],1),t._v("æœåŠ¡ï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl delete serviceentry edition-cnn-com\n$ kubectl delete destinationrule edition-cnn-com\n$ kubectl delete "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" samples/sleep/sleep.yaml\n")])])]),s("h2",{attrs:{id:"å‡ºå£ç½‘å…³"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å‡ºå£ç½‘å…³"}},[t._v("#")]),t._v(" å‡ºå£ç½‘å…³")]),t._v(" "),s("h4",{attrs:{id:"ä»€ä¹ˆæ˜¯å‡ºå£ç½‘å…³"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä»€ä¹ˆæ˜¯å‡ºå£ç½‘å…³"}},[t._v("#")]),t._v(" ä»€ä¹ˆæ˜¯å‡ºå£ç½‘å…³")]),t._v(" "),s("p",[t._v("Istio ä½¿ç”¨"),s("a",{attrs:{href:"https://istio.io/latest/docs/reference/config/networking/gateway/",target:"_blank",rel:"noopener noreferrer"}},[t._v("å…¥å£å’Œå‡ºå£ç½‘å…³"),s("OutboundLink")],1),t._v(" æ¥é…ç½®åœ¨æœåŠ¡ç½‘æ ¼è¾¹ç¼˜æ‰§è¡Œçš„è´Ÿè½½å‡è¡¡å™¨ã€‚å…¥å£ç½‘å…³å…è®¸æ‚¨å®šä¹‰æ‰€æœ‰ä¼ å…¥æµé‡æµè¿‡çš„ç½‘æ ¼çš„å…¥å£ç‚¹ã€‚å‡ºå£ç½‘å…³æ˜¯ä¸€ä¸ªå¯¹ç§°çš„æ¦‚å¿µï¼›å®ƒå®šä¹‰äº†ç½‘æ ¼çš„å‡ºå£ç‚¹ã€‚å‡ºå£ç½‘å…³å…è®¸æ‚¨å°† Istio åŠŸèƒ½ï¼ˆä¾‹å¦‚ç›‘æ§å’Œè·¯ç”±è§„åˆ™ï¼‰åº”ç”¨äºé€€å‡ºç½‘æ ¼çš„æµé‡ã€‚")]),t._v(" "),s("p",[t._v("è€ƒè™‘ä¸€ä¸ªå…·æœ‰ä¸¥æ ¼å®‰å…¨è¦æ±‚çš„ç»„ç»‡ï¼Œå³æ‰€æœ‰ç¦»å¼€æœåŠ¡ç½‘æ ¼çš„æµé‡éƒ½å¿…é¡»æµç»ä¸€ç»„ä¸“ç”¨èŠ‚ç‚¹ã€‚è¿™äº›èŠ‚ç‚¹å°†åœ¨ä¸“ç”¨æœºå™¨ä¸Šè¿è¡Œï¼Œä¸é›†ç¾¤ä¸­è¿è¡Œåº”ç”¨ç¨‹åºçš„å…¶ä½™èŠ‚ç‚¹åˆ†å¼€ã€‚è¿™äº›ç‰¹æ®ŠèŠ‚ç‚¹å°†ç”¨äºå¯¹å‡ºå£æµé‡æ‰§è¡Œç­–ç•¥ï¼Œå¹¶ä¸”å°†æ¯”å…¶ä»–èŠ‚ç‚¹æ›´å½»åº•åœ°ç›‘æ§ã€‚")]),t._v(" "),s("p",[t._v("å¦ä¸€ä¸ªç”¨ä¾‹æ˜¯åº”ç”¨ç¨‹åºèŠ‚ç‚¹æ²¡æœ‰å…¬å…± IP çš„é›†ç¾¤ï¼Œå› æ­¤åœ¨å®ƒä»¬ä¸Šè¿è¡Œçš„ç½‘å†…æœåŠ¡æ— æ³•è®¿é—® Internetã€‚å®šä¹‰ä¸€ä¸ªå‡ºå£ç½‘å…³ï¼Œå¼•å¯¼æ‰€æœ‰å‡ºå£æµé‡é€šè¿‡å®ƒï¼Œå¹¶å°†å…¬å…± IP åˆ†é…ç»™å‡ºå£ç½‘å…³èŠ‚ç‚¹ï¼Œå…è®¸åº”ç”¨ç¨‹åºèŠ‚ç‚¹ä»¥å—æ§æ–¹å¼è®¿é—®å¤–éƒ¨æœåŠ¡ã€‚")]),t._v(" "),s("h4",{attrs:{id:"åŸºç¡€ç¯å¢ƒ-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#åŸºç¡€ç¯å¢ƒ-3"}},[t._v("#")]),t._v(" åŸºç¡€ç¯å¢ƒ")]),t._v(" "),s("p",[t._v("éƒ¨ç½²"),s("a",{attrs:{href:"https://github.com/istio/istio/tree/release-1.13/samples/sleep",target:"_blank",rel:"noopener noreferrer"}},[t._v("sleep"),s("OutboundLink")],1),t._v("ç¤ºä¾‹åº”ç”¨ç¨‹åºä»¥ç”¨ä½œå‘é€è¯·æ±‚çš„æµ‹è¯•æºã€‚å¦‚æœæ‚¨ å¯ç”¨äº†"),s("a",{attrs:{href:"https://istio.io/latest/docs/setup/additional-setup/sidecar-injection/#automatic-sidecar-injection",target:"_blank",rel:"noopener noreferrer"}},[t._v("è‡ªåŠ¨ Sidecar æ³¨å…¥"),s("OutboundLink")],1),t._v(" ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥éƒ¨ç½²ç¤ºä¾‹åº”ç”¨ç¨‹åºï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" samples/sleep/sleep.yaml\n$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("istioctl kube-inject "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" samples/sleep/sleep.yaml"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("å°†"),s("code",[t._v("SOURCE_POD")]),t._v("ç¯å¢ƒå˜é‡è®¾ç½®ä¸ºæº pod çš„åç§°ï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("SOURCE_POD")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("kubectl get pod "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-l")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("sleep "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("jsonpath")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(".items"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("metadata.name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n")])])]),s("h4",{attrs:{id:"éƒ¨ç½²istioå‡ºå£ç½‘å…³"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#éƒ¨ç½²istioå‡ºå£ç½‘å…³"}},[t._v("#")]),t._v(" éƒ¨ç½²Istioå‡ºå£ç½‘å…³")]),t._v(" "),s("ol",[s("li",[t._v("æ£€æŸ¥æ˜¯å¦éƒ¨ç½²äº† Istio å‡ºå£ç½‘å…³ï¼š")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl get pod "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-l")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("istio")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("egressgateway "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" istio-system\n")])])]),s("p",[t._v("å¦‚æœæ²¡æœ‰è¿”å› podï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ­¥éª¤éƒ¨ç½² Istio å‡ºå£ç½‘å…³ã€‚")]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[t._v("å¦‚æœæ‚¨ä½¿ç”¨"),s("code",[t._v("IstioOperator")]),t._v("CR å®‰è£… Istioï¼Œè¯·å°†ä»¥ä¸‹å­—æ®µæ·»åŠ åˆ°æ‚¨çš„é…ç½®ä¸­ï¼š")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("components")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("egressGateways")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" istio"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("egressgateway\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n")])])]),s("p",[t._v("å¦åˆ™ï¼Œå°†ç­‰æ•ˆè®¾ç½®æ·»åŠ åˆ°æ‚¨çš„åŸå§‹"),s("code",[t._v("istioctl install")]),t._v("å‘½ä»¤ï¼Œä¾‹å¦‚ï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ istioctl "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("flags-you-used-to-install-Istio"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n                   "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--set")]),t._v(" components.egressGateways"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(".name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("istio-egressgateway "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n                   "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--set")]),t._v(" components.egressGateways"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(".enabled"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true\n")])])]),s("h4",{attrs:{id:"httpæµé‡çš„å‡ºå£ç½‘å…³"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#httpæµé‡çš„å‡ºå£ç½‘å…³"}},[t._v("#")]),t._v(" HTTPæµé‡çš„å‡ºå£ç½‘å…³")]),t._v(" "),s("p",[t._v("é¦–å…ˆåˆ›å»ºä¸€ä¸ª"),s("code",[t._v("ServiceEntry")]),t._v("å…è®¸ç›´æ¥æµé‡åˆ°å¤–éƒ¨æœåŠ¡ã€‚")]),t._v(" "),s("ol",[s("li",[s("code",[t._v("ServiceEntry")]),t._v("ä¸ºå®šä¹‰ä¸€ä¸ª"),s("code",[t._v("edition.cnn.com")]),t._v("ã€‚\n"),s("ul",[s("li",[s("code",[t._v("é…ç½®ä¸»æœºä¸ºedition.cnn.com")])]),t._v(" "),s("li",[s("code",[t._v("é…ç½®ä¸»æœºå‘ç°æ¨¡å¼ä¸ºDNS")])]),t._v(" "),s("li",[s("code",[t._v("é…ç½®HTTPå’ŒHTTPSä¸¤ä¸ªåè®®")])])])])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("DNS")]),t._v("å¿…é¡»åœ¨ä¸‹é¢çš„æœåŠ¡æ¡ç›®ä¸­ä½¿ç”¨åˆ†è¾¨ç‡ã€‚å¦‚æœåˆ†è¾¨ç‡ä¸º"),s("code",[t._v("NONE")]),t._v("ï¼Œç½‘å…³å°†åœ¨æ— é™å¾ªç¯ä¸­å°†æµé‡å®šå‘åˆ°è‡ªèº«ã€‚è¿™æ˜¯å› ä¸ºç½‘å…³æ¥æ”¶åˆ°ä¸€ä¸ªè¯·æ±‚ï¼Œå…¶åŸå§‹ç›®æ ‡ IP åœ°å€ç­‰äºç½‘å…³çš„æœåŠ¡ IPï¼ˆå› ä¸ºè¯·æ±‚æ˜¯ç”± Sidecar ä»£ç†å®šå‘åˆ°ç½‘å…³çš„ï¼‰ã€‚é€šè¿‡"),s("code",[t._v("DNS")]),t._v("è§£æï¼Œç½‘å…³æ‰§è¡Œ DNS æŸ¥è¯¢ä»¥è·å–å¤–éƒ¨æœåŠ¡çš„ IP åœ°å€å¹¶å°†æµé‡å®šå‘åˆ°è¯¥ IP åœ°å€ã€‚")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" <<EOF\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ServiceEntry\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cnn\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" edition.cnn.com\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("number")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("port\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" HTTP\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("number")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" HTTPS\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resolution")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" DNS\nEOF\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[s("p",[s("a",{attrs:{href:"http://edition.cnn.com/politics",target:"_blank",rel:"noopener noreferrer"}},[t._v("é€šè¿‡å‘http://edition.cnn.com/politics"),s("OutboundLink")],1),s("code",[t._v("ServiceEntry")]),t._v("å‘é€ HTTP è¯·æ±‚æ¥éªŒè¯æ‚¨çš„åº”ç”¨æ˜¯å¦æ­£ç¡®ã€‚")]),t._v(" "),s("p",[t._v("è¾“å‡ºåº”ä¸ "),s("a",{attrs:{href:"https://istio.io/latest/docs/tasks/traffic-management/egress/egress-tls-origination/",target:"_blank",rel:"noopener noreferrer"}},[t._v("TLS Origination for Egress Traffic"),s("OutboundLink")],1),t._v("ç¤ºä¾‹ä¸­çš„ç›¸åŒï¼Œä½†æ²¡æœ‰ TLS å‘èµ·ã€‚")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SOURCE_POD")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),t._v(" -- "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-sSL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" /dev/null "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-D")]),t._v(" - http://edition.cnn.com/politics\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nHTTP/1.1 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("301")]),t._v(" Moved Permanently\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nlocation: https://edition.cnn.com/politics\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n\nHTTP/2 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v("\nContent-Type: text/html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("charset")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf-8\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[s("code",[t._v("Gateway")]),t._v("ä¸º"),s("em",[t._v("edition.cnn.com")]),t._v("åˆ›å»ºä¸€ä¸ªå‡ºå£ï¼Œç«¯å£ 80ï¼Œå¹¶ä¸ºå®šå‘åˆ°å‡ºå£ç½‘å…³çš„æµé‡åˆ›å»ºä¸€ä¸ªç›®æ ‡è§„åˆ™ã€‚\n"),s("ul",[s("li",[s("code",[t._v("é…ç½®å‡ºå£ç½‘å…³ä¸ºegressgateway")])]),t._v(" "),s("li",[s("code",[t._v("é…ç½®ä¸»æœºedition.cnn.comè§„èŒƒä¸ºå…è®¸80ç«¯å£")])]),t._v(" "),s("li",[s("code",[t._v("åˆ›å»ºè·¯ç”±è§„åˆ™ä¸»æœºä½¿ç”¨ istio-egressgateway.istio-system.svc.cluster.local")])]),t._v(" "),s("li",[s("code",[t._v("è·¯ç”±è§„åˆ™ä¸‹çš„å­é›†ä½¿ç”¨cnn")])])])])]),t._v(" "),s("blockquote",[s("p",[t._v("è¦é€šè¿‡å‡ºå£ç½‘å…³å¼•å¯¼å¤šä¸ªä¸»æœºï¼Œæ‚¨å¯ä»¥"),s("code",[t._v("*")]),t._v("åœ¨"),s("code",[t._v("Gateway")]),t._v(". åº”å°† ä¸­çš„"),s("code",[t._v("subset")]),t._v("å­—æ®µé‡æ–°ç”¨äºå…¶ä»–ä¸»æœºã€‚"),s("code",[t._v("DestinationRule")])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" <<EOF\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Gateway\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" istio"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("egressgateway\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("istio")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" egressgateway\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("servers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("number")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" HTTP\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" edition.cnn.com\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" DestinationRule\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" egressgateway"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("for"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cnn\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" istio"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("egressgateway.istio"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("system.svc.cluster.local\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subsets")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cnn\nEOF\n")])])]),s("ol",{attrs:{start:"4"}},[s("li",[t._v("å®šä¹‰ "),s("code",[t._v("VirtualService")]),t._v("ä»¥å°†æµé‡ä» sidecar å¼•å¯¼åˆ° egress ç½‘å…³ï¼Œå¹¶ä» egress ç½‘å…³å¼•å¯¼åˆ°å¤–éƒ¨æœåŠ¡ï¼š\n"),s("ul",[s("li",[s("code",[t._v("å®šä¹‰ä¸»æœºåœ°å€ä¸ºedition.cnn.com")])]),t._v(" "),s("li",[s("code",[t._v("é…ç½®è™šæ‹ŸæœåŠ¡ä½¿ç”¨ä¸¤ä¸ªç½‘å…³ istio-egressgatewayå’Œmesh")])]),t._v(" "),s("li",[s("code",[t._v("é…ç½®httpè§„åˆ™åˆ†åˆ«ä½¿ç”¨ä¸¤ä¸ªç½‘å…³éƒ½æ˜¯å…è®¸80ç«¯å£")])]),t._v(" "),s("li",[s("code",[t._v("é…ç½®meshçš„è·¯ç”±è§„åˆ™å…è®¸ä¸»æœº istio-egressgateway.istio-system.svc.cluster.local ã€å­é›†ä¸ºcnnã€ç«¯å£æ˜¯80 ã€æƒé‡åˆ†é…ä¸º100")])]),t._v(" "),s("li",[s("code",[t._v("é…ç½®istio-egressgatewayçš„è·¯ç”±è§„åˆ™å…è®¸ä¸»æœºä¸ºedition.cnn.comã€ç«¯å£æ˜¯80ã€æƒé‡åˆ†é…ä¹Ÿæ˜¯100")])])])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" <<EOF\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" VirtualService\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" direct"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cnn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("through"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("egress"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("gateway\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" edition.cnn.com\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gateways")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" istio"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("egressgateway\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" mesh\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("match")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gateways")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" mesh\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" istio"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("egressgateway.istio"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("system.svc.cluster.local\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subset")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cnn\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("number")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("weight")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("match")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gateways")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" istio"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("egressgateway\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" edition.cnn.com\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("number")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("weight")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("\nEOF\n")])])]),s("ol",{attrs:{start:"5"}},[s("li",[t._v("å°† HTTP è¯·æ±‚é‡æ–°å‘é€åˆ°"),s("a",{attrs:{href:"https://edition.cnn.com/politics",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://edition.cnn.com/politics"),s("OutboundLink")],1),t._v("ã€‚")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SOURCE_POD")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),t._v(" -- "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-sSL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" /dev/null "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-D")]),t._v(" - http://edition.cnn.com/politics\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nHTTP/1.1 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("301")]),t._v(" Moved Permanently\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nlocation: https://edition.cnn.com/politics\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n\nHTTP/2 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v("\nContent-Type: text/html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("charset")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf-8\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])])]),s("ol",{attrs:{start:"6"}},[s("li",[s("p",[t._v("æ£€æŸ¥"),s("code",[t._v("istio-egressgateway")]),t._v("pod çš„æ—¥å¿—ä¸­æ˜¯å¦æœ‰ä¸æˆ‘ä»¬çš„è¯·æ±‚ç›¸å¯¹åº”çš„è¡Œã€‚å¦‚æœ Istio éƒ¨ç½²åœ¨"),s("code",[t._v("istio-system")]),t._v("å‘½åç©ºé—´ä¸­ï¼Œæ‰“å°æ—¥å¿—çš„å‘½ä»¤æ˜¯ï¼š")]),t._v(" "),s("p",[t._v("è¯·æ³¨æ„ï¼Œæ‚¨ä»…å°†æµé‡ä»ç«¯å£ 80 é‡å®šå‘åˆ°å‡ºå£ç½‘å…³ã€‚åˆ°ç«¯å£ 443 çš„ HTTPS æµé‡ç›´æ¥è½¬åˆ°"),s("em",[t._v("edition.cnn.com")]),t._v("ã€‚")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl logs -l istio=egressgateway -c istio-proxy -n istio-system | tail")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-03-21T09:42:18.336211Z     info    xdsproxy        connected to upstream XDS server: istiod.istio-system.svc:15012\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-03-21T10:14:36.196020Z     info    xdsproxy        connected to upstream XDS server: istiod.istio-system.svc:15012\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-03-21T10:47:07.424114Z     info    xdsproxy        connected to upstream XDS server: istiod.istio-system.svc:15012\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-03-21T11:15:16.460832Z     info    xdsproxy        connected to upstream XDS server: istiod.istio-system.svc:15012\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-03-21T11:42:49.235363Z     info    xdsproxy        connected to upstream XDS server: istiod.istio-system.svc:15012\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-03-21T11:52:20.947Z"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"- - -"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" UF,URX - - "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(" - "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"151.101.65.67:443"')]),t._v(" outbound"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v("edition.cnn.com - "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".1.4:8443 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".1.20:33384 edition.cnn.com -\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-03-21T11:52:28.733Z"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"- - -"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" - - - "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("910")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1262165")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("45829")]),t._v(" - "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"151.101.193.67:443"')]),t._v(" outbound"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v("edition.cnn.com "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".1.4:49136 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".1.4:8443 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".1.20:33440 edition.cnn.com -\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-03-21T12:15:16.256967Z     info    xdsproxy        connected to upstream XDS server: istiod.istio-system.svc:15012\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-03-21T12:45:27.104242Z     info    xdsproxy        connected to upstream XDS server: istiod.istio-system.svc:15012\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-03-21T13:06:35.033Z"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET /politics HTTP/2"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("301")]),t._v(" - via_upstream - "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("356")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("356")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"10.244.1.20"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"curl/7.81.0-DEV"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"82a2b1d1-70f0-9907-bfc3-1a86cfd91721"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"edition.cnn.com"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"151.101.129.67:80"')]),t._v(" outbound"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v("edition.cnn.com "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".1.4:47896 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".1.4:8080 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".1.20:42962 - -\n")])])]),s("h4",{attrs:{id:"æ¸…ç†httpç½‘å…³"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ¸…ç†httpç½‘å…³"}},[t._v("#")]),t._v(" æ¸…ç†HTTPç½‘å…³")]),t._v(" "),s("p",[t._v("åœ¨ç»§ç»­ä¸‹ä¸€æ­¥ä¹‹å‰åˆ é™¤ä»¥å‰çš„å®šä¹‰ï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl delete gateway istio-egressgateway\n$ kubectl delete serviceentry cnn\n$ kubectl delete virtualservice direct-cnn-through-egress-gateway\n$ kubectl delete destinationrule egressgateway-for-cnn\n")])])]),s("h4",{attrs:{id:"httpsæµé‡çš„å‡ºå£ç½‘å…³"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#httpsæµé‡çš„å‡ºå£ç½‘å…³"}},[t._v("#")]),t._v(" HTTPSæµé‡çš„å‡ºå£ç½‘å…³")]),t._v(" "),s("p",[t._v("åœ¨æœ¬èŠ‚ä¸­ï¼Œæ‚¨å°†é€šè¿‡å‡ºå£ç½‘å…³å¼•å¯¼ HTTPS æµé‡ï¼ˆç”±åº”ç”¨ç¨‹åºå‘èµ·çš„ TLSï¼‰ã€‚æ‚¨éœ€è¦"),s("code",[t._v("TLS")]),t._v("åœ¨ä¸€ä¸ªå¯¹åº”"),s("code",[t._v("ServiceEntry")]),t._v("çš„ã€ä¸€ä¸ªå‡ºå£"),s("code",[t._v("Gateway")]),t._v("å’Œä¸€ä¸ª"),s("code",[t._v("VirtualService")]),t._v(".")]),t._v(" "),s("ol",[s("li",[s("code",[t._v("ServiceEntry")]),t._v("ä¸ºå®šä¹‰ä¸€ä¸ª"),s("code",[t._v("edition.cnn.com")]),t._v("ï¼š\n"),s("ul",[s("li",[s("code",[t._v("é…ç½®æœåŠ¡å…¥å£çš„ä¸»æœºåˆ—è¡¨ä¸º edition.cnn.com")])]),t._v(" "),s("li",[s("code",[t._v("é…ç½®portsè§„åˆ™ä¸ºTLSæ¨¡å¼ä»¥åŠ443ç«¯å£")])]),t._v(" "),s("li",[s("code",[t._v("é…ç½®ä¸»æœºå‘ç°æ¨¡å¼ä¸ºDNS")])])])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" <<EOF\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ServiceEntry\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cnn\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" edition.cnn.com\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("number")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" tls\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" TLS\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resolution")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" DNS\nEOF\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[s("a",{attrs:{href:"https://edition.cnn.com/politics",target:"_blank",rel:"noopener noreferrer"}},[t._v("é€šè¿‡å‘https://edition.cnn.com/politics"),s("OutboundLink")],1),s("code",[t._v("ServiceEntry")]),t._v("å‘é€ HTTPS è¯·æ±‚æ¥éªŒè¯æ‚¨çš„åº”ç”¨æ˜¯å¦æ­£ç¡®ã€‚")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SOURCE_POD")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),t._v(" -- "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-sSL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" /dev/null "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-D")]),t._v(" - https://edition.cnn.com/politics\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nHTTP/2 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v("\nContent-Type: text/html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("charset")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf-8\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[s("code",[t._v("Gateway")]),t._v("ä¸º"),s("em",[t._v("edition.cnn.com")]),t._v("åˆ›å»ºä¸€ä¸ªå‡ºå£ã€ä¸€ä¸ªç›®æ ‡è§„åˆ™å’Œä¸€ä¸ªè™šæ‹ŸæœåŠ¡ï¼Œä»¥å¼•å¯¼æµé‡é€šè¿‡å‡ºå£ç½‘å…³å¹¶ä»å‡ºå£ç½‘å…³åˆ°å¤–éƒ¨æœåŠ¡ã€‚\n"),s("ul",[s("li",[s("code",[t._v("åˆ›å»ºæœåŠ¡ç½‘å…³å’Œç›®æ ‡è§„åˆ™ä»¥åŠè™šæ‹ŸæœåŠ¡")])]),t._v(" "),s("li",[s("code",[t._v("é…ç½®Gatewayä½¿ç”¨egressgatewayçš„å‡ºå£ç½‘å…³,æœåŠ¡è§„åˆ™ä¸ºå…è®¸443ç«¯å£ä½¿ç”¨TLS")])]),t._v(" "),s("li",[s("code",[t._v("Gatewayå…è®¸çš„ä¸»æœºä¸º edition.cnn.com tlsçš„æ¨¡å¼ä½¿ç”¨PASSTHROUGH")])]),t._v(" "),s("li",[s("code",[t._v("é…ç½®ç›®æ ‡è§„åˆ™å…è®¸çš„ä¸»æœºåˆ—è¡¨istio-egressgateway.istio-system.svc.cluster.local å­é›†ä¸ºcnn")])]),t._v(" "),s("li",[s("code",[t._v("é…ç½®è™šæ‹ŸæœåŠ¡å…è®¸ä¸»æœºåˆ—è¡¨ä¸ºedition.cnn.com")])]),t._v(" "),s("li",[s("code",[t._v("é…ç½®è™šæ‹ŸæœåŠ¡ä½¿ç”¨å‡ºå£ç½‘å…³istio-egressgatewayå’Œmesh")])]),t._v(" "),s("li",[s("code",[t._v("é…ç½®è™šæ‹ŸæœåŠ¡çš„meshç½‘å…³è¦åŒ¹é…çš„SNIï¼ˆæœåŠ¡å™¨åç§°æŒ‡ç¤ºå™¨ï¼‰edition.cnn.com å…è®¸443ç«¯å£")])]),t._v(" "),s("li",[s("code",[t._v("é…ç½®è™šæ‹ŸæœåŠ¡çš„meshç½‘å…³ç›®æ ‡è§„åˆ™å…è®¸ä¸»æœºåˆ—è¡¨istio-egressgateway.istio-system.svc.cluster.localå¹¶ä¸”å…è®¸443ç«¯å£")])]),t._v(" "),s("li",[s("code",[t._v("é…ç½®è™šæ‹ŸæœåŠ¡çš„istio-egressgatewayç½‘å…³è¦åŒ¹é…çš„SNIï¼ˆæœåŠ¡å™¨åç§°æŒ‡ç¤ºå™¨ï¼‰edition.cnn.com å…è®¸443ç«¯å£")])]),t._v(" "),s("li",[s("code",[t._v("é…ç½®è™šæ‹ŸæœåŠ¡çš„istio-egressgatewayç½‘å…³ç›®æ ‡è§„åˆ™å…è®¸ä¸»æœºåˆ—è¡¨edition.cnn.comå¹¶ä¸”å…è®¸443ç«¯å£ã€æƒé‡ä¸º100")])])])])]),t._v(" "),s("blockquote",[s("p",[t._v("è¦é€šè¿‡å‡ºå£ç½‘å…³å¼•å¯¼å¤šä¸ªä¸»æœºï¼Œæ‚¨å¯ä»¥"),s("code",[t._v("*")]),t._v("åœ¨"),s("code",[t._v("Gateway")]),t._v(". åº”å°† ä¸­çš„"),s("code",[t._v("subset")]),t._v("å­—æ®µé‡æ–°ç”¨äºå…¶ä»–ä¸»æœºã€‚"),s("code",[t._v("DestinationRule")])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" <<EOF\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Gateway\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" istio"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("egressgateway\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("istio")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" egressgateway\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("servers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("number")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" tls\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" TLS\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" edition.cnn.com\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tls")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PASSTHROUGH\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" DestinationRule\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" egressgateway"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("for"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cnn\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" istio"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("egressgateway.istio"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("system.svc.cluster.local\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subsets")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cnn\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.istio.io/v1alpha3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" VirtualService\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" direct"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cnn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("through"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("egress"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("gateway\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" edition.cnn.com\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gateways")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" mesh\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" istio"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("egressgateway\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tls")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("match")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gateways")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" mesh\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("sniHosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" edition.cnn.com\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" istio"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("egressgateway.istio"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("system.svc.cluster.local\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subset")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cnn\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("number")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("match")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gateways")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" istio"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("egressgateway\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("sniHosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" edition.cnn.com\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" edition.cnn.com\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("number")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("weight")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("\nEOF\n")])])]),s("ol",{attrs:{start:"4"}},[s("li",[s("a",{attrs:{href:"https://edition.cnn.com/politics",target:"_blank",rel:"noopener noreferrer"}},[t._v("å‘https://edition.cnn.com/politics"),s("OutboundLink")],1),t._v("å‘é€ HTTPS è¯·æ±‚ã€‚è¾“å‡ºåº”è¯¥å’Œä»¥å‰ä¸€æ ·ã€‚")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SOURCE_POD")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),t._v(" -- "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-sSL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" /dev/null "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-D")]),t._v(" - https://edition.cnn.com/politics\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nHTTP/2 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v("\nContent-Type: text/html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("charset")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf-8\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])])]),s("ol",{attrs:{start:"5"}},[s("li",[t._v("æŸ¥çœ‹å‡ºå£ç½‘å…³ä»£ç†çš„æ—¥å¿—ã€‚å¦‚æœ Istio éƒ¨ç½²åœ¨"),s("code",[t._v("istio-system")]),t._v("å‘½åç©ºé—´ä¸­ï¼Œæ‰“å°æ—¥å¿—çš„å‘½ä»¤æ˜¯ï¼š")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl logs -l istio=egressgateway -n istio-system")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-03-21T11:52:28.733Z"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"- - -"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" - - - "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("910")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1262165")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("45829")]),t._v(" - "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"151.101.193.67:443"')]),t._v(" outbound"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v("edition.cnn.com "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".1.4:49136 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".1.4:8443 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".1.20:33440 edition.cnn.com -\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-03-21T12:15:16.256967Z     info    xdsproxy        connected to upstream XDS server: istiod.istio-system.svc:15012\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-03-21T12:45:27.104242Z     info    xdsproxy        connected to upstream XDS server: istiod.istio-system.svc:15012\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-03-21T13:06:35.033Z"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET /politics HTTP/2"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("301")]),t._v(" - via_upstream - "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("356")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("356")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"10.244.1.20"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"curl/7.81.0-DEV"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"82a2b1d1-70f0-9907-bfc3-1a86cfd91721"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"edition.cnn.com"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"151.101.129.67:80"')]),t._v(" outbound"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v("edition.cnn.com "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".1.4:47896 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".1.4:8080 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".1.20:42962 - -\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-03-21T13:15:59.020699Z     info    xdsproxy        connected to upstream XDS server: istiod.istio-system.svc:15012\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-03-21T13:40:14.303559Z     info    ads     XDS: Incremental Pushing:0 ConnectedEndpoints:2 Version:\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-03-21T13:40:14.597921Z     info    cache   generated new workload certificate   "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("latency")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("294")]),t._v(".218007ms "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ttl")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("23h59m59.402089572s\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-03-21T13:40:14.598006Z     info    ads     SDS: PUSH "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" node:istio-egressgateway-7f4864f59c-q5cdv.istio-system resources:1 size:4.0kB resource:default\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-03-21T13:47:00.985263Z     info    xdsproxy        connected to upstream XDS server: istiod.istio-system.svc:15012\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-03-21T14:18:49.713637Z     info    xdsproxy        connected to upstream XDS server: istiod.istio-system.svc:15012\n")])])]),s("h4",{attrs:{id:"æ¸…ç†httpsç½‘å…³"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ¸…ç†httpsç½‘å…³"}},[t._v("#")]),t._v(" æ¸…ç†HTTPSç½‘å…³")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl delete serviceentry cnn\n$ kubectl delete gateway istio-egressgateway\n$ kubectl delete virtualservice direct-cnn-through-egress-gateway\n$ kubectl delete destinationrule egressgateway-for-cnn\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);