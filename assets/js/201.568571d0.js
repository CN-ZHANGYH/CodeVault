(window.webpackJsonp=window.webpackJsonp||[]).push([[201],{515:function(s,t,a){"use strict";a.r(t);var n=a(7),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"ansible部署主从数据库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ansible部署主从数据库"}},[s._v("#")]),s._v(" Ansible部署主从数据库")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("节点")]),s._v(" "),t("th",[s._v("IP")]),s._v(" "),t("th",[s._v("主机名")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("ansible")]),s._v(" "),t("td",[s._v("172.25.253.137")]),s._v(" "),t("td",[s._v("ansible")])]),s._v(" "),t("tr",[t("td",[s._v("master")]),s._v(" "),t("td",[s._v("172.25.253.140")]),s._v(" "),t("td",[s._v("master")])]),s._v(" "),t("tr",[t("td",[s._v("slave")]),s._v(" "),t("td",[s._v("172.25.253.139")]),s._v(" "),t("td",[s._v("slave")])])])]),s._v(" "),t("blockquote",[t("h3",{attrs:{id:"查看当前的文件树"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看当前的文件树"}},[s._v("#")]),s._v(" 查看当前的文件树")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible ansible"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tree role/")]),s._v("\nrole/\n├── mariadb.yaml\n├── master\n│   ├── "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("\n│   │   ├── hosts\n│   │   └── local.repo\n│   ├── tasks\n│   │   ├── main.yaml\n│   │   ├── mariadb.yaml\n│   │   └── master.yaml\n│   └── templates\n│       ├── server.cnf1.j2\n│       └── server.cnf2.j2\n└── slave\n    └──  tasks\n        ├── main.yaml\n        └── slave.yaml\n  \n")])])]),t("blockquote",[t("h3",{attrs:{id:"配置ansible的hosts"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置ansible的hosts"}},[s._v("#")]),s._v(" 配置ansible的hosts")])]),s._v(" "),t("h4",{attrs:{id:"_1-添加主机清单-变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-添加主机清单-变量"}},[s._v("#")]),s._v(" 1."),t("strong",[s._v("添加主机清单 变量")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible ansible"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/ansible/hosts ")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("server"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.25")]),s._v(".253.140 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("masterip")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("140")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.25")]),s._v(".253.139 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("slaveip")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("139")]),s._v("\n")])])]),t("h4",{attrs:{id:"_2-创建master和slave角色"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-创建master和slave角色"}},[s._v("#")]),s._v(" 2."),t("strong",[s._v("创建master和slave角色")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir -p ansible/role/{master,slave}")]),s._v("\n")])])]),t("blockquote",[t("h3",{attrs:{id:"创建角色需要的文件夹和文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建角色需要的文件夹和文件"}},[s._v("#")]),s._v(" 创建角色需要的文件夹和文件")])]),s._v(" "),t("h4",{attrs:{id:"_3-master和slave创建目录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-master和slave创建目录"}},[s._v("#")]),s._v(" "),t("strong",[s._v("3.master和slave创建目录")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd ansible/role/master/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible master"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir file tasks templates ")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd ansible/role/slave/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible master"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir  tasks ")]),s._v("\n")])])]),t("h4",{attrs:{id:"_4-创建master的相关文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-创建master的相关文件"}},[s._v("#")]),s._v(" "),t("strong",[s._v("4.创建master的相关文件")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible master"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tree file/")]),s._v("\nfile/\n├── hosts\n├── local.repo\n└── server.cnf\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible master"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tree tasks/")]),s._v("\ntasks/\n├── main.yaml\n├── mariadb.yaml\n└── master.yaml\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible master"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tree templates/")]),s._v("\ntemplates/\n├── server.cnf\n├── server.cnf1.j2\n└── server.cnf2.j2\n")])])]),t("h4",{attrs:{id:"_5-创建slave的task文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-创建slave的task文件"}},[s._v("#")]),s._v(" "),t("strong",[s._v("5.创建slave的task文件")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible slave"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tree tasks/")]),s._v("\ntasks/\n├── main.yaml\n└── slave.yaml\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" directories, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" files\n")])])]),t("blockquote",[t("h3",{attrs:{id:"playbook的详细介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#playbook的详细介绍"}},[s._v("#")]),s._v(" playbook的详细介绍")])]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("master角色负责两个节点的配置hosts、配置yum源、安装软件、修改配置文件、授权")])]),s._v(" "),t("li",[t("strong",[s._v("slave角色负责slave节点的加入从节点操作")])]),s._v(" "),t("li",[t("strong",[s._v("复制hosts和local.repo文件到master角色的file目录")])])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible file"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll")]),s._v("\ntotal "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("\n-rw-r--r-- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("203")]),s._v(" Oct "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":26 hosts\n-rw-r--r-- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("76")]),s._v(" Oct "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(":14 local.repo\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible file"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat hosts ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.25")]),s._v(".253.140 master \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.25")]),s._v(".253.139 slave\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible file"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat local.repo  ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("centos"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("centos \n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("baseurl")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://172.25.253.144/file/centos/\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gpgcheck")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])])]),t("ul",[t("li",[t("strong",[s._v("查看tasks")])])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible tasks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll")]),s._v("\ntotal "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("\n-rw-r--r-- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("49")]),s._v(" Oct "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":14 main.yaml\n-rw-r--r-- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("653")]),s._v(" Oct "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":29 mariadb.yaml\n-rw-r--r-- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("329")]),s._v(" Oct "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":34 master.yaml\n")])])]),t("blockquote",[t("h3",{attrs:{id:"编写master的tasks"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编写master的tasks"}},[s._v("#")]),s._v(" 编写Master的tasks")])]),s._v(" "),t("h4",{attrs:{id:"_6-编写master的清单列表"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-编写master的清单列表"}},[s._v("#")]),s._v(" 6.编写master的清单列表")]),s._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible tasks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat  mariadb.yaml ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" copy hosts \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("copy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" src=./file/hosts dest=/etc/hosts\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" delete repo \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("shell")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rm "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rf /etc/yum.repos.d/*\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" copy repo \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("copy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" src=./file/local.repo dest=/etc/yum.repos.d/local.repo \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" install mariadb \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("yum")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" mariadb\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" mariadb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server \n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("state")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" present \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" copy config1 \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" src=server.cnf1.j2 dest=/etc/my.cnf.d/server.cnf \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("when")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(' ansible_fqdn == "master"\n'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" copy config2\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" src=server.cnf2.j2 dest=/etc/my.cnf.d/server.cnf\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("when")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(' ansible_fqdn == "slave"\n'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" start  mariadb\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("service")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" name=mariadb state=started \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql password \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("shell")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysqladmin "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("uroot password 000000\n")])])]),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible tasks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat master.yaml  ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" grant privileges\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("shell")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("uroot "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p000000 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('e " grant all privileges on '),t("span",{pre:!0,attrs:{class:"token important"}},[s._v("*.*")]),s._v(" to root@'%' identified by '000000';\"\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("when")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(' ansible_fqdn == "master"\n'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" grant replication\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("shell")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("uroot "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p000000 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('e " grant replication slave on '),t("span",{pre:!0,attrs:{class:"token important"}},[s._v("*.*")]),s._v(" to 'user'@'slave' identified by '000000';\"\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("when")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(' ansible_fqdn == "master" \n')])])]),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible tasks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat main.yaml  ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("include")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mariadb.yaml \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("include")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" master.yaml \n")])])]),t("blockquote",[t("h3",{attrs:{id:"使用变量修改两个配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用变量修改两个配置文件"}},[s._v("#")]),s._v(" 使用变量修改两个配置文件")])]),s._v(" "),t("h4",{attrs:{id:"_7-修改两个配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-修改两个配置文件"}},[s._v("#")]),s._v(" 7.修改两个配置文件")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("本地安装mariadb，复制/etc/my.cnf.d/server.cnf到templates目录命名为j2的文件")])])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible templates"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll")]),s._v("\ntotal "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n-rw-r--r-- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("816")]),s._v(" Oct "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(":50 server.cnf1.j2\n-rw-r--r-- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("815")]),s._v(" Oct "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(":50 server.cnf2.j2\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible templates"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat server.cnf1.j2 ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# These groups are read by MariaDB server.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Use it for options that only the server (but not clients) should see")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# See the examples of server my.cnf files in /usr/share/mysql/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# this is read by the standalone daemon and embedded servers")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("server"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# this is only for the mysqld standalone daemon")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nlog_bin "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" mysql-bin\nbinlog_ignore_db "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" mysql\nserver_id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" masterip "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible templates"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat server.cnf2.j2 ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# These groups are read by MariaDB server.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Use it for options that only the server (but not clients) should see")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# See the examples of server my.cnf files in /usr/share/mysql/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# this is read by the standalone daemon and embedded servers")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("server"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# this is only for the mysqld standalone daemon")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nlog_bin "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" mysql-bin\nbinlog_ignore_db "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" mysql\nserver_id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" slaveip "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("blockquote",[t("h3",{attrs:{id:"编写slave的tasks"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编写slave的tasks"}},[s._v("#")]),s._v(" 编写Slave的tasks")])]),s._v(" "),t("h4",{attrs:{id:"_8-编写slave角色的清单"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-编写slave角色的清单"}},[s._v("#")]),s._v(" 8.编写slave角色的清单")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible role"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd slave/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible slave"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll")]),s._v("\ntotal "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("41")]),s._v(" Oct "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":40 tasks\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible tasks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll")]),s._v("\ntotal "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n-rw-r--r-- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(" Oct "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":18 main.yaml\n-rw-r--r-- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("268")]),s._v(" Oct "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":23 slave.yaml\n")])])]),t("h4",{attrs:{id:"_9-编写清单"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-编写清单"}},[s._v("#")]),s._v(" 9.编写清单")]),s._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible tasks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat slave.yaml  ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" start slave \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("shell")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("uroot "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p000000 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("e \"change master to master_host='master'"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_user='user'"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_password='000000';\"\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("when")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(' ansible_fqdn == "slave"\n'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" slave \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("shell")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("uroot "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p000000 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('e "start slave;"\n  '),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("when")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(' ansible_fqdn == "slave"\n'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible tasks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat  main.yaml ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("include")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" slave.yaml \n")])])]),t("blockquote",[t("h3",{attrs:{id:"编写role的playbook"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编写role的playbook"}},[s._v("#")]),s._v(" 编写Role的playbook")])]),s._v(" "),t("h4",{attrs:{id:"_10-在role的目录下编写剧本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_10-在role的目录下编写剧本"}},[s._v("#")]),s._v(" 10.在role的目录下编写剧本")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("该剧本使用role角色调用")])])]),s._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible role"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll")]),s._v("\ntotal 4\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rw"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 1 root root 86 Oct 12 22"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("20 mariadb.yaml\ndrwxr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("xr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("x 6 root root 60 Oct 12 21"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("52 master\ndrwxr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("xr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("x 4 root root 31 Oct 13 11"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("16 slave\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible role"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat mariadb.yaml  ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" server \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("remote_user")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" root \n\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("roles")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("role")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" master \n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("role")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" slave\n")])])]),t("h4",{attrs:{id:"_11-执行脚本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_11-执行脚本"}},[s._v("#")]),s._v(" 11.执行脚本")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible role"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ansible-playbook mariadb.yaml  ")]),s._v("\n\nPLAY "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("server"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" ********************************************************************************************************\n\nTASK "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Gathering Facts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" ***********************************************************************************************\nok: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.25")]),s._v(".253.139"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nok: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.25")]),s._v(".253.140"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nTASK "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("master "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" copy hosts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" *******************************************************************************************\nok: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.25")]),s._v(".253.139"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nok: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.25")]),s._v(".253.140"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n·\n·\n·\nPLAY RECAP ***********************************************************************************************************\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.25")]),s._v(".253.139             "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ok")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("changed")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("unreachable")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("failed")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("skipped")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rescued")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ignored")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.25")]),s._v(".253.140             "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ok")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("changed")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("unreachable")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("failed")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("skipped")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rescued")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ignored")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   \n")])])]),t("h4",{attrs:{id:"_12-检查集群是否正常"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_12-检查集群是否正常"}},[s._v("#")]),s._v(" 12.检查集群是否正常")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible role"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ansible  server  -m shell  -a \"mysql -uroot -p000000 -e 'show slave status\\G'\"")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.25")]),s._v(".253.140 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" CHANGED "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rc")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.25")]),s._v(".253.139 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" CHANGED "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rc")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v("\n*************************** "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(". row ***************************\n               Slave_IO_State: Waiting "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" master to send event\n                  Master_Host: master\n                  Master_User: user\n                  Master_Port: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("\n                Connect_Retry: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v("\n              Master_Log_File: mysql-bin.000003\n          Read_Master_Log_Pos: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("666")]),s._v("\n               Relay_Log_File: mariadb-relay-bin.000004\n                Relay_Log_Pos: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("950")]),s._v("\n        Relay_Master_Log_File: mysql-bin.000003\n             Slave_IO_Running: Yes\n            Slave_SQL_Running: Yes\n              Replicate_Do_DB: \n          Replicate_Ignore_DB: \n           Replicate_Do_Table: \n       Replicate_Ignore_Table: \n      Replicate_Wild_Do_Table: \n  Replicate_Wild_Ignore_Table: \n                   Last_Errno: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n                   Last_Error: \n                 Skip_Counter: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n          Exec_Master_Log_Pos: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("666")]),s._v("\n              Relay_Log_Space: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1530")]),s._v("\n              Until_Condition: None\n               Until_Log_File: \n                Until_Log_Pos: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n           Master_SSL_Allowed: No\n           Master_SSL_CA_File: \n           Master_SSL_CA_Path: \n              Master_SSL_Cert: \n            Master_SSL_Cipher: \n               Master_SSL_Key: \n        Seconds_Behind_Master: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nMaster_SSL_Verify_Server_Cert: No\n                Last_IO_Errno: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n                Last_IO_Error: \n               Last_SQL_Errno: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n               Last_SQL_Error: \n  Replicate_Ignore_Server_Ids: \n             Master_Server_Id: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("140")]),s._v("\n")])])])])}),[],!1,null,null,null);t.default=e.exports}}]);