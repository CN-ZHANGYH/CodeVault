(window.webpackJsonp=window.webpackJsonp||[]).push([[162],{476:function(t,s,a){"use strict";a.r(s);var e=a(7),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"k8s集群部署与安全配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#k8s集群部署与安全配置"}},[t._v("#")]),t._v(" K8S集群部署与安全配置")]),t._v(" "),s("h3",{attrs:{id:"主要内容"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#主要内容"}},[t._v("#")]),t._v(" 主要内容")]),t._v(" "),s("p",[t._v("❖ K8s安全运维概述")]),t._v(" "),s("p",[t._v("❖ 部署一套完整的K8s高可用集群")]),t._v(" "),s("p",[t._v("❖ CIS 安全基准介绍与K8s安全基准工具kube-bench")]),t._v(" "),s("p",[t._v("❖ Ingress 配置证书")]),t._v(" "),s("p",[t._v("❖ 网络策略控制集群内部网络通信")]),t._v(" "),s("h3",{attrs:{id:"k8s安全运维概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#k8s安全运维概述"}},[t._v("#")]),t._v(" K8s安全运维概述")]),t._v(" "),s("ul",[s("li",[t._v("安全运维的重要性")]),t._v(" "),s("li",[t._v("SecDevOps")]),t._v(" "),s("li",[t._v("K8s提供的安全机制")]),t._v(" "),s("li",[t._v("K8s安全运维实践思路")])]),t._v(" "),s("h3",{attrs:{id:"安全运维的重要性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安全运维的重要性"}},[t._v("#")]),t._v(" 安全运维的重要性")]),t._v(" "),s("ul",[s("li",[t._v("万物互联，安全为基，企业的网络安全不可小视")]),t._v(" "),s("li",[t._v("服务器被黑事件频发")]),t._v(" "),s("li",[t._v("公司重要数据资产在运维手中")])]),t._v(" "),s("h3",{attrs:{id:"secdevops"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#secdevops"}},[t._v("#")]),t._v(" SecDevOps")]),t._v(" "),s("p",[t._v("SecDevOps与DevOps相似，是一种哲学，鼓励运维人员、开发 人员、测试人员和安全人员进行更高水水平协作，将信息安全被放 在事前考虑，将安全性注入自动化流程中，以确保整个产品周期内 的信息安全。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204111435904.png",alt:"image-20220411143502253"}})]),t._v(" "),s("h3",{attrs:{id:"k8s提供的安全机制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#k8s提供的安全机制"}},[t._v("#")]),t._v(" K8s提供的安全机制")]),t._v(" "),s("p",[t._v("为了保证集群以及容器应用的安全，Kubernetes 提供了多 种安全机制，限制容器的行为，减少容器和集群的攻击面， 保证整个系统的安全性。")]),t._v(" "),s("ol",[s("li",[t._v("**集群安全：**TLS证书认证、RBAC")]),t._v(" "),s("li",[t._v("**Security Context：**限制容器的行为，例如只读文件系统、特权、运行用户等")]),t._v(" "),s("li",[t._v("**Pod Security Policy：**集群级的 Pod 安全策略，自动为集群内的 Pod 配置安全策略")]),t._v(" "),s("li",[t._v("**Sysctls：**允许容器设置内核参数")]),t._v(" "),s("li",[t._v("**AppArmor：**限制容器中应用对资源的访问权限")]),t._v(" "),s("li",[t._v("**Network Policies：**控制集群中网络通信")]),t._v(" "),s("li",[t._v("**Seccomp：**限制容器内进程的系统调用")])]),t._v(" "),s("h3",{attrs:{id:"k8s安全运维实践思路"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#k8s安全运维实践思路"}},[t._v("#")]),t._v(" K8s安全运维实践思路")]),t._v(" "),s("img",{staticStyle:{zoom:"80%"},attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204151113618.png",alt:"image-20220411143733252"}}),t._v(" "),s("h3",{attrs:{id:"cis-安全基准"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cis-安全基准"}},[t._v("#")]),t._v(" CIS 安全基准")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("CIS安全基准介绍")])]),t._v(" "),s("li",[s("code",[t._v("K8s安全基准工具 kube-bench")])])]),t._v(" "),s("h4",{attrs:{id:"cis安全基准"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cis安全基准"}},[t._v("#")]),t._v(" CIS安全基准")]),t._v(" "),s("p",[t._v("互联网安全中心（CIS，Center for Internet Security），是一个非盈利组织，致力为互联网提供 免费的安全防御解决方案。")]),t._v(" "),s("p",[t._v("官网：https://www.cisecurity.org/")]),t._v(" "),s("p",[t._v("Kubernetes CIS基准：https://www.cisecurity.org/benchmark/kubernetes/")]),t._v(" "),s("h4",{attrs:{id:"cis基准测试工具"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cis基准测试工具"}},[t._v("#")]),t._v(" CIS基准测试工具")]),t._v(" "),s("p",[t._v("Kube-bench是容器安全厂商Aquq推出的工具，以CIS K8s基准作为基础，来检查K8s是否安全部署。 主要查找不安全的配置参数、敏感的文件权限、不安全的帐户或公开端口等等。")]),t._v(" "),s("p",[t._v("项目地址：https://github.com/aquasecurity/kube-bench")]),t._v(" "),s("h4",{attrs:{id:"kube-beach部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kube-beach部署"}},[t._v("#")]),t._v(" kube-beach部署")]),t._v(" "),s("p",[s("strong",[t._v("1、下载二进制包")])]),t._v(" "),s("p",[t._v("https://github.com/aquasecurity/kube-bench/releases")]),t._v(" "),s("p",[s("strong",[t._v("2、解压使用")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01:~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# tar zxvf kube-bench_0.6.3_linux_amd64.tar.gz ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01:~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mkdir /etc/kube-bench \t\t\t# 创建默认配置文件路径")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01:~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mv cfg /etc/kube-bench/cfg")]),t._v("\n")])])]),s("p",[s("strong",[t._v("3、kube-beach使用")])]),t._v(" "),s("p",[t._v("使用kube-bench run进行测试，该指令有以下常用参数：")]),t._v(" "),s("p",[t._v("常用参数：")]),t._v(" "),s("ul",[s("li",[s("strong",[s("code",[t._v("-s, --targets")])]),t._v("  指定要基础测试的目标，这个目标需要匹配cfg/中的 文件名称，已有目标：master, controlplane, node, etcd, policies")]),t._v(" "),s("li",[s("strong",[s("code",[t._v("--version：")])]),t._v(" 指定k8s版本，如果未指定会自动检测")]),t._v(" "),s("li",[t._v("**"),s("code",[t._v("--benchmark：")]),t._v("**手动指定CIS基准版本，不能与--version一起使用")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204111504870.png",alt:"image-20220411150422457"}})]),t._v(" "),s("p",[s("strong",[t._v("4、运行kube-beach")])]),t._v(" "),s("p",[s("code",[t._v("检查master组件安全配置，需要指定当前的cis目录。")])]),t._v(" "),s("p",[t._v("**[PASS]：**测试通过")]),t._v(" "),s("p",[t._v("**[FAIL]：**测试未通过，重点关注，在测试结果会给出修复建议")]),t._v(" "),s("p",[t._v("**[WARN]：**警告，可做了解")]),t._v(" "),s("p",[t._v("**[INFO]：**信息")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01:~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cd cfg/")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01:~/cfg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kube-bench run master --config-dir .")]),t._v("\n···\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" Summary policies "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" checks PASS\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" checks FAIL\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),t._v(" checks WARN\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" checks INFO\n\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" Summary total "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("68")]),t._v(" checks PASS\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v(" checks FAIL\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("41")]),t._v(" checks WARN\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" checks INFO\n")])])]),s("p",[t._v("如下是检查后需要建议修复的地方")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204111515804.png",alt:"image-20220411151549372"}})]),t._v(" "),s("p",[t._v("kube-beach工具将会给出修改建议的方案，可以参考做修改：")]),t._v(" "),s("ul",[s("li",[t._v("1.2.16的建议是： "),s("strong",[s("code",[t._v("开启Pod安全策略准入控制器")])])]),t._v(" "),s("li",[t._v("1.2.22的建议是： "),s("strong",[s("code",[t._v("开启日志审计的数据存放路径")])])]),t._v(" "),s("li",[t._v("1.2.23的建议是： "),s("strong",[s("code",[t._v("设置日志最大页数为30")])])]),t._v(" "),s("li",[t._v("1.2.24的建议是： "),s("strong",[s("code",[t._v("设置日志最大的备份数为10")])])]),t._v(" "),s("li",[t._v("1.2.25的建议是： "),s("strong",[s("code",[t._v("设置日志的大小为100M")])])]),t._v(" "),s("li",[t._v("1.2.26的建议是： "),s("strong",[s("code",[t._v("设置请求超时为300s")])])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.2")]),t._v(".16 Follow the documentation and create Pod Security Policy objects as per your environment.\nThen, edit the API server pod specification "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" /etc/kubernetes/manifests/kube-apiserver.yaml\non the master "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("node")]),t._v(" and "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" the --enable-admission-plugins parameter to a\nvalue that includes PodSecurityPolicy:\n--enable-admission-plugins"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".,PodSecurityPolicy,"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nThen restart the API Server.\n\n\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.2")]),t._v(".22 Edit the API server pod specification "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" /etc/kubernetes/manifests/kube-apiserver.yaml\non the master "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("node")]),t._v(" and "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" the --audit-log-path parameter to a suitable path and\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" where you would like audit logs to be written, "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" example:\n--audit-log-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/var/log/apiserver/audit.log\n\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.2")]),t._v(".23 Edit the API server pod specification "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" /etc/kubernetes/manifests/kube-apiserver.yaml\non the master "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("node")]),t._v(" and "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" the --audit-log-maxage parameter to "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v(" or as an appropriate number of days:\n--audit-log-maxage"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.2")]),t._v(".24 Edit the API server pod specification "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" /etc/kubernetes/manifests/kube-apiserver.yaml\non the master "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("node")]),t._v(" and "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" the --audit-log-maxbackup parameter to "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" or to an appropriate\nvalue.\n--audit-log-maxbackup"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.2")]),t._v(".25 Edit the API server pod specification "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" /etc/kubernetes/manifests/kube-apiserver.yaml\non the master "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("node")]),t._v(" and "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" the --audit-log-maxsize parameter to an appropriate size "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" MB.\nFor example, to "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" it as "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v(" MB:\n--audit-log-maxsize"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.2")]),t._v(".26 Edit the API server pod specification "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" /etc/kubernetes/manifests/kube-apiserver.yaml\nand "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" the below parameter as appropriate and "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" needed.\nFor example,\n--request-timeout"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("300s\n")])])]),s("p",[t._v("按照1.2.16建议我们修改之后再次检查：")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("enable"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("admission"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("plugins=NodeRestriction"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("PodSecurityPolicy\n")])])]),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204151355608.png",alt:"image-20220411152909508"}})]),t._v(" "),s("h3",{attrs:{id:"ingress配置证书"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ingress配置证书"}},[t._v("#")]),t._v(" Ingress配置证书")]),t._v(" "),s("ul",[s("li",[s("strong",[s("code",[t._v("Ingress是什么")])])]),t._v(" "),s("li",[s("strong",[s("code",[t._v("HTTPS重要性")])])]),t._v(" "),s("li",[s("strong",[s("code",[t._v("将一个项目对外暴露HTTPS访问")])])])]),t._v(" "),s("h4",{attrs:{id:"ingress是什么"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ingress是什么"}},[t._v("#")]),t._v(" Ingress是什么？")]),t._v(" "),s("p",[t._v("Ingress：K8s中的一个抽象资源，给管理员 提供一个暴露应用的入口定义方法")]),t._v(" "),s("p",[t._v("Ingress Controller：根据Ingress生成具体 的路由规则，并对Pod负载均衡器")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204111537973.png",alt:"image-20220411153701818"}})]),t._v(" "),s("h4",{attrs:{id:"https重要性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#https重要性"}},[t._v("#")]),t._v(" HTTPS重要性")]),t._v(" "),s("p",[t._v("HTTPS是安全的HTTP，HTTP 协议中的内容都是明文传输，HTTPS 的目的是将这 些内容加密，确保信息传输安全。最后一个字母 S 指的是 SSL/TLS 协议，它位于 HTTP 协议与 TCP/IP 协议中间。")]),t._v(" "),s("p",[t._v("HTTPS优势：")]),t._v(" "),s("ol",[s("li",[s("code",[t._v("加密隐私数据：")]),t._v("防止您访客的隐私信息(账号、地址、手机号等)被劫持或窃取。")]),t._v(" "),s("li",[s("code",[t._v("安全身份认证：")]),t._v("验证网站的真实性，防止钓鱼网站。")]),t._v(" "),s("li",[s("code",[t._v("防止网页篡改：")]),t._v("防止数据在传输过程中被篡改，保护用户体验。")]),t._v(" "),s("li",[s("code",[t._v("地址栏安全锁：")]),t._v("地址栏头部的“锁”型图标，提高用户信任度。")]),t._v(" "),s("li",[s("code",[t._v("提高SEO排名：")]),t._v("提高搜索排名顺序，为企业带来更多访问量。")])]),t._v(" "),s("h4",{attrs:{id:"将一个项目对外暴露https访问"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#将一个项目对外暴露https访问"}},[t._v("#")]),t._v(" 将一个项目对外暴露HTTPS访问")]),t._v(" "),s("p",[t._v("配置HTTPS步骤：")]),t._v(" "),s("p",[t._v("1、准备域名证书文件（来自：openssl/cfssl工具自签或者权威机构颁发）")]),t._v(" "),s("p",[t._v("2、将证书文件保存到Secret")]),t._v(" "),s("blockquote",[s("p",[t._v("kubectl create secret tls web-aliangedu-cn -- cert=web.aliangedu.cn.pem --key=web.aliangedu.cn-key.pem")])]),t._v(" "),s("p",[t._v("3、Ingress规则配置tls")]),t._v(" "),s("p",[t._v("4、kubectl get ingress")]),t._v(" "),s("p",[t._v("5、测试，本地电脑绑定hosts记录对应ingress里面配置的域名，IP是 Ingress Concontroller Pod节点IP")]),t._v(" "),s("p",[t._v("1."),s("strong",[t._v("配置自签名的域名证书文件")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01:~/work/cert"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ls ")]),t._v("\ncerts.sh  cfssl  cfssl-certinfo  cfssljson  cfssl.tar.gz\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01:~/work/cert"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mv cfssl* /usr/local/bin/ ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01:~/work/cert"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ./certs.sh ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("/04/11 08:13:18 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" generating a new CA key and certificate from CSR\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("/04/11 08:13:18 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" generate received request\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("/04/11 08:13:18 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" received CSR\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("/04/11 08:13:18 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" generating key: rsa-2048\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("/04/11 08:13:18 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" encoded CSR\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("/04/11 08:13:18 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" signed certificate with serial number "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("28750654571656584514635094557307694380858081500")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("/04/11 08:13:18 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" generate received request\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("/04/11 08:13:18 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" received CSR\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("/04/11 08:13:18 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" generating key: rsa-2048\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("/04/11 08:13:18 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" encoded CSR\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("/04/11 08:13:18 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" signed certificate with serial number "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("399813817984941992535618075144209803695431465162")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("/04/11 08:13:18 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("WARNING"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" This certificate lacks a "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hosts"')]),t._v(" field. This makes it unsuitable "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v("\nwebsites. For "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("more")]),t._v(" information see the Baseline Requirements "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" the Issuance and Management\nof Publicly-Trusted Certificates, v.1.1.6, from the CA/Browser Forum "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("https://cabforum.org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nspecifically, section "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.2")]),t._v(".3 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Information Requirements"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(".\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01:~/work/cert"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl create secret tls web-aliangedu-cn --cert=web.aliangedu.cn.pem --key=web.aliangedu.cn-key.pem ")]),t._v("\nsecret/web-aliangedu-cn created\n")])])]),s("p",[s("strong",[t._v("2.创建应用测试")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01:~/work/cert"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl create deployment web --image=nginx --port=80       ")]),t._v("\ndeployment.apps/web created\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01:~/work/cert"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl expose deployment web --port=80 --type=NodePort ")]),t._v("\nservice/web exposed\n")])])]),s("p",[s("strong",[t._v("3.创建Ingress服务")])]),t._v(" "),s("ul",[s("li",[t._v("创建"),s("strong",[t._v("Ingress")]),t._v("服务名称为aliangedu-https")]),t._v(" "),s("li",[t._v("使用"),s("strong",[t._v("tls")]),t._v("证书web-aliangedu-cn")]),t._v(" "),s("li",[t._v("使用"),s("strong",[t._v("host")]),t._v("为web.aliangedu.cn")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("~/work/cert"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl create ingress aliangedu-https --rule=web.aliangedu.cn/=web:80,tls=web-aliangedu-cn --dry-run -o yaml > ingress.yaml  ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.k8s.io/v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Ingress\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" aliangedu"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("https\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rules")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" web.aliangedu.cn\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("backend")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("service")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" web\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("number")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pathType")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Exact\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tls")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" web.aliangedu.cn\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("secretName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" web"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("aliangedu"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cn\n    \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("~/work/cert"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get ingress")]),t._v("\nNAME              CLASS    HOSTS              ADDRESS   PORTS     AGE\naliangedu"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("https   <none"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("   web.aliangedu.cn             80"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 443   35m\n")])])]),s("p",[t._v("根据ingress-nginx的443端口以及master03节点的IP访问。")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01:~/work/cert"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get svc -n ingress-nginx ")]),t._v("\nNAMESPACE       NAME                                 TYPE        CLUSTER-IP       EXTERNAL-IP   PORT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("S"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("                      AGE\ningress-nginx   ingress-nginx-controller             NodePort    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.108")]),t._v(".51.191    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v(":31950/TCP,443:31465/TCP   4d4h\ningress-nginx   ingress-nginx-controller-admission   ClusterIP   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.97")]),t._v(".104.2      "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("/TCP                      4d4h\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01:~/work/cert"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get  pods -o wide ")]),t._v("\nNAME                   READY   STATUS    RESTARTS   AGE   IP              NODE       NOMINATED NODE   READINESS GATES\nweb-64ffb4ff88-rmvct   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          15m   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".235.12   master03   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204111702010.png",alt:"image-20220411170248985"}})]),t._v(" "),s("h3",{attrs:{id:"网络访问控制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#网络访问控制"}},[t._v("#")]),t._v(" 网络访问控制")]),t._v(" "),s("ul",[s("li",[s("strong",[s("code",[t._v("网络策略应用场景")])])]),t._v(" "),s("li",[s("strong",[s("code",[t._v("网络策略概述")])])]),t._v(" "),s("li",[s("strong",[s("code",[t._v("网络访问控制5个案例")])])])]),t._v(" "),s("h4",{attrs:{id:"网络访问控制-应用场景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#网络访问控制-应用场景"}},[t._v("#")]),t._v(" 网络访问控制：应用场景")]),t._v(" "),s("p",[t._v("默认情况下，Kubernetes 集群网络没任何网络限制，Pod 可以与任何其他 Pod 通信，在某些场景下就需要进行网络控制， 减少网络攻击面，提高安全性，这就会用到网络策略。")]),t._v(" "),s("p",[t._v("网络策略（Network Policy）：是一个K8s资源，用于限制Pod出入流量，提供Pod级别和Namespace级别网络访问控制。")]),t._v(" "),s("p",[t._v("网络策略的应用场景：")]),t._v(" "),s("ol",[s("li",[t._v("应用程序间的访问控制，例如项目A不能访问项目B的Pod")]),t._v(" "),s("li",[t._v("开发环境命名空间不能访问测试环境命名空间Pod • 当Pod暴露到外部时，需要做Pod白名单")]),t._v(" "),s("li",[t._v("多租户网络环境隔离")])]),t._v(" "),s("h4",{attrs:{id:"网络访问控制-网络策略概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#网络访问控制-网络策略概述"}},[t._v("#")]),t._v(" 网络访问控制：网络策略概述")]),t._v(" "),s("p",[s("strong",[s("code",[t._v("podSelector：")])]),t._v("  目标Pod，根据标签选择。")]),t._v(" "),s("p",[s("strong",[s("code",[t._v("policyTypes：")])]),t._v("  策略类型，指定策略用于入站、出站流量。")]),t._v(" "),s("p",[s("strong",[s("code",[t._v("Ingress：")])]),t._v("  from是可以访问的白名单，可以来自于IP段、命名空间、 Pod标签等，ports是可以访问的端口。")]),t._v(" "),s("p",[s("strong",[s("code",[t._v("Egress：")])]),t._v("  这个Pod组可以访问外部的IP段和端口。")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.k8s.io/v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" NetworkPolicy\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" test"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("network"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("policy\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" default\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("podSelector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("role")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" db\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("policyTypes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Ingress\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Egress\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ingress")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("from")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ipBlock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cidr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 172.17.0.0/16\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("except")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 172.17.1.0/24\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespaceSelector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("project")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" myproject\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("podSelector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("role")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" frontend\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" TCP\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("egress")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("to")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ipBlock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cidr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10.0.0.0/24\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" TCP\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5978")]),t._v("\n")])])]),s("h3",{attrs:{id:"网络访问控制-网络策略概述-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#网络访问控制-网络策略概述-2"}},[t._v("#")]),t._v(" 网络访问控制：网络策略概述")]),t._v(" "),s("p",[t._v("网络策略工作流程：")]),t._v(" "),s("p",[t._v("1、创建Network Policy资源")]),t._v(" "),s("p",[t._v("2、Policy Controller监控网络策略，同步并通知节点上程序")]),t._v(" "),s("p",[t._v("3、节点上DaemonSet运行的程序从etcd中获取Policy，调用本 地Iptables创建防火墙规则")]),t._v(" "),s("img",{staticStyle:{zoom:"80%"},attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204111556902.png",alt:"image-20220411155234458"}}),t._v(" "),s("h4",{attrs:{id:"网络访问控制案例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#网络访问控制案例"}},[t._v("#")]),t._v(" 网络访问控制案例")]),t._v(" "),s("ol",[s("li",[t._v("案例1：拒绝命名空间下所有Pod出入站流量")]),t._v(" "),s("li",[t._v("案例2：拒绝其他命名空间Pod访问")]),t._v(" "),s("li",[t._v("案例3：允许其他命名空间Pod访问指定应用")]),t._v(" "),s("li",[t._v("案例4：同一个命名空间下应用之间限制访问")]),t._v(" "),s("li",[t._v("案例5：只允许指定命名空间中的应用访问")])]),t._v(" "),s("h5",{attrs:{id:"拒绝命名空间下所有pod入、出站流量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#拒绝命名空间下所有pod入、出站流量"}},[t._v("#")]),t._v(" 拒绝命名空间下所有Pod入、出站流量")]),t._v(" "),s("p",[s("code",[t._v("需求：拒绝test命名空间下所有Pod入、出站流量")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.k8s.io/v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" NetworkPolicy\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" deny"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("all\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" test\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("podSelector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 匹配本命名空间所有pod")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("policyTypes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Ingress\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Egress\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ingress和egress没有指定规则，则不允许任何流量进出pod")]),t._v("\n")])])]),s("h5",{attrs:{id:"拒绝其他命名空间pod访问"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#拒绝其他命名空间pod访问"}},[t._v("#")]),t._v(" 拒绝其他命名空间Pod访问")]),t._v(" "),s("p",[s("code",[t._v("需求：test命名空间下所有pod可以互相访问，也可以访问其他 命名空间Pod，但其他命名空间不能访问test命名空间Pod。")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.k8s.io/v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" NetworkPolicy\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" deny"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("all"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("namespaces \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" test\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("podSelector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("policyTypes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Ingress\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ingress")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("from")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("podSelector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 匹配本命名空间所有pod")]),t._v("\n")])])]),s("h5",{attrs:{id:"允许其他命名空间pod访问指定应用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#允许其他命名空间pod访问指定应用"}},[t._v("#")]),t._v(" 允许其他命名空间Pod访问指定应用")]),t._v(" "),s("p",[s("code",[t._v("需求：允许其他命名空间访问test命名空间指定Pod")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.k8s.io/v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" NetworkPolicy\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" allow"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("all"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("namespaces \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" test\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("podSelector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" web\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("policyTypes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Ingress\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ingress")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("from")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespaceSelector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 匹配所有命名空间的pod")]),t._v("\n")])])]),s("h5",{attrs:{id:"同一个命名空间下应用之间限制访问"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#同一个命名空间下应用之间限制访问"}},[t._v("#")]),t._v(" 同一个命名空间下应用之间限制访问")]),t._v(" "),s("p",[s("code",[t._v("需求：将test命名空间中标签为run=web的pod隔离， 只允许标签为run=client1的pod访问80端口")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.k8s.io/v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" NetworkPolicy\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("to"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("app\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" test\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("podSelector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" web\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("policyTypes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Ingress\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ingress")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("from")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("podSelector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" client1\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" TCP\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n")])])]),s("h5",{attrs:{id:"只允许指定命名空间中的应用访问"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#只允许指定命名空间中的应用访问"}},[t._v("#")]),t._v(" 只允许指定命名空间中的应用访问")]),t._v(" "),s("p",[s("code",[t._v("需求：限制dev命名空间标签为env=dev的pod，只允许 prod命名空间中的pod访问和其他所有命名空间 app=client1标签pod访问")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" networking.k8s.io/v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" NetworkPolicy\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" dev"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("web\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" dev\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("podSelector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" dev\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("policyTypes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Ingress\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ingress")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 满足允许prod命名空间中的pod访问")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("from")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespaceSelector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" prod\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 允许pod标签为app=client1的pod访问，所有命名空间")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("from")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespaceSelector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("podSelector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" client1\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);