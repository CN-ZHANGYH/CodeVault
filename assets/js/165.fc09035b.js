(window.webpackJsonp=window.webpackJsonp||[]).push([[165],{479:function(t,s,a){"use strict";a.r(s);var n=a(7),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"æœ€å°åŒ–å¾®æœåŠ¡æ¼æ´"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æœ€å°åŒ–å¾®æœåŠ¡æ¼æ´"}},[t._v("#")]),t._v(" æœ€å°åŒ–å¾®æœåŠ¡æ¼æ´")]),t._v(" "),s("h3",{attrs:{id:"ä¸»è¦å†…å®¹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä¸»è¦å†…å®¹"}},[t._v("#")]),t._v(" ä¸»è¦å†…å®¹")]),t._v(" "),s("p",[t._v("â– Podå®‰å…¨ä¸Šä¸‹æ–‡")]),t._v(" "),s("p",[t._v("â– Podå®‰å…¨ç­–ç•¥")]),t._v(" "),s("p",[t._v("â– Secretå­˜å‚¨æ•æ„Ÿæ•°æ®")]),t._v(" "),s("p",[t._v("â– å®‰å…¨æ²™ç®±è¿è¡Œå®¹å™¨")]),t._v(" "),s("h3",{attrs:{id:"podå®‰å…¨ä¸Šä¸‹æ–‡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#podå®‰å…¨ä¸Šä¸‹æ–‡"}},[t._v("#")]),t._v(" Podå®‰å…¨ä¸Šä¸‹æ–‡")]),t._v(" "),s("p",[s("code",[t._v("å®‰å…¨ä¸Šä¸‹æ–‡ï¼ˆSecurity Contextï¼‰")]),t._v("ï¼šK8så¯¹Podå’Œå®¹å™¨æä¾›çš„å®‰å…¨æœºåˆ¶ï¼Œå¯ä»¥è®¾ç½®Podç‰¹æƒå’Œè®¿é—®æ§åˆ¶ã€‚")]),t._v(" "),s("p",[s("strong",[t._v("å®‰å…¨ä¸Šä¸‹æ–‡é™åˆ¶ç»´åº¦ï¼š")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("è‡ªä¸»è®¿é—®æ§åˆ¶ï¼ˆDiscretionary Access Controlï¼‰")]),t._v("ï¼šåŸºäºç”¨æˆ·IDï¼ˆUIDï¼‰å’Œç»„IDï¼ˆGIDï¼‰ï¼Œæ¥åˆ¤å®šå¯¹å¯¹è±¡ï¼ˆä¾‹å¦‚æ–‡ä»¶ï¼‰ çš„è®¿é—®æƒé™ã€‚")]),t._v(" "),s("li",[s("code",[t._v("å®‰å…¨æ€§å¢å¼ºçš„ Linuxï¼ˆSELinuxï¼‰")]),t._v("ï¼š ä¸ºå¯¹è±¡èµ‹äºˆå®‰å…¨æ€§æ ‡ç­¾ã€‚")]),t._v(" "),s("li",[t._v("ä»¥"),s("code",[t._v("ç‰¹æƒæ¨¡å¼")]),t._v("æˆ–è€…éç‰¹æƒæ¨¡å¼è¿è¡Œã€‚")]),t._v(" "),s("li",[s("code",[t._v("Linux Capabilities")]),t._v(": ä¸ºè¿›ç¨‹èµ‹äºˆ root ç”¨æˆ·çš„éƒ¨åˆ†ç‰¹æƒè€Œéå…¨éƒ¨ç‰¹æƒã€‚")]),t._v(" "),s("li",[s("code",[t._v("AppArmor")]),t._v("ï¼šå®šä¹‰Podä½¿ç”¨AppArmoré™åˆ¶å®¹å™¨å¯¹èµ„æºè®¿é—®é™åˆ¶")]),t._v(" "),s("li",[s("code",[t._v("Seccomp")]),t._v("ï¼šå®šä¹‰Podä½¿ç”¨Seccompé™åˆ¶å®¹å™¨è¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨")]),t._v(" "),s("li",[s("code",[t._v("AllowPrivilegeEscalation")]),t._v("ï¼š ç¦æ­¢å®¹å™¨ä¸­è¿›ç¨‹ï¼ˆé€šè¿‡ SetUID æˆ– SetGID æ–‡ä»¶æ¨¡å¼ï¼‰è·å¾—ç‰¹æƒæå‡ã€‚å½“å®¹å™¨ä»¥ç‰¹æƒæ¨¡å¼ è¿è¡Œæˆ–è€…å…·æœ‰CAP_SYS_ADMINèƒ½åŠ›æ—¶ï¼ŒAllowPrivilegeEscalationæ€»ä¸ºTrueã€‚")]),t._v(" "),s("li",[s("code",[t._v("readOnlyRootFilesystem")]),t._v("ï¼šä»¥åªè¯»æ–¹å¼åŠ è½½å®¹å™¨çš„æ ¹æ–‡ä»¶ç³»ç»Ÿã€‚")])]),t._v(" "),s("h3",{attrs:{id:"æ¡ˆä¾‹å®æ–½"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ¡ˆä¾‹å®æ–½"}},[t._v("#")]),t._v(" æ¡ˆä¾‹å®æ–½")]),t._v(" "),s("h5",{attrs:{id:"æ¡ˆä¾‹1-è®¾ç½®å®¹å™¨ä»¥æ™®é€šç”¨æˆ·è¿è¡Œ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ¡ˆä¾‹1-è®¾ç½®å®¹å™¨ä»¥æ™®é€šç”¨æˆ·è¿è¡Œ"}},[t._v("#")]),t._v(" æ¡ˆä¾‹1ï¼šè®¾ç½®å®¹å™¨ä»¥æ™®é€šç”¨æˆ·è¿è¡Œ")]),t._v(" "),s("p",[t._v("èƒŒæ™¯ï¼šå®¹å™¨ä¸­çš„åº”ç”¨ç¨‹åºé»˜è®¤ä»¥rootè´¦å·è¿è¡Œçš„ï¼Œè¿™ä¸ªrootä¸å®¿ä¸»æœºrootè´¦å·æ˜¯ç›¸åŒçš„ï¼Œ æ‹¥æœ‰å¤§éƒ¨åˆ†å¯¹Linuxå†…æ ¸çš„ç³»ç»Ÿè°ƒç”¨æƒé™ï¼Œè¿™æ ·æ˜¯ä¸å®‰å…¨çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥å°†å®¹å™¨ä»¥æ™® é€šç”¨æˆ·è¿è¡Œï¼Œå‡å°‘åº”ç”¨ç¨‹åºå¯¹æƒé™çš„ä½¿ç”¨ã€‚")]),t._v(" "),s("p",[t._v("å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹æ³•è®¾ç½®æ™®é€šç”¨æˆ·ï¼š")]),t._v(" "),s("ol",[s("li",[t._v("Dockerfileé‡Œä½¿ç”¨USERæŒ‡å®šè¿è¡Œç”¨æˆ·")]),t._v(" "),s("li",[t._v("K8sé‡ŒæŒ‡å®šspec.securityContext.runAsUserï¼ŒæŒ‡å®šå®¹å™¨é»˜è®¤ç”¨æˆ·UID")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("securityContext")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runAsUser")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v(" \t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# é•œåƒé‡Œå¿…é¡»æœ‰è¿™ä¸ªç”¨æˆ·UID")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fsGroup")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v(" \t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# æ•°æ®å·æŒ‚è½½åçš„ç›®å½•å±ç»„è®¾ç½®ä¸ºè¯¥ç»„")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" lizhenliang/flask"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("demo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("root\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" web\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("securityContext")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("allowPrivilegeEscalation")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ä¸å…è®¸ææƒ")]),t._v("\n")])])]),s("p",[t._v("åˆ›å»ºPodä½¿ç”¨å®‰å…¨ä¸Šä¸‹æ–‡æµ‹è¯•æ˜¯å¦æ”¹ä¸ºuuidè¿è¡Œå®¹å™¨:")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token null important"}},[t._v("~")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat pod-test.yaml")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Pod\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" test\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("securityContext")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runAsUser")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fsGroup")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" lizhenliang/flask"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("demo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("root\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" test\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("securityContext")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("allowPrivilegeEscalation")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n")])])]),s("p",[t._v("æ‰§è¡Œyamlä¹‹åè¿›å…¥å®¹å™¨æŸ¥çœ‹å½“å‰çš„uuidï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01:~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl exec -it test -- bash")]),t._v("\npython@test:/data/www$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("uid")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("python"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("gid")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("python"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("groups")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("python"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h5",{attrs:{id:"æ¡ˆä¾‹2-é¿å…ä½¿ç”¨ç‰¹æƒå®¹å™¨"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ¡ˆä¾‹2-é¿å…ä½¿ç”¨ç‰¹æƒå®¹å™¨"}},[t._v("#")]),t._v(" æ¡ˆä¾‹2ï¼šé¿å…ä½¿ç”¨ç‰¹æƒå®¹å™¨")]),t._v(" "),s("p",[t._v("èƒŒæ™¯ï¼šå®¹å™¨ä¸­æœ‰äº›åº”ç”¨ç¨‹åºå¯èƒ½éœ€è¦è®¿é—®å®¿ä¸»æœºè®¾å¤‡ã€ä¿®æ”¹å†…æ ¸ç­‰éœ€æ±‚ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œ å®¹å™¨æ²¡è¿™ä¸ªæœ‰è¿™ä¸ªèƒ½åŠ›ï¼Œå› æ­¤è¿™æ—¶ä¼šè€ƒè™‘ç»™å®¹å™¨è®¾ç½®ç‰¹æƒæ¨¡å¼ã€‚")]),t._v(" "),s("p",[t._v("å¯ç”¨ç‰¹æƒæ¨¡å¼ï¼š")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" lizhenliang/flask"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("demo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("root\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" web\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("securityContext")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("privileged")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" true / false \n")])])]),s("blockquote",[s("p",[t._v("å¯ç”¨ç‰¹æƒæ¨¡å¼å°±æ„å‘³ç€ï¼Œä½ è¦ä¸ºå®¹å™¨æä¾›äº†è®¿é—®Linuxå†…æ ¸çš„æ‰€æœ‰èƒ½åŠ›ï¼Œè¿™æ˜¯å¾ˆå±é™©çš„ï¼Œ ä¸ºäº†å‡å°‘ç³»ç»Ÿè°ƒç”¨çš„ä¾›ç»™ï¼Œå¯ä»¥ä½¿ç”¨Capabilitiesä¸ºå®¹å™¨èµ‹äºˆä»…æ‰€éœ€çš„èƒ½åŠ›ã€‚")])]),t._v(" "),s("p",[s("code",[t._v("Linux Capabilitiesï¼šCapabilities æ˜¯ä¸€ä¸ªå†…æ ¸çº§åˆ«çš„æƒé™")]),t._v("ï¼Œå®ƒå…è®¸å¯¹å†…æ ¸è°ƒç”¨æƒ é™è¿›è¡Œæ›´ç»†ç²’åº¦çš„æ§åˆ¶ï¼Œè€Œä¸æ˜¯ç®€å•åœ°ä»¥ root èº«ä»½èƒ½åŠ›æˆæƒã€‚ Capabilities åŒ…æ‹¬æ›´æ”¹æ–‡ä»¶æƒé™ã€æ§åˆ¶ç½‘ç»œå­ç³»ç»Ÿå’Œæ‰§è¡Œç³»ç»Ÿç®¡ç†ç­‰åŠŸèƒ½ã€‚åœ¨ securityContext ä¸­ï¼Œå¯ä»¥æ·»åŠ æˆ–åˆ é™¤ Capabilitiesï¼Œåšåˆ°å®¹å™¨ç²¾ç»†åŒ–æƒé™æ§åˆ¶ã€‚")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204141224069.png",alt:"image-20220413084355164"}})]),t._v(" "),s("h5",{attrs:{id:"æ¡ˆä¾‹3-å–æ¶ˆæŒ‚è½½æ–‡ä»¶ç³»ç»Ÿ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ¡ˆä¾‹3-å–æ¶ˆæŒ‚è½½æ–‡ä»¶ç³»ç»Ÿ"}},[t._v("#")]),t._v(" æ¡ˆä¾‹3ï¼šå–æ¶ˆæŒ‚è½½æ–‡ä»¶ç³»ç»Ÿ")]),t._v(" "),s("p",[t._v("å®¹å™¨é»˜è®¤æ²¡æœ‰æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿèƒ½åŠ›ï¼Œæ·»åŠ SYS_ADMINå¢åŠ è¿™ä¸ªèƒ½åŠ›")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Pod\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" busybox \n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" busybox\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" test\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" sleep\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 24h\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("securityContext")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("capabilities")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("add")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SYS_ADMIN"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[t._v("åˆ›å»ºè¿›å…¥å®¹å™¨æµ‹è¯•æŒ‚è½½æƒé™ï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01:~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl exec -it  busybox -- sh")]),t._v("\n/ "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mount /data/ /tmp/")]),t._v("\nmount: mounting /data/ on /tmp/ failed: Permission denied\n")])])]),s("h5",{attrs:{id:"æ¡ˆä¾‹4-åªè¯»æŒ‚è½½æƒé™"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ¡ˆä¾‹4-åªè¯»æŒ‚è½½æƒé™"}},[t._v("#")]),t._v(" æ¡ˆä¾‹4ï¼šåªè¯»æŒ‚è½½æƒé™")]),t._v(" "),s("p",[t._v("åªè¯»æŒ‚è½½å®¹å™¨æ–‡ä»¶ç³»ç»Ÿï¼Œé˜²æ­¢æ¶æ„äºŒè¿›åˆ¶æ–‡ä»¶åˆ›å»º")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Pod\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" busybox\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" busybox\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" test\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" sleep\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 24h\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("securityContext")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("readOnlyRootFilesystem")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n")])])]),s("p",[t._v("åˆ›å»ºè¿›å…¥å®¹å™¨æµ‹è¯•æ–‡ä»¶æƒé™ï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01:~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl exec -it  busybox  -- sh")]),t._v("\n/ "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mkdir a")]),t._v("\nmkdir: can"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'t create directory '")]),t._v("a': Read-only "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" system\n")])])]),s("h3",{attrs:{id:"podå®‰å…¨ç­–ç•¥-psp"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#podå®‰å…¨ç­–ç•¥-psp"}},[t._v("#")]),t._v(" Podå®‰å…¨ç­–ç•¥ï¼ˆPSPï¼‰")]),t._v(" "),s("p",[s("code",[t._v("PodSecurityPolicyï¼ˆç®€ç§°PSPï¼‰")]),t._v("ï¼šKubernetesä¸­Podéƒ¨ç½²æ—¶é‡è¦çš„å®‰å…¨æ ¡éªŒæ‰‹æ®µï¼Œèƒ½å¤Ÿ æœ‰æ•ˆåœ°çº¦æŸåº”ç”¨è¿è¡Œæ—¶è¡Œä¸ºå®‰å…¨ã€‚ ä½¿ç”¨PSPå¯¹è±¡å®šä¹‰ä¸€ç»„Podåœ¨è¿è¡Œæ—¶å¿…é¡»éµå¾ªçš„æ¡ä»¶åŠç›¸å…³å­—æ®µçš„é»˜è®¤å€¼ï¼Œåªæœ‰Podæ»¡è¶³è¿™ äº›æ¡ä»¶æ‰ä¼šè¢«K8sæ¥å—ã€‚")]),t._v(" "),s("h4",{attrs:{id:"podå®‰å…¨ç­–ç•¥é™åˆ¶ç»´åº¦"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#podå®‰å…¨ç­–ç•¥é™åˆ¶ç»´åº¦"}},[t._v("#")]),t._v(" Podå®‰å…¨ç­–ç•¥é™åˆ¶ç»´åº¦")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204141224517.png",alt:"image-20220413100840633"}})]),t._v(" "),s("h4",{attrs:{id:"å¯ç”¨å‡†å…¥æ§åˆ¶å™¨"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å¯ç”¨å‡†å…¥æ§åˆ¶å™¨"}},[t._v("#")]),t._v(" å¯ç”¨å‡†å…¥æ§åˆ¶å™¨")]),t._v(" "),s("p",[t._v("Podå®‰å…¨ç­–ç•¥å®ç°ä¸ºä¸€ä¸ªå‡†å…¥æ§åˆ¶å™¨ï¼Œé»˜è®¤æ²¡æœ‰å¯ç”¨ï¼Œå½“å¯ç”¨åä¼šå¼ºåˆ¶å®æ–½ Podå®‰å…¨ç­–ç•¥ï¼Œæ²¡æœ‰æ»¡è¶³çš„Podå°†æ— æ³•åˆ›å»ºã€‚å› æ­¤ï¼Œå»ºè®®åœ¨å¯ç”¨PSPä¹‹å‰å…ˆæ·»åŠ  ç­–ç•¥å¹¶å¯¹å…¶æˆæƒã€‚")]),t._v(" "),s("p",[t._v("å¯ç”¨Podå®‰å…¨ç­–ç•¥ï¼š")]),t._v(" "),s("blockquote",[s("p",[t._v("vi /etc/kubernetes/manifests/kube-apiserver.yaml\n...\n--enable-admission-plugins=NodeRestriction,PodSecurityPolicy\n...\nsystemctl restart kubelet")])]),t._v(" "),s("h4",{attrs:{id:"å¦‚ä½•ä½¿ç”¨pspèµ„æº"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å¦‚ä½•ä½¿ç”¨pspèµ„æº"}},[t._v("#")]),t._v(" å¦‚ä½•ä½¿ç”¨PSPèµ„æº")]),t._v(" "),s("p",[t._v("ç”¨æˆ·ä½¿ç”¨SA ï¼ˆServiceAccountï¼‰åˆ›å»ºäº†ä¸€ä¸ªPodï¼Œ"),s("code",[t._v("K8sä¼šå…ˆéªŒè¯è¿™ä¸ªSAæ˜¯å¦ å¯ä»¥è®¿é—®PSPèµ„æºæƒé™")]),t._v("ï¼Œå¦‚æœå¯ä»¥è¿›ä¸€æ­¥éªŒè¯Podé…ç½®æ˜¯å¦æ»¡è¶³PSPè§„åˆ™ï¼Œä»» æ„ä¸€æ­¥ä¸æ»¡è¶³éƒ½ä¼šæ‹’ç»éƒ¨ç½²ã€‚")]),t._v(" "),s("p",[t._v("å› æ­¤ï¼Œéœ€è¦å®æ–½éœ€è¦æœ‰è¿™å‡ ç‚¹ï¼š")]),t._v(" "),s("ol",[s("li",[t._v("åˆ›å»ºSAæœåŠ¡è´¦å·")]),t._v(" "),s("li",[t._v("è¯¥SAéœ€è¦å…·å¤‡åˆ›å»ºå¯¹åº”èµ„æºæƒé™ï¼Œä¾‹å¦‚åˆ›å»ºPodã€Deployment")]),t._v(" "),s("li",[t._v("SAä½¿ç”¨PSPèµ„æºæƒé™ï¼šåˆ›å»ºRoleï¼Œä½¿ç”¨PSPèµ„æºæƒé™ï¼Œå†å°†SAç»‘å®šRole")])]),t._v(" "),s("img",{staticStyle:{zoom:"80%"},attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204141224319.png",alt:"image-20220413102111236"}}),t._v(" "),s("h3",{attrs:{id:"æ¡ˆä¾‹å®æ–½-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ¡ˆä¾‹å®æ–½-2"}},[t._v("#")]),t._v(" æ¡ˆä¾‹å®æ–½")]),t._v(" "),s("h5",{attrs:{id:"ç¤ºä¾‹1-ç¦æ­¢åˆ›å»ºç‰¹æƒæ¨¡å¼çš„pod"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç¤ºä¾‹1-ç¦æ­¢åˆ›å»ºç‰¹æƒæ¨¡å¼çš„pod"}},[t._v("#")]),t._v(" ç¤ºä¾‹1ï¼šç¦æ­¢åˆ›å»ºç‰¹æƒæ¨¡å¼çš„Pod")]),t._v(" "),s("p",[t._v("åˆ›å»ºPodå®‰å…¨ç­–ç•¥èµ„æºå¦‚ä¸‹ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("ä¸å…è®¸ç‰¹æƒPod")]),t._v(" "),s("li",[t._v("è¿è¡ŒseLinuxçš„è§„åˆ™")]),t._v(" "),s("li",[t._v("æŒ‡å®šå®¹å™¨å¯åŠ¨çš„ç”¨æˆ·IDå’Œä¸»ç»„IDä½ä»»ä½•äººæˆ–è€…ç¦æ­¢æ²¡æŒ‡å®šæ™®é€šç”¨æˆ·è¿è¡Œçš„å®¹å™¨ï¼ˆrunAsUserï¼‰")]),t._v(" "),s("li",[t._v("å…è®¸ä½¿ç”¨æŒ‚è½½ç±»å‹æ•°æ®å·")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token null important"}},[t._v("~")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat psp.yaml")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" policy/v1beta1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PodSecurityPolicy\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" psp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("example\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("privileged")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ä¸å…è®¸ç‰¹æƒPod")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ä¸‹é¢æ˜¯ä¸€äº›å¿…è¦çš„å­—æ®µ")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("seLinux")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rule")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" RunAsAny\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("supplementalGroups")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rule")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" RunAsAny\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runAsUser")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rule")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" RunAsAny   /  MustRunAsNonRoot\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fsGroup")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rule")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" RunAsAny\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*'")]),t._v("\n")])])]),s("p",[t._v("æ‰§è¡Œä¹‹åæŸ¥çœ‹å½“å‰çš„PSPèµ„æºæƒ…å†µï¼š")]),t._v(" "),s("p",[t._v("åœ¨åç»­çš„1.25ä¹‹åçš„ç‰ˆæœ¬é‡Œé¢ï¼Œå°†ä¼šå®Œå…¨åºŸå¼ƒPodå®‰å…¨ç­–ç•¥ï¼Œé‡‡ç”¨å®‰å…¨ä¸Šä¸‹æ–‡ çš„æ–¹å¼ã€‚")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01:~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f psp.yaml")]),t._v("\nWarning: policy/v1beta1 PodSecurityPolicy is deprecated "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" v1.21+, unavailable "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" v1.25+\npodsecuritypolicy.policy/psp-example created\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01:~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get psp")]),t._v("\nWarning: policy/v1beta1 PodSecurityPolicy is deprecated "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" v1.21+, unavailable "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" v1.25+\nNAME          PRIV    CAPS   SELINUX    RUNASUSER   FSGROUP    SUPGROUP   READONLYROOTFS   VOLUMES\npsp-example   "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("          RunAsAny   RunAsAny    RunAsAny   RunAsAny   "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("            *\n")])])]),s("h5",{attrs:{id:"ç¤ºä¾‹2-ç¦æ­¢åˆ›å»ºç‰¹æƒæ¨¡å¼æµç¨‹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç¤ºä¾‹2-ç¦æ­¢åˆ›å»ºç‰¹æƒæ¨¡å¼æµç¨‹"}},[t._v("#")]),t._v(" ç¤ºä¾‹2ï¼šç¦æ­¢åˆ›å»ºç‰¹æƒæ¨¡å¼æµç¨‹")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# åˆ›å»ºSA")]),t._v("\n$ kubectl create serviceaccount aliang\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# å°†SAç»‘å®šåˆ°ç³»ç»Ÿå†…ç½®Role")]),t._v("\n$ kubectl create rolebinding aliang "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--clusterrole")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("edit "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--serviceaccount")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("default:aliang\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# åˆ›å»ºä½¿ç”¨PSPæƒé™çš„Role")]),t._v("\n$ kubectl create role psp:unprivileged "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--verb")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("use "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--resource")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("podsecuritypolicy --resource-name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("psp-example\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# å°†SAç»‘å®šåˆ°Role")]),t._v("\n$ kubectl create rolebinding aliang:psp:unprivileged "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--role")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("psp:unprivileged "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--serviceaccount")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("default:aliang\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# åˆ›å»ºpodæµ‹è¯•")]),t._v("\n$ kubectl "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--as")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("system:serviceaccount:default:psp-sa run nginx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--image")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx\n")])])]),s("h3",{attrs:{id:"opa-gatekeeper"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#opa-gatekeeper"}},[t._v("#")]),t._v(" OPA Gatekeeper")]),t._v(" "),s("h4",{attrs:{id:"opaä»‹ç»"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#opaä»‹ç»"}},[t._v("#")]),t._v(" OPAä»‹ç»")]),t._v(" "),s("p",[t._v("PSPä¸è¶³ä¸çŠ¶å†µï¼š")]),t._v(" "),s("ul",[s("li",[t._v("å°†å†1.21ç‰ˆæœ¬å¼ƒç”¨PSPï¼Œåœ¨1.25ç‰ˆæœ¬åˆ é™¤PSP")]),t._v(" "),s("li",[t._v("ä»…æ”¯æŒPodç­–ç•¥")]),t._v(" "),s("li",[t._v("ä½¿ç”¨å¤æ‚ï¼Œæƒé™æ¨¡å‹å­˜åœ¨ç¼ºé™·ï¼Œæ§åˆ¶ä¸æ˜ç¡®")])]),t._v(" "),s("p",[t._v("ğŸ·ï¸"),s("a",{attrs:{href:"https://kubernetes.io/blog/2021/04/06/podsecuritypolicy-deprecation-past-present-and-future/",target:"_blank",rel:"noopener noreferrer"}},[t._v("å¼ƒç”¨æ–‡ç« "),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("ğŸ·ï¸"),s("a",{attrs:{href:"https://github.com/kubernetes/enhancements/issues/2579",target:"_blank",rel:"noopener noreferrer"}},[t._v("æ›¿ä»£ææ¡ˆ"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("code",[t._v("OPAï¼ˆOpen Policy Agentï¼‰")]),t._v("ï¼šæ˜¯ä¸€ä¸ªå¼€æºçš„ã€é€šç”¨ç­–ç•¥å¼•æ“ï¼Œå¯ä»¥å°†ç­–ç•¥ç¼–å†™ä¸ºä»£ç ã€‚æä¾› ä¸€ä¸ªç§é«˜çº§å£°æ˜æ€§è¯­è¨€-Regoæ¥ç¼–å†™ç­–ç•¥ï¼Œå¹¶æŠŠå†³ç­–è¿™ä¸€æ­¥éª¤ä»å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ä¸­è§£è€¦å‡ºæ¥ã€‚")]),t._v(" "),s("p",[t._v("OPAå¯ä»¥ç”¨æ¥åšä»€ä¹ˆï¼Ÿ")]),t._v(" "),s("ol",[s("li",[t._v("æ‹’ç»ä¸ç¬¦åˆæ¡ä»¶çš„YAMLéƒ¨ç½²")]),t._v(" "),s("li",[t._v("å…è®¸ä½¿ç”¨å“ªäº›ä»“åº“ä¸­çš„é•œåƒ")]),t._v(" "),s("li",[t._v("å…è®¸åœ¨å“ªä¸ªæ—¶é—´æ®µè®¿é—®ç³»ç»Ÿ")]),t._v(" "),s("li",[t._v("ç­‰...")])]),t._v(" "),s("h4",{attrs:{id:"opaå·¥ä½œæµç¨‹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#opaå·¥ä½œæµç¨‹"}},[t._v("#")]),t._v(" OPAå·¥ä½œæµç¨‹")]),t._v(" "),s("p",[t._v("Gatekeeper æ˜¯åŸºäº OPAçš„ä¸€ä¸ª Kubernetes ç­–ç•¥è§£å†³æ–¹æ¡ˆï¼Œå¯æ›¿ä»£PSPæˆ–è€…éƒ¨åˆ†RBACåŠŸèƒ½ã€‚")]),t._v(" "),s("p",[t._v("å½“åœ¨é›†ç¾¤ä¸­éƒ¨ç½²äº†Gatekeeperç»„ä»¶ï¼ŒAPIServeræ‰€æœ‰çš„åˆ›å»ºã€æ›´æ–°æˆ–è€…åˆ é™¤æ“ä½œéƒ½ä¼šè§¦å‘ Gatekeeperæ¥å¤„ç†ï¼Œå¦‚æœä¸æ»¡è¶³ç­–ç•¥åˆ™æ‹’ç»ã€‚")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204141223253.png",alt:"image-20220413133253793"}})]),t._v(" "),s("h4",{attrs:{id:"éƒ¨ç½²opa-gatekeeper"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#éƒ¨ç½²opa-gatekeeper"}},[t._v("#")]),t._v(" éƒ¨ç½²OPA Gatekeeper")]),t._v(" "),s("p",[t._v("Gatekeeperçš„ç­–ç•¥ç”±ä¸¤ä¸ªèµ„æºå¯¹è±¡ç»„æˆï¼š")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("Template")]),t._v("ï¼šç­–ç•¥é€»è¾‘å®ç°çš„åœ°æ–¹ï¼Œä½¿ç”¨regoè¯­è¨€")]),t._v(" "),s("li",[s("code",[t._v("Contsraint")]),t._v("ï¼šè´Ÿè´£Kubernetesèµ„æºå¯¹è±¡çš„è¿‡æ»¤æˆ–è€…ä¸ºTemplateæä¾›è¾“å…¥å‚æ•°")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01:~/cks/opa"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f https://raw.githubusercontent.com/open-policy-agent/gatekeeper/release-3.7/deploy/gatekeeper.yaml")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01:~/cks/opa"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get pods -n gatekeeper-system")]),t._v("\nNAME                                             READY   STATUS    RESTARTS   AGE\ngatekeeper-controller-manager-66f474f785-kn5fl   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          32s\ngatekeeper-controller-manager-66f474f785-xgz7s   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          32s\ngatekeeper-controller-manager-66f474f785-xxwdm   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          32s\n")])])]),s("h3",{attrs:{id:"æ¡ˆä¾‹å®æ–½-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ¡ˆä¾‹å®æ–½-3"}},[t._v("#")]),t._v(" æ¡ˆä¾‹å®æ–½")]),t._v(" "),s("h5",{attrs:{id:"æ¡ˆä¾‹1-ç¦æ­¢å®¹å™¨å¯ç”¨ç‰¹æƒ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ¡ˆä¾‹1-ç¦æ­¢å®¹å™¨å¯ç”¨ç‰¹æƒ"}},[t._v("#")]),t._v(" æ¡ˆä¾‹1ï¼šç¦æ­¢å®¹å™¨å¯ç”¨ç‰¹æƒ")]),t._v(" "),s("ul",[s("li",[t._v("éœ€è¦åˆ›å»º"),s("code",[t._v("ConstraintTemplate")]),t._v("çš„èµ„æº")]),t._v(" "),s("li",[t._v("ä½¿ç”¨"),s("code",[t._v("rego")]),t._v("çš„è¯­è¨€ç¼–å†™å¯¹å¯ç”¨ç‰¹æƒçš„èµ„æºå‘å‡ºè­¦å‘Š")]),t._v(" "),s("li",[t._v("éœ€è¦æŒ‡å®šç±»å‹ä¸º"),s("code",[t._v("privileged")]),t._v("æ¨¡å¼")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("~/cks/opa"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat privileged_tpl.yaml")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" templates.gatekeeper.sh/v1beta1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ConstraintTemplate\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" privileged\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("crd")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("names")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" privileged\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targets")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("target")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" admission.k8s.gatekeeper.sh\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rego")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v('\n        package admission\n        violation[{"msg": msg}] {  # å¦‚æœviolationä¸ºtrueè¯´æ˜è¿åçº¦æŸ\n          containers = input.review.object.spec.template.spec.containers\n          c_name := containers[0].name\n          containers[0].securityContext.privileged # å¦‚æœè¿”å›falseæˆ–è€…æ²¡è·å–åˆ°å€¼è¯´æ˜é€šè¿‡\n          msg := sprintf("æç¤ºï¼š\'%v\'å®¹å™¨ç¦æ­¢å¯ç”¨ç‰¹æƒï¼",[c_name])\n        }')]),t._v("\n        \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("~/cks/opa"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get ConstraintTemplate")]),t._v("\nNAME         AGE\nprivileged   32m\n")])])]),s("p",[t._v("åˆ›å»ºçº¦æŸã€å¦‚ä¸‹æ˜¯çº¦æŸèµ„æºç±»å‹ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("Deployment")]),t._v(" "),s("li",[t._v("DaemonSet")]),t._v(" "),s("li",[t._v("StatefulSet")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("~/cks/opa"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat privileged_constraints.yaml")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" constraints.gatekeeper.sh/v1beta1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" privileged\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" privileged\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("match")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# åŒ¹é…çš„èµ„æº")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kinds")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroups")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"apps"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kinds")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Deployment"')]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DaemonSet"')]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"StatefulSet"')]),t._v("\n        \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("~/cks/opa"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get constraints")]),t._v("\nNAME         AGE\nprivileged   31m\n")])])]),s("p",[t._v("åˆ›å»ºDeploymentå¼€å¯ç‰¹æƒæ¨¡å¼å†æ‰§è¡Œåˆ›å»ºä¼šå‘å‡ºè­¦å‘Šã€‚")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apps/v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deployment\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("securityContext")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("privileged")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n          \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("~/cks/opa"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f deployment.yaml")]),t._v("\nError from server ("),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("privileged"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" æç¤ºï¼š'nginx'å®¹å™¨ç¦æ­¢å¯ç”¨ç‰¹æƒï¼)"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v('error when creating "dp.yaml"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v('admission webhook "validation.gatekeeper.sh" denied the request')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("privileged"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" æç¤ºï¼š'nginx'å®¹å™¨ç¦æ­¢å¯ç”¨ç‰¹æƒï¼\n")])])]),s("h5",{attrs:{id:"æ¡ˆä¾‹2-åªå…è®¸ä½¿ç”¨ç‰¹å®šçš„é•œåƒä»“åº“"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ¡ˆä¾‹2-åªå…è®¸ä½¿ç”¨ç‰¹å®šçš„é•œåƒä»“åº“"}},[t._v("#")]),t._v(" æ¡ˆä¾‹2ï¼šåªå…è®¸ä½¿ç”¨ç‰¹å®šçš„é•œåƒä»“åº“")]),t._v(" "),s("ul",[s("li",[t._v("éœ€è¦åˆ›å»º"),s("code",[t._v("ConstraintTemplate")]),t._v("çš„èµ„æº")]),t._v(" "),s("li",[t._v("ä½¿ç”¨"),s("code",[t._v("rego")]),t._v("çš„è¯­è¨€ç¼–å†™å¯¹é•œåƒä»“åº“çš„ä¿¡ä»»")]),t._v(" "),s("li",[t._v("éœ€è¦æŒ‡å®šç±»å‹ä¸º"),s("code",[t._v("image-check")]),t._v("æ¨¡å¼")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("~/cks/opa"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat   image-check_tpl.yaml")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" templates.gatekeeper.sh/v1beta1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ConstraintTemplate\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" image"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("check\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("crd")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("names")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" image"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("check\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("validation")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("openAPIV3Schema")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("properties")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# éœ€è¦æ»¡è¶³æ¡ä»¶çš„å‚æ•°")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("prefix")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targets")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("target")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" admission.k8s.gatekeeper.sh\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rego")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v('\n        package image\n        violation[{"msg": msg}] {\n          containers = input.review.object.spec.template.spec.containers\n          image := containers[0].image\n          not startswith(image, input.parameters.prefix)\n          msg := sprintf("æç¤ºï¼š\'%v\'é•œåƒåœ°å€ä¸åœ¨å¯ä¿¡ä»»ä»“åº“ï¼", [image])\n        }')]),t._v("\n        \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("~/cks/opa"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get constrainttemplate")]),t._v("\nNAME          AGE\nimage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("check   77s\nprivileged    35m\n")])])]),s("p",[t._v('è¿™é‡Œéœ€è¦é…ç½®ä¼ é€’OPAçš„å‚æ•°ä¸ºï¼š "lizhenliang/"')]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("~/cks/opa"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat image-check_constraints.yaml")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" constraints.gatekeeper.sh/v1beta1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" image"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("check\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" image"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("check\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("match")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kinds")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroups")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"apps"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kinds")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Deployment"')]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DaemonSet"')]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"StatefulSet"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("parameters")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ä¼ é€’ç»™opaçš„å‚æ•°")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("prefix")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"lizhenliang/"')]),t._v("\n    \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("~/cks/opa"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get constraints")]),t._v("\nNAME                                                AGE\nimage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("check.constraints.gatekeeper.sh/image"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("check   77s\n")])])]),s("p",[t._v("æ‰§è¡Œæµ‹è¯•æ—¶ä½¿ç”¨dockerå®˜æ–¹çš„é•œåƒä»“åº“ï¼š")]),t._v(" "),s("ol",[s("li",[s("code",[t._v("ç”±äºæˆ‘ä»¬å¼€å¯äº†é•œåƒä»“åº“çš„ä¿¡ä»» æ‰€ä»¥å¯¹dockerä»“åº“ä¸æ”¯æŒ")])]),t._v(" "),s("li",[s("code",[t._v("åªèƒ½ä»lizhenliangè¯¥ä»“åº“è¿›è¡Œæ‹‰å–é•œåƒ")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01:~/cks/opa"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl create deployment test --image=nginx")]),t._v("\nerror: failed to create deployment: admission webhook "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"validation.gatekeeper.sh"')]),t._v(" denied the request: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("image-check"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" æç¤ºï¼š"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'nginx'")]),t._v("é•œåƒåœ°å€ä¸åœ¨å¯ä¿¡ä»»ä»“åº“ï¼\n")])])]),s("h3",{attrs:{id:"secretå­˜å‚¨æ•æ„Ÿæ•°æ®"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#secretå­˜å‚¨æ•æ„Ÿæ•°æ®"}},[t._v("#")]),t._v(" Secretå­˜å‚¨æ•æ„Ÿæ•°æ®")]),t._v(" "),s("p",[t._v("Secretæ˜¯ä¸€ä¸ªç”¨äºå­˜å‚¨æ•æ„Ÿæ•°æ®çš„èµ„æºï¼Œæ‰€æœ‰çš„æ•°æ®è¦ç»è¿‡base64ç¼–ç ï¼Œæ•°æ®å®é™…ä¼šå­˜å‚¨åœ¨K8sä¸­Etcdï¼Œ ç„¶åé€šè¿‡åˆ›å»ºPodæ—¶å¼•ç”¨è¯¥æ•°æ®ã€‚")]),t._v(" "),s("p",[t._v("åº”ç”¨åœºæ™¯ï¼šå‡­æ®")]),t._v(" "),s("p",[t._v("Podä½¿ç”¨secretæ•°æ®æœ‰ä¸¤ç§æ–¹å¼ï¼š")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("å˜é‡æ³¨å…¥")])]),t._v(" "),s("li",[s("code",[t._v("æ•°æ®å·æŒ‚è½½")])])]),t._v(" "),s("h4",{attrs:{id:"secretçš„ç±»å‹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#secretçš„ç±»å‹"}},[t._v("#")]),t._v(" secretçš„ç±»å‹")]),t._v(" "),s("p",[t._v("kubectl create secret æ”¯æŒä¸‰ç§æ•°æ®ç±»å‹ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("docker-registryï¼šå­˜å‚¨é•œåƒä»“åº“è®¤è¯ä¿¡æ¯")]),t._v(" "),s("li",[t._v("genericï¼šä»æ–‡ä»¶ã€ç›®å½•æˆ–è€…å­—ç¬¦ä¸²åˆ›å»ºï¼Œä¾‹å¦‚å­˜å‚¨ç”¨æˆ·åå¯†ç ")]),t._v(" "),s("li",[t._v("tlsï¼šå­˜å‚¨è¯ä¹¦ï¼Œä¾‹å¦‚HTTPSè¯ä¹¦")])]),t._v(" "),s("h4",{attrs:{id:"secretçš„ä½¿ç”¨"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#secretçš„ä½¿ç”¨"}},[t._v("#")]),t._v(" secretçš„ä½¿ç”¨")]),t._v(" "),s("p",[t._v("ä¸€ä¸ª Secret å¯ä»¥åŒ…å« Pod è®¿é—®æ•°æ®åº“æ‰€éœ€çš„ç”¨æˆ·å‡­è¯ã€‚ ä¾‹å¦‚ï¼Œç”±ç”¨æˆ·åå’Œå¯†ç ç»„æˆçš„æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ã€‚ ä½  å¯ä»¥åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šï¼Œå°†ç”¨æˆ·åå­˜å‚¨åœ¨æ–‡ä»¶ "),s("code",[t._v("./username.txt")]),t._v(" ä¸­ï¼Œå°†å¯†ç å­˜å‚¨åœ¨æ–‡ä»¶ "),s("code",[t._v("./password.txt")]),t._v(" ä¸­ã€‚")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01:~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# echo -n 'admin' > username.txt")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01:~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# echo -n '1a2b3c4d' > password.txt")]),t._v("\n")])])]),s("p",[t._v("åœ¨è¿™äº›å‘½ä»¤ä¸­ï¼Œ -n æ ‡å¿—ç¡®ä¿ç”Ÿæˆçš„æ–‡ä»¶åœ¨æ–‡æœ¬æœ«å°¾ä¸åŒ…å«é¢å¤–çš„æ¢è¡Œç¬¦ã€‚ è¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼Œå› ä¸ºå½“ kubectl è¯» å–æ–‡ä»¶å¹¶å°†å†…å®¹ç¼–ç ä¸º base64 å­—ç¬¦ä¸²æ—¶ï¼Œå¤šä½™çš„æ¢è¡Œç¬¦ä¹Ÿä¼šè¢«ç¼–ç ã€‚")]),t._v(" "),s("p",[t._v("kubectl create secret å‘½ä»¤å°†è¿™äº›æ–‡ä»¶æ‰“åŒ…æˆä¸€ä¸ª Secret å¹¶åœ¨ API æœåŠ¡å™¨ä¸Šåˆ›å»ºå¯¹è±¡ã€‚")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token null important"}},[t._v("~")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl create secret generic db-user-pass --from-file=username.txt --from-file=password.txt")]),t._v("\nsecret/db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pass created\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token null important"}},[t._v("~")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get secrets db-user-pass -o yaml")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("password.txt")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" MWEyYjNjNGQ=\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("username.txt")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" YWRtaW4=\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Secret\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("creationTimestamp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2022-04-13T06:43:03Z"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pass\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" default\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resourceVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"100098"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uid")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 440fa829"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("0135"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("4ef2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("b8dc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("9f06f5a2f2a3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Opaque\n")])])]),s("h4",{attrs:{id:"è§£ç -secret"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#è§£ç -secret"}},[t._v("#")]),t._v(" è§£ç  Secret")]),t._v(" "),s("p",[t._v("è¦æŸ¥çœ‹åˆ›å»ºçš„ Secret çš„å†…å®¹ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01:~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get secrets db-user-pass -o jsonpath='{.data}'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"password.txt"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MWEyYjNjNGQ="')]),t._v(","),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"username.txt"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"YWRtaW4="')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01:~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# echo 'MWEyYjNjNGQ=' | base64 -d")]),t._v("\n1a2b3c4d\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01:~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# echo 'YWRtaW4=' | base64 -d")]),t._v("\nadmin\n")])])]),s("h3",{attrs:{id:"æ¡ˆä¾‹å®æ–½-4"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ¡ˆä¾‹å®æ–½-4"}},[t._v("#")]),t._v(" æ¡ˆä¾‹å®æ–½")]),t._v(" "),s("h5",{attrs:{id:"ç¤ºä¾‹-å°†mysqlç”¨æˆ·å¯†ç ä¿å­˜åˆ°secretä¸­å­˜å‚¨"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç¤ºä¾‹-å°†mysqlç”¨æˆ·å¯†ç ä¿å­˜åˆ°secretä¸­å­˜å‚¨"}},[t._v("#")]),t._v(" ç¤ºä¾‹ï¼šå°†Mysqlç”¨æˆ·å¯†ç ä¿å­˜åˆ°Secretä¸­å­˜å‚¨")]),t._v(" "),s("p",[t._v("åˆ›å»ºsecretï¼Œmysql-root-passwordçš„é”®å€¼æ˜¯1a2a3a4a")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token null important"}},[t._v("~")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl create secret generic mysql --from-literal=mysql-root-password=1a2a3a4a")]),t._v("\nsecret/mysql created\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token null important"}},[t._v("~")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get secrets mysql -o yaml")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mysql-root-password")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" MWEyYTNhNGE=\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Secret\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("creationTimestamp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2022-04-13T07:06:21Z"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" default\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resourceVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"102066"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uid")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 3104256b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("5b46"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("43a4"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("85ed"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("acc66be7ccba\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Opaque\n")])])]),s("p",[t._v("åˆ›å»ºPodæµ‹è¯•ï¼Œä½¿ç”¨envä»secretä¸­å¼•ç”¨å˜é‡")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token null important"}},[t._v("~")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat pod.yaml")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Pod\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nodeName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" master01\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  mysql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5.6")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" MYSQL_ROOT_PASSWORD\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("valueFrom")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("secretKeyRef")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("root"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("password\n          \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token null important"}},[t._v("~")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get pods")]),t._v("\nNAME    READY   STATUS    RESTARTS   AGE\nmysql   1/1     Running   0          21s\n")])])]),s("h3",{attrs:{id:"å®‰å…¨æ²™ç®±è¿è¡Œå®¹å™¨"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å®‰å…¨æ²™ç®±è¿è¡Œå®¹å™¨"}},[t._v("#")]),t._v(" å®‰å…¨æ²™ç®±è¿è¡Œå®¹å™¨")]),t._v(" "),s("h4",{attrs:{id:"gvisorä»‹ç»"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gvisorä»‹ç»"}},[t._v("#")]),t._v(" gVisorä»‹ç»")]),t._v(" "),s("img",{staticStyle:{zoom:"80%"},attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204141224780.png",alt:"image-20220413152858652"}}),t._v(" "),s("p",[t._v("æ‰€çŸ¥ï¼Œå®¹å™¨çš„åº”ç”¨ç¨‹åºå¯ä»¥ç›´æ¥è®¿é—®Linuxå†…æ ¸çš„ç³»ç»Ÿè°ƒç”¨ï¼Œå®¹å™¨åœ¨å®‰å…¨éš”ç¦»ä¸Šè¿˜æ˜¯æ¯”è¾ƒå¼±ï¼Œè™½ç„¶ å†…æ ¸åœ¨ä¸æ–­åœ°å¢å¼ºè‡ªèº«çš„å®‰å…¨ç‰¹æ€§ï¼Œä½†ç”±äºå†…æ ¸è‡ªèº«ä»£ç æç«¯å¤æ‚ï¼ŒCVE æ¼æ´å±‚å‡ºä¸ç©·ã€‚ æ‰€ä»¥è¦æƒ³å‡å°‘è¿™æ–¹é¢å®‰å…¨é£é™©ï¼Œå°±æ˜¯åšå¥½å®‰å…¨éš”ç¦»ï¼Œé˜»æ–­å®¹å™¨å†…ç¨‹åºå¯¹ç‰©ç†æœºå†…æ ¸çš„ä¾èµ–ã€‚ Googleå¼€æºçš„ä¸€ç§gVisorå®¹å™¨æ²™ç®±æŠ€æœ¯å°±æ˜¯é‡‡ç”¨è¿™ç§æ€è·¯ï¼ŒgVisoréš”ç¦»å®¹å™¨å†…åº”ç”¨å’Œå†…æ ¸ä¹‹é—´è®¿ é—®ï¼Œæä¾›äº†å¤§éƒ¨åˆ†Linuxå†…æ ¸çš„ç³»ç»Ÿè°ƒç”¨ï¼Œå·§å¦™çš„å°†å®¹å™¨å†…è¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨è½¬åŒ–ä¸ºå¯¹gVisorçš„è®¿é—®ã€‚")]),t._v(" "),s("p",[t._v("gVisorå…¼å®¹OCIï¼Œä¸Dockerå’ŒK8sæ— ç¼é›†æˆï¼Œå¾ˆæ–¹é¢ä½¿ç”¨ã€‚")]),t._v(" "),s("p",[t._v("é¡¹ç›®åœ°å€ï¼šhttps://github.com/google/gvisor")]),t._v(" "),s("h4",{attrs:{id:"gvisorå†…æ ¸äº¤äº’"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gvisorå†…æ ¸äº¤äº’"}},[t._v("#")]),t._v(" gVisorå†…æ ¸äº¤äº’")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204131554215.png",alt:"image-20220413152923179"}})]),t._v(" "),s("h4",{attrs:{id:"gvisoræ¶æ„"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gvisoræ¶æ„"}},[t._v("#")]),t._v(" gVisoræ¶æ„")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204131554075.png",alt:"image-20220413153011389"}})]),t._v(" "),s("h4",{attrs:{id:"gvisorä¸dockeré›†æˆ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gvisorä¸dockeré›†æˆ"}},[t._v("#")]),t._v(" gVisorä¸Dockeré›†æˆ")]),t._v(" "),s("p",[t._v("gVisorå†…æ ¸è¦æ±‚ï¼š")]),t._v(" "),s("p",[t._v("Linux 3.17+ å¦‚æœç”¨çš„æ˜¯CentOS7åˆ™éœ€è¦å‡çº§å†…æ ¸ï¼ŒUbuntuä¸éœ€è¦ã€‚")]),t._v(" "),s("p",[t._v("CentOS7å†…æ ¸å‡çº§æ­¥éª¤ï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# yum --enablerepo=elrepo-kernel install kernel-ml-devel kernel-ml â€“y")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# grub2-set-default 0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# reboot")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# uname -r")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 5.17.2-1.el7.elrepo.x86_64")]),t._v("\n")])])]),s("p",[t._v("gVisoré›†æˆDockeré…ç½®")]),t._v(" "),s("p",[t._v("å‚è€ƒæ–‡æ¡£ï¼šhttps://gvisor.dev/docs/user_guide/install/")]),t._v(" "),s("p",[t._v("å·²ç»æµ‹è¯•è¿‡çš„åº”ç”¨å’Œå·¥å…·ï¼šhttps://gvisor.dev/docs/user_guide/compatibility/")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("ã€å‡†å¤‡gVisoräºŒè¿›åˆ¶æ–‡ä»¶\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# sha512sum -c runsc.sha512")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# rm -f *.sha512")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# chmod a+x runsc ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# chmod a+x containerd-shim-runsc-v1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mv runsc containerd-shim-runsc-v1 /usr/local/bin")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("ã€Dockeré…ç½®ä½¿ç”¨gVisor\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# runsc install # æŸ¥çœ‹åŠ çš„é…ç½®/etc/docker/daemon.json")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# systemctl restart docker")]),t._v("\n\n\nä½¿ç”¨runscè¿è¡Œå®¹å™¨ï¼š\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker run -d --runtime=runsc nginx")]),t._v("\nä½¿ç”¨dmesgéªŒè¯ï¼š\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker run --runtime=runsc -it nginx dmesg")]),t._v("\n")])])]),s("h4",{attrs:{id:"gvisorä¸containerdé›†æˆ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gvisorä¸containerdé›†æˆ"}},[t._v("#")]),t._v(" gVisorä¸Containerdé›†æˆ")]),t._v(" "),s("p",[t._v("å¦‚æœè¿™é‡Œæ˜¯Dockerçš„ç¯å¢ƒï¼Œéœ€è¦åˆ‡æ¢åˆ°Containerdå®¹å™¨å¼•æ“ã€‚")]),t._v(" "),s("p",[t._v("ä»ç„¶éœ€è¦å°†runsc ã€containerd-shim-runsc-v1å·¥å…·ç§»åˆ°/usr/local/binä¸‹é¢")]),t._v(" "),s("p",[s("strong",[t._v("1.å‡†å¤‡é…ç½®")])]),t._v(" "),s("p",[t._v("å¼€å¯ipv4è·¯ç”±è½¬å‘é…ç½®ï¼Œé‡æ–°ç”Ÿæ•ˆç³»ç»Ÿé…ç½®")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat > /etc/sysctl.d/99-kubernetes-cri.conf << EOF")]),t._v("\nnet.bridge.bridge-nf-call-iptables "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\nnet.ipv4.ip_forward "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\nnet.bridge.bridge-nf-call-ip6tables "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\nEOF\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# sysctl -system")]),t._v("\n")])])]),s("p",[s("strong",[t._v("2ã€å®‰è£…Containerd")])]),t._v(" "),s("p",[t._v("å¦‚æœé»˜è®¤å®‰è£…äº†docker-ceä¼šè‡ªåŠ¨å®‰è£…containerdçš„ä¾èµ–ï¼Œæ²¡æœ‰åˆ™éœ€è¦å®‰è£…containerdã€‚")]),t._v(" "),s("p",[t._v("ubuntuæ·»åŠ docker-ceçš„repoæºä¹‹åapt-get installçš„æ–¹å¼å®‰è£…")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cd /etc/yum.repos.d")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# wget http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# yum install -y containerd.io")]),t._v("\n")])])]),s("p",[s("strong",[t._v("3ã€ä¿®æ”¹é…ç½®æ–‡ä»¶")])]),t._v(" "),s("ol",[s("li",[t._v("pauseé•œåƒåœ°å€")]),t._v(" "),s("li",[t._v("Cgroupé©±åŠ¨æ”¹ä¸ºsystemd")]),t._v(" "),s("li",[t._v("å¢åŠ runscå®¹å™¨è¿è¡Œæ—¶")]),t._v(" "),s("li",[t._v("é…ç½®dockeré•œåƒåŠ é€Ÿå™¨")])]),t._v(" "),s("p",[t._v("ä¿®æ”¹é…ç½®æ–‡ä»¶é»˜è®¤çš„containerdçš„é…ç½®æ–‡ä»¶æ˜¯ç©ºçš„ï¼Œæ‰€ä»¥éœ€è¦é‡æ–°ç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„é…ç½®æ–‡ä»¶ã€‚")]),t._v(" "),s("p",[t._v("containerdçš„ç›®å½•æ˜¯åœ¨ "),s("code",[t._v("/etc/containerd")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cd /etc/containerd/")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01 containerd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# containerd config  default > config.toml")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01 containerd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vim config.toml")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("43")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("plugins."),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"io.containerd.grpc.v1.cri"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n \t\tÂ·Â·Â·Â·\n \t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ä¿®æ”¹é•œåƒä¸ºå›½å†…çš„é•œåƒ")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("56")]),t._v("     sandbox_image "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"registry.aliyuncs.com/google_containers/pause:3.2"')]),t._v("   \n \t\tÂ·Â·Â·Â· \n \t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# æ·»åŠ ä¸€ä¸ªrunsc,æŒ‡å®šç±»å‹ä¸ºrunscï¼Œè¿™é‡Œæ˜¯è·ŸruncåŒçº§")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("90")]),t._v("        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("plugins."),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"io.containerd.grpc.v1.cri"')]),t._v(".containerd.runtimes.runsc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  \n "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("91")]),t._v("           runtime_type "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"io.containerd.runsc.v1"')]),t._v("   \t\t\t\t  \n\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ä¿®æ”¹systemdé©±åŠ¨ä¸ºtrue")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("94")]),t._v("        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("plugins."),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"io.containerd.grpc.v1.cri"')]),t._v(".containerd.runtimes.runc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("103")]),t._v("          "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("plugins."),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"io.containerd.grpc.v1.cri"')]),t._v(".containerd.runtimes.runc.options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\t\t\t\tÂ·Â·Â·\n "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("114")]),t._v("            SystemdCgroup "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\t\n \t\t\n \t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# æ·»åŠ dockerä»“åº“çš„é•œåƒæºï¼Œé…ç½®é˜¿é‡Œé•œåƒåŠ é€Ÿ")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("139")]),t._v("       "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("plugins."),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"io.containerd.grpc.v1.cri"')]),t._v(".registry.mirrors"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("140")]),t._v("        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("plugins."),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"io.containerd.grpc.v1.cri"')]),t._v(".registry.mirrors."),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"docker.io"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  \n "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("141")]),t._v("          endpoint "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://b9pmyelo.mirror.aliyuncs.com"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[s("strong",[t._v("é…ç½®kubeletä½¿ç”¨containerd")])]),t._v(" "),s("p",[t._v("é…ç½®å®Œä¹‹åå…ˆé‡å¯containerdï¼Œå†é‡å¯kubeletï¼Œæœ€åå¦‚æœpodå‡ºç°æŠ¥é”™ï¼Œé‡å¯dockerã€‚")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vi /etc/sysconfig/kubelet ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("KUBELET_EXTRA_ARGS")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("--container-runtime"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("remote --container-runtime-endpoint"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("unix:///run/containerd/containerd.sock --cgroup-driver"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("systemd\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# systemctl restart containerd")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# systemctl restart kubelet")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# systemctl restart docker")]),t._v("\n")])])]),s("p",[s("strong",[t._v("éªŒè¯å½“å‰çš„Kuberneteså®¹å™¨åŸºå±‚")])]),t._v(" "),s("ol",[s("li",[s("code",[t._v("ä»¥ä¸Šçš„æ­¥éª¤éœ€è¦åœ¨æ‰€æœ‰é›†ç¾¤é…ç½®")])]),t._v(" "),s("li",[s("code",[t._v("åŒ…æ‹¬crictlè¿æ¥containerdçš„é…ç½®ä¹Ÿè¦åœ¨æ‰€æœ‰é›†ç¾¤è¿è¡Œ")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get  node -o wide | awk  '{print $1,$2,$5,$NF}' | column -t")]),t._v("\nNAME      STATUS  VERSION  CONTAINER-RUNTIME\nmaster01  Ready   v1.22.1  containerd://1.5.11\nmaster02  Ready   v1.22.1  containerd://1.5.11\nmaster03  Ready   v1.22.1  containerd://1.5.11\n")])])]),s("p",[s("strong",[t._v("crictlè¿æ¥containerd")])]),t._v(" "),s("p",[t._v("containerdä¹Ÿæœ‰ ctr ç®¡ç†å·¥å…·ï¼Œä½†åŠŸèƒ½æ¯”è¾ƒç®€å•ï¼Œä¸€èˆ¬ä½¿ç”¨crictlå·¥å…·æ£€æŸ¥å’Œè°ƒè¯•å®¹å™¨ã€‚")]),t._v(" "),s("p",[t._v("é¡¹ç›®åœ°å€ï¼šhttps://github.com/kubernetes-sigs/cri-tools/")]),t._v(" "),s("p",[t._v("å‡†å¤‡crictlè¿æ¥containerdé…ç½®æ–‡ä»¶ï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat > /etc/crictl.yaml << EOF")]),t._v("\nruntime-endpoint: unix:///run/containerd/containerd.sock\nEOF\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# systemctl restart  containerd ")]),t._v("\n")])])]),s("p",[t._v("ä¸‹é¢æ˜¯dockerä¸crictlå‘½ä»¤å¯¹ç…§è¡¨ï¼š")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204141224352.png",alt:"image-20220414115021436"}})]),t._v(" "),s("h3",{attrs:{id:"æ¡ˆä¾‹å®æ–½-5"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ¡ˆä¾‹å®æ–½-5"}},[t._v("#")]),t._v(" æ¡ˆä¾‹å®æ–½")]),t._v(" "),s("h5",{attrs:{id:"ç¤ºä¾‹-k8sä½¿ç”¨gvisorè¿è¡Œå®¹å™¨"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç¤ºä¾‹-k8sä½¿ç”¨gvisorè¿è¡Œå®¹å™¨"}},[t._v("#")]),t._v(" ç¤ºä¾‹ï¼š K8sä½¿ç”¨gVisorè¿è¡Œå®¹å™¨")]),t._v(" "),s("ul",[s("li",[t._v("åˆ›å»ºRuntimeClass")]),t._v(" "),s("li",[t._v("ç»‘å®šRuntimeClass")])]),t._v(" "),s("p",[t._v("RuntimeClass æ˜¯ä¸€ä¸ªç”¨äºé€‰æ‹©å®¹å™¨è¿è¡Œæ—¶é…ç½®çš„ç‰¹æ€§ï¼Œå®¹å™¨è¿è¡Œæ—¶é…ç½®ç”¨ äºè¿è¡Œ Pod ä¸­çš„å®¹å™¨ã€‚")]),t._v(" "),s("p",[t._v("åˆ›å»ºRuntimeClassï¼š")]),t._v(" "),s("ul",[s("li",[t._v("è¿™é‡Œåˆ›å»ºä¸€ä¸ªåç§°ä¸º"),s("code",[t._v("gvisor")]),t._v("çš„runtimeclassèµ„æº")]),t._v(" "),s("li",[t._v("å¯ä»¥åˆ›å»ºå¤šä¸ª"),s("code",[t._v("runtimeclass")]),t._v("èµ„æºï¼Œèµ·åˆ°éš”ç¦»çš„æ•ˆæœ")]),t._v(" "),s("li",[t._v("handlerä¸€å®šæ˜¯"),s("code",[t._v("runsc")]),t._v("ï¼Œå¯¹åº”CSIçš„é…ç½®åç§°")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat runtime.yaml")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" node.k8s.io/v1 "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# RuntimeClass å®šä¹‰äº node.k8s.io API ç»„")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" RuntimeClass\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" gvisor "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ç”¨æ¥å¼•ç”¨ RuntimeClass çš„åå­—")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("handler")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" runsc "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# å¯¹åº”çš„ CRI é…ç½®çš„åç§°")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get runtimeclasses")]),t._v("\nNAME     HANDLER   AGE\ngvisor   runsc     72m\n")])])]),s("p",[t._v("åˆ›å»ºPodæµ‹è¯•gVisorï¼š")]),t._v(" "),s("p",[t._v("è¿™é‡Œä½¿ç”¨"),s("code",[t._v("runtimeClassName")]),t._v("ç»‘å®š")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat pod.yaml")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Pod\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" pod\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" pod\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nodeName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"master01"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runtimeClassName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" gvisor\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" pod\n    \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master01 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get pods")]),t._v("\nNAME   READY   STATUS    RESTARTS   AGE\npod    1/1     Running   0          72m\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);