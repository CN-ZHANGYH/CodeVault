(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{343:function(t,a,s){"use strict";s.r(a);var e=s(7),n=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"部署微服务告警监控系统"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署微服务告警监控系统"}},[t._v("#")]),t._v(" 部署微服务告警监控系统")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202205082345672.png",alt:"c9266c472c142b93a312365ebad8eb4"}})]),t._v(" "),a("h3",{attrs:{id:"📌容器化部署node-exporter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#📌容器化部署node-exporter"}},[t._v("#")]),t._v(" 📌容器化部署Node-Exporter")]),t._v(" "),a("p",[t._v("在master节点上编写 /root/Monitor/Dockerfile-exporter 文件构建 monitor-exporter:v1.0 镜像具体要求如下：(需要用到的软件包：http://10.24.1.46/Monitor.tar.gz)")]),t._v(" "),a("p",[t._v("（1）基础镜像："),a("code",[t._v("centos:centos7.9.2009 ；")])]),t._v(" "),a("p",[t._v("（2）使用二进制包 "),a("code",[t._v("node_exporter-0.18.1.linux-amd64.tar.gz")]),t._v(" 安装"),a("code",[t._v("node-exporter")]),t._v("服务；")]),t._v(" "),a("p",[t._v("（3）开放端口："),a("code",[t._v("9100")]),t._v(" ；")]),t._v(" "),a("p",[t._v("（4）设置服务开机自启。")]),t._v(" "),a("p",[t._v("当前所有的文件如下:")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master Monitor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ll")]),t._v("\ntotal "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("369616")]),t._v("\n-rw-r--r--. "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("25880024")]),t._v(" May "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),t._v(" 08:18 alertmanager-0.24.0.linux-amd64.tar.gz\n-rw-------. "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("211696640")]),t._v(" Jan "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" 08:49 CentOS_7.9.2009.tar\n-rw-r--r--. "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("952")]),t._v(" May "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),t._v(":16 docker-compose.yaml\n-rw-r--r--. "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("633")]),t._v(" May "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":55 Dockerfile-alert\n-rw-r--r--. "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("243")]),t._v(" May "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":47 Dockerfile-exporter\n-rw-r--r--. "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("191")]),t._v(" May "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v(" 05:33 Dockerfile-grafana\n-rw-r--r--. "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("519")]),t._v(" May "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),t._v(":17 Dockerfile-prometheus\n-rw-r--r--. "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("59635417")]),t._v(" May "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),t._v(" 08:18 grafana-6.4.1.linux-amd64.tar.gz\n-rw-r--r--. "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8083296")]),t._v(" May "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),t._v(" 08:17 node_exporter-0.18.1.linux-amd64.tar.gz\ndrwxr-xr-x. "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3434")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3434")]),t._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("132")]),t._v(" May "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v(" 06:42 prometheus-2.29.1.linux-amd64\n-rw-r--r--. "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("73156341")]),t._v(" May "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),t._v(" 08:18 prometheus-2.29.1.linux-amd64.tar.gz\n-rw-r--r--. "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root      "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1122")]),t._v(" May "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v(":37 prometheus.yml\n")])])]),a("div",{staticClass:"language-dockerfile extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" centos:centos7.9.2009")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("MAINTAINER")]),t._v(" Chinaskill ")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ADD")]),t._v(" node_exporter-0.18.1.linux-amd64.tar.gz /opt")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" mv /opt/node_exporter-0.18.1.linux-amd64/node_exporter  /bin/node_exporter")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("EXPOSE")]),t._v(" 9100  ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENTRYPOINT")]),t._v("  [ "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/bin/node_exporter"')]),t._v(" ]")]),t._v("\n\n[root@master ~]# docker build -t monitor-exporter:v1.0 -f Dockerfile-exporter .\n")])])]),a("p",[t._v("检测命令1：")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /rootMonitor "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-t")]),t._v(" monitor-exporterv1.0 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" Dockerfile-exporter "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n返回\nnode_exporter-0.18.1.linux-amd64.tar.gz "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9100")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" Successfully tagged monitor-exporterv1.0\n\n检测命令2：\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),t._v(" exporter-exam-jiance monitor-exporter:v1.0 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" exporter-exam-jiance "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-aux")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" exporter-exam-jiance\n返回\nnode_exporter\n")])])]),a("h3",{attrs:{id:"📌容器化部署alertmanager"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#📌容器化部署alertmanager"}},[t._v("#")]),t._v(" 📌容器化部署Alertmanager")]),t._v(" "),a("p",[t._v("在master节点上编写 /root/Monitor/Dockerfile-alert 文件构建 monitor-alert:v1.0 镜像具体要求如下：(需要用到的软件包：http://10.24.1.46/Monitor.tar.gz)")]),t._v(" "),a("p",[t._v("（1）基础镜像："),a("code",[t._v("centos:centos7.9.2009 ；")])]),t._v(" "),a("p",[t._v("（2）使用提供的二进制包 "),a("code",[t._v("alertmanager-0.19.0.linux-amd64.tar.gz")]),t._v(" 安装 "),a("code",[t._v("Alertmanager")]),t._v("服务;")]),t._v(" "),a("p",[t._v("（3）开放端口："),a("code",[t._v("9093, 9094")]),t._v("；")]),t._v(" "),a("p",[t._v("（4）设置服务开机自启。")]),t._v(" "),a("div",{staticClass:"language-dockerfile extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" centos:centos7.9.2009")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("MAINTAINER")]),t._v(" Chinaskill")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ADD")]),t._v(" alertmanager-0.24.0.linux-amd64.tar.gz /bin/ ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" mv /bin/alertmanager-0.24.0.linux-amd64/ /bin/alertmanager")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("EXPOSE")]),t._v(" 9093 9094  ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENTRYPOINT")]),t._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/bin/alertmanager/alertmanager"')]),t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CMD")]),t._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--config.file=/bin/alertmanager/alertmanager.yml"')]),t._v("] ")]),t._v("\n\n[root@master ~]# docker build -t monitor-alert:v1.0 -f Dockerfile-alert .\n")])])]),a("p",[t._v("检测命令1：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /root/Monitor/ "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-t")]),t._v(" monitor-alert:v1.0 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" Dockerfile-alert "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n返回\nalertmanager-0.19.0.linux-amd64.tar.gz "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9093")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" Successfully tagged monitor-alert:v1.0\n\n检测命令2：\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),t._v(" alert-exam-jiance monitor-alert:v1.0 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" alert-exam-jiance "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-aux")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" alert-exam-jiance\n返回\nalertmanager\n")])])]),a("h3",{attrs:{id:"📌容器化部署grafana"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#📌容器化部署grafana"}},[t._v("#")]),t._v(" 📌容器化部署Grafana")]),t._v(" "),a("p",[t._v("在master节点上编写 /root/Monitor/Dockerfile-grafana 文件构建 monitor-grafana:v1.0 镜像具体要求如下：(需要用到的软件包：http://10.24.1.46/Monitor.tar.gz)")]),t._v(" "),a("p",[t._v("（1）基础镜像："),a("code",[t._v("centos:centos7.9.2009 ；")])]),t._v(" "),a("p",[t._v("（2）使用提供的二进制包 "),a("code",[t._v("grafana-6.4.1.linux-amd64.tar.gz")]),t._v(" 安装 "),a("code",[t._v("grafana")]),t._v("服务;")]),t._v(" "),a("p",[t._v("（3）开放端口："),a("code",[t._v("3000 ；")])]),t._v(" "),a("p",[t._v("（4）设置 nacos 服务开机自启。")]),t._v(" "),a("div",{staticClass:"language-dockerfile extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" centos:centos7.9.2009")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("MAINTAINER")]),t._v(" Chinaskill ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ADD")]),t._v(" grafana-6.4.1.linux-amd64.tar.gz /usr/ ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WORKDIR")]),t._v(" /usr/grafana-6.4.1/  ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("EXPOSE")]),t._v(" 3000")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENTRYPOINT")]),t._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/grafana-6.4.1/bin/grafana-server"')]),t._v("]")]),t._v("\n\n[root@master ~]# docker build -t monitor-grafana:v1.0 -f Dockerfile-grafana .\n")])])]),a("p",[t._v("检测命令1：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /root/Monitor/ "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-t")]),t._v(" monitor-grafana:v1.0 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" Dockerfile-grafana "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n返回\ngrafana-6.4.1.linux-amd64.tar.gz "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" successfully tagged monitor-grafana:v1.0\n\n检测命令2：\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),t._v(" grafana-exam-jiance monitor-grafana:v1.0 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" grafana-exam-jiance "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-aux")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" grafana-exam-jiance\n返回\ngrafana-server\n")])])]),a("h3",{attrs:{id:"📌容器化部署prometheus"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#📌容器化部署prometheus"}},[t._v("#")]),t._v(" 📌容器化部署Prometheus")]),t._v(" "),a("p",[t._v("在master节点上编写 /rootMonitor/Dockerfile-prometheus 文件构建 monitor-prometheus:v1.0 镜像具体要求如下：(需要用到的软件包：http://10.24.1.46/Monitor.tar.gz)")]),t._v(" "),a("p",[t._v("（1）基础镜像："),a("code",[t._v("centos:centos7.9.2009 ；")])]),t._v(" "),a("p",[t._v("（2）使用提供的二进制包 "),a("code",[t._v("monitor-2.13.0.linux-amd64.tar.gz")]),t._v(" 安装"),a("code",[t._v("promethues")]),t._v(" 服务;")]),t._v(" "),a("p",[t._v("（3）编写 "),a("code",[t._v("prometheus.yml")]),t._v("文件，创建3个任务模板："),a("code",[t._v("prometheus")]),t._v("、"),a("code",[t._v("node")]),t._v(" 和 "),a("code",[t._v("alertmanager")]),t._v("，并将该文件拷贝到"),a("code",[t._v("/data/prometheus/")]),t._v(" 目录下；")]),t._v(" "),a("p",[t._v("（4）开放端口："),a("code",[t._v("9090；")])]),t._v(" "),a("p",[t._v("（5）设置服务开机自启。")]),t._v(" "),a("blockquote",[a("p",[t._v("注意:")]),t._v(" "),a("p",[t._v("Dockerfile注释的三行是配置地区时间，也可以在docker-compose中配置，我是在docker-compose配置")])]),t._v(" "),a("div",{staticClass:"language-dockerfile extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" centos:centos7.9.2009")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("MAINTAINER")]),t._v(" Chinaskill")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" mkdir /data")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ADD")]),t._v(" prometheus-2.29.1.linux-amd64.tar.gz /data/")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" mv /data/prometheus-2.29.1.linux-amd64 /data/prometheus && "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n    rm -rf  /data/prometheus/prometheus.yml")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COPY")]),t._v(" prometheus.yml  /data/prometheus/")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WORKDIR")]),t._v(" /data/prometheus")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# ENV TZ "Asia/Shanghai"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# RUN ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# RUN echo $TZ > /etc/timezone")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("EXPOSE")]),t._v(" 9090")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENTRYPOINT")]),t._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/data/prometheus/prometheus"')]),t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CMD")]),t._v(" [ "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--config.file=/data/prometheus/prometheus.yml"')]),t._v("]")]),t._v("\n\n[root@master ~]# docker build -t monitor-prometheus:v1.0 -f Dockerfile-prometheus  .\n")])])]),a("p",[t._v("查看prometheus.yml")]),t._v(" "),a("ol",[a("li",[a("code",[t._v("monitor-alertmanager")]),t._v(" 是容器名称")]),t._v(" "),a("li",[a("code",[t._v("monitor-node")]),t._v(" 是容器名称")]),t._v(" "),a("li",[a("code",[t._v("monitor-alertmanager")]),t._v(" 是容器名称")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# my global config")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("global")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scrape_interval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 15s "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Set the scrape interval to every 15 seconds. Default is every 1 minute.")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("evaluation_interval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 15s "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Evaluate rules every 15 seconds. The default is every 1 minute.")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# scrape_timeout is set to the global default (10s).")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Alertmanager configuration")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("alerting")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("alertmanagers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("static_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" monitor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("alertmanager"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9093")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Load rules once and periodically evaluate them according to the global 'evaluation_interval'.")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rule_files")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# - "first_rules.yml"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# - "second_rules.yml"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# A scrape configuration containing exactly one endpoint to scrape:")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Here it's Prometheus itself.")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scrape_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The job name is added as a label `job=<job_name>` to any timeseries scraped from this config.")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("job_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"prometheus"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# metrics_path defaults to '/metrics'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# scheme defaults to 'http'.")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("static_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost:9090"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" \n\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("job_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"node"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("static_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"monitor-node:9100"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n   \n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("job_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"alertmanager"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("static_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"monitor-alertmanager:9093"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("p",[t._v("检测命令1：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /root/Monitorl "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-t")]),t._v(" monitor-prometheus:v1.0 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" Dockerfile-prometheus "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n返回\nprometheus-2.13.0.linux-amd64.tar.gz "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9090")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" Successfully tagged monitor-prometheus:v1.0\n\n检测命令2：\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),t._v(" monitor-exam-jiance monitor-prometheus:v1.0 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" monitor-exam-jiance "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-aux")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" monitor-exam-jiance\n返回\nprometheus.yml\n")])])]),a("h3",{attrs:{id:"📌编排部署监控系统"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#📌编排部署监控系统"}},[t._v("#")]),t._v(" 📌编排部署监控系统")]),t._v(" "),a("p",[t._v("在master节点上编写/root/Monitor/docker-compose.yaml文件部署，具体要求如下：")]),t._v(" "),a("p",[t._v("（1）容器 1 名称："),a("code",[t._v("monitor-node；")]),t._v("镜像："),a("code",[t._v("monitor-exporter:v1.0；")]),t._v("端口映射："),a("code",[t._v("9100:9100")]),t._v("；")]),t._v(" "),a("p",[t._v("（2）容器 2 名称："),a("code",[t._v("monitor-alertmanager；")]),t._v("镜像："),a("code",[t._v("monitor-alert:v1.0；")]),t._v("端口映射："),a("code",[t._v("9093:9093")]),t._v("、"),a("code",[t._v("9094:9094")]),t._v("；")]),t._v(" "),a("p",[t._v("（3）容器 3 名称："),a("code",[t._v("monitor-grafana；")]),t._v("镜像："),a("code",[t._v("monitor-grafana:v1.0；")]),t._v("端口映射："),a("code",[t._v("3000")]),t._v(":"),a("code",[t._v("3000")]),t._v("；")]),t._v(" "),a("p",[t._v("（4）容器 4 名称："),a("code",[t._v("monitor-prometheus；")]),t._v("镜像："),a("code",[t._v("monitor-prometheus:v1.0；")]),t._v("端口映射："),a("code",[t._v("9090")]),t._v(":"),a("code",[t._v("9090")]),t._v("；")]),t._v(" "),a("p",[t._v("完成后编排部署监控系统，将"),a("code",[t._v("Prometheus")]),t._v("设置为"),a("code",[t._v("Grafana")]),t._v("的数据源，并命名为"),a("code",[t._v("Prometheus")]),t._v("。")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master Monitor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker images | grep monitor ")]),t._v("\nmonitor-grafana                                     v1.0             d924b97d967c   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("54")]),t._v(" minutes ago   376MB\nmonitor-alert                                       v1.0             1cae6c12be14   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("55")]),t._v(" minutes ago   318MB\nmonitor-exporter                                    v1.0             61356c46a125   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("55")]),t._v(" minutes ago   238MB\nmonitor-prometheus                                  v1.0             773023b3fc23   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("58")]),t._v(" minutes ago   590MB\n")])])]),a("p",[t._v("编写docker—compose：")]),t._v(" "),a("ol",[a("li",[t._v("先部署 "),a("code",[t._v("monitor-node")])]),t._v(" "),a("li",[t._v("再部署  "),a("code",[t._v("monitor-node")])]),t._v(" "),a("li",[t._v("部署"),a("code",[t._v("Prometheus")]),t._v(" 需要依赖  "),a("code",[t._v("monitor-node")]),t._v(" 和  "),a("code",[t._v("monitor-node")])]),t._v(" "),a("li",[t._v("部署"),a("code",[t._v("Grafana")]),t._v(" 需要依赖 "),a("code",[t._v("Prometheus")])]),t._v(" "),a("li",[t._v("所有容器配置时间地区和时间同步，保证不会出现时间差")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3.7"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("monitor-node")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" monitor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("exporter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("v1.0\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" monitor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"9100:9100"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /etc/localtime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/localtime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("ro \n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /etc/timezone"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/timezone"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("ro\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /proc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/host/proc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("ro \n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /sys"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/host/sys"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("ro \n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/rootfs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("ro\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("monitor-alertmanager")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" monitor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("alert"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("v1.0 \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" monitor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("alertmanager\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"9093:9093"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"9094:9094"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /etc/localtime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/localtime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("ro \n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /etc/timezone"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/timezone"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("ro\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("monitor-prometheus")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" monitor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("prometheus"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("v1.0 \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" monitor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("prometheus\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"9090:9090"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("depends_on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" monitor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("alertmanager \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /etc/localtime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/localtime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("ro\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /etc/timezone"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/timezone"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("ro\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("monitor-grafana")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" monitor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("grafana"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("v1.0 \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" monitor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("grafana\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3000:3000"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /etc/localtime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/localtime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("ro \n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /etc/timezone"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/timezone"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("ro\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("depends_on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" monitor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("prometheus   \n")])])]),a("p",[t._v("执行docker-compose测试：")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@host-192-168-100-186 opt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker-compose up -d ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("+"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Running "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("/5\n ⠿ Network opt_default             Created                                                                                                              "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".1s\n ⠿ Container monitor-alertmanager  Started                                                                                                              "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".6s\n ⠿ Container monitor-node          Started                                                                                                              "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".6s\n ⠿ Container monitor-prometheus    Started                                                                                                              "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(".4s\n ⠿ Container monitor-grafana       Started                                                                                                              "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(".3s\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@host-192-168-100-186 opt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker-compose ps ")]),t._v("\nNAME                   COMMAND                  SERVICE                STATUS              PORTS\nmonitor-alertmanager   "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/bin/alertmanager/a…"')]),t._v("   monitor-alertmanager   running             "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:9093-9094-"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9093")]),t._v("-9094/tcp, :::9093-9094-"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9093")]),t._v("-9094/tcp\nmonitor-grafana        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/grafana-6.4.1/…"')]),t._v("   monitor-grafana        running             "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:3000-"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),t._v("/tcp, :::3000-"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),t._v("/tcp\nmonitor-node           "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/bin/node_exporter"')]),t._v("     monitor-node           running             "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:9100-"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9100")]),t._v("/tcp, :::9100-"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9100")]),t._v("/tcp\nmonitor-prometheus     "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/prometheus-2.2…"')]),t._v("   monitor-prometheus     running             "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:9090-"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9090")]),t._v("/tcp, :::9090-"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9090")]),t._v("/tcp\n")])])]),a("p",[t._v("检测命令1：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker-compose")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" /root/Monitor/docker-compose.yaml "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" Up\n返回\nmonitor-alertmanager "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9093")]),t._v("-"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9093")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" monitor-grafana "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),t._v("-"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" monitor-node "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9100")]),t._v("-"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9100")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" monitor-prometheus "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9090")]),t._v("-"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9090")]),t._v("\n\n检测命令2：\n$ curl-L http://"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("hostname")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-i")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v(":9090/targets\n返回\nalertmanager "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1 up"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1 up"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" prometheus "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1 up"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n检测命令3：\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-u")]),t._v(" admin:admin http://"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("hostname")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-i")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v(":3000/datasources\n返回\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9090")]),t._v("\n\n检测命令4：\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" monitor-prometheus "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" ldata/prometheus/prometheus.yml\n\n返回\nnode-exporter "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" alertmanager\n\n检测命令5：\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-L")]),t._v(" http://"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("hostname")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-i")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v(":9093\n返回\nAlertmanager\n")])])]),a("h3",{attrs:{id:"📌配置grafana"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#📌配置grafana"}},[t._v("#")]),t._v(" 📌配置Grafana")]),t._v(" "),a("p",[t._v("查看当前的"),a("code",[t._v("Prometheus")]),t._v("监控的"),a("code",[t._v("targets")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202205182314162.png",alt:"image-20220518231449017"}})]),t._v(" "),a("p",[t._v("查看当前的"),a("code",[t._v("alertmanager")]),t._v("的状态")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202205182316390.png",alt:"image-20220518231634803"}})]),t._v(" "),a("p",[t._v("查看当前的"),a("code",[t._v("node_exporter")]),t._v("监控指标")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202205182317934.png",alt:"image-20220518231737038"}})]),t._v(" "),a("p",[t._v("登录"),a("code",[t._v("Grafana")]),t._v("配置"),a("code",[t._v("prometheus")]),t._v("的数据源")]),t._v(" "),a("p",[t._v("账号： "),a("code",[t._v("admin")])]),t._v(" "),a("p",[t._v("密码： "),a("code",[t._v("admin")])]),t._v(" "),a("p",[t._v("导入我们下载好的离线json文件")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202205182322038.png",alt:"image-20220518232239506"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202205182323118.png",alt:"image-20220518232358323"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202205182324645.png",alt:"image-20220518232421989"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202205182325992.png",alt:"image-20220518232515126"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202205182325670.png",alt:"image-20220518232554564"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202205182326389.png",alt:"image-20220518232640555"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202205182327951.png",alt:"image-20220518232713905"}})])])}),[],!1,null,null,null);a.default=n.exports}}]);