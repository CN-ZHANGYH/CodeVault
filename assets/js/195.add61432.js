(window.webpackJsonp=window.webpackJsonp||[]).push([[195],{509:function(s,t,a){"use strict";a.r(t);var e=a(7),n=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"guestfish修改镜像密码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#guestfish修改镜像密码"}},[s._v("#")]),s._v(" Guestfish修改镜像密码")]),s._v(" "),t("p",[s._v("从openstack官方下载的云镜像一般都是普通用户密钥登陆，比如centos镜像的普通用户为centos，ubuntu镜像的普通用户为ubuntu,虽然密钥登陆系统相比密码登陆来说比较方便安全，但是如果需要vnc登陆系统的话，必须得是密码才可以。那么如何实现openstack云镜像密码登陆呢，guestfish工具是一个不错的选择。（本次操作是在centos系统上利用guestfish工具修改openstack官方centos镜像的密码，包括root用户以及普通用户centos）")]),s._v(" "),t("h4",{attrs:{id:"安装工具包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装工具包"}},[s._v("#")]),s._v(" 安装工具包")]),s._v(" "),t("p",[t("code",[s._v("这里需要用到epel的源。")])]),s._v(" "),t("p",[t("code",[s._v("该安装包是基于Kvm的环境")]),s._v("，如果有Kvm环境可以直接安装guestfish。")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum install -y epel-release")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum install -y qemu-kvm libvirt virt-install bridge-utils ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl start libvirtd")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum install guestfish")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# guestfish version ")]),s._v("\nmajor: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nminor: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v("\nrelease: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\nextra: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rhel")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(",release"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(".el7,libvirt\n")])])]),t("h4",{attrs:{id:"guestfish修改镜像的密码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#guestfish修改镜像的密码"}},[s._v("#")]),s._v(" guestfish修改镜像的密码")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# guestfish --rw -a CentOS-7-x86_64-GenericCloud-1804_02.qcow2c ")]),s._v("\n\nWelcome to guestfish, the guest filesystem shell "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v("\nediting virtual machine filesystems and disk images.\n\nType: ‘help’ "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("help")]),s._v(" on commands\n      ‘man’ to "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" the manual\n      ‘quit’ to quit the shell\n\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("fs"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" run \n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("% ⟦▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒⟧ --:--\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("fs"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" list-filesystems\n/dev/sda1: xfs\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("fs"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),s._v(" /dev/sda1 /\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("fs"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" \n")])])]),t("h4",{attrs:{id:"修改root密码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改root密码"}},[s._v("#")]),s._v(" 修改root密码")]),s._v(" "),t("p",[s._v("再开一个shell,执行如下命令生成root的加密密码，"),t("code",[s._v("记住这个加密的密码。")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# openssl passwd -1 000000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$pTRh9tzP")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$KRX0LisujyB")]),s._v("/cDY97lmSZ/\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n")])])]),t("p",[s._v("返回guestfish所在shell,"),t("code",[s._v("编辑 /etc/shadow文件。")])]),s._v(" "),t("p",[s._v("将root默认的随机密码替换成生成的加密密码。")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("fs"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/shadow\n\nroot:"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$pTRh9tzP")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$KRX0LisujyB")]),s._v("/cDY97lmSZ/:17667:0:99999:7:::    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将这段的感叹号修改成刚刚的密码")]),s._v("\nbin:*:17632:0:99999:7:::\ndaemon:*:17632:0:99999:7:::\nadm:*:17632:0:99999:7:::\nlp:*:17632:0:99999:7:::\nsync:*:17632:0:99999:7:::\nshutdown:*:17632:0:99999:7:::\nhalt:*:17632:0:99999:7:::\nmail:*:17632:0:99999:7:::\noperator:*:17632:0:99999:7:::\ngames:*:17632:0:99999:7:::\nftp:*:17632:0:99999:7:::\nnobody:*:17632:0:99999:7:::\nsystemd-network:"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(":17667::::::\ndbus:"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(":17667::::::\npolkitd:"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(":17667::::::\nrpc:"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(":17667:0:99999:7:::\nrpcuser:"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(":17667::::::\nnfsnobody:"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(":17667::::::\nsshd:"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(":17667::::::\npostfix:"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(":17667::::::\nchrony:"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(":17667::::::                                               \n")])])]),t("h4",{attrs:{id:"修改centos密码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改centos密码"}},[s._v("#")]),s._v(" 修改centos密码")]),s._v(" "),t("p",[s._v("编辑/etc/cloud.cfg文件。")]),s._v(" "),t("p",[s._v("把lock_passwd字段的值修改为false,解禁密码登陆。增加"),t("code",[s._v("plain_text_passwd")]),s._v("字段，设置为你自己的密码,我这里设置的是"),t("code",[s._v("‘000000’")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("fs"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/cloud/cloud.cfg\n···\nsystem_info:\n  default_user:\n    name: centos\n    lock_passwd: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#修改为false")]),s._v("\n    plain_text_passwd: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'000000'")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#添加这一行")]),s._v("\n    gecos: Cloud User\n    groups: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("wheel, adm, systemd-journal"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    sudo: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ALL=(ALL) NOPASSWD:ALL"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    shell: /bin/bash\n    \n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("fs"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" quit\n")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);