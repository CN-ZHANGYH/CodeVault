(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{346:function(t,s,a){"use strict";a.r(s);var e=a(7),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"kubevirt部署和使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kubevirt部署和使用"}},[t._v("#")]),t._v(" KubeVirt部署和使用")]),t._v(" "),s("h3",{attrs:{id:"安装-kubevirt"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装-kubevirt"}},[t._v("#")]),t._v(" 安装 Kubevirt")]),t._v(" "),s("h4",{attrs:{id:"🔍准备k8s集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#🔍准备k8s集群"}},[t._v("#")]),t._v(" 🔍准备K8S集群")]),t._v(" "),s("p",[t._v("查看当前的K8S集群环境，确保两个节点有足够的性能支撑。当前这里使用的是1.21.1版本的集群。")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl cluster-info ")]),t._v("\nKubernetes control plane is running at https://apiserver.cluster.local:6443\nCoreDNS is running at https://apiserver.cluster.local:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy\n\nTo further debug and diagnose cluster problems, use "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'kubectl cluster-info dump'")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get node ")]),t._v("\nNAME               STATUS   ROLES                         AGE    VERSION\nk8s-master-node1   Ready    control-plane,master,worker   2d1h   v1.21.1\nk8s-worker-node1   Ready    worker                        2d1h   v1.21.1\n")])])]),s("h4",{attrs:{id:"🔍开启虚拟化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#🔍开启虚拟化"}},[t._v("#")]),t._v(" 🔍开启虚拟化")]),t._v(" "),s("ul",[s("li",[t._v("在安装 Kubevirt 之前，需要做一些准备工作。先安装 libvrt 和 qemu 软件包")]),t._v(" "),s("li",[t._v("查看节点是否支持 kvm 硬件辅助虚拟化")]),t._v(" "),s("li",[t._v("如果不支持，则先生成让 Kubevirt 使用软件虚拟化的配置")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Ubuntu")]),t._v("\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v(" qemu-kvm libvirt-bin bridge-utils virt-manager\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# CentOS")]),t._v("\n$ yum "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v(" qemu-kvm libvirt virt-install bridge-utils\n\n$ virt-host-validate qemu\n  QEMU: Checking "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" hardware virtualization                                 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" PASS\n  QEMU: Checking "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" device /dev/kvm exists                                   "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" PASS\n  QEMU: Checking "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" device /dev/kvm is accessible                            "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" PASS\n  QEMU: Checking "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" device /dev/vhost-net exists                             "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" PASS\n  QEMU: Checking "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" device /dev/net/tun exists                               "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" PASS\n  QEMU: Checking "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" cgroup "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'memory'")]),t._v(" controller support                      "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" PASS\n  QEMU: Checking "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" cgroup "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'memory'")]),t._v(" controller mount-point                  "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" PASS\n  QEMU: Checking "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" cgroup "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cpu'")]),t._v(" controller support                         "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" PASS\n  QEMU: Checking "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" cgroup "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cpu'")]),t._v(" controller mount-point                     "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" PASS\n  QEMU: Checking "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" cgroup "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cpuacct'")]),t._v(" controller support                     "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" PASS\n  QEMU: Checking "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" cgroup "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cpuacct'")]),t._v(" controller mount-point                 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" PASS\n  QEMU: Checking "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" cgroup "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cpuset'")]),t._v(" controller support                      "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" PASS\n  QEMU: Checking "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" cgroup "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cpuset'")]),t._v(" controller mount-point                  "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" PASS\n  QEMU: Checking "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" cgroup "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'devices'")]),t._v(" controller support                     "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" PASS\n  QEMU: Checking "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" cgroup "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'devices'")]),t._v(" controller mount-point                 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" PASS\n  QEMU: Checking "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" cgroup "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'blkio'")]),t._v(" controller support                       "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" PASS\n  QEMU: Checking "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" cgroup "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'blkio'")]),t._v(" controller mount-point                   "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" PASS\n  QEMU: Checking "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" device assignment IOMMU support                         "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" PASS\n  QEMU: Checking "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" IOMMU is enabled by kernel                               "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" PASS\n")])])]),s("p",[t._v("不支持需要开启Kubevirt的虚拟化配置：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl create namespace kubevirt\n$ kubectl create configmap "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" kubevirt kubevirt-config "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --from-literal "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("debug.useEmulation")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true\n")])])]),s("h4",{attrs:{id:"🔍部署kubevirt"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#🔍部署kubevirt"}},[t._v("#")]),t._v(" 🔍部署kubevirt")]),t._v(" "),s("p",[t._v("部署最新版本的 Kubevirt，官方有提供对应的版本，如果你的k8s集群版本较低，可以切换相对应的版本。")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("VERSION")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-s")]),t._v(" https://api.github.com/repos/kubevirt/kubevirt/releases "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" tag_name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" -- "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'-rc'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("head")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("awk")]),t._v(" -F"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("': '")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{print $2}'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sed")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'s/,//'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("xargs")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" https://github.com/kubevirt/kubevirt/releases/download/"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${VERSION}")]),t._v("/kubevirt-operator.yaml\n$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" https://github.com/kubevirt/kubevirt/releases/download/"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${VERSION}")]),t._v("/kubevirt-cr.yaml\n")])])]),s("p",[t._v("查看部署结果：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ kubectl "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" kubevirt get pod\nNAME                               READY   STATUS    RESTARTS   AGE\nvirt-api-64999f7bf5-n9kcl          "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          6d\nvirt-api-64999f7bf5-st5qv          "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          6d8h\nvirt-controller-8696ccdf44-v5wnq   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          6d\nvirt-controller-8696ccdf44-vjvsw   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          6d8h\nvirt-handler-85rdn                 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("          7d19h\nvirt-handler-bpgzp                 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v("         7d19h\nvirt-handler-d55c7                 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("          7d19h\nvirt-operator-78fbcdfdf4-sf5dv     "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          6d8h\nvirt-operator-78fbcdfdf4-zf9qr     "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          6d\n")])])]),s("h4",{attrs:{id:"🔍部署-cdi"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#🔍部署-cdi"}},[t._v("#")]),t._v(" 🔍部署 CDI")]),t._v(" "),s("p",[s("code",[t._v("Containerized Data Importer（CDI）")]),t._v("项目提供了用于使 PVC 作为 KubeVirt VM 磁盘的功能。建议同时部署 CDI：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("VERSION")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-s")]),t._v(" https://github.com/kubevirt/containerized-data-importer/releases/latest "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"v[0-9]\\.[0-9]*\\.[0-9]*"')]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n$ kubectl create "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" https://github.com/kubevirt/containerized-data-importer/releases/download/"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$VERSION")]),t._v("/cdi-operator.yaml\n$ kubectl create "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" https://github.com/kubevirt/containerized-data-importer/releases/download/"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$VERSION")]),t._v("/cdi-cr.yaml\n\n$ kubectl get pods "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" cdi \nNAME                               READY   STATUS    RESTARTS   AGE\ncdi-apiserver-6dfc78cdfb-qj2jm     "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          32h\ncdi-deployment-6bf458c4bb-9c2hn    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          32h\ncdi-operator-74d4968557-f5q49      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          35h\ncdi-uploadproxy-5767c4bf64-b879k   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          32h\n")])])]),s("h4",{attrs:{id:"🔍客户端准备"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#🔍客户端准备"}},[t._v("#")]),t._v(" 🔍客户端准备")]),t._v(" "),s("p",[t._v("Kubevirt 提供了一个命令行工具 "),s("code",[t._v("virtctl")]),t._v("，可以直接下载：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("VERSION")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-s")]),t._v(" https://api.github.com/repos/kubevirt/kubevirt/releases "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" tag_name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" -- "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'-rc'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("head")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("awk")]),t._v(" -F"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("': '")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{print $2}'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sed")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'s/,//'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("xargs")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-L")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" /usr/local/bin/virtctl https://github.com/kubevirt/kubevirt/releases/download/"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$VERSION")]),t._v("/virtctl-"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$VERSION")]),t._v("-linux-amd64\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("chmod")]),t._v(" +x /usr/local/bin/virtctl\n")])])]),s("h3",{attrs:{id:"使用kubevirt创建虚拟机"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用kubevirt创建虚拟机"}},[t._v("#")]),t._v(" 使用KubeVirt创建虚拟机")]),t._v(" "),s("h4",{attrs:{id:"🔍准备镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#🔍准备镜像"}},[t._v("#")]),t._v(" 🔍准备镜像")]),t._v(" "),s("p",[t._v("这里使用的是containerDisk的模式创建虚拟机，用qcow2的镜像构建。新建一个工作目录叫"),s("code",[t._v("kubevirt")]),t._v(" 目前KubeVirt支持的镜像格式有以下：")]),t._v(" "),s("ul",[s("li",[s("p",[t._v(".img")])]),t._v(" "),s("li",[s("p",[t._v(".qcow2")])]),t._v(" "),s("li",[s("p",[t._v(".iso")])]),t._v(" "),s("li",[s("p",[t._v("压缩为 .tar，.gz，.xz 格式的上述镜像")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mkdir kubevirt")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cd kubevirt/ ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 kubevirt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ll")]),t._v("\ntotal "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("567012")]),t._v("\n-rw-r--r--. "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("510459904")]),t._v(" Sep "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v(" CentOS_7.5_x86_64_XD.qcow2\n-rw-r--r--. "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("88")]),t._v(" Mar "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("29")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(":24 Dockerfile\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 kubevirt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat Dockerfile  ")]),t._v("\nFROM kubevirt/container-disk-v1alpha\nCOPY CentOS_7.5_x86_64_XD.qcow2 /disk/centos.img \n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 kubevirt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker build -t centos-disk:v1 . ")]),t._v("\nSending build context to Docker daemon  556MB\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/2 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" FROM kubevirt/container-disk-v1alpha\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" e4fa80ad2d49\nStep "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("/2 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" COPY CentOS_7.5_x86_64_XD.qcow2 /disk/centos.img\n ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" aa0a0ad6d5f6\nSuccessfully built aa0a0ad6d5f6\nSuccessfully tagged centos-disk:v1\n")])])]),s("h4",{attrs:{id:"🔍编写virtualmachine资源"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#🔍编写virtualmachine资源"}},[t._v("#")]),t._v(" 🔍编写VirtualMachine资源")]),t._v(" "),s("p",[t._v("通过vm资源创建一个虚拟机，分别使用的参数在后部分详解：")]),t._v(" "),s("p",[t._v("这里一共分为三个部分组成，分别是"),s("code",[t._v("资源类型、资源模板、磁盘类型。")]),t._v(" 所以需要通过这三个部分来对kubevirt创建虚拟机所要求的资源根据需求修改。")]),t._v(" "),s("blockquote",[s("p",[t._v("注意：")]),t._v(" "),s("p",[t._v("创建虚拟机的时候，如果是本地存储创建虚拟机的时候，需要划分一部分空间，对于节点的调度，可以打上标签。")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node1 kubevirt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat vm2.yaml  ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubevirt.io/v1 \n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" VirtualMachine \n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" centos \n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("running")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v(" \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kubevirt.io/size")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" small \n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kubevirt.io/domain")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" centos \n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("domain")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("devices")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("disks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" containerdisk \n              "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("disk")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n                "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("bus")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" virtio  \n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("interfaces")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n          "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" default \n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("masquerade")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("requests")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("memory")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 1024M\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cpu")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" \n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" default \n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pod")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" containerdisk \n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerDisk")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" centos"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("disk"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("v1\n")])])]),s("h4",{attrs:{id:"🔍virtualmachine资源详解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#🔍virtualmachine资源详解"}},[t._v("#")]),t._v(" 🔍VirtualMachine资源详解")]),t._v(" "),s("p",[t._v("virtualmachine的资源类型：")]),t._v(" "),s("ul",[s("li",[t._v("Kind是：  "),s("code",[t._v("VirtualMachine")])]),t._v(" "),s("li",[t._v("api的版本是： "),s("code",[t._v("kubevirt.io/v1")])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubevirt.io/v1 \n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" VirtualMachine \n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" centos \n")])])]),s("p",[t._v("规范：")]),t._v(" "),s("p",[t._v("VirtualMachineInstance规范包含VirtualMachineInstance规范。")]),t._v(" "),s("ul",[s("li",[t._v("这里的running是表示： "),s("code",[t._v("是否创建关联VM和VMI的资源")])]),t._v(" "),s("li",[t._v("template表示： "),s("code",[t._v("是VirtualMachine Instance的直接规范")])]),t._v(" "),s("li",[t._v("labels： "),s("code",[t._v("打上两个标签")])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("running")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v(" \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kubevirt.io/size")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" small \n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kubevirt.io/domain")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" centos \n")])])]),s("p",[t._v("模板里的规范配置主机参数：")]),t._v(" "),s("p",[t._v("在模板规范中，配置当前主机的一些主要相关联的设备以及资源，配置规范详解如下。")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("cpu：")]),t._v(" "),s("code",[t._v("主要是设置cpu的核心数为1个")])]),t._v(" "),s("li",[s("strong",[t._v("devices:")]),t._v(" "),s("code",[t._v("设备允许添加磁盘、网络接口等")])]),t._v(" "),s("li",[s("strong",[t._v("disks:")]),t._v(" "),s("code",[t._v("在devices的规范下添加vmi连接到的磁盘、CD-ROM、软盘和LUN")]),t._v("  总线指示要模拟的磁盘设备的类型。支持的值："),s("code",[t._v("virtio，sata、scsi")])]),t._v(" "),s("li",[s("strong",[t._v("interfaces:")]),t._v(" "),s("code",[t._v("接口描述添加到vmi的网络接口")])]),t._v(" "),s("li",[s("strong",[t._v("machine:")]),t._v(" "),s("code",[t._v("机器类型")])]),t._v(" "),s("li",[s("strong",[t._v("resources:")]),t._v(" "),s("code",[t._v("设置资源和请求资源")])]),t._v(" "),s("li",[s("strong",[t._v("hostname:")]),t._v(" "),s("code",[t._v("设置主机名称")])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("domain")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cpu")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cores")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" \n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("devices")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("disks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("bootOrder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" \n              "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("disk")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n                "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("bus")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" virtio\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cloudinitdisk \n              "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("disk")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n                "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("bus")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" virtio\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" containerdisk \n              "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("disk")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n                "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("bus")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" virtio  \n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("interfaces")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n          "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" default \n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("masquerade")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("machine")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" q35\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("limits")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cpu")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"4"')]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("memory")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 4Gi\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("requests")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cpu")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 1333m\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("memory")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 4Gi \n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostname")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" wtest \n")])])]),s("p",[t._v("模板里的规范配置主机外部参数网络部分：")]),t._v(" "),s("p",[t._v("在配置完模板的主机规范之后，配置外部的网络参数。")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("networks:")]),t._v(" "),s("code",[t._v("配置外部的网络参数")])]),t._v(" "),s("li",[s("strong",[t._v("pod：")]),t._v(" "),s("code",[t._v("配置网络接口CIDR")])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" default \n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pod")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n")])])]),s("p",[t._v("模板里的规范配置主机外部参数磁盘：")]),t._v(" "),s("p",[t._v("这里主要配置的是虚拟机的磁盘来源，这里采用的是containerDisk的方式")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("cloudInitNoCloud:")]),t._v(" "),s("code",[t._v("配置cloudinit的一些参数")])]),t._v(" "),s("li",[s("strong",[t._v("containerDisk:")]),t._v(" "),s("code",[t._v("ContainerDisk引用docker映像，嵌入qcow或原始磁盘")])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cloudInitNoCloud")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networkDataBase64")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("userDataBase64")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cloudinitdisk \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" containerdisk \n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerDisk")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" centos"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("disk"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("v1\n")])])]),s("h4",{attrs:{id:"🔍创建虚拟机"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#🔍创建虚拟机"}},[t._v("#")]),t._v(" 🔍创建虚拟机")]),t._v(" "),s("p",[t._v("使用apply执行yaml文件，并且查看vm和vmi的资源,通过virtctl的命令开启虚拟机，需要等待一会，当镜像完全加载完成之后再使用console连接。")]),t._v(" "),s("blockquote",[s("p",[t._v("注意：")]),t._v(" "),s("p",[t._v("使用vm资源创建之后的虚拟机，默认状态是属于stop，需要开启之后再次查看vmi和pod的资源是否同步。")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 kubevirt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f vm1.yaml  ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 kubevirt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# virtctl start  centos ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 kubevirt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get vm,vmi,pod  ")]),t._v("\nNAME                                AGE     STATUS    READY\nvirtualmachine.kubevirt.io/centos   7h52m   Running   True\n\nNAME                                        AGE     PHASE     IP            NODENAME           READY\nvirtualmachineinstance.kubevirt.io/centos   7h51m   Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".0.12   k8s-master-node1   True\n\nNAME                             READY   STATUS    RESTARTS   AGE\npod/virt-launcher-centos-tjfs4   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("/2     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          7h51m\n")])])]),s("h4",{attrs:{id:"🔍连接虚拟机"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#🔍连接虚拟机"}},[t._v("#")]),t._v(" 🔍连接虚拟机")]),t._v(" "),s("p",[t._v("virtctl 命令可以管理虚拟机的生命周期： "),s("code",[t._v("开启、重启、删除等。")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master-node1 kubevirt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# virtctl console centos ")]),t._v("\nSuccessfully connected to centos console. The escape sequence is ^"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\nCentOS Linux "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Core"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nKernel "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.10")]),t._v(".0-862.2.3.el7.x86_64 on an x86_64\n\ncentos login: root\nPassword: \nLast login: Tue Mar "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("29")]),t._v(" 08:35:38 on ttyS0\n\n "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#########################")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  Welcome to XianDian  #")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#########################")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@centos ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);