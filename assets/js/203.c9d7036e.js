(window.webpackJsonp=window.webpackJsonp||[]).push([[203],{516:function(t,s,a){"use strict";a.r(s);var n=a(7),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"ansible部署kafka集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ansible部署kafka集群"}},[t._v("#")]),t._v(" Ansible部署kafka集群")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("节点")]),t._v(" "),s("th",[t._v("IP")]),t._v(" "),s("th",[t._v("主机名")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("ansible")]),t._v(" "),s("td",[t._v("172.25.253.137")]),t._v(" "),s("td",[t._v("ansible")])]),t._v(" "),s("tr",[s("td",[t._v("node1")]),t._v(" "),s("td",[t._v("172.25.253.138")]),t._v(" "),s("td",[t._v("zookeeper1")])]),t._v(" "),s("tr",[s("td",[t._v("node2")]),t._v(" "),s("td",[t._v("172.25.253.139")]),t._v(" "),s("td",[t._v("zookeeper2")])]),t._v(" "),s("tr",[s("td",[t._v("node3")]),t._v(" "),s("td",[t._v("172.25.253.140")]),t._v(" "),s("td",[t._v("zookeeper3")])])])]),t._v(" "),s("blockquote",[s("h3",{attrs:{id:"查看文件树"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看文件树"}},[t._v("#")]),t._v(" "),s("strong",[t._v("查看文件树")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible ansible"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# tree role/ ")]),t._v("\nrole/\n├── kafka\n│   ├── "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v("\n│   │   └── run.sh\n│   ├── tasks\n│   │   ├── kafka.yaml\n│   │   └── main.yaml\n│   ├── templates\n│   │   ├── server.properties1.j2\n│   │   ├── server.properties2.j2\n│   │   └── server.properties3.j2\n│   └── vars\n│       └── main.yaml\n├── playbook.yaml\n└── zookeeper\n    ├── "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v("\n    │   ├── hosts\n    │   ├── local.repo\n    │   └── run.sh\n    ├── tasks\n    │   ├── main.yaml\n    │   ├── start.yaml\n    │   └── zookeeper.yaml\n    ├── templates\n    │   ├── myid1.j2\n    │   ├── myid2.j2\n    │   ├── myid3.j2\n    │   └── zoo.cfg.j2\n    ├── vars\n    │   └── main.yaml\n    └── zookeeper-3.4.14.tar.gz\n")])])]),s("blockquote",[s("h3",{attrs:{id:"ansible部署kafka集群-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ansible部署kafka集群-2"}},[t._v("#")]),t._v(" "),s("strong",[t._v("Ansible部署Kafka集群")])])]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("部署kafka集群需要提前部署zookeeper集群，所以要部署zookeeper集群")])]),t._v(" "),s("li",[s("strong",[t._v("使用role的两个角色扮演的部署集群方式")])]),t._v(" "),s("li",[s("strong",[t._v("角色分别是zookeeper角色和kafka角色")])]),t._v(" "),s("li",[s("strong",[t._v("zookeeper角色主要是负责zookeeper环境的部署")])]),t._v(" "),s("li",[s("strong",[t._v("kafka角色主要是负责kafka集群的部署")])])]),t._v(" "),s("blockquote",[s("h3",{attrs:{id:"配置ansible的主机清单"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置ansible的主机清单"}},[t._v("#")]),t._v(" "),s("strong",[t._v("配置ansible的主机清单")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible ansible"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat /etc/ansible/hosts  ")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.25")]),t._v(".253.138 \n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.25")]),t._v(".253.140\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.25")]),t._v(".253.139\n")])])]),s("blockquote",[s("h3",{attrs:{id:"创建角色和角色需要的文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建角色和角色需要的文件"}},[t._v("#")]),t._v(" 创建角色和角色需要的文件")])]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("分别创建file tasks vars templates")])]),t._v(" "),s("li",[s("strong",[t._v("并且上传两个角色相对应的压缩包")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible ansible"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mkdir  role/{kafka,zookeeper}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible ansible"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# touch role/kafka/{file,vars,tasks,templates}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible ansible"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# touch role/zookeeper/{file,vars,tasks,templates}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible ansible"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ll role/zookeeper/ ")]),t._v("\ndrwxr-xr-x "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" root root       "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("51")]),t._v(" Oct "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),t._v(":12 "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v("\ndrwxr-xr-x "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" root root       "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("63")]),t._v(" Oct "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v(":33 tasks\ndrwxr-xr-x "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" root root       "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("72")]),t._v(" Oct "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v(":40 templates\ndrwxr-xr-x "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" root root       "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(" Oct "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v(":38 vars\n-rw-r--r-- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("37676320")]),t._v(" Nov "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v(" zookeeper-3.4.14.tar.gz\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible ansible"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ll role/kafka/ ")]),t._v("\ndrwxr-xr-x "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" root root "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" Oct "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v(":39 "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v("\ndrwxr-xr-x "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" root root "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("41")]),t._v(" Oct "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v(":15 tasks\ndrwxr-xr-x "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" root root "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("93")]),t._v(" Oct "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v(":28 templates\ndrwxr-xr-x "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" root root "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(" Oct "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v(":26 vars\n-rw-r--r-- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("57471165")]),t._v(" Nov "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v(" kafka_2.11-1.1.1.tgz\n")])])]),s("blockquote",[s("h3",{attrs:{id:"zookeeper角色"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#zookeeper角色"}},[t._v("#")]),t._v(" Zookeeper角色")])]),t._v(" "),s("h3",{attrs:{id:"zookeeper"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#zookeeper"}},[t._v("#")]),t._v(" Zookeeper")]),t._v(" "),s("h4",{attrs:{id:"_1-基础环境部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-基础环境部署"}},[t._v("#")]),t._v(" 1.基础环境部署")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("复制hosts文件到file目录下并且修改")])]),t._v(" "),s("li",[s("strong",[t._v("复制local.repo到file目录下并且修改")])]),t._v(" "),s("li",[s("strong",[t._v("编写run.sh脚本作为zookeeper集群的启动脚本")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible file"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat hosts  ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n\n\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.25")]),t._v(".253.138 zookeeper1 \n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.25")]),t._v(".253.139 zookeeper2 \n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.25")]),t._v(".253.140 zookeeper3\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible file"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat  local.repo  ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("centos"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("centos\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("baseurl")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("http://172.25.253.144/file/centos/\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("gpgcheck")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("gpmall-repo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("gpmall-repo\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("baseurl")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("http://172.25.253.144/file/gpmall-repo/\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("gpgcheck")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible file"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat  run.sh  ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#!/bin/bash")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /opt/zookeeper-3.4.14/bin/\n./zkServer.sh start\n./zkServer.sh restart\n\n")])])]),s("h4",{attrs:{id:"_2-编写playbook"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-编写playbook"}},[t._v("#")]),t._v(" 2.编写playbook")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("在tasks目录里编写zookeeper的清单")])]),t._v(" "),s("li",[s("strong",[t._v("编写zookeeper.yaml作为安装zookeeper的环境清单")])]),t._v(" "),s("li",[s("strong",[t._v("编写start.yaml作为开启集群的清单")])]),t._v(" "),s("li",[s("strong",[t._v("编写main.yaml指定顺序")])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible tasks"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat zookeeper.yaml  ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" copy hosts \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("copy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" src=./file/hosts dest=/etc/hosts \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" delete repo \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("shell")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rm "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("rf /etc/yum.repos.d/*\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" copy repo \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("copy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" src=./file/local.repo  dest=/etc/yum.repos.d/local.repo \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Install Packages \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("yum")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("1.8.0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("openjdk \n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("1.8.0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("openjdk"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("devel \n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("state")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" latest\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" tar tar \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("unarchive")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" src=zookeeper"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("3.4.14.tar.gz dest=/opt/zookeeper"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("3.4.14/\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" delete file \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("file")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" path=/opt/zookeeper"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("3.4.14/conf/zoo_sample.cfg state=absent \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" add config \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" src=zoo.cfg.j2 dest=/opt/zookeeper"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("3.4.14/conf/zoo.cfg  owner=2002 group=2002 mode=664\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" create file \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("file")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" path=/tmp/zookeeper state=directory\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" myid1 \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" src=myid1.j2 dest=/tmp/zookeeper/myid\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("when")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(' ansible_fqdn == "zookeeper1"\n'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" myid2\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" src=myid2.j2 dest=/tmp/zookeeper/myid\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("when")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(' ansible_fqdn == "zookeeper2"\n'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" myid3\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" src=myid3.j2 dest=/tmp/zookeeper/myid\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("when")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(' ansible_fqdn == "zookeeper3"\n')])])]),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible tasks"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat  start.yaml  ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" start zookeeper \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /root/ansible/role/zookeeper/file/run.sh \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("when")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ansible_fqdn == "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"item"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with_items")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" zookeeper1 \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" zookeeper2 \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" zookeeper3\n")])])]),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible tasks"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat main.yaml  ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("include")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" zookeeper.yaml \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("include")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" start.yaml \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible tasks"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ")]),t._v("\n")])])]),s("h4",{attrs:{id:"_3-添加变量vars"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-添加变量vars"}},[t._v("#")]),t._v(" 3.添加变量vars")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("在vars的目录main.yaml添加如下变量")])]),t._v(" "),s("li",[s("strong",[t._v("指定网段加端口号")])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible vars"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat main.yaml ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ip1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 172.25.253.138"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("2888"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3888")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ip2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 172.25.253.139"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("2888"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3888")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ip3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 172.25.253.140"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("2888"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3888")]),t._v("\n")])])]),s("h4",{attrs:{id:"_4-修改templates的j2文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-修改templates的j2文件"}},[t._v("#")]),t._v(" 4.修改templates的j2文件")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("添加myid的三个文件内容分别是1、2、3")])]),t._v(" "),s("li",[s("strong",[t._v("配置zoo.cfg文件需要添加三个server的id以及ip")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible templates"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# echo 1 > myid1.j2")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible templates"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# echo 2 > myid2.j2")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible templates"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# echo 3 > myid3.j2")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible templates"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat zoo.cfg.j2  ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The number of milliseconds of each tick")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("tickTime")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2000")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The number of ticks that the initial ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# synchronization phase can take")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("initLimit")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The number of ticks that can pass between ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# sending a request and getting an acknowledgement")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("syncLimit")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# the directory where the snapshot is stored.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# do not use /tmp for storage, /tmp here is just ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# example sakes.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("dataDir")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/tmp/zookeeper\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# the port at which the clients will connect")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("clientPort")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2181")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# the maximum number of client connections.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# increase this if you need to handle more clients")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#maxClientCnxns=60")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Be sure to read the maintenance section of the ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# administrator guide before turning on autopurge.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The number of snapshots to retain in dataDir")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#autopurge.snapRetainCount=3")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Purge task interval in hours")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# Set to "0" to disable auto purge feature')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#autopurge.purgeInterval=1")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("server.1")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" ip1 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("server.2")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" ip2 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("server.3")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" ip3 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible templates"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ll")]),t._v("\ntotal "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v("\n-rw-r--r-- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" Oct "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v(":35 myid1.j2\n-rw-r--r-- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" Oct "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v(":35 myid2.j2\n-rw-r--r-- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" Oct "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v(":38 myid3.j2\n-rw-r--r-- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("982")]),t._v(" Oct "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v(":40 zoo.cfg.j2\n")])])]),s("blockquote",[s("h3",{attrs:{id:"kafka角色"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kafka角色"}},[t._v("#")]),t._v(" Kafka角色")])]),t._v(" "),s("h3",{attrs:{id:"kafka"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kafka"}},[t._v("#")]),t._v(" kafka")]),t._v(" "),s("h4",{attrs:{id:"_1-编写playbook"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-编写playbook"}},[t._v("#")]),t._v(" 1.编写playbook")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("在kafka角色中只需要传送压缩包解压缩包括替换文件")])]),t._v(" "),s("li",[s("strong",[t._v("编排akfka的playboot")])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible tasks"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat kafka.yaml  ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" tar  tar\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("unarchive")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" src=kafka/kafka_2.11"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("1.1.1.tgz  dest=/media/\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" change config1 \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" src=server.properties1.j2 dest=/media/kafka_2.11"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("1.1.1/config/server.properties\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("when")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(' ansible_fqdn == "zookeeper1"\n'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" change config2\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" src=server.properties2.j2 dest=/media/kafka_2.11"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("1.1.1/config/server.properties\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("when")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(' ansible_fqdn == "zookeeper2"\n'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" change config3\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" src=server.properties3.j2 dest=/media/kafka_2.11"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("1.1.1/config/server.properties\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("when")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(' ansible_fqdn == "zookeeper3"\n'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" run kafka \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("shell")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cd /media/kafka_2.11"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("1.1.1/bin/  "),s("span",{pre:!0,attrs:{class:"token important"}},[t._v("&&")]),t._v(" ./kafka"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("start.sh "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("daemon ../config/server.properties\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible tasks"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat main.yaml  ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("include")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kafka.yaml \n")])])]),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible tasks"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat main.yaml  ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("include")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kafka.yaml \n")])])]),s("h4",{attrs:{id:"_2-添加变量vars"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-添加变量vars"}},[t._v("#")]),t._v(" 2.添加变量vars")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("在vars的目录中添加相对应的变量")])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible vars"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat main.yaml  ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" \n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" \n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" \n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cluster_ip")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 172.25.253.138"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2181")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("172.25.253.139"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2181")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("172.25.253.140"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2181")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("localip1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 172.25.253.138"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9092")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("localip2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 172.25.253.139"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9092")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("localip3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 172.25.253.140"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9092")]),t._v("\n")])])]),s("h4",{attrs:{id:"_3-修改j2文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-修改j2文件"}},[t._v("#")]),t._v(" 3.修改j2文件")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("修改templates的目录下的三个j2文件")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("在配置文件中找到以下两行并注释掉（在文本前加"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#）如下所示：")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#broker.id=0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#zookeeper.connect=localhost:2181")]),t._v("\n\n\n\n然后在配置文件的底部添加如下 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" 个配置。三个节点分别修改不同的变量 zookeeper1使用id1、zookeeper2使用id2\nzookeeper1 节点：\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("broker.id")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" id1  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("zookeeper.connect")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" cluster_ip "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("listeners")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("PLAINTEXT://"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" localip1 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nzookeeper2 节点：\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("broker.id")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" id2  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("zookeeper.connect")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" cluster_ip "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("listeners")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("PLAINTEXT://"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" localip2 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nzookeeper3 节点：\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("broker.id")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" id3  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("zookeeper.connect")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" cluster_ip "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("listeners")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("PLAINTEXT://"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" localip3 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible templates"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ll")]),t._v("\ntotal "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),t._v("\n-rw-r--r-- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6953")]),t._v(" Oct "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v(":27 server.properties1.j2\n-rw-r--r-- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6952")]),t._v(" Oct "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v(":28 server.properties2.j2\n-rw-r--r-- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6951")]),t._v(" Oct "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v(":28 server.properties3.j2\n")])])]),s("blockquote",[s("h3",{attrs:{id:"role的playbook"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#role的playbook"}},[t._v("#")]),t._v(" Role的playbook")])]),t._v(" "),s("h4",{attrs:{id:"_5-编写role的playbook分步执行"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-编写role的playbook分步执行"}},[t._v("#")]),t._v(" 5.编写role的playbook分步执行")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible role"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat playbook.yaml ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" server \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("remote_user")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" root \n  \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("roles")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("role")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" zookeeper\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("role")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kafka\n")])])]),s("h3",{attrs:{id:"集群验证"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#集群验证"}},[t._v("#")]),t._v(" 集群验证")]),t._v(" "),s("h4",{attrs:{id:"_1-执行脚本"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-执行脚本"}},[t._v("#")]),t._v(" 1.执行脚本")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible role"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ansible-playbook playbook.yaml  ")]),t._v("\n\nPLAY "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" **************************************************************************************************************\n\nTASK "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Gathering Facts"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" *****************************************************************************************************\nok: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.25")]),t._v(".253.139"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nok: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.25")]),t._v(".253.140"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nok: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.25")]),t._v(".253.138"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\nTASK "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("zookeeper "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" copy hosts"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" **********************************************************************************************\nok: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.25")]),t._v(".253.140"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nok: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.25")]),t._v(".253.139"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nok: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.25")]),t._v(".253.138"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n·\n·\n·\nPLAY RECAP *****************************************************************************************************************\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.25")]),t._v(".253.138             "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ok")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("changed")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("unreachable")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("failed")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("skipped")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("rescued")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ignored")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("   \n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.25")]),t._v(".253.139             "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ok")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("changed")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("unreachable")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("failed")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("skipped")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("rescued")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ignored")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("   \n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.25")]),t._v(".253.140             "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ok")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("changed")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("unreachable")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("failed")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("skipped")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("rescued")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ignored")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("   \n")])])]),s("h4",{attrs:{id:"_2-验证集群是否正常"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-验证集群是否正常"}},[t._v("#")]),t._v(" 2.验证集群是否正常")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("查看端口开放")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible role"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# ansible server -m shell -a "ss -ntpl | grep 9092"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.25")]),t._v(".253.140 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" CHANGED "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("rc")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v("\nLISTEN     "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("       ::ffff:172.25.253.140:9092                    :::*                   users:"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("((")]),t._v('"java"'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("pid"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6105")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("fd"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("99")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("))")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.25")]),t._v(".253.139 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" CHANGED "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("rc")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v("\nLISTEN     "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("       ::ffff:172.25.253.139:9092                    :::*                   users:"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("((")]),t._v('"java"'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("pid"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2783")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("fd"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("99")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("))")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.25")]),t._v(".253.138 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" CHANGED "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("rc")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v("\nLISTEN     "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("       ::ffff:172.25.253.138:9092                    :::*                   users:"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("((")]),t._v('"java"'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("pid"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5814")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("fd"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("99")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("))")])]),t._v("\n")])])]),s("ul",[s("li",[s("strong",[t._v("验证")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("zookeeper1：\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost bin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ./kafka-topics.sh --create --zookeeper 172.25.253.138:2181 --replication-factor 1 --partitions 1 --topic test")]),t._v("\nCreated topic "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n\nzookeeper2：\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost bin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ./kafka-topics.sh --list --zookeeper 172.25.253.139:2181   ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("test")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);