(window.webpackJsonp=window.webpackJsonp||[]).push([[128],{442:function(s,t,a){"use strict";a.r(t);var e=a(7),r=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"istioå®‰è£…"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#istioå®‰è£…"}},[s._v("#")]),s._v(" Istioå®‰è£…")]),s._v(" "),t("h2",{attrs:{id:"ä½¿ç”¨istioctlå®‰è£…"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä½¿ç”¨istioctlå®‰è£…"}},[s._v("#")]),s._v(" ä½¿ç”¨Istioctlå®‰è£…")]),s._v(" "),t("h3",{attrs:{id:"_1-æ‹‰å–istioçš„å®‰è£…åŒ…"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-æ‹‰å–istioçš„å®‰è£…åŒ…"}},[s._v("#")]),s._v(" 1.æ‹‰å–Istioçš„å®‰è£…åŒ…")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-O")]),s._v(" http://192.168.1.110/file/istio-1.9.5-linux-amd64.tar.gz\n\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" \nistio-1.9.5-linux-amd64.tar.gz\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-zxvf")]),s._v(" istio-1.9.5-linux-amd64.tar.gz\n")])])]),t("h3",{attrs:{id:"_2-å¤åˆ¶istioctlå·¥å…·"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-å¤åˆ¶istioctlå·¥å…·"}},[s._v("#")]),s._v(" 2.å¤åˆ¶istioctlå·¥å…·")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" istio-1.9.5/\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" bin/istioctl  /usr/local/bin/\n")])])]),t("h3",{attrs:{id:"_3-ä½¿ç”¨é»˜è®¤é…ç½®æ–‡ä»¶å®‰è£…-istio"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-ä½¿ç”¨é»˜è®¤é…ç½®æ–‡ä»¶å®‰è£…-istio"}},[s._v("#")]),s._v(" 3.ä½¿ç”¨é»˜è®¤é…ç½®æ–‡ä»¶å®‰è£… Istio")]),s._v(" "),t("p",[s._v("æœ€ç®€å•çš„é€‰æ‹©æ˜¯ ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…"),t("code",[s._v("default")]),s._v("Istio "),t("a",{attrs:{href:"https://istio.io/latest/docs/setup/additional-setup/config-profiles/",target:"_blank",rel:"noopener noreferrer"}},[s._v("é…ç½®æ–‡ä»¶"),t("OutboundLink")],1),s._v("ï¼š")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ istioctl "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])])]),t("h3",{attrs:{id:"_4-å®‰è£…ä¸åŒçš„é…ç½®æ–‡ä»¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-å®‰è£…ä¸åŒçš„é…ç½®æ–‡ä»¶"}},[s._v("#")]),s._v(" 4.å®‰è£…ä¸åŒçš„é…ç½®æ–‡ä»¶")]),s._v(" "),t("p",[s._v("é€šè¿‡åœ¨å‘½ä»¤è¡Œä¸Šä¼ é€’é…ç½®æ–‡ä»¶åç§°ï¼Œå¯ä»¥å°†å…¶ä»– Istio é…ç½®æ–‡ä»¶å®‰è£…åˆ°é›†ç¾¤ä¸­ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹å‘½ä»¤å¯ç”¨äºå®‰è£…"),t("code",[s._v("demo")]),s._v("é…ç½®æ–‡ä»¶ï¼š")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ kubectl  create  ns istio-system\n$ istioctl "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("profile")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("demo "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v("\nâœ” Istio core installed                                                   \nâœ” Istiod installed                                                  \nâœ” Egress gateways installed                                                        \nâœ” Ingress gateways installed                                                        \nâœ” Installation complete    \n")])])]),t("h3",{attrs:{id:"_5-æ£€æŸ¥å®‰è£…äº†ä»€ä¹ˆ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-æ£€æŸ¥å®‰è£…äº†ä»€ä¹ˆ"}},[s._v("#")]),s._v(" 5.æ£€æŸ¥å®‰è£…äº†ä»€ä¹ˆ")]),s._v(" "),t("p",[s._v("è¯¥"),t("code",[s._v("istioctl")]),s._v("å‘½ä»¤å°†"),t("code",[s._v("IstioOperator")]),s._v("ç”¨äºå®‰è£… Istioçš„CRä¿å­˜åœ¨åä¸º"),t("code",[s._v("installed-state")]),s._v(". è€Œä¸æ˜¯æ£€æŸ¥ Istio å®‰è£…çš„éƒ¨ç½²ã€podã€æœåŠ¡å’Œå…¶ä»–èµ„æºï¼Œä¾‹å¦‚ï¼š")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ kubectl "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" istio-system get deploy\nNAME                   READY   UP-TO-DATE   AVAILABLE   AGE\nistio-egressgateway    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("           25s\nistio-ingressgateway   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("           24s\nistiod                 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("           20s\n")])])]),t("h3",{attrs:{id:"_6-æ³¨å…¥é»˜è®¤å˜é‡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-æ³¨å…¥é»˜è®¤å˜é‡"}},[s._v("#")]),s._v(" 6.æ³¨å…¥é»˜è®¤å˜é‡")]),s._v(" "),t("p",[s._v("å°†ç›®å½•æ›´æ”¹ä¸º Istio å®‰è£…çš„æ ¹ç›®å½•ã€‚\né»˜è®¤çš„ Istio å®‰è£…ä½¿ç”¨"),t("a",{attrs:{href:"https://istio.io/latest/docs/setup/additional-setup/sidecar-injection/#automatic-sidecar-injection",target:"_blank",rel:"noopener noreferrer"}},[s._v("è‡ªåŠ¨è¾¹è½¦æ³¨å…¥"),t("OutboundLink")],1),s._v("ã€‚æ ‡è®°å°†æ‰˜ç®¡åº”ç”¨ç¨‹åºçš„å‘½åç©ºé—´"),t("code",[s._v("istio-injection=enabled")]),s._v("ï¼š")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ kubectl label namespace default istio-injection"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("enabled \n")])])]),t("h3",{attrs:{id:"å¸è½½-istio"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¸è½½-istio"}},[s._v("#")]),s._v(" å¸è½½ Istio")]),s._v(" "),t("p",[s._v("è¦ä»é›†ç¾¤ä¸­å®Œå…¨å¸è½½ Istioï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ istioctl x uninstall "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--purge")]),s._v("\n")])])]),t("p",[s._v("å¯é€‰"),t("code",[s._v("--purge")]),s._v("æ ‡å¿—å°†åˆ é™¤æ‰€æœ‰ Istio èµ„æºï¼ŒåŒ…æ‹¬å¯èƒ½ä¸å…¶ä»– Istio æ§åˆ¶å¹³é¢å…±äº«çš„é›†ç¾¤èŒƒå›´çš„èµ„æºã€‚")]),s._v(" "),t("h2",{attrs:{id:"æµ‹è¯•ä¸€ä¸ªå®ä¾‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æµ‹è¯•ä¸€ä¸ªå®ä¾‹"}},[s._v("#")]),s._v(" æµ‹è¯•ä¸€ä¸ªå®ä¾‹")]),s._v(" "),t("h3",{attrs:{id:"bookinfo"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#bookinfo"}},[s._v("#")]),s._v(" Bookinfo")]),s._v(" "),t("p",[t("strong",[s._v("Bookinfo åº”ç”¨ç¨‹åºåˆ†ä¸ºå››ä¸ªç‹¬ç«‹çš„å¾®æœåŠ¡ï¼š")])]),s._v(" "),t("ul",[t("li",[t("code",[s._v("productpage")]),s._v(". è¯¥"),t("code",[s._v("productpage")]),s._v("å¾®æœåŠ¡è°ƒç”¨"),t("code",[s._v("details")]),s._v("å’Œ"),t("code",[s._v("reviews")]),s._v("å¾®æœåŠ¡æ¥å¡«å……é¡µé¢ã€‚")]),s._v(" "),t("li",[t("code",[s._v("details")]),s._v(". è¯¥"),t("code",[s._v("details")]),s._v("å¾®æœåŠ¡åŒ…å«å›¾ä¹¦ä¿¡æ¯ã€‚")]),s._v(" "),t("li",[t("code",[s._v("reviews")]),s._v(". è¯¥"),t("code",[s._v("reviews")]),s._v("å¾®æœåŠ¡åŒ…å«äº†ä¹¦è¯„ã€‚å®ƒè¿˜è°ƒç”¨"),t("code",[s._v("ratings")]),s._v("å¾®æœåŠ¡ã€‚")]),s._v(" "),t("li",[t("code",[s._v("ratings")]),s._v(". è¯¥"),t("code",[s._v("ratings")]),s._v("å¾®æœåŠ¡åŒ…å«é¢„å®šä¼´éšä¹¦è¯„æ’åä¿¡æ¯ã€‚")])]),s._v(" "),t("p",[t("strong",[t("code",[s._v("reviews")]),s._v("å¾®æœåŠ¡æœ‰ 3 ä¸ªç‰ˆæœ¬ï¼š")])]),s._v(" "),t("ul",[t("li",[s._v("ç‰ˆæœ¬ v1 ä¸è°ƒç”¨è¯¥"),t("code",[s._v("ratings")]),s._v("æœåŠ¡ã€‚")]),s._v(" "),t("li",[s._v("ç‰ˆæœ¬ v2 è°ƒç”¨è¯¥"),t("code",[s._v("ratings")]),s._v("æœåŠ¡ï¼Œå¹¶å°†æ¯ä¸ªè¯„çº§æ˜¾ç¤ºä¸º 1 åˆ° 5 é¢—é»‘æ˜Ÿã€‚")]),s._v(" "),t("li",[s._v("ç‰ˆæœ¬ v3 è°ƒç”¨è¯¥"),t("code",[s._v("ratings")]),s._v("æœåŠ¡ï¼Œå¹¶å°†æ¯ä¸ªè¯„çº§æ˜¾ç¤ºä¸º 1 åˆ° 5 é¢—çº¢æ˜Ÿã€‚")])]),s._v(" "),t("p",[s._v("è¯¥åº”ç”¨ç¨‹åºçš„ç«¯åˆ°ç«¯æ¶æ„å¦‚ä¸‹æ‰€ç¤ºã€‚")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://pic.imgdb.cn/item/61ec02b22ab3f51d91299fc2.png",alt:""}})]),s._v(" "),t("h4",{attrs:{id:"ä½¿ç”¨istioéƒ¨ç½²åº”ç”¨ç¨‹åº"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä½¿ç”¨istioéƒ¨ç½²åº”ç”¨ç¨‹åº"}},[s._v("#")]),s._v(" ä½¿ç”¨Istioéƒ¨ç½²åº”ç”¨ç¨‹åº")]),s._v(" "),t("p",[s._v("ä½¿ç”¨ Istio è¿è¡Œç¤ºä¾‹ä¸éœ€è¦æ›´æ”¹åº”ç”¨ç¨‹åºæœ¬èº«ã€‚ç›¸åï¼Œæ‚¨åªéœ€è¦åœ¨æ”¯æŒ Istio çš„ç¯å¢ƒä¸­é…ç½®å’Œè¿è¡ŒæœåŠ¡ï¼Œå¹¶åœ¨æ¯ä¸ªæœåŠ¡æ—è¾¹æ³¨å…¥ Envoy sidecarã€‚ç”Ÿæˆçš„éƒ¨ç½²å°†å¦‚ä¸‹æ‰€ç¤ºï¼š")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://pic.imgdb.cn/item/61ec02b22ab3f51d91299fca.png",alt:""}})]),s._v(" "),t("h4",{attrs:{id:"å¯åŠ¨åº”ç”¨æœåŠ¡ğŸš€"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¯åŠ¨åº”ç”¨æœåŠ¡ğŸš€"}},[s._v("#")]),s._v(" å¯åŠ¨åº”ç”¨æœåŠ¡ğŸš€")]),s._v(" "),t("p",[s._v("ä½¿ç”¨ä»¥ä¸‹"),t("code",[s._v("kubectl")]),s._v("å‘½ä»¤éƒ¨ç½²æ‚¨çš„åº”ç”¨ç¨‹åºï¼š")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ kubectl apply "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" samples/bookinfo/platform/kube/bookinfo.yaml\n")])])]),t("h4",{attrs:{id:"æŸ¥çœ‹æ‰€æœ‰æœåŠ¡ğŸš€"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æŸ¥çœ‹æ‰€æœ‰æœåŠ¡ğŸš€"}},[s._v("#")]),s._v(" æŸ¥çœ‹æ‰€æœ‰æœåŠ¡ğŸš€")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master istio-1.9.5"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get svc ")]),s._v("\nNAME          TYPE        CLUSTER-IP       EXTERNAL-IP   PORT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    AGE\ndetails       ClusterIP   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.104")]),s._v(".17.202    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9080")]),s._v("/TCP   21m\nkubernetes    ClusterIP   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.1        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("/TCP    41m\nproductpage   ClusterIP   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.110")]),s._v(".235.179   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9080")]),s._v("/TCP   21m\nratings       ClusterIP   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.104")]),s._v(".53.51     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9080")]),s._v("/TCP   21m\nreviews       ClusterIP   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.101")]),s._v(".21.63     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9080")]),s._v("/TCP   21m\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master istio-1.9.5"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pods ")]),s._v("\nNAME                              READY   STATUS    RESTARTS   AGE\ndetails-v1-79f774bdb9-gwhkf       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          21m\nproductpage-v1-6b746f74dc-6dtg8   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          21m\nratings-v1-b6994bb9-9h2wn         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          21m\nreviews-v1-545db77b95-6cmmv       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          21m\nreviews-v2-7bf8c9648f-m2k9d       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          21m\nreviews-v3-84779c7bbc-vd86b       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          21m\n")])])]),t("h4",{attrs:{id:"é€šè¿‡curlè¯·æ±‚æµ‹è¯•ğŸš€"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é€šè¿‡curlè¯·æ±‚æµ‹è¯•ğŸš€"}},[s._v("#")]),s._v(" é€šè¿‡Curlè¯·æ±‚æµ‹è¯•ğŸš€")]),s._v(" "),t("p",[s._v("è¦ç¡®è®¤ Bookinfo åº”ç”¨ç¨‹åºæ­£åœ¨è¿è¡Œï¼Œè¯·é€šè¿‡"),t("code",[s._v("curl")]),s._v("æ¥è‡ªæŸä¸ª podçš„å‘½ä»¤å‘å…¶å‘é€è¯·æ±‚ï¼Œä¾‹å¦‚æ¥è‡ª"),t("code",[s._v("ratings")]),s._v("ï¼š")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master istio-1.9.5"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# kubectl exec "$(kubectl get pod -l app=ratings -o jsonpath=\'{.items[0].metadata.name}\')" -c ratings -- curl -sS productpage:9080/productpage | grep -o "<title>.*</title>"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("title"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("Simple Bookstore App"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/title"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),t("h4",{attrs:{id:"ç¡®å®šå…¥å£ipå’Œç«¯å£ğŸš€"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç¡®å®šå…¥å£ipå’Œç«¯å£ğŸš€"}},[s._v("#")]),s._v(" ç¡®å®šå…¥å£IPå’Œç«¯å£ğŸš€")]),s._v(" "),t("p",[s._v("ç°åœ¨ Bookinfo æœåŠ¡å·²å¯åŠ¨å¹¶è¿è¡Œï¼Œæ‚¨éœ€è¦ä½¿åº”ç”¨ç¨‹åºå¯ä» Kubernetes é›†ç¾¤å¤–éƒ¨è®¿é—®ï¼Œä¾‹å¦‚ä»æµè§ˆå™¨è®¿é—®ã€‚ä¸€ä¸ª"),t("a",{attrs:{href:"https://istio.io/latest/docs/concepts/traffic-management/#gateways",target:"_blank",rel:"noopener noreferrer"}},[s._v("Istioç½‘å…³"),t("OutboundLink")],1),s._v(" ç”¨äºæ­¤ç›®çš„ã€‚")]),s._v(" "),t("ol",[t("li",[t("strong",[t("code",[s._v("ä¸ºåº”ç”¨å®šä¹‰å…¥å£ç½‘å…³")])])])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master istio-1.9.5"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f samples/bookinfo/networking/bookinfo-gateway.yaml ")]),s._v("\ngateway.networking.istio.io/bookinfo-gateway created\nvirtualservice.networking.istio.io/bookinfo created\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[t("strong",[t("code",[s._v("ç¡®è®¤ç½‘å…³å·²åˆ›å»º")])])])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master istio-1.9.5"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get gateway ")]),s._v("\nNAME               AGE\nbookinfo-gateway   61s\n")])])]),t("ol",{attrs:{start:"3"}},[t("li",[t("strong",[t("code",[s._v("æ”¹ä¸ºNodePort")])]),s._v("\næ­¤å¤„æˆ‘ä»¬å¹¶æ²¡æœ‰å¤–éƒ¨è´Ÿè½½ï¼Œæ‰€ä»¥è¦å°†svcä¿®æ”¹æˆNodePortçš„æ–¹å¼ã€‚")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master istio-1.9.5"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get svc -n istio-system ")]),s._v("\nNAME                   TYPE         CLUSTER-IP      EXTERNAL-IP   PORT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                                                      AGE\nistio-egressgateway    ClusterIP    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.102")]),s._v(".197.30   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/TCP,443/TCP,15443/TCP                                                     89m\nistio-ingressgateway   LoadBalancer "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.109")]),s._v(".71.35    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15021")]),s._v(":31964/TCP,80:31467/TCP,443:31845/TCP,31400:31077/TCP,15443:30757/TCP   89m\nistiod                 ClusterIP    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.111")]),s._v(".156.86   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15010")]),s._v("/TCP,15012/TCP,443/TCP,15014/TCP                                        90m\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#è®¿é—®masterIP+80ç«¯å£å¯¹åº”æš´éœ²çš„31962")]),s._v("\n")])])]),t("p",[t("code",[s._v("æ³¨æ„ï¼š å¦‚æœ EXTERNAL-IP è®¾ç½®äº†è¯¥å€¼ï¼Œåˆ™è¦æ±‚æ‚¨çš„ç¯å¢ƒå…·æœ‰å¯ç”¨äº Ingress ç½‘å…³çš„å¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨ã€‚å¦‚æœ EXTERNAL-IP å€¼æ˜¯ <none>ï¼ˆæˆ–ä¸€ç›´æ˜¯ <pending> ï¼‰ï¼Œåˆ™è¯´æ˜å¯èƒ½æ‚¨çš„ç¯å¢ƒä¸æ”¯æŒä¸º ingress ç½‘å…³æä¾›å¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨çš„åŠŸèƒ½ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Service çš„ node port æ–¹å¼è®¿é—®ç½‘å…³ã€‚")])]),s._v(" "),t("p",[s._v("ä½¿ç”¨ kubectl patch æ›´æ–° istio-ingressgateway æœåŠ¡ç½‘å…³ç±»å‹")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master istio-1.9.5"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# kubectl patch service istio-ingressgateway -n istio-system -p \'{"spec":{"type":"NodePort"}}\'')]),s._v("\n")])])]),t("p",[s._v("è®¾ç½®å…¥å£ç«¯å£")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("INGRESS_PORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" istio-system get "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" istio-ingressgateway "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{.spec.ports[?(@.name==\"http2\")].nodePort}'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SECURE_INGRESS_PORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" istio-system get "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" istio-ingressgateway "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{.spec.ports[?(@.name==\"https\")].nodePort}'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TCP_INGRESS_PORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" istio-system get "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" istio-ingressgateway "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{.spec.ports[?(@.name==\"tcp\")].nodePort}'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n")])])]),t("p",[s._v("è·å–ingress ipåœ°å€")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("INGRESS_HOST")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl get po "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("istio")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ingressgateway "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" istio-system "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{.items[0].status.hostIP}'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n")])])]),t("p",[t("img",{attrs:{src:"https://pic.imgdb.cn/item/61ec02cb2ab3f51d9129b8c9.png",alt:""}})]),s._v(" "),t("h4",{attrs:{id:"åº”ç”¨é»˜è®¤ç›®æ ‡è§„åˆ™ğŸš€"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åº”ç”¨é»˜è®¤ç›®æ ‡è§„åˆ™ğŸš€"}},[s._v("#")]),s._v(" åº”ç”¨é»˜è®¤ç›®æ ‡è§„åˆ™ğŸš€")]),s._v(" "),t("p",[s._v("åœ¨ä½¿ç”¨ Istio æ§åˆ¶ Bookinfo ç‰ˆæœ¬è·¯ç”±ä¹‹å‰ï¼Œæ‚¨éœ€è¦åœ¨"),t("a",{attrs:{href:"https://istio.io/latest/docs/concepts/traffic-management/#destination-rules",target:"_blank",rel:"noopener noreferrer"}},[s._v("ç›®æ ‡è§„åˆ™ä¸­"),t("OutboundLink")],1),s._v("å®šä¹‰å¯ç”¨ç‰ˆæœ¬ï¼Œç§°ä¸º"),t("em",[s._v("å­é›†")]),s._v("ã€‚")]),s._v(" "),t("p",[s._v("è¿è¡Œä»¥ä¸‹å‘½ä»¤ä¸º Bookinfo æœåŠ¡åˆ›å»ºé»˜è®¤ç›®æ ‡è§„åˆ™ï¼š")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ kubectl apply "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" samples/bookinfo/networking/destination-rule-all.yaml\n")])])]),t("blockquote",[t("p",[s._v("åœ¨"),t("code",[s._v("default")]),s._v("ä¸"),t("code",[s._v("demo")]),s._v(" "),t("a",{attrs:{href:"https://istio.io/latest/docs/setup/additional-setup/config-profiles/",target:"_blank",rel:"noopener noreferrer"}},[s._v("é…ç½®è½®å»“"),t("OutboundLink")],1),s._v("å…·æœ‰"),t("a",{attrs:{href:"https://istio.io/latest/docs/tasks/security/authentication/authn-policy/#auto-mutual-tls",target:"_blank",rel:"noopener noreferrer"}},[s._v("è‡ªåŠ¨ç›¸äº’TLS"),t("OutboundLink")],1),s._v("å¯ç”¨é»˜è®¤æƒ…å†µä¸‹ã€‚è¦å¼ºåˆ¶å®æ–½åŒå‘ TLSï¼Œè¯·ä½¿ç”¨"),t("code",[s._v("samples/bookinfo/networking/destination-rule-all-mtls.yaml")]),s._v(".")])]),s._v(" "),t("h4",{attrs:{id:"æ¸…ç†ğŸš€"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ¸…ç†ğŸš€"}},[s._v("#")]),s._v(" æ¸…ç†ğŸš€")]),s._v(" "),t("p",[s._v("å½“æ‚¨å®Œæˆ Bookinfo ç¤ºä¾‹çš„è¯•éªŒåï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹è¯´æ˜å¸è½½å¹¶æ¸…ç†å®ƒï¼š\nåˆ é™¤è·¯ç”±è§„åˆ™å¹¶ç»ˆæ­¢åº”ç”¨ç¨‹åº Pod")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ samples/bookinfo/platform/kube/cleanup.sh\n")])])]),t("p",[s._v("ç¡®è®¤å…³æœº")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ kubectl get virtualservices   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#-- there should be no virtual services")]),s._v("\n$ kubectl get destinationrules  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#-- there should be no destination rules")]),s._v("\n$ kubectl get gateway           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#-- there should be no gateway")]),s._v("\n$ kubectl get pods              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#-- the Bookinfo pods should be deleted")]),s._v("\n")])])])])}),[],!1,null,null,null);t.default=r.exports}}]);