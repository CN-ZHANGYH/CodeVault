(window.webpackJsonp=window.webpackJsonp||[]).push([[161],{474:function(t,s,a){"use strict";a.r(s);var n=a(7),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"kubernetes-python-client"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes-python-client"}},[t._v("#")]),t._v(" Kubernetes Python Client")]),t._v(" "),s("h2",{attrs:{id:"æ¦‚è¿°"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ¦‚è¿°"}},[t._v("#")]),t._v(" æ¦‚è¿°")]),t._v(" "),s("p",[t._v("1."),s("strong",[t._v("Python kubernetesåº“çš„ä½¿ç”¨")])]),t._v(" "),s("p",[t._v("â€‹\t\tå•ä¸ª Dockeré€š å¸¸å¹¶ä¸èƒ½å®Œæˆæˆ‘ä»¬çš„æ—¥å¸¸ä»»åŠ¡ï¼Œæˆ‘ä»¬éœ€è¦å¤šä¸ª Docker ååŒå·¥ä½œï¼Œè¿™æ—¶å°±éœ€è¦ä¸€äº›å®¹å™¨ç¼–æ’å·¥å…·ï¼Œç®€å•æ¥è¯´å°±æ˜¯ä¸€äº›ç®¡ç†å®¹å™¨çš„å·¥å…·ã€‚ç°é˜¶æ®µï¼ŒGoogle å…¬å¸æä¾›çš„ kubernetes æ˜¯æœ€æµè¡Œçš„å®¹å™¨ç¼–æ’ç®¡ç†å·¥å…·ï¼Œæœ¬èŠ‚å°†ä»‹ç»è¯¥å·¥å…·çš„ä½¿ç”¨ã€‚")]),t._v(" "),s("p",[t._v("â€‹\t\tæˆ‘ä»¬ä»‹ç»çš„å·¥å…·å«ä½œ kubernetes-clientã€‚è¿™ä¸ªè½¯ä»¶åŒ…æ˜¯ kubernetes å›¢é˜Ÿæä¾›çš„ï¼Œæ›´æ–°é€Ÿåº¦è¿˜æ˜¯ä¸é”™çš„ã€‚å…¶ä»–ç±»ä¼¼çš„å¼€å‘åŒ…ä¹Ÿæœ‰ä¸€äº›ï¼Œå®ƒä»¬æä¾›å„è‡ªä¸åŒé£æ ¼çš„æ¥å£ï¼Œä½†æ˜¯æˆ‘ä»¬è¿™é‡Œä¸æ‰“ç®—ä»‹ç»ï¼Œä»…ä»…å…³æ³¨ kubernetes-client è¿™ä¸ªè½¯ä»¶åŒ…ã€‚")]),t._v(" "),s("p",[t._v("â€‹\t\tç”±äº kubernetes æ¶‰åŠçš„æ¦‚å¿µå’Œå†…å®¹éå¸¸å¤šï¼Œä¸€äº›åŸºç¡€çš„çŸ¥è¯†è¿™é‡Œå°±ç›´æ¥è·³è¿‡äº†ï¼Œä¾‹å¦‚å¦‚ä½•æ­å»ºä¸€ä¸ªkubernetesé›†ç¾¤ï¼Œå¦‚ä½•è®¾ç½®é›†ç¾¤ç”¨æˆ·ç­‰ï¼Œæ‰€ä»¥æœ¬èŠ‚å†…å®¹é€‚åˆæœ‰ä¸€å®š kubernetes æ“ä½œç»éªŒçš„äººé˜…è¯»ã€‚")]),t._v(" "),s("p",[s("code",[t._v("ä½¿ç”¨Pythonè®¿é—®K8sçš„é›†ç¾¤ï¼Œè°ƒç”¨ç›¸å¯¹äºçš„APIæ¥å£æœ‰ä¸¤ç§æ–¹æ³•ï¼Œä¸€ç§æ˜¯ä½¿ç”¨Tokenï¼Œä¸€ç§æ˜¯ä½¿ç”¨configæ–‡ä»¶ã€‚")])]),t._v(" "),s("p",[t._v("2."),s("strong",[t._v("Kuberneteså®˜æ–¹åº“é¡¹ç›®åœ°å€ï¼š")])]),t._v(" "),s("p",[t._v("Kuberneteså®˜æ–¹ç»´æŠ¤çš„Pythonå®¢æˆ·ç«¯client-pythonï¼Œ åœ°å€ï¼šhttps://github.com/kubernetes-client/python")]),t._v(" "),s("h3",{attrs:{id:"ğŸ·ï¸å®‰è£…æ¨¡å—"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ·ï¸å®‰è£…æ¨¡å—"}},[t._v("#")]),t._v(" ğŸ·ï¸å®‰è£…æ¨¡å—")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[t._v("$ pip3 install kubernetes\n")])])]),s("h3",{attrs:{id:"ğŸ·ï¸ç¯å¢ƒè¯´æ˜"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ·ï¸ç¯å¢ƒè¯´æ˜"}},[t._v("#")]),t._v(" ğŸ·ï¸ç¯å¢ƒè¯´æ˜")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"center"}},[t._v("æ“ä½œç³»ç»Ÿ")]),t._v(" "),s("th",{staticStyle:{"text-align":"center"}},[t._v("Centos7.9")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("K8sç‰ˆæœ¬")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("1.23.5")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("IPåœ°å€")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("10.11.121.111")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("ä¸»æœºåç§°")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("k8s-master")])])])]),t._v(" "),s("h2",{attrs:{id:"è·å–apiä¸token"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#è·å–apiä¸token"}},[t._v("#")]),t._v(" è·å–APIä¸token")]),t._v(" "),s("h4",{attrs:{id:"_1-è·å–cluster-urlåœ°å€"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-è·å–cluster-urlåœ°å€"}},[t._v("#")]),t._v(" 1.è·å–Cluster URLåœ°å€")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("APISERVER")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("kubectl config view "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--minify")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" server "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cut")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("- "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('":"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tr")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('" "')]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$APISERVER")]),t._v("\nhttps://10.11.121.111:6443\n")])])]),s("h4",{attrs:{id:"_2-åˆ›å»ºk8s-admin-token"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-åˆ›å»ºk8s-admin-token"}},[t._v("#")]),t._v(" 2.åˆ›å»ºk8s admin-token")]),t._v(" "),s("p",[t._v("ä½¿ç”¨clusterrolebindingå’ŒSAç»‘å®šä¸€ä¸ªadminçš„è§’è‰²ã€‚")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat admin-token.yaml")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClusterRoleBinding\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io/v1beta1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" admin\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("annotations")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rbac.authorization.kubernetes.io/autoupdate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("roleRef")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClusterRole\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cluster"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("admin\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroup")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subjects")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ServiceAccount\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" admin\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("system\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ServiceAccount\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" admin\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("system\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kubernetes.io/cluster-service")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("addonmanager.kubernetes.io/mode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Reconcile\n")])])]),s("h4",{attrs:{id:"_3-è·å–tokenå€¼"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-è·å–tokenå€¼"}},[t._v("#")]),t._v(" 3.è·å–tokenå€¼")]),t._v(" "),s("p",[t._v("é€šè¿‡ä»¥ä¸Šåˆ›å»ºå¥½çš„æƒé™ï¼ŒæŸ¥çœ‹å½“å‰çš„Tokenï¼Œæœ€åå°†tokenä¸APISERVERåœ°å€è¿”å›å†…å®¹å¤åˆ¶åˆ°python clientä¸»æœºä¸Š, ä¾›è„šæœ¬ä½¿ç”¨.")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s-master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  kubectl describe secret/$(kubectl get secret -nkube-system |grep admin|awk '{print $1}') -nkube-system|grep token:")]),t._v("\ntoken:      eyJhbGciOiJSUzI1NiIsImtpZCI6IndfU2t4TmtWbVBraHFDTWctWDAyb2NnTzBoQXVPemhXbEJaN3hHS3lrRnMifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJhZG1pbi10b2tlbi1yN3N3cSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50Lm5hbWUiOiJhZG1pbiIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6ImJiM2U3ZWNmLWU5ODYtNGI5OS05ZmJkLTkzZDI5OTMzNTkzMyIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDprdWJlLXN5c3RlbTphZG1pbiJ9.Bjc6sNWx_ag_sEr1dDA7Ln1Fg6hl1Cuyns4fad-aqxlJJnixdtoFod-AGZ6lgs6dcXP8lJ1sSHKp9d4xLsGvhZPLKS6OF0jAFNzRWtw_scFQIMboeiTkTZOVJcxJXjOglcxtNrrAii-N5yyQxbjuKSwGmjZbdt56jKZ9sye1WLvLBNBgaY7eAmDmOVd_UnFSE9IaNzBRE8a6sl2cEC45BRPlwQXZr4ogRLwvM794Y0P-8KkjBZ4wV2SkHpTOEtxM-FWpPiQJwcFJgpHp0dx8YTCZttKJK8f-JD_HiGlNf83EGlOkocHviwzMSZdteXU0numAUnSuS_2HpksdCn0N2g\n")])])]),s("h2",{attrs:{id:"åœ¨python-clientä¸»æœºä¸Šç¼–å†™è„šæœ¬"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#åœ¨python-clientä¸»æœºä¸Šç¼–å†™è„šæœ¬"}},[t._v("#")]),t._v(" åœ¨python clientä¸»æœºä¸Šç¼–å†™è„šæœ¬")]),t._v(" "),s("h3",{attrs:{id:"_1-åˆ›å»ºç›®å½•ç»“æ„"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-åˆ›å»ºç›®å½•ç»“æ„"}},[t._v("#")]),t._v(" 1.åˆ›å»ºç›®å½•ç»“æ„")]),t._v(" "),s("p",[t._v("è¿™é‡Œæˆ‘ä»¬è·å–çš„tokenä¼šå¼•å…¥åˆ°æˆ‘ä»¬çš„è„šæœ¬ä¸‹, ä½œä¸ºbearer authorizationçš„api keyä¸è¿œç¨‹k8s APIå»ºç«‹è®¤è¯è¿æ¥.")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" /kube/auth\n$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /kube/auth\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" token.txt\n")])])]),s("h3",{attrs:{id:"_2-ç¼–å†™python-clientè„šæœ¬"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-ç¼–å†™python-clientè„šæœ¬"}},[t._v("#")]),t._v(" 2.ç¼–å†™python clientè„šæœ¬")]),t._v(" "),s("h4",{attrs:{id:"è·å–çš„å‘½åç©ºé—´"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#è·å–çš„å‘½åç©ºé—´"}},[t._v("#")]),t._v(" è·å–çš„å‘½åç©ºé—´")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" kubernetes "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("config\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KubernetesTools")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("object")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("__init__")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("k8s_url "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://10.11.121.111:6443'")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get_token")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""\n        è·å–token\n        :return:\n        """')]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("open")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'token.txt'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'r'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("file")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            Token "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("file")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("read"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("strip"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\\n'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" Token\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get_api")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""\n        è·å–APIçš„CoreV1Apiç‰ˆæœ¬å¯¹è±¡\n        :return:\n        """')]),t._v("\n        configuration "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Configuration"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        configuration"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("host "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("k8s_url\n        configuration"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("verify_ssl "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),t._v("\n        configuration"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("api_key "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"authorization"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Bearer "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_token"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        client1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ApiClient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("configuration"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("configuration"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        api "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CoreV1Api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("client1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" api\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get_namespace_list")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""\n        è·å–å‘½åç©ºé—´åˆ—è¡¨\n        :return:\n        """')]),t._v("\n        api "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        namespace_list "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" ns "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("list_namespace"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("items"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# print(ns.metadata.name)")]),t._v("\n            namespace_list"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("append"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ns"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("metadata"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" namespace_list\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" __name__ "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'__main__'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    namespace_list "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" KubernetesTools"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_namespace_list"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("namespace_list"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("æ‰§è¡Œè¾“å‡ºï¼š")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("'default'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 'istio-system'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 'kube-node-lease'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 'kube-public'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 'kube-system'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[t._v("æ³¨æ„ï¼šè¾“å‡ºæ—¶ï¼Œä¼šæœ‰ä¸€æ®µè­¦å‘Šä¿¡æ¯")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("InsecureRequestWarning")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Unverified "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("HTTPS")]),t._v(" request is being made to host "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'192.168.31.74'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" Adding certificate verification is strongly advised"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" See"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" https"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("urllib3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("readthedocs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("io"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("en"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("latest"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("advanced"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("usage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html#ssl"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("warnings\n  InsecureRequestWarning"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])]),s("p",[t._v("è¿™ä¸ªæ˜¯requestsåº“æç¤ºè­¦å‘Šï¼Œå› ä¸ºæˆ‘æ˜¯ipè®¿é—®çš„ï¼Œæ‰€ä»¥SSLéªŒè¯ä¼šå¤±è´¥ã€‚ä½†è¿™ä¸ªä¸å½±å“ã€‚")]),t._v(" "),s("h4",{attrs:{id:"è·å–æ‰€æœ‰services"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#è·å–æ‰€æœ‰services"}},[t._v("#")]),t._v(" è·å–æ‰€æœ‰services")]),t._v(" "),s("p",[t._v("åœ¨ä¸Šé¢çš„ä»£ç åŸºç¡€ä¸Šï¼Œå†åŠ ä¸€ä¸ªæ–¹æ³•")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get_services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""\n        è·å–æ‰€æœ‰services\n        :return:\n        """')]),t._v("\n        api "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        ret "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("list_service_for_all_namespaces"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("watch"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" ret"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("items"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%s \\t%s \\t%s \\t%s \\t%s \\n"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n                i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("kind"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("metadata"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("namespace"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("metadata"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("spec"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cluster_ip"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("spec"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ports"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("å•ç‹¬æ‰§è¡Œè¿™ä¸ªæ–¹æ³•ï¼Œä¼šè¾“å‡ºå¾ˆå¤šä¿¡æ¯ã€‚æˆ‘è¿™é‡Œæ˜¯kube-systemå’Œdefaultçš„èµ„æºã€‚å¯ä»¥çœ‹åˆ°å¾ˆå¤šä¿¡æ¯ï¼ŒåŒ…æ‹¬serviceåï¼Œsvcåœ°å€ï¼Œä»¥åŠnode_portæš´éœ²çš„ç«¯å£")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("None \t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" \tkubernetes \t"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.96")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),t._v(" \t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'app_protocol'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" None"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'name'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'node_port'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" None"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'port'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'protocol'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'TCP'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'target_port'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6443")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" \n\nNone \tkube"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("system \tkube"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("dns \t"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.96")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".10")]),t._v(" \t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'app_protocol'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" None"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'name'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dns'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'node_port'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" None"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'port'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("53")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'protocol'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'UDP'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'target_port'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("53")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'app_protocol'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" None"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'name'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dns-tcp'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'node_port'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" None"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'port'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("53")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'protocol'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'TCP'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'target_port'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("53")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'app_protocol'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" None"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'name'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'metrics'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'node_port'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" None"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'port'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9153")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'protocol'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'TCP'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'target_port'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9153")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" \n\n")])])]),s("h4",{attrs:{id:"è·å–podä¿¡æ¯"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#è·å–podä¿¡æ¯"}},[t._v("#")]),t._v(" è·å–podä¿¡æ¯")]),t._v(" "),s("p",[t._v("å…ˆç™»å½•k8s-masterï¼ŒæŸ¥çœ‹ç›®å‰è¿è¡Œçš„pod")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("master "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("# kubectl "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("get")]),t._v(" pods\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NAME")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("READY")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("STATUS")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("RESTARTS")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("AGE")]),t._v("\nnginx   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          2m41s\n")])])]),s("p",[t._v("åœ¨ä¸Šé¢çš„ä»£ç åŸºç¡€ä¸Šï¼Œå†åŠ ä¸€ä¸ªæ–¹æ³•")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get_pod_info")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("namespaces"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("pod_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""\n        æŸ¥çœ‹podä¿¡æ¯\n        :param namespaces: å‘½ä»¤ç©ºé—´ï¼Œæ¯”å¦‚ï¼šdefault\n        :param pod_name: podå®Œæ•´åç§°ï¼Œæ¯”å¦‚ï¼šnginx\n        :return:\n        """')]),t._v("\n        api "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ç¤ºä¾‹å‚æ•°")]),t._v("\n        namespaces "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default"')]),t._v("\n        pod_name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nginx"')]),t._v("\n        resp "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("read_namespaced_pod"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("namespace"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("namespaces"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("pod_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#è¯¦ç»†ä¿¡æ¯")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("resp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("æ‰§è¡Œæ­¤æ–¹æ³•ï¼Œè¾“å‡ºä»¥ä¸‹ä¿¡æ¯ï¼Œç”±äºè¾“å‡ºè¿‡å¤šï¼Œä½¿ç”¨...çœç•¥")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'api_version'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'v1'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'kind'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Pod'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n")])])]),s("p",[t._v("å®ƒä¼šè¾“å‡ºä¸€æ®µå¾ˆé•¿çš„jsonï¼Œé‡Œé¢åŒ…å«äº†æ­¤podçš„è¯¦ç»†ä¿¡æ¯")]),t._v(" "),s("h4",{attrs:{id:"è·å–podæ—¥å¿—"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#è·å–podæ—¥å¿—"}},[t._v("#")]),t._v(" è·å–podæ—¥å¿—")]),t._v(" "),s("p",[t._v("åœ¨ä¸Šé¢çš„ä»£ç åŸºç¡€ä¸Šï¼Œå†åŠ ä¸€ä¸ªæ–¹æ³•")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get_pod_logs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("namespaces"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("pod_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""\n        æŸ¥çœ‹podæ—¥å¿—\n        :param namespaces: å‘½ä»¤ç©ºé—´ï¼Œæ¯”å¦‚ï¼šdefault\n        :param pod_name: podå®Œæ•´åç§°ï¼Œæ¯”å¦‚ï¼šnginx\n        :return:\n        """')]),t._v("\n        api "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ç¤ºä¾‹å‚æ•°")]),t._v("\n        namespaces "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default"')]),t._v("\n        pod_name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nginx"')]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""\n        prettyç¾åŒ–è¾“å‡º\n        tail_lines=200è¾“å‡ºæœ€è¿‘200è¡Œ\n        """')]),t._v("\n        log_content "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("read_namespaced_pod_log"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pod_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" namespaces"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" pretty"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" tail_lines"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("log_content"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("æ‰§è¡Œæ­¤æ–¹æ³•ï¼Œè¾“å‡ºä»¥ä¸‹ä¿¡æ¯ï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration\n/docker-entrypoint.sh: Looking "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" shell scripts "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" /docker-entrypoint.d/\n/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" /etc/nginx/conf.d/default.conf\n/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh\n/docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh\n/docker-entrypoint.sh: Configuration complete"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" ready "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" start up\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("/04/21 02:48:47 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("notice"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#1: using the "epoll" event method')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("/04/21 02:48:47 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("notice"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#1: nginx/1.21.5")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("/04/21 02:48:47 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("notice"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#1: built by gcc 10.2.1 20210110 (Debian 10.2.1-6) ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("/04/21 02:48:47 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("notice"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#1: OS: Linux 3.10.0-1160.el7.x86_64")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("/04/21 02:48:47 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("notice"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("/04/21 02:48:47 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("notice"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#1: start worker processes")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("/04/21 02:48:47 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("notice"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#1: start worker process 32")]),t._v("\n")])])]),s("p",[t._v("è¿™ä¸ªæ˜¯nginxè¿è¡Œä¹‹åï¼Œè¾“å‡ºçš„æ—¥å¿—ä¿¡æ¯ã€‚")]),t._v(" "),s("h2",{attrs:{id:"ä½¿ç”¨configæ–‡ä»¶è¿æ¥api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä½¿ç”¨configæ–‡ä»¶è¿æ¥api"}},[t._v("#")]),t._v(" ä½¿ç”¨configæ–‡ä»¶è¿æ¥API")]),t._v(" "),s("h3",{attrs:{id:"_1-å¤åˆ¶configæ–‡ä»¶"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-å¤åˆ¶configæ–‡ä»¶"}},[t._v("#")]),t._v(" 1.å¤åˆ¶configæ–‡ä»¶")]),t._v(" "),s("p",[t._v("é¦–å…ˆæˆ‘ä»¬éœ€è¦å°†"),s("code",[t._v("~/.kube/config")]),t._v("æ–‡ä»¶å¤åˆ¶åˆ°å½“å‰çš„é¡¹ç›®ç›®å½•ä¸‹ã€‚")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cd ~/.kube/")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@k8s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master .kube"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat config")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("clusters")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cluster")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("certificate-authority-data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" LS0tLS1CRUdJTiBDRVJUSUZJQ0FU==\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//10.11.121.111"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6443")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("contexts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("context")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cluster")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("user")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("admin\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("admin@kubernetes\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("current-context")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("admin@kubernetes\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Config\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("preferences")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("users")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("admin\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("user")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("client-certificate-data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" LS0tLS1CRUdJTiBDRVJ==\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("client-key-data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" LS0tLS1CRUdJTiBSU0EgUFJJVko=\n")])])]),s("p",[t._v("å¦‚ä¸‹æ˜¯é¡¹ç›®æ–‡ä»¶æ ‘ï¼š")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204211112872.png",alt:"image-20220421111223477"}})]),t._v(" "),s("h3",{attrs:{id:"_2-ç¼–å†™python-clientè„šæœ¬-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-ç¼–å†™python-clientè„šæœ¬-2"}},[t._v("#")]),t._v(" 2.ç¼–å†™Python clientè„šæœ¬")]),t._v(" "),s("h4",{attrs:{id:"æŸ¥çœ‹å½“å‰çš„æ‰€æœ‰pod"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æŸ¥çœ‹å½“å‰çš„æ‰€æœ‰pod"}},[t._v("#")]),t._v(" æŸ¥çœ‹å½“å‰çš„æ‰€æœ‰Pod")]),t._v(" "),s("p",[t._v("kubernetes é›†ç¾¤æœ¬èº«ä¹Ÿæœ‰ä¸€äº›ç³»ç»Ÿpodåœ¨è¿è¡Œï¼Œè¿™äº›å®¹å™¨ä¸»è¦å®Œæˆé›†ç¾¤çš„ç®¡ç†å·¥ä½œã€‚ä¸‹é¢æ˜¯å®Œæ•´çš„ä»£ç ã€‚")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" kubernetes "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" config       "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# å¼•å…¥æˆ‘ä»¬è¦ç”¨çš„åŒ…")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get_pod")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("                              "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# å®šä¹‰æˆ‘ä»¬çš„ä¸»å‡½æ•°")]),t._v("\n    config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("load_kube_config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("r'kubeconfig.yaml'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("         "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# è¯»å…¥é›†ç¾¤ç›¸å…³ä¿¡æ¯ï¼Œå°±æ˜¯è¦æ“ä½œå“ªä¸ªé›†ç¾¤")]),t._v("\n    v1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CoreV1Api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("                             "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# å¾—åˆ°å®¢æˆ·ç«¯ä¸­çš„ä¸€ä¸ªç»„æ¥å£")]),t._v("\n                                                        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# æŸ¥è¯¢æ‰€æœ‰çš„podä¿¡æ¯")]),t._v("\n    ret "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" v1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("list_pod_for_all_namespaces"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("watch"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" ret"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("items"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("                                 "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# éå†å¾—åˆ°çš„pod")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%s\\t%s\\t%s"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("                            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# æ˜¾ç¤ºpodçš„IPåœ°å€ã€æ‰€å±å‘½åç©ºé—´å’Œåå­—")]),t._v("\n              "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pod_ip"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("metadata"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("namespace"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("metadata"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" __name__ "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'__main__'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("                              "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ä½œä¸ºè„šæœ¬æ—¶è¿è¡Œ")]),t._v("\n    get_pod"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("                                           "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# è¿è¡Œä¸»ç¨‹åº")]),t._v("\n")])])]),s("p",[t._v("è¿è¡Œåçš„è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".169.136\tdefault\tnginx\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".36.73\tkube-system\tcalico-kube-controllers-7c845d499-t9zwb\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.11")]),t._v(".121.112\tkube-system\tcalico-node-cj8bb\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.11")]),t._v(".121.113\tkube-system\tcalico-node-hbkk8\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.11")]),t._v(".121.111\tkube-system\tcalico-node-nwrhm\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".36.74\tkube-system\tcoredns-6d8c4cb4d-cwvqj\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".169.133\tkube-system\tcoredns-6d8c4cb4d-rh786\nÂ·Â·Â·\n")])])]),s("h4",{attrs:{id:"ç›‘è§†è¿™äº›äº‹ä»¶"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç›‘è§†è¿™äº›äº‹ä»¶"}},[t._v("#")]),t._v(" ç›‘è§†è¿™äº›äº‹ä»¶")]),t._v(" "),s("p",[t._v("åœ¨ kubernetes ä¸­å®šä¹‰äº†å¾ˆå¤šäº‹ä»¶ï¼Œå¦‚æŸä¸ª pod è¢«åˆ›å»ºäº†ã€æŸä¸ª pod è¢«é‡æ–°éƒ¨ç½²äº†ç­‰ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ä»£ç ç›‘è§†è¿™äº›äº‹ä»¶ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" kubernetes "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" watch\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("event_demo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("load_kube_config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("r'kubeconfig.yaml'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# å¾—åˆ°é›†ç¾¤ä¿¡æ¯")]),t._v("\n    v1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CoreV1Api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("             "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# å¾—åˆ°æ¥å£å®ä¾‹")]),t._v("\n    count "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("                          "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# è¯»å–10ä¸ªäº‹ä»¶")]),t._v("\n    w "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" watch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Watch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("                   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# åˆ›å»ºä¸€ä¸ªç›‘è§†å¯¹è±¡")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" event "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" w"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stream"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("v1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("list_namespace"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" timeout_seconds"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Event: %s %s"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'type'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'object'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n            metadata"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        count "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("                      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# æ‰“å°äº‹ä»¶çš„ç±»å‹å’Œåå­—")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" count"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("                   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# å¦‚æœæ£€æµ‹åˆ°è¶³å¤Ÿæ•°é‡çš„äº‹ä»¶ï¼Œé€€å‡ºå¾ªç¯")]),t._v("\n            w"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stop"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Ended."')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("                     "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# é€€å‡ºå¾ªç¯")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" __name__ "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'__main__'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    event_demo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("è¿è¡Œåçš„è¾“å…¥ç»“æœå¦‚ä¸‹ï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("Event: ADDED test123\nEvent: ADDED gitlab-runner\nEvent: ADDED kube-system\nEvent: ADDED kube-public\nEvent: ADDED kube-node-lease\nEvent: ADDED default\nEnded.\n")])])]),s("h4",{attrs:{id:"æŸ¥è¯¢æ¥å£ç‰ˆæœ¬"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æŸ¥è¯¢æ¥å£ç‰ˆæœ¬"}},[t._v("#")]),t._v(" æŸ¥è¯¢æ¥å£ç‰ˆæœ¬")]),t._v(" "),s("p",[t._v("kubernetes çš„å‡çº§é€Ÿåº¦å¾ˆå¿«ï¼Œæ‰€ä»¥æ¥å£çš„ç‰ˆæœ¬ä¹Ÿæ¯”è¾ƒå¤šã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥è¯¢çš„æ–¹å¼å¾—åˆ°æŸä¸ªé›†ç¾¤æ”¯æŒçš„æ¥å£ç‰ˆæœ¬å’Œæ¨èçš„ç‰ˆæœ¬ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" kubernetes "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" config\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("query_api_ver")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("load_kube_config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("r'kubeconfig.yaml'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# å¾—åˆ°é›†ç¾¤ä¿¡æ¯")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Supported APIs (* is preferred version):"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%-20s %s"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("\t\t\t\t\t\t\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# æ‰“å°ç‰ˆæœ¬ä¿¡æ¯")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"core"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('","')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("join"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CoreApi"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_api_versions"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("versions"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" api "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ApisApi"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_api_versions"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("groups"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        versions "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" v "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("versions"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" v"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("version "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("preferred_version"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("version "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("and")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("len")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n                    api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("versions"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*"')]),t._v("\n            name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" v"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("version\n            versions"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("append"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%-40s %s"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('","')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("join"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("versions"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" __name__ "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'__main__'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    query_api_ver"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("è¿è¡Œåçš„è¾“å‡ºå¦‚ä¸‹ï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("Supported APIs "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("* is preferred version"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(":\ncore                 v1\napiregistration.k8s.io                   v1\napps                                     v1\nevents.k8s.io                            *v1,v1beta1\nauthentication.k8s.io                    v1\nauthorization.k8s.io                     v1\nautoscaling                              *v2,v1,v2beta1,v2beta2\nbatch                                    *v1,v1beta1\ncertificates.k8s.io                      v1\nnetworking.k8s.io                        v1\npolicy                                   *v1,v1beta1\nrbac.authorization.k8s.io                v1\nstorage.k8s.io                           *v1,v1beta1\nadmissionregistration.k8s.io             v1\napiextensions.k8s.io                     v1\nscheduling.k8s.io                        v1\ncoordination.k8s.io                      v1\nnode.k8s.io                              *v1,v1beta1\ndiscovery.k8s.io                         *v1,v1beta1\nflowcontrol.apiserver.k8s.io             *v1beta2,v1beta1\ncrd.projectcalico.org                    v1\n")])])]),s("h4",{attrs:{id:"åˆ›å»ºdeployment"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#åˆ›å»ºdeployment"}},[t._v("#")]),t._v(" åˆ›å»ºDeployment")]),t._v(" "),s("p",[t._v("ä½¿ç”¨appsæ¥å£åˆ›å»ºdeploymentï¼Œè¯»å–ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯kubeconfig.yamlä¸€ä¸ªæ˜¯æ¨¡æ¿nginx-deployment.yamlæ–‡ä»¶ã€‚")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" os "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" path\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" yaml\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" kubernetes "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" config\n\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Configs can be set in Configuration class directly or using helper")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# utility. If no argument provided, the config will be loaded from")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# default location.")]),t._v("\n    config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("load_kube_config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("r'kubeconfig.yaml'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("open")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("join"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dirname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__file__"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nginx-deployment.yaml"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" f"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        dep "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" yaml"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("safe_load"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("f"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        k8s_apps_v1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AppsV1Api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        resp "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" k8s_apps_v1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("create_namespaced_deployment"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n            body"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("dep"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" namespace"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"Deployment created. status='%s'\"")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v(" resp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("metadata"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" __name__ "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'__main__'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    main"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("è¿è¡Œåçš„è¾“å‡ºå¦‚ä¸‹ï¼š")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("Deployment created. "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("status")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'nginx-deployment'")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);