(window.webpackJsonp=window.webpackJsonp||[]).push([[204],{517:function(t,s,a){"use strict";a.r(s);var n=a(7),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"ansible部署rabbitmq集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ansible部署rabbitmq集群"}},[t._v("#")]),t._v(" Ansible部署Rabbitmq集群")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("节点")]),t._v(" "),s("th",[t._v("IP")]),t._v(" "),s("th",[t._v("主机名")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("ansible")]),t._v(" "),s("td",[t._v("172.25.253.137")]),t._v(" "),s("td",[t._v("ansible")])]),t._v(" "),s("tr",[s("td",[t._v("node1")]),t._v(" "),s("td",[t._v("172.25.253.138")]),t._v(" "),s("td",[t._v("node1")])]),t._v(" "),s("tr",[s("td",[t._v("node2")]),t._v(" "),s("td",[t._v("172.25.253.139")]),t._v(" "),s("td",[t._v("node2")])]),t._v(" "),s("tr",[s("td",[t._v("node3")]),t._v(" "),s("td",[t._v("172.25.253.140")]),t._v(" "),s("td",[t._v("node3")])])])]),t._v(" "),s("blockquote",[s("h3",{attrs:{id:"查看当前文件树"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看当前文件树"}},[t._v("#")]),t._v(" 查看当前文件树")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible ansible"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# tree rabbitmq/ ")]),t._v("\nrabbitmq/\n├── hosts\n├── local.repo\n├── playbook.yaml\n├── rabbitmq.sh\n└── scp.sh\n")])])]),s("blockquote",[s("h3",{attrs:{id:"查看ansible主机清单"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看ansible主机清单"}},[t._v("#")]),t._v(" 查看ansible主机清单")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible rabbitmq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat /etc/ansible/hosts ")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.25")]),t._v(".253.138 "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("hostname")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("node1\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.25")]),t._v(".253.140 "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("hostname")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("node3\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.25")]),t._v(".253.139 "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("hostname")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("node2\n")])])]),s("blockquote",[s("h3",{attrs:{id:"ansible部署rabbitmq集群-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ansible部署rabbitmq集群-2"}},[t._v("#")]),t._v(" ansible部署rabbitmq集群")])]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("使用playbook编写一键部署集群")])]),t._v(" "),s("li",[s("strong",[t._v("配置好所有机器的ssh免密")])]),t._v(" "),s("li",[s("strong",[t._v("更改好hosts配置文件、local.repo、以及编写两个脚本")])]),t._v(" "),s("li",[s("strong",[t._v("编写playbook")])])]),t._v(" "),s("h4",{attrs:{id:"_1-配置hosts文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-配置hosts文件"}},[t._v("#")]),t._v(" 1.配置hosts文件")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("配置三个节点的映射以及解析主机名")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible rabbitmq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat hosts ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.25")]),t._v(".253.138 node1 \n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.25")]),t._v(".253.139 node2\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.25")]),t._v(".253.140 node3 \n")])])]),s("h4",{attrs:{id:"_2-配置yum源"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置yum源"}},[t._v("#")]),t._v(" 2.配置yum源")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("可以使用file本地yum源也可以使用http源")])]),t._v(" "),s("li",[s("strong",[t._v("这里为了方便使用http源")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible rabbitmq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat local.repo  ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("rabbitmq-repo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("rabbitmq-repo\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("baseurl")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("http://172.25.253.144/file/rabbitmq-repo/\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("gpgcheck")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n")])])]),s("h4",{attrs:{id:"_3-编写scp-sh"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-编写scp-sh"}},[t._v("#")]),t._v(" 3.编写scp.sh")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("scp传送文件的时候用主机名会需要输入密码 ip地址不会显示输入密码")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible rabbitmq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat scp.sh  ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#!/bin/bash")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("scp")]),t._v(" /var/lib/rabbitmq/.erlang.cookie root@172.25.253.139:/var/lib/rabbitmq/.erlang.cookie\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("scp")]),t._v(" /var/lib/rabbitmq/.erlang.cookie root@172.25.253.140:/var/lib/rabbitmq/.erlang.cookie\n")])])]),s("h4",{attrs:{id:"_4-编写rabbitmq-sh"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-编写rabbitmq-sh"}},[t._v("#")]),t._v(" 4.编写rabbitmq.sh")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("使用shell脚本自动化加入集群")])]),t._v(" "),s("li",[s("strong",[t._v("停止集群状态")])]),t._v(" "),s("li",[s("strong",[t._v("加入磁盘节点node1")])]),t._v(" "),s("li",[s("strong",[t._v("启动集群状态")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible rabbitmq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat rabbitmq.sh ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#!/bin/bash ")]),t._v("\n\nrabbitmqctl stop_app\nrabbitmqctl join_cluster "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--ram")]),t._v(" rabbit@node1\nrabbitmqctl start_app\n")])])]),s("h4",{attrs:{id:"_5-编写playbook"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-编写playbook"}},[t._v("#")]),t._v(" 5.编写playbook")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("使用copy模块传输文件")])]),t._v(" "),s("li",[s("strong",[t._v("使用yum和service模块安装和开启服务的状态")])]),t._v(" "),s("li",[s("strong",[t._v("使用script模块运行脚本")])]),t._v(" "),s("li",[s("strong",[t._v("标记好更改配置文件用notify，使用handlers重启服务 利用一个item的循环")])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible rabbitmq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat playbook.yaml  ")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" first tasks \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" server \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("remote_user")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" root \n\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tasks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" copy hosts \n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("copy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" src=hosts dest=/etc/hosts\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" delete repo \n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("shell")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rm "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("rf /etc/yum.repos.d/* \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" copy repo \n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("copy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" src=local.repo dest=/etc/yum.repos.d/local.repo \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Install packages\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("yum")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" name=rabbitmq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server state=present \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" start rabbitmq\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("service")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" name=rabbitmq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server state=started \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" run sh \n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" scp.sh\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("when")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(' ansible_fqdn == "node1"\n    '),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Install UI\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("shell")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rabbitmq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("plugins enable rabbitmq_management\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("notify")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  restart service3\n\n\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("handlers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" restart service3\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("service")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" name=rabbitmq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server state=restarted \n\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" two tasks\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" server\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("remote_user")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" root\n  \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tasks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" run rabbitmq.sh \n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rabbitmq.sh \n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("when")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ansible_fqdn ==  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"item"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with_items")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" node2 \n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" node3\n")])])]),s("h4",{attrs:{id:"_6-执行脚本"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-执行脚本"}},[t._v("#")]),t._v(" 6.执行脚本")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible rabbitmq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ansible-playbook playbook.yaml  ")]),t._v("\n\nPLAY "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("first tasks"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" ******************************************************************************************************************************\n\nTASK "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Gathering Facts"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" **************************************************************************************************************************\nok: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.25")]),t._v(".253.138"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nok: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.25")]),t._v(".253.139"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nok: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.25")]),t._v(".253.140"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\nTASK "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("copy hosts"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" *******************************************************************************************************************************\nok: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.25")]),t._v(".253.138"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nok: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.25")]),t._v(".253.140"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nok: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.25")]),t._v(".253.139"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n·\n·\n·\n\nPLAY RECAP **************************************************************************************************************************************\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.25")]),t._v(".253.138             "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ok")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("changed")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("unreachable")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("failed")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("skipped")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("rescued")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ignored")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("   \n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.25")]),t._v(".253.139             "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ok")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("changed")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("unreachable")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("failed")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("skipped")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("rescued")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ignored")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("   \n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.25")]),t._v(".253.140             "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ok")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("changed")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("unreachable")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("failed")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("skipped")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("rescued")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ignored")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("   \n")])])]),s("h4",{attrs:{id:"_7-检查集群状态"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-检查集群状态"}},[t._v("#")]),t._v(" 7.检查集群状态")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible rabbitmq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# ansible server -m shell -a "rabbitmqctl cluster_status"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.25")]),t._v(".253.138 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" CHANGED "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("rc")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v("\nCluster status of "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("node")]),t._v(" rabbit@node1 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("nodes,"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("disc,"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("rabbit@node1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(","),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("ram,"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("rabbit@node3,rabbit@node2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("running_nodes,"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("rabbit@node2,rabbit@node3,rabbit@node1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("cluster_name,"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rabbit@node1"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("partitions,"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".done.\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.25")]),t._v(".253.140 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" CHANGED "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("rc")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v("\nCluster status of "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("node")]),t._v(" rabbit@node3 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("nodes,"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("disc,"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("rabbit@node1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(","),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("ram,"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("rabbit@node3,rabbit@node2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("running_nodes,"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("rabbit@node1,rabbit@node2,rabbit@node3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("cluster_name,"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rabbit@node1"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("partitions,"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".done.\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.25")]),t._v(".253.139 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" CHANGED "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("rc")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v("\nCluster status of "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("node")]),t._v(" rabbit@node2 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("nodes,"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("disc,"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("rabbit@node1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(","),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("ram,"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("rabbit@node3,rabbit@node2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("running_nodes,"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("rabbit@node1,rabbit@node3,rabbit@node2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("cluster_name,"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rabbit@node1"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("partitions,"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".done.\n")])])]),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204111251209.png",alt:"image-20211013202726146"}})]),t._v(" "),s("h4",{attrs:{id:"_8-记录rabbitmq集群的更新"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-记录rabbitmq集群的更新"}},[t._v("#")]),t._v(" 8.记录Rabbitmq集群的更新：")]),t._v(" "),s("p",[t._v("这里我使用的是fetch和file模块对rabbitmq集群的密钥进行传输")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible rabbit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vim rabbit.yaml  ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rabbit\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("remote_user")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" root\n\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tasks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rm repofile\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("shell")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rm "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("rf /etc/yum.repos.d/*\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" copy repofile\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("copy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" local.repo\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/yum.repos.d/\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("backup")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" tar repo.tar\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("unarchive")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rabbitmq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("repo.tar.gz\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /opt/\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("remote_src")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" no\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" install rabbitmq\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("yum")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rabbitmq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("state")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" latest\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" service\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("service")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rabbitmq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("state")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" started\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" fetch\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fetch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /root/rabbit/\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  /var/lib/rabbitmq/.erlang.cookie\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("flat")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" yes\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("when")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(' ansible_fqdn == "node'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v('1"\n  '),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" copy erlang.conf\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("copy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /root/rabbit/.erlang.cookie\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /var/lib/rabbitmq/.erlang.cookie\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("when")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ansible_fqdn ==  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"item"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("      \n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with_items")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  \n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" node"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" \n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" node"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" chmod\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("file")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /var/lib/rabbitmq/.erlang.cookie\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("owner")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rabbitmq\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("group")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rabbitmq\n\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);