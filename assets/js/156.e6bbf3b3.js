(window.webpackJsonp=window.webpackJsonp||[]).push([[156],{470:function(t,s,a){"use strict";a.r(s);var e=a(7),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"ceph对接k8s存储使用rbd"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ceph对接k8s存储使用rbd"}},[t._v("#")]),t._v(" Ceph对接K8S存储使用RBD")]),t._v(" "),s("h2",{attrs:{id:"环境搭建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#环境搭建"}},[t._v("#")]),t._v(" 环境搭建")]),t._v(" "),s("h3",{attrs:{id:"使用服务器规划"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用服务器规划"}},[t._v("#")]),t._v(" 使用服务器规划")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("Master")]),t._v(" "),s("th",[t._v("node1")]),t._v(" "),s("th",[t._v("node2")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("192.168.0.61")]),t._v(" "),s("td",[t._v("192.168.0.2")]),t._v(" "),s("td",[t._v("192.168.0.53")])])])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("Ceph1")]),t._v(" "),s("th",[t._v("Ceph2")]),t._v(" "),s("th",[t._v("Ceph3")]),t._v(" "),s("th",[t._v("Ceph4")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("192.168.0.130")]),t._v(" "),s("td",[t._v("192.168.0.141")]),t._v(" "),s("td",[t._v("192.168.0.249")]),t._v(" "),s("td",[t._v("192.168.0.47")])]),t._v(" "),s("tr",[s("td",[t._v("硬盘10G*3")]),t._v(" "),s("td",[t._v("硬盘10G*3")]),t._v(" "),s("td",[t._v("硬盘10G*3")]),t._v(" "),s("td",[t._v("硬盘10G*3")])])])]),t._v(" "),s("h3",{attrs:{id:"ceph集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ceph集群"}},[t._v("#")]),t._v(" Ceph集群")]),t._v(" "),s("p",[t._v("使用ceph-deploy的方式将Ceph集群搭建完成。")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ceph1 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ceph -s ")]),t._v("\n  cluster:\n    id:     1ca010d2-42d2-4ce8-b7da-4c2cf70ac697\n    health: HEALTH_OK\n \n  services:\n    mon: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" daemons, quorum ceph4,ceph1,ceph2,ceph3 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("age 90m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    mgr: ceph1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("active, since 96m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(", standbys: ceph4, ceph3, ceph2\n    mds: cephfs:1 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ceph1"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("up:active"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" up:standby\n    osd: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" osds: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" up "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("since 115m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("since 115m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n \n  data:\n    pools:   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" pools, "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("320")]),t._v(" pgs\n    objects: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("133")]),t._v(" objects, "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("273")]),t._v(" MiB\n    usage:   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v(" GiB used, "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("107")]),t._v(" GiB / "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("120")]),t._v(" GiB avail\n    pgs:     "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("320")]),t._v(" active+clean\n \n  io:\n    client:   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v(" KiB/s rd, "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(" op/s rd, "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" op/s wr\n")])])]),s("h3",{attrs:{id:"k8s集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#k8s集群"}},[t._v("#")]),t._v(" k8s集群")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get node")]),t._v("\nNAME     STATUS   ROLES                  AGE    VERSION\nmaster   Ready    control-plane,master   153m   v1.20.0\nnode1    Ready    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("                 152m   v1.20.0\nnode2    Ready    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("                 152m   v1.20.0\n")])])]),s("h2",{attrs:{id:"k8s连接对接外部ceph集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#k8s连接对接外部ceph集群"}},[t._v("#")]),t._v(" k8s连接对接外部ceph集群")]),t._v(" "),s("h3",{attrs:{id:"对接存储简介"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#对接存储简介"}},[t._v("#")]),t._v(" 对接存储简介")]),t._v(" "),s("p",[s("strong",[t._v("一共 6 种方式对接ceph存储集群：")])]),t._v(" "),s("ol",[s("li",[t._v("直接使用ceph的文件系统")]),t._v(" "),s("li",[t._v("直接使用ceph的块存储")]),t._v(" "),s("li",[t._v("使用社区提供的 cephfs 做持久数据卷")]),t._v(" "),s("li",[t._v("使用社区提供的 RBD 做 pod 的持久存储")]),t._v(" "),s("li",[t._v("使用 官方 ceph-csi 的 cephfs 方式")]),t._v(" "),s("li",[t._v("使用 官方 ceph-csi 的 rbd 方式")])]),t._v(" "),s("blockquote",[s("p",[t._v("这里主要是动态基于 sc 创建 pvc，为 k8s提供动态申请 pv的功能，ceph提供底层存储功能。")]),t._v(" "),s("p",[t._v("1、社区")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("cephfs 做持久数据卷")])]),t._v(" "),s("li",[s("code",[t._v("RBD 做 pod 的持久存储")])])]),t._v(" "),s("p",[t._v("2、官方 ceph-csi")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("cephfs 方式")])]),t._v(" "),s("li",[s("code",[t._v("rbd 方式")])])])]),t._v(" "),s("p",[s("strong",[t._v("k8s可以通过两种方式使用 ceph做 volume:")]),t._v(" "),s("strong",[s("code",[t._v("cephfs和 rbd")])])]),t._v(" "),s("ol",[s("li",[t._v("一个 Ceph 集群仅支持一个 CephFS")]),t._v(" "),s("li",[t._v("cephfs方式支持k8s的pv的3种访问模式 "),s("code",[t._v("ReadWriteOnce、ReadOnlyMany 、ReadWriteMany")])]),t._v(" "),s("li",[t._v("RBD支持 ReadWriteOnce、ReadOnlyMany 两种模式")])]),t._v(" "),s("blockquote",[s("p",[t._v("注意：访问模式只是能力描述，并不是强制执行的，对于没有按pvc声明的方式使用pv，存储提供者应该负责访问时的运行错误。例如如果设置pvc的访问模式为 ReadOnlyMany ，pod挂载后依然可写，如果需要真正的不可写，申请pvc是需要指定 readOnly: true 参数")])]),t._v(" "),s("p",[s("strong",[t._v("k8s使用 volume的方法：")])]),t._v(" "),s("ol",[s("li",[t._v("直接方式: Volume->backend")]),t._v(" "),s("li",[t._v("静态配备: Volume->PersistentVolumeClaim->PersistentVolume->Backend")]),t._v(" "),s("li",[t._v("动态配备: Volume->PersistentVolumeClaim->StorageClass->Backend")])]),t._v(" "),s("h3",{attrs:{id:"rbd的方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#rbd的方式"}},[t._v("#")]),t._v(" rbd的方式")]),t._v(" "),s("p",[t._v("1、所有"),s("code",[t._v("k8s节点")]),t._v("安装依赖组件，配置yum源安装ceph-common")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat /etc/yum.repos.d/ceph.repo ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ceph \n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("baseurl")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("gpgcheck")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" \n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("enabled")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" \n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# for i in master node1 node2 ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("scp")]),t._v(" /etc/yum.repos.d/ceph.repo "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v(":/etc/yum.repos.d/ceph.repo \n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ssh")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"yum install -y ceph-common"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v("\n")])])]),s("p",[t._v("2、查看当前的"),s("code",[t._v("ceph集群")]),t._v("配置文件")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ceph1 my-cluster"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat /etc/ceph/ceph.conf ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("global"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nfsid "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" 1ca010d2-42d2-4ce8-b7da-4c2cf70ac697\npublic_network "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.0/24\ncluster_network "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.0/24\nmon_initial_members "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ceph1, ceph2, ceph3, ceph4\nmon_host "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.130,192.168.0.141,192.168.0.249,192.168.0.47\nauth_cluster_required "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cephx\nauth_service_required "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cephx\nauth_client_required "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cephx\n\nmon_allow_pool_delete "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\nmon_max_pg_per_osd "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2000")]),t._v("\n")])])]),s("p",[t._v("3、在"),s("code",[t._v("ceph1的控制节点")]),t._v("上面同步配置文件")]),t._v(" "),s("p",[t._v("将admin的ceph权限以及配置文件分发到k8s集群，发完权限可以在k8s集群上操作ceph集群，也可以在ceph集群中操作，以下是在k8s集群下操作ceph集群")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ceph1 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ssh-copy-id master")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ceph1 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ssh-copy-id node1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ceph1 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ssh-copy-id node2")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ceph1 my-cluster"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ceph-deploy --overwrite-conf admin  ceph2 ceph3 ceph4 master node1 node2 ")]),t._v("\n")])])]),s("p",[t._v("4、创建存储池并开启rbd功能")]),t._v(" "),s("p",[t._v("创建kube池给k8s集群使用，在kube池下面创建一个20G的镜像")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ceph osd pool create kube 128 128 ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# rbd create -p kube -s 20G ceph-image")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# rbd info --image kube/ceph-image")]),t._v("\nrbd image "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ceph-image'")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v("\n        size "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" GiB "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5120")]),t._v(" objects\n        order "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" MiB objects"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        snapshot_count: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n        id: ac9857b1b5fd\n        block_name_prefix: rbd_data.ac9857b1b5fd\n        format: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n        features: layering, exclusive-lock\n        op_features: \n        flags: \n        create_timestamp: Sat Feb  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":48:37 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("\n        access_timestamp: Sat Feb  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":48:37 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("\n        modify_timestamp: Sat Feb  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":48:37 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("\n")])])]),s("p",[t._v("5、创建ceph用户，提供给k8s使用")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看ceph集群中的认证用户及相关的key")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ceph auth list")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ceph auth get-or-create client.kube mon 'allow r' osd 'allow class-read object_prefix  rbd_children,allow rwx pool=kube'")]),t._v("\n")])])]),s("p",[t._v("6、创建secret资源")]),t._v(" "),s("blockquote",[s("p",[t._v("base64 单向加密一下，k8s不以明文方式存储账号密码")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ceph auth get-key client.admin | base64")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("QVFERUVQNWhQbE96QnhBQWNyUkp1dVdrc2d1N2FJdGZneDltbHc9PQ")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ceph auth get-key client.kube | base64")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("QVFCd0cvNWg2cW9XRHhBQXM0ZkluZEFIMDZnVTdtcG9tTlF3UVE9PQ")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v("\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mkdir jtpv && cd jtpv")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master jtpv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl create secret generic ceph-admin-secret  \\")]),t._v("\n--from-literal"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("QVFERUVQNWhQbE96QnhBQWNyUkp1dVdrc2d1N2FJdGZneDltbHc9PQ"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--dry-run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" yaml "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" ceph-adminsecret.yaml  \n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master jtpv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl create secret generic ceph-kube-secret  \\")]),t._v("\n--from-literal"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("QVFCd0cvNWg2cW9XRHhBQXM0ZkluZEFIMDZnVTdtcG9tTlF3UVE9PQ"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--dry-run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" yaml "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" ceph-adminsecret.yaml  \n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master jtpv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f .")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master jtpv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get secrets ")]),t._v("\nNAME                  TYPE                                  DATA   AGE\nceph-admin-secret     kubernetes.io/rbd                     "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("      106m\nceph-kube-secret      kubernetes.io/rbd                     "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("      106m\ndefault-token-2nnk5   kubernetes.io/service-account-token   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("      3h3m\n")])])]),s("blockquote",[s("p",[t._v("secret的两个yaml文件如下：")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master jtpv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat ceph-admin-secret.yaml ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" QVFERUVQNWhQbE96QnhBQWNyUkp1dVdrc2d1N2FJdGZneDltbHc9PQ==\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Secret\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("creationTimestamp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token null important"}},[t._v("null")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("admin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("secret\n  \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master jtpv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat ceph-kube-secret.yaml ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" QVFCd0cvNWg2cW9XRHhBQXM0ZkluZEFIMDZnVTdtcG9tTlF3UVE9PQ==\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Secret\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("creationTimestamp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token null important"}},[t._v("null")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("kube"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("secret\n")])])]),s("p",[t._v("7、创建PV连接存储池")]),t._v(" "),s("ul",[s("li",[t._v("PV的名称叫"),s("code",[t._v("ceph-pv-test")])]),t._v(" "),s("li",[t._v("申请的PV是"),s("code",[t._v("10Gi")]),t._v("的大小")]),t._v(" "),s("li",[t._v("读写模式是"),s("code",[t._v("ReadWriteMany")])]),t._v(" "),s("li",[t._v("rbd的mon节点分别是"),s("code",[t._v("四个ceph的osd节点")])]),t._v(" "),s("li",[t._v("存储池使用的是创建的"),s("code",[t._v("kube")]),t._v("，镜像使用"),s("code",[t._v("ceph-image")]),t._v("，用户使用"),s("code",[t._v("admin")]),t._v("，密钥使用创建好的"),s("code",[t._v("secret")]),t._v("，文件格式使用"),s("code",[t._v("ext4")]),t._v("，"),s("code",[t._v("关闭只读")])]),t._v(" "),s("li",[t._v("pv的策略使用"),s("code",[t._v("Retain")])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master jtpv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat pv.yaml ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1 \n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PersistentVolume\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("test \n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("capacity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("storage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10Gi \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("accessModes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ReadWriteMany\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rbd")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("monitors")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 192.168.0.130"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6789")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 192.168.0.141"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6789")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 192.168.0.249"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("67889")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 192.168.0.47"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6789")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pool")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube \n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("image\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("user")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" admin \n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("secretRef")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("admin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("secret\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fsType")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ext4 \n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("readOnly")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("persistentVolumeReclaimPolicy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Retain \n")])])]),s("p",[t._v("8、创建pvc")]),t._v(" "),s("ul",[s("li",[t._v("创建PVC的名称是pvc-test-claim")]),t._v(" "),s("li",[t._v("读写模式使用ReadWriteMany")]),t._v(" "),s("li",[t._v("一共申请的PV有10G的大小，PVC申请5Gi存储使用")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master jtpv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat pvc.yaml ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1 \n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PersistentVolumeClaim \n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" pvc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("test"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("claim \n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("accessModes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ReadWriteMany \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("requests")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("storage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 5Gi \n")])])]),s("p",[t._v("查看当前的pv和pvc的状态")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master jtpv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get pv,pvc ")]),t._v("\nNAME                             CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                    STORAGECLASS   REASON   AGE\npersistentvolume/ceph-pv-test    10Gi       RWX            Retain           Bound    default/pvc-test-claim                           116m\n\nNAME                                   STATUS        VOLUME         CAPACITY   ACCESS MODES   STORAGECLASS   AGE\npersistentvolumeclaim/pvc-test-claim   Terminating   ceph-pv-test   10Gi       RWX                           114m\n")])])]),s("p",[t._v("9、禁用image功能集")]),t._v(" "),s("p",[t._v("以下操作可以在第一个Pod挂载PVC报错里面找到，直接复制执行。")]),t._v(" "),s("p",[t._v("RBD图像功能集不匹配。您可以使用“rbd feature disable kube/ceph image object map fast diff deep flatten”禁用内核不支持的功能。")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master jtpv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# rbd feature disable kube/ceph-image object-map fast-diff deep-flatten")]),t._v("\n")])])]),s("p",[t._v("10、使用Pod测试PVC")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master jtpv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat pod.yaml ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Pod\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pod\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" busybox"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.24")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pod\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sleep'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'60000'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumeMounts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" pvc \n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPath")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /usr/share/busybox\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" pvc \n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("persistentVolumeClaim")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("claimName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" pvc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("test"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("claim\n      \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master jtpv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get pods ")]),t._v("\nNAME       READY   STATUS    RESTARTS   AGE\nceph"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pod   1/1     Running   0          113m\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master jtpv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl exec -it ceph-pod -- sh")]),t._v("\n/ "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# df  | grep rbd")]),t._v("\n/dev/rbd0             20511312     45080  20449848   0% /usr/share/busybox\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);