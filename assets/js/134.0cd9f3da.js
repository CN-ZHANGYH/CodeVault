(window.webpackJsonp=window.webpackJsonp||[]).push([[134],{446:function(a,s,t){"use strict";t.r(s);var e=t(7),r=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"docker"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker"}},[a._v("#")]),a._v(" Docker")]),a._v(" "),s("h2",{attrs:{id:"docker介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker介绍"}},[a._v("#")]),a._v(" Docker介绍")]),a._v(" "),s("p",[s("strong",[a._v("Docker 是一个开源的应用容器引擎，让开发者可以打包他们的应用以及依赖包到一个可移植的镜像中，然后发布到任何流行的 Linux或Windows 机器上，也可以实现虚拟化。"),s("code",[a._v("容器是完全使用沙箱机制，相互之间不会有任何接口。")])])]),a._v(" "),s("p",[s("img",{attrs:{src:"https://pic.imgdb.cn/item/61ebf8fd2ab3f51d911f7336.png",alt:""}})]),a._v(" "),s("h2",{attrs:{id:"docker组成"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker组成"}},[a._v("#")]),a._v(" Docker组成")]),a._v(" "),s("p",[s("strong",[a._v("一个完整的 Docker 有以下几个部分组成：")])]),a._v(" "),s("ul",[s("li",[s("code",[a._v("DockerClient 客户端")])]),a._v(" "),s("li",[s("code",[a._v("Docker Daemon 守护进程")])]),a._v(" "),s("li",[s("code",[a._v("Docker Image 镜像")])]),a._v(" "),s("li",[s("code",[a._v("DockerContainer 容器")])])]),a._v(" "),s("h2",{attrs:{id:"docker-的安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-的安装"}},[a._v("#")]),a._v(" Docker 的安装")]),a._v(" "),s("p",[a._v("在线安装和离线安装\nDocker 阿里镜像加速仓库在线安装")]),a._v(" "),s("h3",{attrs:{id:"安装步骤"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装步骤"}},[a._v("#")]),a._v(" 安装步骤")]),a._v(" "),s("p",[s("strong",[a._v("1.官网中文安装参考手册")]),a._v("\nhttps://docs.docker-cn.com/engine/installation/linux/docker-ce/centos/")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("确定你是 CentOS7 及以上版本\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" /etc/redhat-release\n\nyum 安装 gcc 相关 \n$ yum "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" gcc\n$ yum "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" gcc -c++\n\n卸载旧版本\n")])])]),s("p",[s("strong",[a._v("2.安装需要的软件包")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ yum "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" yum-utils device-mapper-persistent-data lvm2\n")])])]),s("p",[s("strong",[a._v("3.拉取docker镜像仓库")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\n")])])]),s("p",[s("strong",[a._v("4.更新 yum 软件包索引")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ yum makecache fast\n")])])]),s("p",[s("strong",[a._v("5.安装 DOCKER CE")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ yum "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" docker-ce\n启动 "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v("\n$ systemctl start "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" systemctl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("enable")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v("\n测试\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" version\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run hello-world\n")])])]),s("p",[s("strong",[a._v("6.配置镜像加速")]),a._v("\n阿里云镜像加速地址： https://ably8t50.mirror.aliyuncs.com")]),a._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[a._v("$ vim  /etc/docker/daemon.json\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"registry-mirrors"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"https://ably8t50.mirror.aliyuncs.com"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n加载配置重启服务\n$ systemctl daemon-reload\n$ systemctl restart docker\n\n卸载\n$ systemctl stop docker\n$ yum -y remove docker-ce\n$ rm -rf /var/lib/docker\n")])])]),s("h2",{attrs:{id:"docker-私有仓库离线安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-私有仓库离线安装"}},[a._v("#")]),a._v(" Docker 私有仓库离线安装")]),a._v(" "),s("p",[a._v("Docker 私有仓库\n"),s("code",[a._v("docker-registry (opens new window)是官方提供的工具，可以用于构建私有的镜像仓库。本文内 容基于 docker-registry (opens new window)v2.x 版本。")])]),a._v(" "),s("h3",{attrs:{id:"配置仓库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置仓库"}},[a._v("#")]),a._v(" 配置仓库")]),a._v(" "),s("p",[a._v("配置私有仓库的时候，json 文件如下格式：")]),a._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[a._v("$ cat >> /etc/docker/daemon.json << EOF\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("  \n\n"),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"insecure-registries"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"192.168.100.10:5000"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\nEOF\n")])])]),s("h3",{attrs:{id:"安装运行-docker-registry"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装运行-docker-registry"}},[a._v("#")]),a._v(" 安装运行 docker-registry")]),a._v(" "),s("p",[a._v("使用官方 registry 镜像来运行:")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5000")]),a._v(":5000 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--restart")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("always "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" registry registry\n")])])]),s("p",[s("code",[a._v("默认情况下，仓库会被创建在容器的 /var/lib/registry 目录下。你可以通过 -v 参数来将镜像 文件存放在本地的指定路径。例如下面的例子将上传的镜像放到本地的 /opt/data/registry 目 录。")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("    \n\t"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5000")]),a._v(":5000 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n\t"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" registry "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n\t"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--restart")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("always  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n\t"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /opt/data/registry:/var/lib/registry "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n\tregistry:latest\n")])])]),s("h3",{attrs:{id:"仓库使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#仓库使用"}},[a._v("#")]),a._v(" 仓库使用")]),a._v(" "),s("p",[a._v("在私有仓库上传、搜索、下载镜像\n"),s("code",[a._v("创建好私有仓库之后，就可以使用 docker tag 来标记一个镜像，然后推送它到仓库。例如私有仓库地址为 127.0.0.1:5000。")])]),a._v(" "),s("p",[a._v("先在本机查看已有的镜像。")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" image "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v("\nREPOSITORY                    TAG                 IMAGE ID            CREATED             VIRTUAL SIZE\nubuntu                        latest              ba5877dc9bec        "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("6")]),a._v(" weeks ago         "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.7")]),a._v(" MB\n")])])]),s("p",[a._v("使用 docker tag 将 ubuntu:latest 这个镜像标记为 127.0.0.1:5000/ubuntu:latest。\n"),s("code",[a._v("格式为docker tag IMAGE[:TAG] [REGISTRY_HOST[:REGISTRY_PORT]/]REPOSITORY[:TAG]。")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" tag ubuntu:latest "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.1:5000/ubuntu:latest\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" image "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v("\nREPOSITORY                    TAG                 IMAGE ID            CREATED             VIRTUAL SIZE\nubuntu                        latest              ba5877dc9bec        "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("6")]),a._v(" weeks ago         "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.7")]),a._v(" MB\n"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.1:5000/ubuntu:latest  latest              ba5877dc9bec        "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("6")]),a._v(" weeks ago         "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.7")]),a._v(" MB\n")])])]),s("p",[a._v("使用 docker push 上传标记的镜像。")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" push "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.1:5000/ubuntu:latest\nThe push refers to repository "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.1:5000/ubuntu"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n373a30c24545: Pushed\na9148f5200b0: Pushed\ncdd3de0940ab: Pushed\nfc56279bbb33: Pushed\nb38367233d37: Pushed\n2aebd096e0e2: Pushed\nlatest: digest: sha256:fe4277621f10b5026266932ddf760f5a756d2facd505a94d2da12f4f52f71f5a size: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1568")]),a._v("\n")])])]),s("p",[a._v("用 curl 查看仓库中的镜像。")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.1:5000/v2/_catalog\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"repositories"')]),a._v(":"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"ubuntu"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("h3",{attrs:{id:"下载镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#下载镜像"}},[a._v("#")]),a._v(" 下载镜像")]),a._v(" "),s("p",[a._v('这里可以看到 {"repositories":["ubuntu"]}，表明镜像已经被成功上传了。\n先删除已有镜像，再尝试从私有仓库中下载这个镜像。')]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" image "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.1:5000/ubuntu:latest\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" pull "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.1:5000/ubuntu:latest\nPulling repository "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.1:5000/ubuntu:latest\nba5877dc9bec: Download complete\n511136ea3c5a: Download complete\n9bad880da3d2: Download complete\n25f11f5fb0cb: Download complete\nebc34468f71d: Download complete\n2318d26665ef: Download complete\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" image "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v("\nREPOSITORY                         TAG                 IMAGE ID            CREATED             VIRTUAL SIZE\n"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.1:5000/ubuntu:latest       latest              ba5877dc9bec        "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("6")]),a._v(" weeks ago         "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.7")]),a._v(" MB\n")])])]),s("h2",{attrs:{id:"docker-的常用命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-的常用命令"}},[a._v("#")]),a._v(" Docker 的常用命令")]),a._v(" "),s("ul",[s("li",[s("code",[a._v("docker info")]),a._v("  信息描述")]),a._v(" "),s("li",[s("code",[a._v("docker version")]),a._v(" 版本信息")]),a._v(" "),s("li",[s("code",[a._v("docker --help")]),a._v("   帮助命令")])]),a._v(" "),s("h3",{attrs:{id:"镜像命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#镜像命令"}},[a._v("#")]),a._v(" 镜像命令")]),a._v(" "),s("p",[s("strong",[a._v("docker images 列出本地主机上的镜像")])]),a._v(" "),s("p",[s("img",{attrs:{src:"https://pic.imgdb.cn/item/61ebf91b2ab3f51d911f96e3.png",alt:""}})]),a._v(" "),s("p",[s("img",{attrs:{src:"https://pic.imgdb.cn/item/61ebf9a02ab3f51d9120224d.png",alt:""}})]),a._v(" "),s("p",[s("strong",[a._v("docker search 某个 xx 镜像的名字")]),a._v(" "),s("img",{attrs:{src:"https://pic.imgdb.cn/item/61ebf9b42ab3f51d91203831.png",alt:""}})]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" search nginx \nNAME                              DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED\nnginx                             Official build of Nginx.                        "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("15928")]),a._v("     "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("OK"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("   \njwilder/nginx-proxy               Automated Nginx reverse proxy "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" con…   "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2101")]),a._v("      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("OK"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\nricharvey/nginx-php-fpm           Container running Nginx + PHP-FPM capable of…   "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("820")]),a._v("       "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("OK"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\njc21/nginx-proxy-manager          Docker container "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" managing Nginx proxy ho…   "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("288")]),a._v("             \nlinuxserver/nginx                 An Nginx container, brought to you by LinuxS…   "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("160")]),a._v("             \n")])])]),s("h3",{attrs:{id:"下载镜像-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#下载镜像-2"}},[a._v("#")]),a._v(" 下载镜像")]),a._v(" "),s("p",[a._v("$ docker pull 镜像名字[：TAG]")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" pull nginx 等价于 "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" pull nginx:latest （latest 最新版）\n删除某个 xx 镜像的名字 ID\n删除镜像 "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" rmi 镜像 ID （要先删除容器才能删）\n删除单个 "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" rmi "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" 镜像 ID （-f 强制删除）\n删除多个 "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" rmi "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" 镜像名 "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(":TAG 镜像名 "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(":TAG\n删除全部 "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" rmi "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" images "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-qa")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("\n")])])]),s("h3",{attrs:{id:"导出镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#导出镜像"}},[a._v("#")]),a._v(" 导出镜像")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@docker01 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker image list")]),a._v("\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\ncentos              latest              ff426288ea90        "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v(" weeks ago         207MB\nnginx               latest              3f8a4339aadd        "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),a._v(" weeks ago         108MB\n\n"),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'导出'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@docker01 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker image save centos > docker-centos.tar.gz")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'导入镜像'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@docker01 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker image load -i docker-centos.tar.gz  ")]),a._v("\ne15afa4858b6: Loading layer  "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("215")]),a._v(".8MB/215.8MB\nLoaded image: centos:latest\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@docker01 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker image list")]),a._v("\nREPOSITORY    TAG         IMAGE ID        CREATED         SIZE\ncentos        latest      ff426288ea90    "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v(" weeks ago     207MB\nnginx         latest      3f8a4339aadd    "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),a._v(" weeks ago     108MB\n")])])]),s("h3",{attrs:{id:"容器命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#容器命令"}},[a._v("#")]),a._v(" 容器命令")]),a._v(" "),s("p",[a._v("启动容器\n"),s("code",[a._v("docker run [OPTIONS] IMAGE [COMMAND][ARG...]")]),a._v(" "),s("a",{attrs:{href:"https://pic.imgdb.cn/item/61ebf92d2ab3f51d911faaab.png",target:"_blank",rel:"noopener noreferrer"}},[s("img",{attrs:{src:"https://pic.imgdb.cn/item/61ebf92d2ab3f51d911faaab",alt:""}}),s("OutboundLink")],1)]),a._v(" "),s("p",[a._v("启动交互式容器\n"),s("code",[a._v("列出当前所有正在运行的容器")]),a._v(" "),s("img",{attrs:{src:"https://pic.imgdb.cn/item/61ebf9e82ab3f51d9120713b.png",alt:""}})]),a._v(" "),s("p",[s("code",[a._v("ps 列出当前所有正在运行的容器")]),a._v(" "),s("img",{attrs:{src:"https://pic.imgdb.cn/item/61ebf9fb2ab3f51d91208cc8.png",alt:""}})]),a._v(" "),s("h3",{attrs:{id:"退出容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#退出容器"}},[a._v("#")]),a._v(" 退出容器")]),a._v(" "),s("p",[s("strong",[a._v("两种退出方式")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exit")]),a._v(" \t\t容器停止退出\nctrl+P+Q \t容器不停止退出 \n")])])]),s("h3",{attrs:{id:"启动容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动容器"}},[a._v("#")]),a._v(" 启动容器")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" start 容器 ID 或者容器名字\n")])])]),s("h3",{attrs:{id:"重启容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#重启容器"}},[a._v("#")]),a._v(" 重启容器")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" restart 容器 ID 或者容器名字\n")])])]),s("h3",{attrs:{id:"停止容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#停止容器"}},[a._v("#")]),a._v(" 停止容器")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" stop 容器 ID 或者容器名字\n")])])]),s("h3",{attrs:{id:"强制停止容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#强制停止容器"}},[a._v("#")]),a._v(" 强制停止容器")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("kill")]),a._v(" 容器 ID 或者容器名字\n")])])]),s("h3",{attrs:{id:"删除已停止的容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#删除已停止的容器"}},[a._v("#")]),a._v(" 删除已停止的容器")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" 容器 ID\n")])])]),s("h3",{attrs:{id:"一次性删除多个容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一次性删除多个容器"}},[a._v("#")]),a._v(" 一次性删除多个容器")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ps")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-a")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-q")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ps")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-a")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-q")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("xargs")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" 重要\n")])])]),s("h3",{attrs:{id:"启动守护式容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动守护式容器"}},[a._v("#")]),a._v(" 启动守护式容器")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" 容器名\n")])])]),s("p",[s("strong",[a._v("使用镜像 centos:latest 以后台模式启动一个容器")]),a._v("\ndocker run -d centos\n问题:然后 docker ps -a 进行查看,会发现容器已经退出 很重要的要说明的一点:"),s("code",[a._v("Docker 容器后台运行,就必须有一个前台进程. 容器运行的命令如果不是那些一直挂起的命令(比如运行 top，tail)，就是会自 动退出的。")]),a._v("这个是 docker 的机制问题,比如你的 web 容器，我们以 nginx 为例，正常情况 下，我们配置启动服务只需要启动响应的 service 即可。"),s("code",[a._v("例如 service nginx start 但是,这样做,nginx 为后台进程模式运行,就导致 docker 前台没有运行的应用, 这样的容器后台启动后，会立即自杀因为他觉得他没事可做了. 所以，最佳的解决方案是,将你要运行的程序以前台进程的形式运行")])]),a._v(" "),s("p",[a._v("查看容器日志")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" logs "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--tail")]),a._v(" 容器 ID\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" 是加入时间戳\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" 跟随最新的日志打印\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--tail")]),a._v(" 数字 显示最后多少条\n")])])]),s("p",[a._v("查看容器内运行的进程")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("top")]),a._v(" 容器 ID\n")])])]),s("p",[a._v("查看容器内部细节")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" inspect 容器 ID\n")])])]),s("p",[a._v("进入正在运行的容器并以命令行交互")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" 容器 ID bashshell\n")])])]),s("p",[a._v("重新进入 docker attach 容器 ID")]),a._v(" "),s("p",[a._v("上述两个区别")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("attach 直接进入容器启动命令的终端，不会启动新的进程\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" 是在容器中打开新的终端，并且可以启动新的进程\n")])])]),s("h2",{attrs:{id:"docker-容器数据卷"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-容器数据卷"}},[a._v("#")]),a._v(" Docker 容器数据卷")]),a._v(" "),s("h3",{attrs:{id:"_1-是什么"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-是什么"}},[a._v("#")]),a._v(" 1.是什么")]),a._v(" "),s("p",[a._v("先来看看 Docker 的理念: "),s("code",[a._v("将运用与运行的环境打包形成容器运行，运行可以伴随着容器，但是我们 对数 据的要求希望是持久化的 容器之间希望有可能共享数据Docker 容器产生的数据，如果不通过 docker commit 生成新的镜像，使得数据做 为镜像的一部分保存下来， 那么当容器删除后，数据自然也就没有了。")]),a._v(" 为了能保存数据在 docker 中我们使用卷。")]),a._v(" "),s("h3",{attrs:{id:"_2-能干嘛"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-能干嘛"}},[a._v("#")]),a._v(" 2.能干嘛")]),a._v(" "),s("ul",[s("li",[a._v("卷就是目录或文件，存在于一个或多个容器中，由 docker 挂载到容器，但不属 于联合文件系统，因此能够绕过 Union File System 提供一些用于持续存储或共 "),s("code",[a._v("享数据的特性")]),a._v(":")]),a._v(" "),s("li",[a._v("卷的设计目的就是数据的持久化，完全独立于容器的生存周期，因此 Docker 不 会在容器删除时删除其挂载的数据卷")])]),a._v(" "),s("h3",{attrs:{id:"特点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#特点"}},[a._v("#")]),a._v(" 特点:")]),a._v(" "),s("p",[a._v("1:"),s("code",[a._v("数据卷可在容器之间共享或重用数据")]),a._v("\n2:"),s("code",[a._v("卷中的更改可以直接生效")]),a._v("\n3:"),s("code",[a._v("数据卷中的更改不会包含在镜像的更新中")]),a._v("\n4:"),s("code",[a._v("数据卷的生命周期一直持续到没有容器使用它为止 容器的持久化 容器间继承+共享数据")])]),a._v(" "),s("h3",{attrs:{id:"数据卷"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据卷"}},[a._v("#")]),a._v(" 数据卷")]),a._v(" "),s("p",[a._v("容器内添加数据卷\n直接命令添加")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /宿主机绝对路径目录:/容器内目录 镜像名\n")])])]),s("p",[a._v("查看数据卷是否挂载成功")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" inspect 容器 ID\n")])])]),s("p",[a._v("容器和宿主机之间的数据共享 主机创建文件，容器可以同步 容器停止退出后，主机修改后数据是否同步 同步")]),a._v(" "),s("h3",{attrs:{id:"命令-容器只读权限"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#命令-容器只读权限"}},[a._v("#")]),a._v(" 命令（容器只读权限）")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /宿主机绝对路径目录:/容器内目录:ro 镜像名                  \n")])])]),s("p",[a._v("实例：")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")]),a._v(":80 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /opt/data:/usr/share/nginx/html  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" nginx nginx:latest \n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")]),a._v(":80 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /opt/data:/usr/share/nginx/html:rw  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" nginx nginx:latest\n")])])]),s("h3",{attrs:{id:"dockerfile-添加"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile-添加"}},[a._v("#")]),a._v(" Dockerfile 添加")]),a._v(" "),s("p",[a._v("根目录下新建 mydocker 文件夹并进入 ，可在 Dockerfile 中使用 VOLUME 指令来给镜像添加一个或多个数据卷\n"),s("code",[a._v('VOLUME [\'/dataVolumeContainer\',"/dataVolumeContainer2","/dataVolumeCont ainer3"]')]),a._v("\n说明:")]),a._v(" "),s("ul",[s("li",[a._v("出于可移植和分享的考虑，用-v 主机目录:容器目录这种方法不能够直接在 Dockerfile 中实现。")]),a._v(" "),s("li",[a._v("由于宿主机目录是依赖于特定宿主机的，并不能够保证在所有的宿主机上都存在 这样的特定目录。")])]),a._v(" "),s("p",[s("strong",[a._v("Dockerfile 构建")])]),a._v(" "),s("div",{staticClass:"language-dockerfile extra-class"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("FROM")]),a._v(" centos ")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("VOLUME")]),a._v(" ["),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/dataVolumeContainer1"')]),a._v(","),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/dataVolumeContainer2"')]),a._v("] ")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("CMD")]),a._v(" echo "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"finished-----success1"')]),a._v(" ")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("CMD")]),a._v(" /bin/bash")]),a._v("\n构建镜像\n\n$ docker build -f /mydocker/dockerfile2 -t zzyy/centos .\n")])])]),s("h3",{attrs:{id:"run-容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#run-容器"}},[a._v("#")]),a._v(" run 容器")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" zzyy/centos\n\n通过上述步骤，容器内的卷目录地址已经知道，对应的主机目录地址哪??\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" inspect 容器 ID 可以查看主机对应默认地址口\n")])])]),s("p",[a._v("备注")]),a._v(" "),s("ul",[s("li",[a._v("Docker 挂载主机目录 Docker 访问出现 cannot open directory .: Permission deniedy")]),a._v(" "),s("li",[a._v("解决办法:在挂载目录后多加一个--privileged=true 参数即可")])]),a._v(" "),s("h2",{attrs:{id:"docker-镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-镜像"}},[a._v("#")]),a._v(" Docker 镜像")]),a._v(" "),s("p",[s("strong",[a._v("是什么?")]),a._v(" "),s("code",[a._v("镜像是一种轻量级、可执行的独立软件包，用来打包软件运行环境和基于运行环 境开发的软件，它包含运行某个软件所需的所有内容，包括代码、运行时、库、 环境变量和配置文件。")])]),a._v(" "),s("p",[s("strong",[a._v("UnionFS (联合文件系统)")])]),a._v(" "),s("ul",[s("li",[a._v("UnionFS (联合文件系统) : "),s("code",[a._v("Union 文件 系统(UnionFS) 是一种分层、轻量级并 且高性能的文件系统，它支持对文件系统的修改作为一次提交来一层层的叠加， 同时可以将不同目录挂载到同一个虚拟文件")]),a._v("系统下(unite several directories into a single virtual filesystem)。Union 文件系统是 Docker 镜像的基础。 镜像可以通过分层来进行继承，基于基础镜像(没有父镜像)，可以制作各种具体 的应用镜像。")]),a._v(" "),s("li",[a._v("特性: "),s("code",[a._v("一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统， 联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文 件和目录")])])]),a._v(" "),s("h3",{attrs:{id:"docker-镜像加载原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-镜像加载原理"}},[a._v("#")]),a._v(" Docker 镜像加载原理")]),a._v(" "),s("ul",[s("li",[s("code",[a._v("Docker 镜像加载原理:")]),a._v(" docker 的镜像实际上由一层一层的文件 系统组成，这种层级的文件系统 UnionFS.")]),a._v(" "),s("li",[s("code",[a._v("botfs(boot fle system)")]),a._v("主要包含 bootloader 和 kernel, botoader 主要是引导 加载 kernel,Linux 刚启动时会加载 bootfs 文件系统，在 Docker 镜像的最底层 是 botfs。这一层与我们典型的 Linux/Unix 系统是一样的，包含 boot 加载器和 内核。当 boot 加载完成之后整个内核就都在内存中了，此时内存的使用权已由 bootfs 转交给内核，此时系统也会卸载 boofs.")]),a._v(" "),s("li",[s("code",[a._v("roots (root file system)")]),a._v("，在 botfs 之上。 包含的就是典型 Linux 系统中的 /dev, /proc, /bin, /etc 等标准目录和文件。rootfs就 是各种不同的操作系 统发行版，比如 Ubuntu， Centos 等等。")]),a._v(" "),s("li",[s("code",[a._v("为什么 Docker 镜像要采用这种分层结构呢最大的一个好处就是一共享资源")]),a._v(" 比如:有多个镜像都从相同的 base 镜像构建而来，那么宿主机只需在磁盘上保存 一份 base 镜像， 同时内存中也只需加载-份 base 镜像，就可以为所有容器服务了。而且镜像的每 一层都可以被共享。")])]),a._v(" "),s("h3",{attrs:{id:"特点-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#特点-2"}},[a._v("#")]),a._v(" 特点")]),a._v(" "),s("p",[s("code",[a._v('Docker 镜像都是只读的 当容器启动时，一个新的可写层被加载到镜像的项部。 这一层通常被称作"容器层","容器层"之下的都叫"镜像层”。')])]),a._v(" "),s("p",[a._v("docker镜像 commit 操作补充\n"),s("code",[a._v("dockercommit 提交容器副本使之成为--个新的镜像 docker commit -m=“提交的描述信息”-a=”作者”容器 ID 要创建的目标镜像 名:[标签名]")])]),a._v(" "),s("h3",{attrs:{id:"案例演示"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#案例演示"}},[a._v("#")]),a._v(" 案例演示")]),a._v(" "),s("p",[s("strong",[a._v("1. 从 Hub 上下载 tomcat 镜像到本地并成功运行")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8080")]),a._v(":8080 tomcat\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" 主机端口:docker 容器端口\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-P")]),a._v(" 随机分配端口\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v(" 交互\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" 终端\n")])])]),s("p",[s("strong",[a._v("2.故意删除上一步镜像生产 tomcat 容器的文档")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" 容器名 /bin/bash\n$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" webapps\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-rf")]),a._v(" docs\n")])])]),s("p",[s("strong",[a._v("3. 也即当前的 tomcat 运行实例是一- 个没有文档内容的容器，以它为模板 commit 一个没有 doc 的 tomcat 新镜像 atguigu/tomcat02")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" commit "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("“zzyy”-m"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"del tomcat docs"')]),a._v(" 容器 ID atguigu/tomcat02:1.2\n")])])]),s("p",[s("strong",[a._v("4.启动我们的新镜像并和原来的对比")])]),a._v(" "),s("ul",[s("li",[a._v("启动 atguigu/tomcat02，它没有 docs")]),a._v(" "),s("li",[a._v("新启动原来的 tomcat，它有 docs")])])])}),[],!1,null,null,null);s.default=r.exports}}]);