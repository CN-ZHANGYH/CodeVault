(window.webpackJsonp=window.webpackJsonp||[]).push([[197],{511:function(t,s,a){"use strict";a.r(s);var n=a(7),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"ansible常用模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ansible常用模块"}},[t._v("#")]),t._v(" Ansible常用模块")]),t._v(" "),s("blockquote",[s("h3",{attrs:{id:"ansible常用模块-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ansible常用模块-2"}},[t._v("#")]),t._v(" Ansible常用模块")])]),t._v(" "),s("h3",{attrs:{id:"hostname模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hostname模块"}},[t._v("#")]),t._v(" hostname模块")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("用于管理远程主机的主机名")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("name: 必选项，主机名称\n\n更改主机名\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ansible 192.168.100.20 -m hostname -a 'name=node99'")]),t._v("\n")])])]),s("h3",{attrs:{id:"user模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#user模块"}},[t._v("#")]),t._v(" user模块")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("用于创建用户以及修改用户的权限")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("User：管理用户\n\n   home   指定家目录路径\n   system 指定系统账号\n   group  指定组\n   remove 清除账户\n   shell  指定shell类型\n\n   ansible websrvs "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" user "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'name=user1 comment=\"test user\" uid=2048 home=/app/user1 group=root'")]),t._v("\n   ansible websrvs "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" user "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'name=sysuser1 system=yes home=/app/sysuser1'")]),t._v("\n   ansible websrvs "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" user "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'name=user1 state=absent remove=yes'")]),t._v("  清空用户所有数据\n   ansible websrvs "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" user "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'name=app uid=88 system=yes home=/app groups=root shell=/sbin/nologin password=\"$1$zfVojmPy$ZILcvxnXljvTI2PhP2Iqv1\"'")]),t._v("  创建用户\n   ansible websrvs "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" user "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'name=app state=absent'")]),t._v("  不会删除家目录\n")])])]),s("h3",{attrs:{id:"group模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#group模块"}},[t._v("#")]),t._v(" group模块")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("用于创建组和修改组的权限操作")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("Group：管理组\n\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("state")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("present表示创建组，state"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("absent时表示删除组；\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("syste")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("yes表示创建系统组，system"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("no表示创建的不是系统组；\n\n\tansible srv "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" group "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name=testgroup system=yes"')]),t._v("   创建组\n  \tansible srv "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" group "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name=testgroup state=absent"')]),t._v(" 删除组\n  \t在test组包含的被控端上创建组testgroup，组id为111\n\tansible "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("test")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" group "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'name =testgroup gid=111 state=present system=yes'")]),t._v("\n")])])]),s("h3",{attrs:{id:"command模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#command模块"}},[t._v("#")]),t._v(" command模块")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("在远程主机执行命令，默认模块，可忽略-m选项")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v(" chdir:   进入到被管理主机目录\n creates: 如果有一个目录是存在的,步骤将不会运行Command命令\n ansible websrvs "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'chdir=/data/ ls'")]),t._v("\n \n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" ansible srvs "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("command")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'service vsftpd start'")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" ansible srvs "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("command")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'echo adong |passwd --stdin 123456'")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#此命令不支持 $VARNAME < > | ; & 等,用shell模块实现")]),t._v("\n")])])]),s("ul",[s("li",[s("strong",[t._v("Playbook用法")])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" return motd to registered var\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cat /etc/motd\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("register")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mymotd\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Run command if /path/to/database does not exist (without 'args' keyword).\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /usr/bin/make_database.sh db_user db_name creates=/path/to/database\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 'args' is a task keyword, passed at the same level as the module")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Run command if /path/to/database does not exist (with 'args' keyword).\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /usr/bin/make_database.sh db_user db_name\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("args")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("creates")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /path/to/database\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 'cmd' is module parameter")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Run command if /path/to/database does not exist (with 'cmd' parameter).\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cmd")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /usr/bin/make_database.sh db_user db_name\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("creates")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /path/to/database  \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Change the working directory to somedir/ and run the command as db_owner if /path/to/database does not exist.\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /usr/bin/make_database.sh db_user db_name\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("become")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" yes\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("become_user")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" db_owner\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("args")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("chdir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" somedir/\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("creates")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /path/to/database\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 'argv' is a parameter, indented one level from the module")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Use 'argv' to send a command as a list "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" leave 'command' empty\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("argv")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /usr/bin/make_database.sh\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Username with whitespace\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" dbname with whitespace     \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" safely use templated variable to run command. Always use the quote filter to avoid injection issues.\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cat "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" myfile"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("quote "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("register")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" myoutput\n")])])]),s("h3",{attrs:{id:"shell模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#shell模块"}},[t._v("#")]),t._v(" shell模块")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("和command相似，用shell执行命令")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("   修改配置文件,使shell作为默认模块    \n\n       "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" /etc/ansible/ansible.cfg\n       module_name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" shell\n       \n   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" ansible all "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" shell  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'getenforce'")]),t._v("  查看SELINUX状态\n   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("  ansible all "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" shell  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"sed -i 's/SELINUX=.*/SELINUX=disabled'     \t/etc/selinux/config\"")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" ansible srv "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" shell "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'echo magedu |passwd –stdin wang'")]),t._v("\n\n   调用bash执行命令 类似 "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" /tmp/stanley.md "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("awk")]),t._v(" -F"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'|'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{print $1,$2}'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&>")]),t._v(" /tmp/example.txt \n   这些复杂命令，即使使用shell也可能会失败，\n   解决办法：写到脚本时，copy到远程执行，再把需要的结果拉回执行命令的机器 \n")])])]),s("ul",[s("li",[s("strong",[t._v("Playbook用法")])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Execute the command in remote shell; stdout goes to the specified file on the remote.\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("shell")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" somescript.sh "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v(" somelog.txt\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Change the working directory to somedir/ before executing the command.\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("shell")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" somescript.sh "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v(" somelog.txt\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("args")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("chdir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" somedir/\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# You can also use the 'args' form to provide the options.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" This command will change the working directory to somedir/ and will only run when somedir/somelog.txt doesn't exist.\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("shell")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" somescript.sh "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v(" somelog.txt\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("args")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("chdir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" somedir/\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("creates")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" somelog.txt\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# You can also use the 'cmd' parameter instead of free form format.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" This command will change the working directory to somedir/.\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("shell")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cmd")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ls "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("l "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" grep log\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("chdir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" somedir/\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Run a command that uses non"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("posix shell"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("isms (in this example /bin/sh doesn't handle redirection and wildcards together but bash does)\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("shell")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cat < /tmp/"),s("span",{pre:!0,attrs:{class:"token important"}},[t._v("*txt")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("args")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("executable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /bin/bash\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Run a command using a templated variable (always use quote filter to avoid injection)\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("shell")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cat "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" myfile"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("quote "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# You can use shell to run other executables to perform actions inline")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Run expect to wait for a successful PXE boot via out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("of"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("band CIMC\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("shell")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v('\n    set timeout 300\n    spawn ssh admin@{{ cimc_host }}\n    expect "password:"\n    send "{{ cimc_password }}\\n"\n    expect "\\n{{ cimc_name }}"\n    send "connect host\\n"\n    expect "pxeboot.n12"\n    send "\\n"\n    exit 0')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("args")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("executable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /usr/bin/expect\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("delegate_to")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" localhost\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Disabling warnings")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Using curl to connect to a host via SOCKS proxy (unsupported in uri). Ordinarily this would throw a warning.\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("shell")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" curl "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("socks5 localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("9000 http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//www.ansible.com\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("args")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("warn")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" no\n")])])]),s("h3",{attrs:{id:"copy模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#copy模块"}},[t._v("#")]),t._v(" copy模块")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("从主控端复制文件到远程主机")])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("   "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("src")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 源文件  指定拷贝文件的本地路径  (如果有/ 则拷贝目录内容"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("比拷贝目录本身)\n   "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 指定目标路径\n   "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 设置权限\n   "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("backup")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 备份源文件\n   "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("content")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 代替src  指定本机文件内容"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("生成目标主机文件\n   \n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v(" ansible websrvs "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("m copy "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v('a "src=/root/test1.sh dest=/tmp/test2.showner=wang mode=600 backup=yes"\n\n   如果目标存在，默认覆盖，此处指定先备份\n   '),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v(" ansible websrvs "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("m copy "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("a \"content='test content\\nxxx' dest=/tmp/test.txt\"\n   指定内容，直接生成目标文件\n")])])]),s("ul",[s("li",[s("strong",[t._v("Playbook用法")])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Copy file with owner and permissions\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("copy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /srv/myfiles/foo.conf\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/foo.conf\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("owner")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" foo\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("group")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" foo\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0644'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Copy file with owner and permission"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" using symbolic representation\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("copy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /srv/myfiles/foo.conf\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/foo.conf\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("owner")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" foo\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("group")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" foo\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" u=rw"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("g=r"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("o=r\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Another symbolic mode example"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" adding some permissions and removing others\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("copy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /srv/myfiles/foo.conf\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/foo.conf\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("owner")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" foo\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("group")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" foo\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" u+rw"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("g"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("wx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("o"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("rwx\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(' Copy a new "ntp.conf file into place'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" backing up the original if it differs from the copied version\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("copy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /mine/ntp.conf\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/ntp.conf\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("owner")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" root\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("group")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" root\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0644'")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("backup")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" yes\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(' Copy a new "sudoers" file into place'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" after passing validation with visudo\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("copy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /mine/sudoers\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/sudoers\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("validate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /usr/sbin/visudo "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("csf %s\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(' Copy a "sudoers" file on the remote machine for editing\n  '),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("copy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/sudoers\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/sudoers.edit\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("remote_src")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" yes\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("validate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /usr/sbin/visudo "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("csf %s\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Copy using inline content\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("copy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("content")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'# This file was moved to /etc/other.conf'")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/mine.conf\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" If follow=yes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" /path/to/file will be overwritten by contents of foo.conf\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("copy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/foo.conf\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /path/to/link  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# link to /path/to/file")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("follow")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" yes\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" If follow=no"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" /path/to/link will become a file and be overwritten by contents of foo.conf\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("copy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/foo.conf\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /path/to/link  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# link to /path/to/file")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("follow")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" no\n")])])]),s("h3",{attrs:{id:"yum-repository模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#yum-repository模块"}},[t._v("#")]),t._v(" yum_repository模块")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("配置repo的yum源模块")])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name参数")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\t \t\t必须参数，用于指定要操作的唯一的仓库ID，也就是”.repo”配置文件中每个仓库对应的”中括号”内的仓库ID\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("baseurl参数")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\t\t此参数用于设置yum仓库的baseurl\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("description参数")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\t此参数用于设置仓库的注释，也就是”.repo”配置文件中每个仓库对应的”name字段”对应的内容。\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("file参数")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\t\t\t此参数用于设置仓库的配置文件名称，即设置”.repo”配置文件的文件名前缀，在不使用此参数的情况下，默认以name参数的仓库ID作为”.repo”配置文件的文件名前缀，同一个’.repo’配置文件中可以存在多个yum源\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled参数")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\t\t此参数用于设置是否激活对应的yum源，此参数默认值为yes，表示启用对应的yum源，设置为no表示不启用对应的yum源。\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gpgcheck参数")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\t\t此参数用于设置是否开启rpm包验证功能，默认值为no，表示不启用包验证，设置为yes表示开启包验证功能。\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gpgcakey参数")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\t\t当gpgcheck参数设置为yes时，需要使用此参数指定验证包所需的公钥\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("state参数")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\t\t\t默认值为present，当值设置为absent时，表示删除对应的yum源\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("yum_repository模块的示例命令如下：\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@server4 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ansible testA -m yum_repository -a 'name=rhel7.3 description=\"ansible rhel7.3\" baseurl=http://172.25.1.250/westos gpgcheck=no enabled=yes'")]),t._v("\n")])])]),s("h3",{attrs:{id:"yum模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#yum模块"}},[t._v("#")]),t._v(" yum模块")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("yum源安装rpm包的管理模块")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("  state：状态（present安装，absent卸载，latest最新的）  \n  \n  ansible websrvs "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" yum "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'list=httpd'")]),t._v("  查看程序列表\n  ansible websrvs "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" yum "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'name=httpd state=present'")]),t._v(" 安装\n  ansible websrvs "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" yum "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'name=httpd state=absent'")]),t._v("  删除\n  \n  可以同时安装多个程序包\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ansible test -m yum -a 'name=vsftpd,httpd,memcached'")]),t._v("\n  更新缓存\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ansible test  -m yum -a 'name=dstat update_cache=yes'")]),t._v("\n")])])]),s("ul",[s("li",[s("strong",[t._v("Playbook用法")])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" install the latest version of Apache\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("yum")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" httpd\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("state")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" latest\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ensure a list of packages installed\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("yum")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{{ packages }}"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("vars")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("packages")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" httpd\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" httpd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("tools\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" remove the Apache package\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("yum")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" httpd\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("state")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" absent\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" install the latest version of Apache from the testing repo\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("yum")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" httpd\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enablerepo")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" testing\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("state")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" present\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" install one specific version of Apache\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("yum")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" httpd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("2.2.29"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("1.4.amzn1\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("state")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" present\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" upgrade all packages\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("yum")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*'")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("state")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" latest\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" upgrade all packages"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" excluding kernel & foo related packages\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("yum")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*'")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("state")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" latest\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("exclude")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kernel*"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("foo*\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" install the nginx rpm from a remote repo\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("yum")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//nginx.org/packages/centos/6/noarch/RPMS/nginx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("release"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("centos"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("6"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("0.el6.ngx.noarch.rpm\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("state")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" present\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" install nginx rpm from a local file\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("yum")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /usr/local/src/nginx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("release"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("centos"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("6"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("0.el6.ngx.noarch.rpm\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("state")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" present\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" install the 'Development tools' package group\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("yum")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@Development tools"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("state")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" present\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" install the 'Gnome desktop' environment group\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("yum")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@^gnome-desktop-environment"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("state")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" present\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" List ansible packages and register result to print with debug later.\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("yum")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("list")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ansible\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("register")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" result\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Install package with multiple repos enabled\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("yum")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" sos\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enablerepo")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"epel,ol7_latest"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Install package with multiple repos disabled\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("yum")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" sos\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("disablerepo")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"epel,ol7_latest"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Install a list of packages\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("yum")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" nginx\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" postgresql\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" postgresql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("state")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" present\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Download the nginx package but do not install it\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("yum")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" nginx\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("state")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" latest\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("download_only")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n")])])]),s("h3",{attrs:{id:"service模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#service模块"}},[t._v("#")]),t._v(" service模块")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("服务状态管理模块")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("    enabled："),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("yes/no"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" 启动os后启动对应service的选项"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("是否开机启动\n    name:需要进行操作的service名字\n    state:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("stared/stoped/restarted/reloaded"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" 服务最终操作后的状态\n    \n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("ansible srv "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'name=httpd state=stopped'")]),t._v("  停止服务\n  \t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("ansible srv "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'name=httpd state=started enabled=yes'")]),t._v(" 启动服务,并设为开机自启\n  \t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("ansible srv "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'name=httpd state=reloaded'")]),t._v("  重新加载\n  \t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("ansible srv "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'name=httpd state=restarted'")]),t._v(" 重启服务\n")])])]),s("ul",[s("li",[s("strong",[t._v("Playbook用法")])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Start service httpd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" if not started\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("service")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" httpd\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("state")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" started\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Stop service httpd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" if started\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("service")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" httpd\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("state")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" stopped\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Restart service httpd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" in all cases\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("service")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" httpd\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("state")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" restarted\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Reload service httpd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" in all cases\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("service")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" httpd\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("state")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" reloaded\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Enable service httpd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" and not touch the state\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("service")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" httpd\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" yes\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Start service foo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" based on running process /usr/bin/foo\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("service")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" foo\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pattern")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /usr/bin/foo\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("state")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" started\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Restart network service for interface eth0\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("service")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" network\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("state")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" restarted\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("args")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" eth0\n")])])]),s("h3",{attrs:{id:"script模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#script模块"}},[t._v("#")]),t._v(" script模块")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("可以实现被控端上可以执行ansible控制端的脚本")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v(" 示例：ansible "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("test")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" script "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/4.40/www/2.sh'")]),t._v("\n 在test组所有被控端执行ansible控制端中/4.40./www/目录下的2.sh\n \n   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/PATH/TO/SCRIPT_FILE"')]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" ansible websrvs "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" script "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" /data/test.sh\n \n")])])]),s("ul",[s("li",[s("strong",[t._v("Playbook用法")])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Run a script with arguments (free form)\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /some/local/script.sh "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("some"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("argument 1234\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Run a script with arguments (using 'cmd' parameter)\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cmd")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /some/local/script.sh "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("some"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("argument 1234\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Run a script only if file.txt does not exist on the remote node\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /some/local/create_file.sh "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("some"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("argument 1234\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("args")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("creates")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /the/created/file.txt\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Run a script only if file.txt exists on the remote node\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /some/local/remove_file.sh "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("some"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("argument 1234\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("args")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("removes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /the/removed/file.txt\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Run a script using an executable in a non"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("system path\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /some/local/script\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("args")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("executable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /some/remote/executable\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Run a script using an executable in a system path\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /some/local/script.py\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("args")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("executable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" python3\n")])])]),s("h3",{attrs:{id:"fetch-file模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#fetch-file模块"}},[t._v("#")]),t._v(" fetch+file模块")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("Fetch：从远程主机提取文件至主控端，copy相反，目前不支持目录,可以先打包,再提取文件")])]),t._v(" "),s("li",[s("strong",[t._v("File：设置文件属性")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Fetch：从远程主机提取文件至主控端，copy相反，目前不支持目录,可以先打包,再提取文件")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" ansible websrvs "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" fetch "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'src=/root/test.sh dest=/data/scripts'")]),t._v("\n    会生成每个被管理主机不同编号的目录,不会发生文件名冲突\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" ansible all "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" shell "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'tar jxvf test.tar.gz /root/test.sh'")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" ansible all "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" fetch "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'src=/root/test.tar.gz dest=/data/'")]),t._v("\n\n \n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# File：设置文件属性")]),t._v("\n\n   path: 要管理的文件路径 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("强制添加"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n   recurse: 递归,文件夹要用递归\n   src:  创建硬链接,软链接时,指定源目标,配合"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'state=link'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'state=hard'")]),t._v(" 设置软链接,硬链接\n   state: 状态\n   absent 缺席,删除\n\n         \n\n   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" ansible websrvs "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'path=/app/test.txt state=touch'")]),t._v("       创建文件\n   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" ansible websrvs "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"path=/data/testdir state=directory"')]),t._v("   创建目录    \n   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" ansible websrvs "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"path=/root/test.sh owner=wang mode=755"')]),t._v("  设置权限755\n   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" ansible websrvs "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'src=/data/testfile dest=/data/testfile-link state=link'")]),t._v(" 创建软链接\n")])])]),s("ul",[s("li",[s("strong",[t._v("playbook用法")])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Change file ownership"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" group and permissions\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("file")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/foo.conf\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("owner")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" foo\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("group")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" foo\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0644'")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Give insecure permissions to an existing file\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("file")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /work\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("owner")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" root\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("group")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" root\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1777'")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Create a symbolic link\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("file")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /file/to/link/to\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /path/to/symlink\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("owner")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" foo\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("group")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" foo\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("state")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" link\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Create two hard links\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("file")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/tmp/{{ item.src }}'")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{{ item.dest }}'")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("state")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" hard\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("loop")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" y "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" z"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" k "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"cron模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cron模块"}},[t._v("#")]),t._v(" cron模块")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("定时任务的创建和删除管理")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("创建一个定时任务\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ansible test -m cron -a 'minute=* weekday=1,3,5  job=\"/usr/bin/wall FBI waring\" name=warningcron'  ")]),t._v("\n\n禁用一个定时任务\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ansible test -m cron -a 'disabled=true  job=\"/usr/bin/wall FBI waring\" name=warningcron'")]),t._v("\n")])])]),s("h3",{attrs:{id:"unarchive模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#unarchive模块"}},[t._v("#")]),t._v(" unarchive模块")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("解压缩的管理模块，可以将本地ansible控制节点的包解压至node节点")])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("creates")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \t\t一个文件名，当它已经存在时，这个步骤将不会被运行。\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("copy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  \t\t\t默认为yes，拷贝的文件从ansible主机复制到远程主机，no在远程主机上寻找src源文件解压\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \t\t\ttar源路径，可以是ansible主机上的路径，也可以是远程主机上的路径，如果是远程主机上的路径，则需设置copy=no\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \t\t\t远程主机上的目标绝对路径\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \t\t\t设置解压缩后的文件权限\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("exec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \t\t\t列出需要排除的目录和文件\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("remote_src")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \t设置remote_src=yes为解包目标上已经存在的档案。对于Windows目标，改用win_unzip模块。\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("owner")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  \t\t解压后文件或目录的属主\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("group")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\t\t \t解压后的目录或文件的属组\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("在远程主机上解压文件并设置权限\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ansible all -m unarchive -a 'src=/srv/tomcat8/apache-tomcat-8.0.29.tar.gz dest=/usr/local copy=no mode=0755'")]),t._v("\n\n解压ansible管理机上的压缩文件到远程主机并设置权限\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# ansible all -m unarchive -a "src=/tmp/install/zabbix-3.0.4.tar.gz dest=/tmp/ mode=0755 copy=yes"')]),t._v("\n")])])]),s("ul",[s("li",[s("strong",[t._v("Playbook用法")])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Extract foo.tgz into /var/lib/foo\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("unarchive")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" foo.tgz\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /var/lib/foo\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Unarchive a file that is already on the remote machine\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("unarchive")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /tmp/foo.zip\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /usr/local/bin\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("remote_src")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" yes\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Unarchive a file that needs to be downloaded (added in 2.0)\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("unarchive")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//example.com/example.zip\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /usr/local/bin\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("remote_src")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" yes\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Unarchive a file with extra options\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("unarchive")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /tmp/foo.zip\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /usr/local/bin\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("extra_opts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("transform\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" s/^xxx/yyy/\n")])])]),s("hr"),t._v(" "),s("h3",{attrs:{id:"利用模块快速部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#利用模块快速部署"}},[t._v("#")]),t._v(" 利用模块快速部署")]),t._v(" "),s("p",[s("code",[t._v("配置好hosts")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ansible --list-hosts server")]),t._v("\n  hosts "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(":\n    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.107\n    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.108\n    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.110\n\n")])])]),s("p",[s("code",[t._v("使用模块操作子机")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#使用COPY模块传送CentOS-Base.repo的yum源")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# ansible server -m copy -a "src=/root/CentOS-Base.repo dest=/etc/yum.repos.d/CentOS-Base.repo mode=600 backup=yes"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.110 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" CHANGED "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ansible_facts"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"discovered_interpreter_python"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/libexec/platform-python"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"changed"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" true,\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"checksum"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"4966466ad015ef3d2a3cc0b8252d43efbdcf2c94"')]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dest"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/etc/yum.repos.d/CentOS-Base.repo"')]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"gid"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"group"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"root"')]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"md5sum"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"d06fb7d5709727828bcaba7457ea673e"')]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mode"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0600"')]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"owner"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"root"')]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"secontext"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"system_u:object_r:system_conf_t:s0"')]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"size"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2595")]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"src"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/root/.ansible/tmp/ansible-tmp-1632059937.218095-11326-239583984569451/source"')]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"state"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"file"')]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"uid"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#使用shell模块检测yum源是否正常使用")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# ansible server -m shell -a "yum repolist all" ')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("WARNING"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": Consider using the yum module rather than running "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'yum'")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("  If you need to use "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("command")]),t._v(" because yum is insufficient you can "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'warn:\nfalse'")]),t._v(" to this "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("command")]),t._v(" task or "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'command_warnings=False'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" ansible.cfg to get rid of this message.\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.110 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" CHANGED "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("rc")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v("\nUpdating Subscription Management repositories.\nUnable to "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("read")]),t._v(" consumer identity\nThis system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.\nrepo "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v("             repo name                                           status\nAppStream           CentOS-8 - AppStream - mirrors.aliyun.com           enabled\nPowerTools          CentOS-8 - PowerTools - mirrors.aliyun.com          disabled\nbase                CentOS-8 - Base - mirrors.aliyun.com                enabled\ncentosplus          CentOS-8 - Plus - mirrors.aliyun.com                disabled\nextras              CentOS-8 - Extras - mirrors.aliyun.com              enabled\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#使用yum模块安装httpd服务")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# ansible -m yum -a "name=httpd state=present" server')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.108 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" CHANGED "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ansible_facts"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"discovered_interpreter_python"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/libexec/platform-python"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"changed"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" true,\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"msg"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rc"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"results"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Installed: mailcap-2.1.48-3.el8.noarch"')]),t._v(",\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Installed: httpd-2.4.37-39.module_el8.4.0+778+c970deab.x86_64"')]),t._v(",\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Installed: httpd-filesystem-2.4.37-39.module_el8.4.0+778+c970deab.noarch"')]),t._v(",\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Installed: httpd-tools-2.4.37-39.module_el8.4.0+778+c970deab.x86_64"')]),t._v(",\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Installed: mod_http2-1.15.7-3.module_el8.4.0+778+c970deab.x86_64"')]),t._v(",\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Installed: centos-logos-httpd-85.8-1.el8.noarch"')]),t._v(",\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Installed: apr-1.6.3-11.el8.x86_64"')]),t._v(",\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Installed: apr-util-1.6.1-6.el8.x86_64"')]),t._v(",\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Installed: apr-util-bdb-1.6.1-6.el8.x86_64"')]),t._v(",\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Installed: apr-util-openssl-1.6.1-6.el8.x86_64"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#使用shell模块远程开启，远程查看服务状态")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# ansible server -m shell -a "systemctl start httpd" ')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.107 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" CHANGED "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("rc")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.108 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" CHANGED "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("rc")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.110 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" CHANGED "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("rc")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# ansible server -m shell -a "curl http://local:80" ')]),t._v("\n^Z\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("+  Stopped                 ansible server "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" shell "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"curl http://local:80"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# ansible server -m shell -a "systemctl status httpd" ')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.110 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" CHANGED "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("rc")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v("\n● httpd.service - The Apache HTTP Server\n   Loaded: loaded "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("/usr/lib/systemd/system/httpd.service"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" disabled"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" vendor preset: disabled"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n   Active: active "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("running"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" since Sun "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v("-09-19 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),t._v(":08:57 CST"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" 1min 24s ago\n     Docs: man:httpd.service"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n Main PID: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("11512")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("httpd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n   Status: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Running, listening on: port 80"')]),t._v("\n    Tasks: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("213")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("limit: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("11468")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n   Memory: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("27")]),t._v(".4M\n   CGroup: /system.slice/httpd.service\n           ├─11512 /usr/sbin/httpd "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-DFOREGROUND")]),t._v("\n           ├─11612 /usr/sbin/httpd "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-DFOREGROUND")]),t._v("\n           ├─11613 /usr/sbin/httpd "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-DFOREGROUND")]),t._v("\n           ├─11614 /usr/sbin/httpd "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-DFOREGROUND")]),t._v("\n           └─11615 /usr/sbin/httpd "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-DFOREGROUND")]),t._v("\n\nSep "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),t._v(":08:17 server3 systemd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": Starting The Apache HTTP Server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nSep "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),t._v(":08:57 server3 httpd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("11512")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": AH00558: httpd: Could not reliably determine the server"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'s fully qualified domain name, using fe80::4a92:a42e:da79:b4e6. Set the '")]),t._v("ServerName' directive globally to suppress this message\nSep "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),t._v(":08:57 server3 systemd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": Started The Apache HTTP Server.\nSep "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),t._v(":09:37 server3 httpd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("11512")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": Server configured, listening on: port "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n\n")])])]),s("h3",{attrs:{id:"使用playbook的方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用playbook的方式"}},[t._v("#")]),t._v(" "),s("strong",[t._v("使用playbook的方式")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vim playbook.yaml  ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" install httpd\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" server\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tasks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" install httpd\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("yum")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" httpd\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("state")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" present\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" service start\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("service")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" httpd\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("state")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" started\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" yes\n")])])]),s("p",[s("strong",[t._v("使用ansible-playbook部署")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ansible-playbook  playbook.yaml ")]),t._v("\n\nPLAY "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("install httpd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" ***********************************************************************************************\n\nTASK "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Gathering Facts"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" *********************************************************************************************\nok: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.107"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nok: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.108"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nok: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.110"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\nTASK "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("install httpd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" ***********************************************************************************************\nok: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.110"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nok: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.107"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nok: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.108"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\nTASK "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("service start"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" ***********************************************************************************************\nchanged: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.108"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nchanged: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.107"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nchanged: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.110"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\nPLAY RECAP *********************************************************************************************************\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.107              "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ok")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("changed")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("unreachable")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("failed")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("skipped")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("rescued")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ignored")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("  \n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.108              "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ok")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("changed")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("unreachable")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("failed")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("skipped")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("rescued")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ignored")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("  \n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.110              "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ok")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("changed")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("unreachable")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("failed")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("skipped")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("rescued")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ignored")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("  \n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@ansible ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);