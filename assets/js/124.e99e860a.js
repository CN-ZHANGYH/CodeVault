(window.webpackJsonp=window.webpackJsonp||[]).push([[124],{438:function(s,t,a){"use strict";a.r(t);var e=a(7),r=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"云原生存储概述"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#云原生存储概述"}},[s._v("#")]),s._v(" 云原生存储概述")]),s._v(" "),t("h2",{attrs:{id:"k8s数据持久化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#k8s数据持久化"}},[s._v("#")]),s._v(" k8s数据持久化")]),s._v(" "),t("p",[t("strong",[s._v("松耦合的方式，Pod与存储分离，三种方式")])]),s._v(" "),t("ul",[t("li",[s._v("volume，需要知道后端存储的细节")]),s._v(" "),t("li",[s._v("PV/PVC 管理员定义PV，PersistentVolume。用户通过PVC的使用PersistentVolumeClaim。")]),s._v(" "),t("li",[s._v("storageclass： 静态+动态，通过PVC声明使用的空间，自动创建PV和后端驱动的对接。")])]),s._v(" "),t("p",[t("strong",[s._v("普通存储卷")])]),s._v(" "),t("p",[t("strong",[t("code",[s._v("configmap和secret以及secret都是容器启动时依赖的数据，emptyDir和hostPath都是临时数据存储，nfs，cephfs，GlutserFS，cloud都是持久化数据存储。")])])]),s._v(" "),t("p",[s._v("存储没有单独的资源对象，与Pod的生命周期一起。")]),s._v(" "),t("ul",[t("li",[s._v("configmap")]),s._v(" "),t("li",[s._v("secret")]),s._v(" "),t("li",[s._v("​                                                                                                                                                                                                                             emptyDir")]),s._v(" "),t("li",[s._v("hostPath")]),s._v(" "),t("li",[s._v("nfs")]),s._v(" "),t("li",[s._v("cephfs")]),s._v(" "),t("li",[s._v("ClutserFS")]),s._v(" "),t("li",[s._v("Cloud")])]),s._v(" "),t("h2",{attrs:{id:"揭开rook神秘面纱"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#揭开rook神秘面纱"}},[s._v("#")]),s._v(" 揭开rook神秘面纱")]),s._v(" "),t("h3",{attrs:{id:"ceph部署方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ceph部署方法"}},[s._v("#")]),s._v(" Ceph部署方法")]),s._v(" "),t("p",[s._v("Ceph常见的部署方法有：")]),s._v(" "),t("ul",[t("li",[s._v("ceph-deploy")]),s._v(" "),t("li",[s._v("cephadm")]),s._v(" "),t("li",[s._v("手工部署")]),s._v(" "),t("li",[s._v("Rook")])]),s._v(" "),t("h3",{attrs:{id:"什么是rook"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#什么是rook"}},[s._v("#")]),s._v(" 什么是Rook")]),s._v(" "),t("p",[s._v("Rook 将分布式存储系统转变为自我管理、自我扩展、自我修复的存储服务。它可以自动执行存储管理员的任务：部署、引导、配置、供应、扩展、升级、迁移、灾难恢复、监控和资源管理。")]),s._v(" "),t("p",[s._v("定义： 开源，为Kubernetes而服务的云原生存储,即为Kubernetes")]),s._v(" "),t("h3",{attrs:{id:"rook存储类型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rook存储类型"}},[s._v("#")]),s._v(" Rook存储类型")]),s._v(" "),t("ul",[t("li",[s._v("Ceph")]),s._v(" "),t("li",[s._v("NFS")]),s._v(" "),t("li",[s._v("Cassandra")]),s._v(" "),t("li",[s._v("CockroachDB")]),s._v(" "),t("li",[s._v("Yugabyte DB")]),s._v(" "),t("li",[s._v("EdgeFS")])]),s._v(" "),t("h3",{attrs:{id:"rook与k8s结合"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rook与k8s结合"}},[s._v("#")]),s._v(" Rook与K8S结合")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://i.bmp.ovh/imgs/2022/02/1a3bd1c65ecffd28.png",alt:""}})]),s._v(" "),t("p",[t("strong",[s._v("rook负责初始化和管理Ceph集群")])]),s._v(" "),t("ul",[t("li",[s._v("monitor集群")]),s._v(" "),t("li",[s._v("mgr集群")]),s._v(" "),t("li",[s._v("osd集群")]),s._v(" "),t("li",[s._v("pool管理")]),s._v(" "),t("li",[s._v("对象存储")]),s._v(" "),t("li",[s._v("文件存储")])]),s._v(" "),t("p",[t("strong",[s._v("rook负责提供访问存储所需的驱动")])]),s._v(" "),t("ul",[t("li",[s._v("Flex驱动（旧驱动，不建议使用）")]),s._v(" "),t("li",[s._v("CSI驱动")]),s._v(" "),t("li",[s._v("RBD块存储")]),s._v(" "),t("li",[s._v("CephFS文件存储")]),s._v(" "),t("li",[s._v("S3/Swift风格对象存储")])]),s._v(" "),t("h3",{attrs:{id:"rook架构解析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rook架构解析"}},[s._v("#")]),s._v(" Rook架构解析")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://i.bmp.ovh/imgs/2022/02/2fdd5db7892f536c.png",alt:""}})]),s._v(" "),t("p",[t("strong",[s._v("所有对象依托于Kubernetes集群")])]),s._v(" "),t("ul",[t("li",[s._v("mon")]),s._v(" "),t("li",[s._v("rgw")]),s._v(" "),t("li",[s._v("mds")]),s._v(" "),t("li",[s._v("mgr")]),s._v(" "),t("li",[s._v("osd")]),s._v(" "),t("li",[s._v("Agent\n"),t("ul",[t("li",[s._v("csi-rbdplugin")]),s._v(" "),t("li",[s._v("csi-cephfsplugi")])])])]),s._v(" "),t("p",[t("strong",[s._v("抽象化管理，隐藏细节")])]),s._v(" "),t("ul",[t("li",[s._v("pool")]),s._v(" "),t("li",[s._v("volumes")]),s._v(" "),t("li",[s._v("filesystems")]),s._v(" "),t("li",[s._v("buckets")])]),s._v(" "),t("h2",{attrs:{id:"rook快速入门"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rook快速入门"}},[s._v("#")]),s._v(" Rook快速入门")]),s._v(" "),t("h3",{attrs:{id:"部署rook的前提"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#部署rook的前提"}},[s._v("#")]),s._v(" 部署Rook的前提")]),s._v(" "),t("p",[s._v("集群环境介绍")]),s._v(" "),t("blockquote",[t("p",[t("strong",[s._v("操作系统版本： CentOS Linux release 8.3.2011")])]),s._v(" "),t("p",[t("strong",[s._v("kubenetes版本： kubernetes v1.20.2")])])]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("节点名称")]),s._v(" "),t("th",[s._v("IP地址")]),s._v(" "),t("th",[s._v("k8s角色")]),s._v(" "),t("th",[s._v("组件名称")]),s._v(" "),t("th",[s._v("磁盘-50G")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("node1")]),s._v(" "),t("td"),s._v(" "),t("td",[s._v("master")]),s._v(" "),t("td",[s._v("ceph-mon"),t("br"),s._v("  ceph-mgr"),t("br"),s._v("  ceph-osd"),t("br"),s._v("  csi-cephfsplugin"),t("br"),s._v("  csi-cephfsplugin")]),s._v(" "),t("td",[s._v("/dev/vdb")])]),s._v(" "),t("tr",[t("td",[s._v("node2")]),s._v(" "),t("td"),s._v(" "),t("td",[s._v("node")]),s._v(" "),t("td",[s._v("ceph-mon"),t("br"),s._v("  ceph-mgr"),t("br"),s._v("  ceph-osd"),t("br"),s._v("  csi-cephfsplugin"),t("br"),s._v("  csi-cephfsplugin")]),s._v(" "),t("td",[s._v("/dev/vdb")])]),s._v(" "),t("tr",[t("td",[s._v("node3")]),s._v(" "),t("td"),s._v(" "),t("td",[s._v("node")]),s._v(" "),t("td",[s._v("ceph-mon"),t("br"),s._v("  ceph-osd"),t("br"),s._v("  csi-cephfsplugin"),t("br"),s._v("  csi-cephfsplugin")]),s._v(" "),t("td",[s._v("/dev/vdb")])]),s._v(" "),t("tr",[t("td",[s._v("node4")]),s._v(" "),t("td"),s._v(" "),t("td",[s._v("node")]),s._v(" "),t("td",[s._v("ceph-osd"),t("br"),s._v("  csi-cephfsplugin"),t("br"),s._v("  csi-cephfsplugin")]),s._v(" "),t("td",[s._v("/dev/vdb")])]),s._v(" "),t("tr",[t("td",[s._v("node5")]),s._v(" "),t("td"),s._v(" "),t("td",[s._v("node")]),s._v(" "),t("td",[s._v("ceph-osd"),t("br"),s._v("  csi-cephfsplugin"),t("br"),s._v("  csi-cephfsplugin")]),s._v(" "),t("td",[s._v("/dev/vdb")])])])]),s._v(" "),t("h3",{attrs:{id:"获取源码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#获取源码"}},[s._v("#")]),s._v(" 获取源码")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone --single-branch "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--branch")]),s._v(" v1.8.3 https://github.com/rook/rook.git\n$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" rook/deploy/examples\n$ kubectl create "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" crds.yaml "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" common.yaml "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" operator.yaml\n$ kubectl create "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" cluster.yaml\n")])])]),t("h3",{attrs:{id:"拉取ceph镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#拉取ceph镜像"}},[s._v("#")]),s._v(" 拉取Ceph镜像")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker pull rook/ceph:v1.8.3")]),s._v("\n\nv1.8.3: Pulling from rook/ceph\nDigest: sha256:d3b03079b6e055f5a436611fb06f3eaa3991fe222ff066765491d66e4cd5f401\nStatus: Image is up to "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" rook/ceph:v1.8.3\ndocker.io/rook/ceph:v1.8.3\n")])])]),t("h3",{attrs:{id:"拉取csi镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#拉取csi镜像"}},[s._v("#")]),s._v(" 拉取Csi镜像")]),s._v(" "),t("p",[s._v("找出需要拉取的镜像")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# for i in `kubectl get pods -n rook-ceph -o jsonpath='{.items[*].spec.containers[*].image}'`;do echo ${i} | grep gcr.io;done")]),s._v("\nk8s.gcr.io/sig-storage/csi-node-driver-registrar:v2.4.0\nk8s.gcr.io/sig-storage/csi-node-driver-registrar:v2.4.0\nk8s.gcr.io/sig-storage/csi-attacher:v3.4.0\nk8s.gcr.io/sig-storage/csi-snapshotter:v4.2.0\nk8s.gcr.io/sig-storage/csi-resizer:v1.3.0\nk8s.gcr.io/sig-storage/csi-provisioner:v3.1.0\nk8s.gcr.io/sig-storage/csi-attacher:v3.4.0\nk8s.gcr.io/sig-storage/csi-snapshotter:v4.2.0\nk8s.gcr.io/sig-storage/csi-resizer:v1.3.0\nk8s.gcr.io/sig-storage/csi-provisioner:v3.1.0\nk8s.gcr.io/sig-storage/csi-node-driver-registrar:v2.4.0\nk8s.gcr.io/sig-storage/csi-node-driver-registrar:v2.4.0\nk8s.gcr.io/sig-storage/csi-node-driver-registrar:v2.4.0\nk8s.gcr.io/sig-storage/csi-node-driver-registrar:v2.4.0\nk8s.gcr.io/sig-storage/csi-node-driver-registrar:v2.4.0\nk8s.gcr.io/sig-storage/csi-provisioner:v3.1.0\nk8s.gcr.io/sig-storage/csi-resizer:v1.3.0\nk8s.gcr.io/sig-storage/csi-attacher:v3.4.0\nk8s.gcr.io/sig-storage/csi-snapshotter:v4.2.0\nk8s.gcr.io/sig-storage/csi-provisioner:v3.1.0\nk8s.gcr.io/sig-storage/csi-resizer:v1.3.0\nk8s.gcr.io/sig-storage/csi-attacher:v3.4.0\nk8s.gcr.io/sig-storage/csi-snapshotter:v4.2.0\nk8s.gcr.io/sig-storage/csi-node-driver-registrar:v2.4.0\n")])])]),t("p",[s._v("然后编写一个脚本拉取镜像")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash ")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("image_list")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n        csi-provisioner:v3.1.0\n        csi-node-driver-registrar:v2.4.0\n        csi-attacher:v3.4.0\n        csi-snapshotter:v4.2.0\n        csi-resizer:v1.3.0\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("aliyuncs")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"registry.aliyuncs.com/it00021hot"')]),s._v(" 或者 registry.aliyuncs.com/google_containers\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("google_gcr")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k8s.gcr.io/sig-storage"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("image")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${image_list"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("*"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image pull "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${aliyuncs}")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${image}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image tag  "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${aliyuncs}")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${image}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${google_gcr}")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${image}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${aliyuncs}")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${image}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${aliyuncs}")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${image}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${google_gcr}")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${image}")]),s._v(' downloaded"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v(" \n")])])]),t("h3",{attrs:{id:"查看状态"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看状态"}},[s._v("#")]),s._v(" 查看状态")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pods -o wide -n rook-ceph ")]),s._v("\nNAME                                              READY   STATUS      RESTARTS   AGE   IP               NODE    NOMINATED NODE   READINESS GATES\ncsi-cephfsplugin-6cmc9                            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("/3     Running     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          26m   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.121    node2   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\ncsi-cephfsplugin-kpk9h                            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("/3     Running     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          27m   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.133    node4   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\ncsi-cephfsplugin-n87jf                            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("/3     Running     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          26m   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.42     node3   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\ncsi-cephfsplugin-provisioner-57fdf9cc88-6c57f     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("/6     Running     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          27m   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".104.10    node2   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\ncsi-cephfsplugin-provisioner-57fdf9cc88-dqhf8     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("/6     Running     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          27m   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".135.11    node3   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\ncsi-cephfsplugin-zck7h                            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("/3     Running     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          27m   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.177    node1   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\ncsi-rbdplugin-btjpc                               "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("/3     Running     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          26m   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.42     node3   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\ncsi-rbdplugin-jb864                               "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("/3     Running     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          26m   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.133    node4   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\ncsi-rbdplugin-lpj4t                               "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("/3     Running     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          27m   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.177    node1   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\ncsi-rbdplugin-provisioner-865f84ff48-bwwvw        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("/6     Running     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          27m   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".166.143   node1   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\ncsi-rbdplugin-provisioner-865f84ff48-ls2jv        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("/6     Running     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          27m   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".3.75      node4   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\ncsi-rbdplugin-w9wb5                               "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("/3     Running     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          27m   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.121    node2   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nrook-ceph-crashcollector-node1-7bdf8cf7d-8fvfw    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          60m   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".166.138   node1   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nrook-ceph-crashcollector-node2-5d87c47d67-qqgzw   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          62m   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".104.4     node2   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nrook-ceph-crashcollector-node3-5999b78949-rqm6d   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          51m   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".135.8     node3   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nrook-ceph-crashcollector-node4-69d99c8b7c-v6rbq   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          61m   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".3.69      node4   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nrook-ceph-mgr-a-9bfd675fc-pblwn                   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          62m   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".166.134   node1   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nrook-ceph-mon-a-6985594f74-55hdt                  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          70m   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".3.68      node4   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nrook-ceph-mon-b-d7b47d9c6-ptv5n                   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          65m   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".104.3     node2   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nrook-ceph-mon-c-58dfcdfd8f-87svf                  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          62m   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".166.133   node1   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nrook-ceph-operator-6b5c6b5dcf-dwfhp               "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          87m   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".104.1     node2   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nrook-ceph-osd-0-65d46bb8d8-p6cdm                  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          55m   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".3.73      node4   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nrook-ceph-osd-1-7887c44f8d-8qdmr                  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          55m   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".104.8     node2   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nrook-ceph-osd-2-55c6df6466-slxrf                  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          53m   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".166.140   node1   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nrook-ceph-osd-3-6648dc584-mjtbv                   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          51m   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".135.7     node3   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nrook-ceph-osd-prepare-node1-bx4bw                 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     Completed   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          49m   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".166.142   node1   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nrook-ceph-osd-prepare-node2-kcbrv                 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     Completed   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          49m   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".104.9     node2   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nrook-ceph-osd-prepare-node3-9t666                 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     Completed   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          49m   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".135.10    node3   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nrook-ceph-osd-prepare-node4-rcrfc                 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     Completed   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          49m   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".3.74      node4   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),t("h3",{attrs:{id:"master加入osd"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#master加入osd"}},[s._v("#")]),s._v(" Master加入OSD")]),s._v(" "),t("p",[s._v("因为Master节点是被禁止调度，就是污点，需要设置取消禁止调度和污点。然后让Master加入OSD节点。")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl taint node master  node-role.kubernetes.io/master:NoSchedule-")]),s._v("\nnode/master untainted\n")])])]),t("h3",{attrs:{id:"部署rook-ceph-工具"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#部署rook-ceph-工具"}},[s._v("#")]),s._v(" 部署Rook Ceph 工具")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master examples"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create -f toolbox.yaml ")]),s._v("\n")])])]),t("p",[s._v("通过ceph-tool工具pod查看ceph集群状态")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl exec -it pod/rook-ceph-tools-7bbd566fd9-smchn -n rook-ceph -- bash")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("rook@rook-ceph-tools-7bbd566fd9-smchn /"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ ceph "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" \n  cluster:\n    id:     9790e7f4-cfa3-44de-a411-5926d3034cb7\n    health: HEALTH_OK\n \n  services:\n    mon: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" daemons, quorum a,c,b "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("age 106m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    mgr: a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("active, since 104m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    osd: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" osds: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" up "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("since 29m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("since 29m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n \n  data:\n    pools:   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" pools, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" pgs\n    objects: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" objects, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" B\n    usage:   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),s._v(" MiB used, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("250")]),s._v(" GiB / "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("250")]),s._v(" GiB avail\n    pgs:     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" active+clean\n\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("rook@rook-ceph-tools-7bbd566fd9-smchn /"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ ceph "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("df")]),s._v(" \n--- RAW STORAGE ---\nCLASS     SIZE    AVAIL    USED  RAW USED  %RAW USED\nhdd    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("250")]),s._v(" GiB  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("250")]),s._v(" GiB  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),s._v(" MiB    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),s._v(" MiB       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01")]),s._v("\nTOTAL  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("250")]),s._v(" GiB  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("250")]),s._v(" GiB  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),s._v(" MiB    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),s._v(" MiB       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01")]),s._v("\n \n--- POOLS ---\nPOOL                   ID  PGS  STORED  OBJECTS  USED  %USED  MAX AVAIL\ndevice_health_metrics   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" B        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" B      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("79")]),s._v(" GiB\n")])])]),t("h3",{attrs:{id:"部署ceph-dashboard"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#部署ceph-dashboard"}},[s._v("#")]),s._v(" 部署Ceph Dashboard")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master examples"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f dashboard-external-https.yaml")]),s._v("\n")])])]),t("p",[s._v("获取dashboard的admin密码")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master examples"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl -n rook-ceph get secret rook-ceph-dashboard-password -o \\")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"{['data']['password']}\"")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" base64 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v("\ndrX3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("d2D"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#dU,Z,_#z6kn")]),s._v("\n")])])]),t("p",[s._v("通过NodePort去访问")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master examples"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get svc -n rook-ceph")]),s._v("\nNAME                                     TYPE        CLUSTER-IP       EXTERNAL-IP   PORT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             AGE\ncsi-cephfsplugin-metrics                 ClusterIP   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.103")]),s._v(".81.126    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("/TCP,8081/TCP   110m\ncsi-rbdplugin-metrics                    ClusterIP   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.105")]),s._v(".224.132   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("/TCP,8081/TCP   110m\nrook-ceph-mgr                            ClusterIP   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.104")]),s._v(".54.196    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9283")]),s._v("/TCP            98m\nrook-ceph-mgr-dashboard                  ClusterIP   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.109")]),s._v(".104.68    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8443")]),s._v("/TCP            98m\nrook-ceph-mgr-dashboard-external-https   NodePort    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.104")]),s._v(".174.92    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8443")]),s._v(":32349/TCP      32m     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#这个就是dashboard的地址")]),s._v("\nrook-ceph-mon-a                          ClusterIP   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.100")]),s._v(".122.20    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6789")]),s._v("/TCP,3300/TCP   108m\nrook-ceph-mon-b                          ClusterIP   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.97")]),s._v(".200.54     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6789")]),s._v("/TCP,3300/TCP   103m\nrook-ceph-mon-c                          ClusterIP   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.101")]),s._v(".245.217   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6789")]),s._v("/TCP,3300/TCP   100m\n")])])]),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"https://i.bmp.ovh/imgs/2022/02/a86d7dc906dc25a6.png"}}),s._v(" "),t("h2",{attrs:{id:"ceph集群管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ceph集群管理"}},[s._v("#")]),s._v(" Ceph集群管理")]),s._v(" "),t("h3",{attrs:{id:"ceph资源对象"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ceph资源对象"}},[s._v("#")]),s._v(" Ceph资源对象")]),s._v(" "),t("p",[s._v("Ceph包含的组件：")]),s._v(" "),t("ul",[t("li",[s._v("mon monitor 管理集群")]),s._v(" "),t("li",[s._v("mgr manager 监控管理")]),s._v(" "),t("li",[s._v("mds CephFS  元数据管理")]),s._v(" "),t("li",[s._v("rgw 对象存储")]),s._v(" "),t("li",[s._v("osd 存储")])]),s._v(" "),t("h3",{attrs:{id:"k8s集群访问ceph"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#k8s集群访问ceph"}},[s._v("#")]),s._v(" K8S集群访问Ceph")]),s._v(" "),t("p",[s._v("查看容器内部的Ceph配置文件")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("rook@rook-ceph-tools-7bbd566fd9-smchn /"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/ceph/ceph.conf \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("global"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nmon_host "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.101")]),s._v(".245.217:6789,10.100.122.20:6789,10.97.200.54:6789\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("client.admin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nkeyring "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /etc/ceph/keyring\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("rook@rook-ceph-tools-7bbd566fd9-smchn /"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/ceph/keyring \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("client.admin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nkey "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("AQAZOPph2QMBMxAAqepptucmmM6eM5gG5ZbKHg")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v("\n")])])]),t("p",[s._v("拷贝容器内的配置文件到本地集群")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir /etc/ceph ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/ceph/ceph.conf ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("global"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nmon_host "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.101")]),s._v(".245.217:6789,10.100.122.20:6789,10.97.200.54:6789\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("client.admin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nkeyring "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /etc/ceph/keyring\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim  /etc/ceph/keyring ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("client.admin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nkey "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("AQAZOPph2QMBMxAAqepptucmmM6eM5gG5ZbKHg")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v("\n")])])]),t("p",[s._v("安装Ceph客户端")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat > /etc/yum.repos.d/ceph.repo << EOF ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ceph"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ceph\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("baseurl")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://mirrors.aliyun.com/ceph/rpm-pacific/el8/x86_64/\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gpgcheck")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" EOF\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum install -y ceph-common ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph -s ")]),s._v("\n  cluster:\n    id:     9790e7f4-cfa3-44de-a411-5926d3034cb7\n    health: HEALTH_OK\n \n  services:\n    mon: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" daemons, quorum a,c,b "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("age 106m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    mgr: a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("active, since 104m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    osd: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" osds: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" up "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("since 29m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("since 29m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n \n  data:\n    pools:   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" pools, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" pgs\n    objects: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" objects, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" B\n    usage:   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),s._v(" MiB used, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("250")]),s._v(" GiB / "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("250")]),s._v(" GiB avail\n    pgs:     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" active+clean\n")])])]),t("h3",{attrs:{id:"访问rbd块存储"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#访问rbd块存储"}},[s._v("#")]),s._v(" 访问RBD块存储")]),s._v(" "),t("p",[s._v("1、创建pool")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph osd  pool  create rook 16 16 ")]),s._v("\npool "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rook'")]),s._v(" created\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph osd lspools ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" device_health_metrics\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" rook\n")])])]),t("p",[s._v("2、在pool创建RBD块设备")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rbd create -p rook --image  rook-rbd.img --size 10G")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rbd ls -p rook")]),s._v("\nrook-rbd.img\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rbd info rook/rook-rbd.img")]),s._v("\nrbd image "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rook-rbd.img'")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("\n        size "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" GiB "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2560")]),s._v(" objects\n        order "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" MiB objects"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        snapshot_count: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n        id: 4a802aa59f38\n        block_name_prefix: rbd_data.4a802aa59f38\n        format: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n        features: layering\n        op_features: \n        flags: \n        create_timestamp: Wed Feb  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":21:34 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("\n        access_timestamp: Wed Feb  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":21:34 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("\n        modify_timestamp: Wed Feb  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":21:34 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("\n")])])]),t("p",[s._v("3、客户端挂载")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rbd map rook/rook-rbd.img ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rbd showmapped ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkfs.xfs /dev/rbd0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mount /dev/rbd0 /media/")]),s._v("\n")])])]),t("h3",{attrs:{id:"rook提供rbd服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rook提供rbd服务"}},[s._v("#")]),s._v(" rook提供RBD服务")]),s._v(" "),t("p",[s._v("rook可以提供以下3类型的存储：")]),s._v(" "),t("ul",[t("li",[s._v("Block: Create block storage to be consumed by a pod")]),s._v(" "),t("li",[s._v("Object: Create an object store that is accessible inside or outside the Kubernetes cluster")]),s._v(" "),t("li",[s._v("Shared File System: Create a file system to be shared across multiple pods")])]),s._v(" "),t("h3",{attrs:{id:"使用rook-ceph的块存储"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用rook-ceph的块存储"}},[s._v("#")]),s._v(" 使用rook-ceph的块存储")]),s._v(" "),t("blockquote",[t("p",[s._v("1、基于 CSI 驱动程序创建卷\n2、基于 flex 驱动程序创建卷\n1、"),t("code",[s._v("此示例使用 CSI 驱动程序，它是 K8s 1.13 和更新版本的首选驱动程序。")]),s._v("\n2、flex 驱动程序（K8s 1.12 或更早版本需要）的存储类")]),s._v(" "),t("p",[s._v("要基于 flex 驱动程序创建卷，确保通过 Ceph CSI 启用了 flex 驱动程序。为此，您需要在您的操作员部署文件 operator.yaml 中设置 ROOK_ENABLE_FLEX_DRIVER 为 true ，与 CSI 驱动程序相同。")]),s._v(" "),t("p",[s._v("注意：CSI 驱动程序，此示例要求每个节点至少有 1 个 OSD，每个 OSD 位于3 个不同的节点上。因为 failureDomain 设置为 host 并且 replicated.size 设置为 3 。")])]),s._v(" "),t("p",[t("code",[s._v("这里使用 CSI 驱动程序，创建了一个示例应用程序来使用 Rook 提供的块存储和经典的 wordpress 和 mysql 应用程序，这两个应用程序都将使用 Rook 提供的块卷")])]),s._v(" "),t("p",[s._v("在提供块存储之前，需要先创建 StorageClass 和存储池pool，k8s需要这两类资源，才能和 Rook 交互，进而分配持久卷（PV）。")]),s._v(" "),t("p",[t("strong",[s._v("在kubernetes集群里，要提供rbd块设备服务，需要有如下步骤：")])]),s._v(" "),t("ol",[t("li",[s._v("创建 rbd-provisione")]),s._v(" "),t("li",[s._v("创建 pool")]),s._v(" "),t("li",[s._v("创建对应的 storageclass")]),s._v(" "),t("li",[s._v("使用rbd对应的storageclass创建pvc，然后动态申请pv")]),s._v(" "),t("li",[s._v("创建pod使用pv（ 使用存储 ）")])]),s._v(" "),t("blockquote",[t("p",[s._v("通过rook创建Ceph Cluster集群之后，rook自身提供了rbd-provisioner服务，所以不需要再部署 其provisioner（供应商，就是提供存储的）。")])]),s._v(" "),t("p",[s._v("1、这里使用CSI 驱动程序")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("、CSI 驱动程序 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("、3步骤可以直接使用下面命令执行"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create -f /rook/cluster/examples/kubernetes/ceph/csi/rbd/storageclass.yaml")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("、flex 驱动程序\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create -f cluster/examples/kubernetes/ceph/flex/storageclass.yaml")]),s._v("\n")])])]),t("p",[s._v("2、创建pool，创建一个自己的工作目录")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /root/rook/cluster/examples/kubernetes/ceph")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir my_yaml")]),s._v("\n")])])]),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat > pool.yaml << EOF")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ceph.rook.io/v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" CephBlockPool\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" replicapool "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# operator会监听并创建一个pool")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rook"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("failureDomain")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" host\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicated")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("size")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("requireSafeReplicaSize")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\nEOF\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f pool.yaml")]),s._v("\n")])])]),t("blockquote",[t("p",[s._v("创建了一个名为 replicapool 的存储池")]),s._v(" "),t("p",[s._v("apply执行完后，登录 ceph dashboard 界面上能看到对应的pool")])]),s._v(" "),t("p",[s._v("3、创建对应的 storageclass")]),s._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat > storageclass.yaml << EOF")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" storage.k8s.io/v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" StorageClass\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rook"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("block \t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里创建一个storage class, 在pvc中指定这个storage class即可实现动态创建PV")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("provisioner")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rook"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph.rbd.csi.ceph.com\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("parameters")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("clusterID")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rook"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("Pool")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" replicapool\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imageFormat")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imageFeatures")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" layering\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("csi.storage.k8s.io/provisioner-secret-name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rook"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("csi"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rbd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("provisioner\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("csi.storage.k8s.io/provisioner-secret-namespace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rook"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph \t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 必须与rook-ceph集群ns相同")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("csi.storage.k8s.io/controller-expand-secret-name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rook"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("csi"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rbd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("provisioner\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("csi.storage.k8s.io/controller-expand-secret-namespace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rook"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("csi.storage.k8s.io/node-stage-secret-namespace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rook"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ceph\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("csi.storage.k8s.io/fstype")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ext4 \t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定卷的文件系统类型。如果没有指定，它将使用ext4")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("allowVolumeExpansion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("reclaimPolicy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Delete \t\t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不写默认值为Delete,其他选项包括“保留(Retain)”、“回收(Recycle)”")]),s._v("\nEOF\n\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f storageclass.yaml  #创建了一个名为 rook-ceph-block 的storageClass")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get storageclass    ")]),s._v("\n")])])]),t("blockquote",[t("p",[s._v("如果您在“rook-ceph”以外的命名空间中部署了 Rook operator ，请更改配置器中的前缀以匹配您 使用的命名空间。例如，如果 Rook operator 在名称空间“my-namespace”中运行，则供应商值应 为“my-namespace.rbd.csi.ceph.com”。")])])])}),[],!1,null,null,null);t.default=r.exports}}]);