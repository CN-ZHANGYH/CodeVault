(window.webpackJsonp=window.webpackJsonp||[]).push([[150],{463:function(t,s,a){"use strict";a.r(s);var e=a(7),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"kubernetes集群维护"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes集群维护"}},[t._v("#")]),t._v(" Kubernetes集群维护")]),t._v(" "),s("h2",{attrs:{id:"etcd数据备份与恢复"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#etcd数据备份与恢复"}},[t._v("#")]),t._v(" Etcd数据备份与恢复")]),t._v(" "),s("p",[s("strong",[t._v("kubernetes使用Etcd数据库实时存储集群中的数据，安全起见，一定要备份。")])]),t._v(" "),s("h3",{attrs:{id:"安装etcd"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装etcd"}},[t._v("#")]),t._v(" 安装etcd")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master etcd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# yum install -y etcd ")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# etcdctl --version ")]),t._v("\netcdctl version: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.3")]),t._v(".11\nAPI version: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n")])])]),s("h3",{attrs:{id:"备份etcd数据库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#备份etcd数据库"}},[t._v("#")]),t._v(" 备份etcd数据库")]),t._v(" "),s("p",[s("strong",[t._v("如果工具版本是3默认API版本是2就要换成3版本")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master etcd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ETCDCTL_API=3 etcdctl \\")]),t._v("\nsnapshot save snap.db "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v(" \t\t\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#备份，指定一个文件名，在线进行备份")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--endpoints")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("https://127.0.0.1:2379 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#连接ETCD的节点  使用ss -ntpl |grep 2379,需要查看网络插件是否使用宿主机的，访问带上ca证书校验")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--cacert")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/etc/kubernetes/pki/etcd/ca.crt "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#指定证书的公共目录下的etcd目录的ca.crt ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--cert")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/etc/kubernetes/pki/etcd/server.crt "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v(" \t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#指定数字证书")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--key")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/etc/kubernetes/pki/etcd/server.key  \t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#指定密钥")]),t._v("\n\nSnapshot saved at snap.db\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# du -sh snap.db \t\t\t\t#查看大小")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(".2M    snap.db\n")])])]),s("h3",{attrs:{id:"删除数据deployment"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#删除数据deployment"}},[t._v("#")]),t._v(" 删除数据deployment")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get deployment ")]),t._v("\nNAME   READY   UP-TO-DATE   AVAILABLE   AGE\nweb    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("            "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("           161m\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl delete deployment web ")]),t._v("\ndeployment.apps "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"web"')]),t._v(" deleted\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get deployment ")]),t._v("\nNo resources found "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" default namespace.\n\n\n可以看到当前是没有deployment的\n")])])]),s("h3",{attrs:{id:"恢复数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#恢复数据"}},[t._v("#")]),t._v(" 恢复数据")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("先暂停kube-apiserver和etcd容器")])]),t._v(" "),s("li",[s("strong",[t._v("相当于把之前的文件夹换个名字做备份测试")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mv /etc/kubernetes/manifests /etc/kubernetes/manifests.bak")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mv /var/lib/etcd/ /var/lib/etcd.back ")]),t._v("\n")])])]),s("h3",{attrs:{id:"恢复"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#恢复"}},[t._v("#")]),t._v(" 恢复")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ETCDCTL_API=3 etcdctl snapshot restore snap.db --data-dir=/var/lib/etcd")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v("-11-08 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),t._v(":46:35.934598 I "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" mvcc: restore compact to "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19609")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v("-11-08 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),t._v(":46:35.941164 I "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" etcdserver/membership: added member 8e9e05c52164694d "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("http://localhost:2380"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" to cluster cdf818194e3a8c32\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mv /etc/kubernetes/manifests.bak/ /etc/kubernetes/manifests")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# systemctl restart kubelet ")]),t._v("\n")])])]),s("h3",{attrs:{id:"查看数据恢复情况"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看数据恢复情况"}},[t._v("#")]),t._v(" 查看数据恢复情况")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("这里需要稍等一会，然后等待Pods重新构建起来")])]),t._v(" "),s("li",[s("strong",[t._v("查看deployment是否存在之前的数据")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get pods -A ")]),t._v("\nNAMESPACE       NAME                                       READY   STATUS    RESTARTS   AGE\ndefault         web-96d5df5c8-w2vvf                        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          172m\ningress-nginx   nginx-ingress-controller-gvfvl             "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          3h29m\nkube-system     calico-kube-controllers-659bd7879c-qv5qx   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v("          4h2m\nkube-system     calico-node-df8kn                          "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          4h2m\nkube-system     calico-node-xrmnz                          "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          3h57m\nkube-system     client3                                    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          79m\nkube-system     coredns-7f89b7bc75-jwxfg                   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          4h2m\nkube-system     coredns-7f89b7bc75-qf8dg                   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          4h2m\nkube-system     etcd-master                                "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          4h2m\nkube-system     kube-apiserver-master                      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          4h2m\nkube-system     kube-controller-manager-master             "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          4h\nkube-system     kube-proxy-mbhtv                           "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("          4h2m\nkube-system     kube-proxy-n8qc8                           "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          3h57m\nkube-system     kube-scheduler-master                      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          4h2m\n\nroot@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get deployment ")]),t._v("\nNAME   READY   UP-TO-DATE   AVAILABLE   AGE\nweb    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("            "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("           172m\n")])])]),s("h2",{attrs:{id:"k8s集群版本升级"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#k8s集群版本升级"}},[t._v("#")]),t._v(" K8S集群版本升级")]),t._v(" "),s("p",[s("strong",[t._v("Kubernetes每隔3个月发布一个小版本。")])]),t._v(" "),s("h3",{attrs:{id:"升级策略"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#升级策略"}},[t._v("#")]),t._v(" 升级策略：")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("始终保持最新")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("每半年升级一次，这样会落后社区1-2个版本")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("一年升级一次，或者更长，落后版本太多")])])])]),t._v(" "),s("h3",{attrs:{id:"升级的基本流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#升级的基本流程"}},[t._v("#")]),t._v(" 升级的基本流程")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("升级管理节点  >  升级其他管理节点  >  升级工作节点")])])]),t._v(" "),s("h3",{attrs:{id:"注意事项"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#注意事项"}},[t._v("#")]),t._v(" 注意事项：")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("升级之前必须备份所有组件以及数据，例如etcd")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("千万不要跨多个小版本进行升级，例如从1.16-1.19")])])])]),t._v(" "),s("blockquote",[s("h3",{attrs:{id:"kubeadm对k8s集群进行版本升级"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kubeadm对k8s集群进行版本升级"}},[t._v("#")]),t._v(" Kubeadm对K8S集群进行版本升级")])]),t._v(" "),s("h3",{attrs:{id:"升级管理节点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#升级管理节点"}},[t._v("#")]),t._v(" 升级管理节点")]),t._v(" "),s("h4",{attrs:{id:"查找最新版本号"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查找最新版本号"}},[t._v("#")]),t._v(" 查找最新版本号：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# yum list --showduplicates kubeadm ")]),t._v("\n")])])]),s("h4",{attrs:{id:"升级kubeadm"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#升级kubeadm"}},[t._v("#")]),t._v(" 升级kubeadm：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# yum install -y kubeadm-1.20.1-0")]),t._v("\n")])])]),s("h4",{attrs:{id:"驱逐node上的pod-且不可调度"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#驱逐node上的pod-且不可调度"}},[t._v("#")]),t._v(" 驱逐node上的Pod，且不可调度：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl drain master ")]),t._v("\nnode/master cordoned\nerror: unable to drain "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("node")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"master"')]),t._v(", aborting command"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n\nThere are pending nodes to be drained:\n master\nerror: cannot delete DaemonSet-managed Pods "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("use --ignore-daemonsets to ignore"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(": kube-system/calico-node-df8kn, kube-system/kube-proxy-mbhtv\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl drain master --ignore-daemonsets")]),t._v("\nnode/master already cordoned\nnode/master evicted\n")])])]),s("h4",{attrs:{id:"检查集群是否可以升级-并且获取可以升级的版本"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#检查集群是否可以升级-并且获取可以升级的版本"}},[t._v("#")]),t._v(" 检查集群是否可以升级，并且获取可以升级的版本：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubeadm upgrade plan ")]),t._v("\n···\nYou can now apply the upgrade by executing the following command:\n\n        kubeadm upgrade apply v1.20.12    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#将会提示你更新到可用的最新版本")]),t._v("\n\nNote: Before you can perform this upgrade, you have to update kubeadm to v1.20.12.\n")])])]),s("h4",{attrs:{id:"执行升级"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#执行升级"}},[t._v("#")]),t._v(" 执行升级：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubeadm upgrade apply v1.20.1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("upgrade/config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Making sure the configuration is correct:\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("upgrade/config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Reading configuration from the cluster"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("upgrade/config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" FYI: You can "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("look")]),t._v(" at this config "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" with "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'kubectl -n kube-system get cm kubeadm-config -o yaml'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("preflight"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Running pre-flight checks.\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("upgrade"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Running cluster health checks\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("upgrade/version"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" You have chosen to change the cluster version to "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"v1.20.1"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("upgrade/versions"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Cluster version: v1.20.0\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("upgrade/versions"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" kubeadm version: v1.20.1\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("upgrade/confirm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Are you sure you want to proceed with the upgrade? "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("y/N"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": y\n···\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("upgrade/successful"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" SUCCESS"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" Your cluster was upgraded to "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"v1.20.1"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v(" Enjoy"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("upgrade/kubelet"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Now that your control plane is upgraded, please proceed with upgrading your kubelets "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" you haven't already "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v(" so.\n")])])]),s("h4",{attrs:{id:"取消不可调度"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#取消不可调度"}},[t._v("#")]),t._v(" 取消不可调度：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get nodes ")]),t._v("\nNAME     STATUS                     ROLES                  AGE     VERSION\nmaster   Ready,SchedulingDisabled   control-plane,master   4h45m   v1.20.0\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("node")]),t._v("     Ready                      "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("                 4h40m   v1.20.0\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl uncordon master ")]),t._v("\nnode/master uncordoned\n")])])]),s("h4",{attrs:{id:"升级kubelet和kubectl"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#升级kubelet和kubectl"}},[t._v("#")]),t._v(" 升级kubelet和kubectl：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# yum install -y kubectl-1.20.1-0 kubelet-1.20.1-0")]),t._v("\n")])])]),s("h4",{attrs:{id:"重启kubelet"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#重启kubelet"}},[t._v("#")]),t._v(" 重启kubelet：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# systemctl daemon-reload ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# systemctl restart kubelet ")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get nodes ")]),t._v("\nNAME     STATUS   ROLES                  AGE     VERSION\nmaster   Ready    control-plane,master   4h49m   v1.20.1\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("node")]),t._v("     Ready    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("                 4h44m   v1.20.0\n")])])]),s("h3",{attrs:{id:"升级工作节点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#升级工作节点"}},[t._v("#")]),t._v(" 升级工作节点")]),t._v(" "),s("h4",{attrs:{id:"升级kubeadm-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#升级kubeadm-2"}},[t._v("#")]),t._v(" 升级kubeadm：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# yum install -y kubeadm-1.20.1-0")]),t._v("\n")])])]),s("h4",{attrs:{id:"驱逐node上的pod-且不可调度-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#驱逐node上的pod-且不可调度-2"}},[t._v("#")]),t._v(" 驱逐node上的Pod，且不可调度：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl drain node --ignore-daemonsets --force")]),t._v("\nnode/node already cordoned\nnode/node evicted\n")])])]),s("h4",{attrs:{id:"升级kubelet配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#升级kubelet配置"}},[t._v("#")]),t._v(" 升级kubelet配置：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubeadm upgrade node ")]),t._v("\n")])])]),s("h4",{attrs:{id:"升级kubelet和kubectl-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#升级kubelet和kubectl-2"}},[t._v("#")]),t._v(" 升级kubelet和kubectl:")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# yum install -y kubectl=1.20.1-0 kubelet-1.20.1-0 ")]),t._v("\n")])])]),s("h4",{attrs:{id:"重启kubelet-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#重启kubelet-2"}},[t._v("#")]),t._v(" 重启kubelet：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# systemctl daemon-reload ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# systemctl restart kubelet ")]),t._v("\n")])])]),s("h4",{attrs:{id:"取消不可调度-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#取消不可调度-2"}},[t._v("#")]),t._v(" 取消不可调度：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get nodes ")]),t._v("\nNAME     STATUS                     ROLES                  AGE     VERSION\nmaster   Ready                      control-plane,master   4h59m   v1.20.1\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("node")]),t._v("     Ready,SchedulingDisabled   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("                 4h54m   v1.20.1\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl uncordon node")]),t._v("\nnode/node uncordoned\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get nodes ")]),t._v("\nNAME     STATUS   ROLES                  AGE     VERSION\nmaster   Ready    control-plane,master   4h59m   v1.20.1\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("node")]),t._v("     Ready    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("                 4h54m   v1.20.1\n")])])]),s("h2",{attrs:{id:"k8s集群节点正确下线流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#k8s集群节点正确下线流程"}},[t._v("#")]),t._v(" K8s集群节点正确下线流程")]),t._v(" "),s("p",[t._v("如果你想维护或者删除某个节点，正确流程如下：")]),t._v(" "),s("h4",{attrs:{id:"获取节点列表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#获取节点列表"}},[t._v("#")]),t._v(" 获取节点列表：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get nodes ")]),t._v("\nNAME     STATUS   ROLES                  AGE     VERSION\nmaster   Ready    control-plane,master   5h3m    v1.20.1\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("node")]),t._v("     Ready    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("                 4h57m   v1.20.1\n")])])]),s("h4",{attrs:{id:"设置不可调度"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#设置不可调度"}},[t._v("#")]),t._v(" 设置不可调度：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl cordon node ")]),t._v("\nnode/node cordoned\n")])])]),s("h4",{attrs:{id:"驱逐节点上的pod"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#驱逐节点上的pod"}},[t._v("#")]),t._v(" 驱逐节点上的Pod：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl drain node --ignore-daemonsets")]),t._v("\nnode/node already cordoned\nnode/node evicted\n")])])]),s("h4",{attrs:{id:"移除节点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#移除节点"}},[t._v("#")]),t._v(" 移除节点：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl delete node node ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("node")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"node"')]),t._v(" deleted\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get node ")]),t._v("\nNAME     STATUS   ROLES                  AGE    VERSION\nmaster   Ready    control-plane,master   5h4m   v1.20.1\n")])])]),s("h3",{attrs:{id:"重新加入节点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#重新加入节点"}},[t._v("#")]),t._v(" 重新加入节点")]),t._v(" "),s("h4",{attrs:{id:"使用kubeadm重置节点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用kubeadm重置节点"}},[t._v("#")]),t._v(" 使用kubeadm重置节点：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubeadm reset ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("reset"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" WARNING: Changes made to this "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("host")]),t._v(" by "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'kubeadm init'")]),t._v(" or "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'kubeadm join'")]),t._v(" will be reverted.\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("reset"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Are you sure you want to proceed? "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("y/N"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": y\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("preflight"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Running pre-flight checks\n")])])]),s("h4",{attrs:{id:"在master节点生成新的token"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#在master节点生成新的token"}},[t._v("#")]),t._v(" 在master节点生成新的token：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubeadm  token create  ")]),t._v("\nmmvxlw.lgpb891ml8g7q9oq\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2>/dev/null | openssl dgst -sha256 -hex | sed 's/^.* //'")]),t._v("\n0026319b035eef72f40ba1545358f75113756c7b97e9925f4dd3105a01fbdb01\n")])])]),s("h4",{attrs:{id:"node重新加入节点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#node重新加入节点"}},[t._v("#")]),t._v(" node重新加入节点：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubeadm join 192.168.1.18:6443 --token mmvxlw.lgpb891ml8g7q9oq --discovery-token-ca-cert-hash sha256:0026319b035eef72f40ba1545358f75113756c7b97e9925f4dd3105a01fbdb01")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("preflight"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Running pre-flight checks\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("WARNING SystemVerification"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": this Docker version is not on the list of validated versions: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20.10")]),t._v(".10. Latest validated version: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19.03")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("preflight"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Reading configuration from the cluster"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("preflight"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" FYI: You can "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("look")]),t._v(" at this config "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" with "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'kubectl -n kube-system get cm kubeadm-config -o yaml'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet-start"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Writing kubelet configuration to "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/lib/kubelet/config.yaml"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet-start"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Writing kubelet environment "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" with flags to "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/lib/kubelet/kubeadm-flags.env"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet-start"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Starting the kubelet\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet-start"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Waiting "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" the kubelet to perform the TLS Bootstrap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n\nThis "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("node")]),t._v(" has joined the cluster:\n* Certificate signing request was sent to apiserver and a response was received.\n* The Kubelet was informed of the new secure connection details.\n\nRun "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'kubectl get nodes'")]),t._v(" on the control-plane to see this "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("node")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),t._v(" the cluster.\n")])])]),s("h4",{attrs:{id:"查看节点列表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看节点列表"}},[t._v("#")]),t._v(" 查看节点列表：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get nodes ")]),t._v("\nNAME     STATUS   ROLES                  AGE     VERSION\nmaster   Ready    control-plane,master   5h13m   v1.20.1\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("node")]),t._v("     Ready    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("                 32s     v1.20.1\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);