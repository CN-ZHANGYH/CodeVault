<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>GitLab + GitLab CI + Harbor + Kubernetes | CodeVault文档站</title>
    <meta name="generator" content="VuePress 1.9.2">
    <link rel="icon" href="/CodeVault/img/Aj.svg">
    <meta name="description" content="CodeVault一个记录云计算、云原生、Java开发的文档站。">
    <meta name="keywords" content="vuepress,theme,blog,vdoing">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/CodeVault/assets/css/0.styles.bcdd6f38.css" as="style"><link rel="preload" href="/CodeVault/assets/js/app.ef278985.js" as="script"><link rel="preload" href="/CodeVault/assets/js/2.f96441c8.js" as="script"><link rel="preload" href="/CodeVault/assets/js/174.d0a94b6a.js" as="script"><link rel="prefetch" href="/CodeVault/assets/js/10.0b981dbd.js"><link rel="prefetch" href="/CodeVault/assets/js/100.5c06c78f.js"><link rel="prefetch" href="/CodeVault/assets/js/101.88d67c9c.js"><link rel="prefetch" href="/CodeVault/assets/js/102.70928850.js"><link rel="prefetch" href="/CodeVault/assets/js/103.ef636770.js"><link rel="prefetch" href="/CodeVault/assets/js/104.c1927b63.js"><link rel="prefetch" href="/CodeVault/assets/js/105.85c8a7cd.js"><link rel="prefetch" href="/CodeVault/assets/js/106.fb2e66ea.js"><link rel="prefetch" href="/CodeVault/assets/js/107.0f35bf63.js"><link rel="prefetch" href="/CodeVault/assets/js/108.fccb735c.js"><link rel="prefetch" href="/CodeVault/assets/js/109.682036f0.js"><link rel="prefetch" href="/CodeVault/assets/js/11.ac4d24fe.js"><link rel="prefetch" href="/CodeVault/assets/js/110.b7f8edea.js"><link rel="prefetch" href="/CodeVault/assets/js/111.fd94666b.js"><link rel="prefetch" href="/CodeVault/assets/js/112.a07708f0.js"><link rel="prefetch" href="/CodeVault/assets/js/113.63efff87.js"><link rel="prefetch" href="/CodeVault/assets/js/114.ab1099fa.js"><link rel="prefetch" href="/CodeVault/assets/js/115.f5fe6b28.js"><link rel="prefetch" href="/CodeVault/assets/js/116.6ce08e8e.js"><link rel="prefetch" href="/CodeVault/assets/js/117.48dbb04e.js"><link rel="prefetch" href="/CodeVault/assets/js/118.5b909be0.js"><link rel="prefetch" href="/CodeVault/assets/js/119.8f6e0bf7.js"><link rel="prefetch" href="/CodeVault/assets/js/12.c1e5feb4.js"><link rel="prefetch" href="/CodeVault/assets/js/120.21cc7ba5.js"><link rel="prefetch" href="/CodeVault/assets/js/121.04134de2.js"><link rel="prefetch" href="/CodeVault/assets/js/122.31567951.js"><link rel="prefetch" href="/CodeVault/assets/js/123.002f9bee.js"><link rel="prefetch" href="/CodeVault/assets/js/124.e99e860a.js"><link rel="prefetch" href="/CodeVault/assets/js/125.72c926b3.js"><link rel="prefetch" href="/CodeVault/assets/js/126.01a5e87f.js"><link rel="prefetch" href="/CodeVault/assets/js/127.1956ebe6.js"><link rel="prefetch" href="/CodeVault/assets/js/128.d65996f5.js"><link rel="prefetch" href="/CodeVault/assets/js/129.67eabc56.js"><link rel="prefetch" href="/CodeVault/assets/js/13.13f84e24.js"><link rel="prefetch" href="/CodeVault/assets/js/130.634c4ce3.js"><link rel="prefetch" href="/CodeVault/assets/js/131.a418f195.js"><link rel="prefetch" href="/CodeVault/assets/js/132.ea662f19.js"><link rel="prefetch" href="/CodeVault/assets/js/133.63b2b38b.js"><link rel="prefetch" href="/CodeVault/assets/js/134.0cd9f3da.js"><link rel="prefetch" href="/CodeVault/assets/js/135.4e8913a1.js"><link rel="prefetch" href="/CodeVault/assets/js/136.53ad8182.js"><link rel="prefetch" href="/CodeVault/assets/js/137.8d8f6ff4.js"><link rel="prefetch" href="/CodeVault/assets/js/138.1e5627de.js"><link rel="prefetch" href="/CodeVault/assets/js/139.4c335178.js"><link rel="prefetch" href="/CodeVault/assets/js/14.92742bc3.js"><link rel="prefetch" href="/CodeVault/assets/js/140.ad32a483.js"><link rel="prefetch" href="/CodeVault/assets/js/141.509650db.js"><link rel="prefetch" href="/CodeVault/assets/js/142.8a4692a4.js"><link rel="prefetch" href="/CodeVault/assets/js/143.4226943d.js"><link rel="prefetch" href="/CodeVault/assets/js/144.a04016d3.js"><link rel="prefetch" href="/CodeVault/assets/js/145.55b32ea3.js"><link rel="prefetch" href="/CodeVault/assets/js/146.d78a1fa5.js"><link rel="prefetch" href="/CodeVault/assets/js/147.c48fa78d.js"><link rel="prefetch" href="/CodeVault/assets/js/148.24a7cd95.js"><link rel="prefetch" href="/CodeVault/assets/js/149.a74e35f1.js"><link rel="prefetch" href="/CodeVault/assets/js/15.6953f44b.js"><link rel="prefetch" href="/CodeVault/assets/js/150.7f27817b.js"><link rel="prefetch" href="/CodeVault/assets/js/151.6445d326.js"><link rel="prefetch" href="/CodeVault/assets/js/152.eadc171d.js"><link rel="prefetch" href="/CodeVault/assets/js/153.2da9c7f8.js"><link rel="prefetch" href="/CodeVault/assets/js/154.a3546076.js"><link rel="prefetch" href="/CodeVault/assets/js/155.351a616f.js"><link rel="prefetch" href="/CodeVault/assets/js/156.e6bbf3b3.js"><link rel="prefetch" href="/CodeVault/assets/js/157.ee152deb.js"><link rel="prefetch" href="/CodeVault/assets/js/158.076e0f8c.js"><link rel="prefetch" href="/CodeVault/assets/js/159.9ad1744e.js"><link rel="prefetch" href="/CodeVault/assets/js/16.df859e45.js"><link rel="prefetch" href="/CodeVault/assets/js/160.c5beea39.js"><link rel="prefetch" href="/CodeVault/assets/js/161.0cf956e1.js"><link rel="prefetch" href="/CodeVault/assets/js/162.c58e81e1.js"><link rel="prefetch" href="/CodeVault/assets/js/163.63d65593.js"><link rel="prefetch" href="/CodeVault/assets/js/164.9626ab8a.js"><link rel="prefetch" href="/CodeVault/assets/js/165.fc09035b.js"><link rel="prefetch" href="/CodeVault/assets/js/166.b38be38b.js"><link rel="prefetch" href="/CodeVault/assets/js/167.8f5417ed.js"><link rel="prefetch" href="/CodeVault/assets/js/168.d636e649.js"><link rel="prefetch" href="/CodeVault/assets/js/169.dd84c459.js"><link rel="prefetch" href="/CodeVault/assets/js/17.a2971fe6.js"><link rel="prefetch" href="/CodeVault/assets/js/170.a488616f.js"><link rel="prefetch" href="/CodeVault/assets/js/171.a7896a98.js"><link rel="prefetch" href="/CodeVault/assets/js/172.90b58f0e.js"><link rel="prefetch" href="/CodeVault/assets/js/173.ce66d68a.js"><link rel="prefetch" href="/CodeVault/assets/js/175.87ea7df7.js"><link rel="prefetch" href="/CodeVault/assets/js/176.67abf34b.js"><link rel="prefetch" href="/CodeVault/assets/js/177.3b2acda5.js"><link rel="prefetch" href="/CodeVault/assets/js/178.5fe697a5.js"><link rel="prefetch" href="/CodeVault/assets/js/179.57349e36.js"><link rel="prefetch" href="/CodeVault/assets/js/18.45b06c71.js"><link rel="prefetch" href="/CodeVault/assets/js/180.a8b6136e.js"><link rel="prefetch" href="/CodeVault/assets/js/181.c96cb1ac.js"><link rel="prefetch" href="/CodeVault/assets/js/182.e13a2ed6.js"><link rel="prefetch" href="/CodeVault/assets/js/183.4982d955.js"><link rel="prefetch" href="/CodeVault/assets/js/184.123e3912.js"><link rel="prefetch" href="/CodeVault/assets/js/185.c1db2bfa.js"><link rel="prefetch" href="/CodeVault/assets/js/186.bff6dc40.js"><link rel="prefetch" href="/CodeVault/assets/js/187.3e10e06d.js"><link rel="prefetch" href="/CodeVault/assets/js/188.53f01570.js"><link rel="prefetch" href="/CodeVault/assets/js/189.53c9b973.js"><link rel="prefetch" href="/CodeVault/assets/js/19.21381c2f.js"><link rel="prefetch" href="/CodeVault/assets/js/190.f9e298a3.js"><link rel="prefetch" href="/CodeVault/assets/js/191.7055ec43.js"><link rel="prefetch" href="/CodeVault/assets/js/192.6083d608.js"><link rel="prefetch" href="/CodeVault/assets/js/193.72e5d099.js"><link rel="prefetch" href="/CodeVault/assets/js/194.cb4c2f87.js"><link rel="prefetch" href="/CodeVault/assets/js/195.add61432.js"><link rel="prefetch" href="/CodeVault/assets/js/196.cafb716f.js"><link rel="prefetch" href="/CodeVault/assets/js/197.29ad1cb1.js"><link rel="prefetch" href="/CodeVault/assets/js/198.1ca9886c.js"><link rel="prefetch" href="/CodeVault/assets/js/199.28f7095d.js"><link rel="prefetch" href="/CodeVault/assets/js/20.fe478246.js"><link rel="prefetch" href="/CodeVault/assets/js/200.cdd91d66.js"><link rel="prefetch" href="/CodeVault/assets/js/201.568571d0.js"><link rel="prefetch" href="/CodeVault/assets/js/202.0b55d1cd.js"><link rel="prefetch" href="/CodeVault/assets/js/203.c9d7036e.js"><link rel="prefetch" href="/CodeVault/assets/js/204.f877fa44.js"><link rel="prefetch" href="/CodeVault/assets/js/205.f7dcea25.js"><link rel="prefetch" href="/CodeVault/assets/js/206.266f6bb0.js"><link rel="prefetch" href="/CodeVault/assets/js/207.962cdf0e.js"><link rel="prefetch" href="/CodeVault/assets/js/208.dcbb7fb9.js"><link rel="prefetch" href="/CodeVault/assets/js/209.89cb12fb.js"><link rel="prefetch" href="/CodeVault/assets/js/21.1a17ddc5.js"><link rel="prefetch" href="/CodeVault/assets/js/210.442ced55.js"><link rel="prefetch" href="/CodeVault/assets/js/211.6d14fe33.js"><link rel="prefetch" href="/CodeVault/assets/js/212.65a1883d.js"><link rel="prefetch" href="/CodeVault/assets/js/213.21351702.js"><link rel="prefetch" href="/CodeVault/assets/js/214.bd781706.js"><link rel="prefetch" href="/CodeVault/assets/js/215.f30b644c.js"><link rel="prefetch" href="/CodeVault/assets/js/216.587501ff.js"><link rel="prefetch" href="/CodeVault/assets/js/217.8db2123f.js"><link rel="prefetch" href="/CodeVault/assets/js/218.aa6b1af6.js"><link rel="prefetch" href="/CodeVault/assets/js/219.2b27640b.js"><link rel="prefetch" href="/CodeVault/assets/js/22.7652d0d6.js"><link rel="prefetch" href="/CodeVault/assets/js/220.eafe6218.js"><link rel="prefetch" href="/CodeVault/assets/js/221.ab153f73.js"><link rel="prefetch" href="/CodeVault/assets/js/222.4f7df33b.js"><link rel="prefetch" href="/CodeVault/assets/js/223.6f5b1e03.js"><link rel="prefetch" href="/CodeVault/assets/js/224.6bed6414.js"><link rel="prefetch" href="/CodeVault/assets/js/225.03a64323.js"><link rel="prefetch" href="/CodeVault/assets/js/226.2db9dc4b.js"><link rel="prefetch" href="/CodeVault/assets/js/227.6e01bc51.js"><link rel="prefetch" href="/CodeVault/assets/js/228.d06cad32.js"><link rel="prefetch" href="/CodeVault/assets/js/229.3f46b203.js"><link rel="prefetch" href="/CodeVault/assets/js/23.8a5bbf3f.js"><link rel="prefetch" href="/CodeVault/assets/js/230.b84fd605.js"><link rel="prefetch" href="/CodeVault/assets/js/231.ca2e1834.js"><link rel="prefetch" href="/CodeVault/assets/js/232.e572f662.js"><link rel="prefetch" href="/CodeVault/assets/js/233.0a7e6deb.js"><link rel="prefetch" href="/CodeVault/assets/js/234.9dddbcb6.js"><link rel="prefetch" href="/CodeVault/assets/js/235.b4ed574b.js"><link rel="prefetch" href="/CodeVault/assets/js/236.252b1f69.js"><link rel="prefetch" href="/CodeVault/assets/js/237.c529d9c4.js"><link rel="prefetch" href="/CodeVault/assets/js/238.16da920c.js"><link rel="prefetch" href="/CodeVault/assets/js/239.14f7892d.js"><link rel="prefetch" href="/CodeVault/assets/js/24.1ca1bd80.js"><link rel="prefetch" href="/CodeVault/assets/js/240.d00a46df.js"><link rel="prefetch" href="/CodeVault/assets/js/25.43c779a1.js"><link rel="prefetch" href="/CodeVault/assets/js/26.bdfe293e.js"><link rel="prefetch" href="/CodeVault/assets/js/27.330c11f5.js"><link rel="prefetch" href="/CodeVault/assets/js/28.46dfe7f4.js"><link rel="prefetch" href="/CodeVault/assets/js/29.4fc19b1e.js"><link rel="prefetch" href="/CodeVault/assets/js/3.44fcbdc8.js"><link rel="prefetch" href="/CodeVault/assets/js/30.da1d9fd7.js"><link rel="prefetch" href="/CodeVault/assets/js/31.df871787.js"><link rel="prefetch" href="/CodeVault/assets/js/32.e62268d4.js"><link rel="prefetch" href="/CodeVault/assets/js/33.b2c675b0.js"><link rel="prefetch" href="/CodeVault/assets/js/34.461e2f23.js"><link rel="prefetch" href="/CodeVault/assets/js/35.2666157f.js"><link rel="prefetch" href="/CodeVault/assets/js/36.b55a4b34.js"><link rel="prefetch" href="/CodeVault/assets/js/37.556ba5c1.js"><link rel="prefetch" href="/CodeVault/assets/js/38.8c982590.js"><link rel="prefetch" href="/CodeVault/assets/js/39.a7850266.js"><link rel="prefetch" href="/CodeVault/assets/js/4.8a0557a7.js"><link rel="prefetch" href="/CodeVault/assets/js/40.9a11a440.js"><link rel="prefetch" href="/CodeVault/assets/js/41.c3a71e10.js"><link rel="prefetch" href="/CodeVault/assets/js/42.7e9779c1.js"><link rel="prefetch" href="/CodeVault/assets/js/43.e017fec5.js"><link rel="prefetch" href="/CodeVault/assets/js/44.22c5aef3.js"><link rel="prefetch" href="/CodeVault/assets/js/45.dfe95d23.js"><link rel="prefetch" href="/CodeVault/assets/js/46.10af373d.js"><link rel="prefetch" href="/CodeVault/assets/js/47.a1e4779a.js"><link rel="prefetch" href="/CodeVault/assets/js/48.3142bf91.js"><link rel="prefetch" href="/CodeVault/assets/js/49.08546fe2.js"><link rel="prefetch" href="/CodeVault/assets/js/5.1bad1047.js"><link rel="prefetch" href="/CodeVault/assets/js/50.75c37eaf.js"><link rel="prefetch" href="/CodeVault/assets/js/51.b2f39f65.js"><link rel="prefetch" href="/CodeVault/assets/js/52.97fc3d07.js"><link rel="prefetch" href="/CodeVault/assets/js/53.1a2a51df.js"><link rel="prefetch" href="/CodeVault/assets/js/54.09f7dfd6.js"><link rel="prefetch" href="/CodeVault/assets/js/55.d112e5e2.js"><link rel="prefetch" href="/CodeVault/assets/js/56.b7b00837.js"><link rel="prefetch" href="/CodeVault/assets/js/57.5beac805.js"><link rel="prefetch" href="/CodeVault/assets/js/58.04f116f1.js"><link rel="prefetch" href="/CodeVault/assets/js/59.d660a6b3.js"><link rel="prefetch" href="/CodeVault/assets/js/6.7220274d.js"><link rel="prefetch" href="/CodeVault/assets/js/60.54783427.js"><link rel="prefetch" href="/CodeVault/assets/js/61.6e520517.js"><link rel="prefetch" href="/CodeVault/assets/js/62.78b5acff.js"><link rel="prefetch" href="/CodeVault/assets/js/63.0492d6b3.js"><link rel="prefetch" href="/CodeVault/assets/js/64.bd2a8518.js"><link rel="prefetch" href="/CodeVault/assets/js/65.8acc8c15.js"><link rel="prefetch" href="/CodeVault/assets/js/66.c2dc1d15.js"><link rel="prefetch" href="/CodeVault/assets/js/67.d584fc60.js"><link rel="prefetch" href="/CodeVault/assets/js/68.7221e725.js"><link rel="prefetch" href="/CodeVault/assets/js/69.f1a4c42c.js"><link rel="prefetch" href="/CodeVault/assets/js/7.ee190d28.js"><link rel="prefetch" href="/CodeVault/assets/js/70.8fb27ce3.js"><link rel="prefetch" href="/CodeVault/assets/js/71.2011297a.js"><link rel="prefetch" href="/CodeVault/assets/js/72.81904f20.js"><link rel="prefetch" href="/CodeVault/assets/js/73.cae4a206.js"><link rel="prefetch" href="/CodeVault/assets/js/74.41ca332e.js"><link rel="prefetch" href="/CodeVault/assets/js/75.ae7006ef.js"><link rel="prefetch" href="/CodeVault/assets/js/76.8477b765.js"><link rel="prefetch" href="/CodeVault/assets/js/77.ae764f14.js"><link rel="prefetch" href="/CodeVault/assets/js/78.b47518b4.js"><link rel="prefetch" href="/CodeVault/assets/js/79.bde0466f.js"><link rel="prefetch" href="/CodeVault/assets/js/8.e3ab8186.js"><link rel="prefetch" href="/CodeVault/assets/js/80.94af34f8.js"><link rel="prefetch" href="/CodeVault/assets/js/81.f1ba0edc.js"><link rel="prefetch" href="/CodeVault/assets/js/82.4485e21e.js"><link rel="prefetch" href="/CodeVault/assets/js/83.940dbcc3.js"><link rel="prefetch" href="/CodeVault/assets/js/84.6be8c64a.js"><link rel="prefetch" href="/CodeVault/assets/js/85.aa147bd8.js"><link rel="prefetch" href="/CodeVault/assets/js/86.0259d757.js"><link rel="prefetch" href="/CodeVault/assets/js/87.c88b420b.js"><link rel="prefetch" href="/CodeVault/assets/js/88.38f98c94.js"><link rel="prefetch" href="/CodeVault/assets/js/89.421840d7.js"><link rel="prefetch" href="/CodeVault/assets/js/9.cb249ed0.js"><link rel="prefetch" href="/CodeVault/assets/js/90.cd9b70c8.js"><link rel="prefetch" href="/CodeVault/assets/js/91.0c040f15.js"><link rel="prefetch" href="/CodeVault/assets/js/92.1ea436cf.js"><link rel="prefetch" href="/CodeVault/assets/js/93.7de38599.js"><link rel="prefetch" href="/CodeVault/assets/js/94.f2ad5a97.js"><link rel="prefetch" href="/CodeVault/assets/js/95.22f940d7.js"><link rel="prefetch" href="/CodeVault/assets/js/96.6a991248.js"><link rel="prefetch" href="/CodeVault/assets/js/97.aeccee85.js"><link rel="prefetch" href="/CodeVault/assets/js/98.79db6c16.js"><link rel="prefetch" href="/CodeVault/assets/js/99.aa13c9cb.js">
    <link rel="stylesheet" href="/CodeVault/assets/css/0.styles.bcdd6f38.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/CodeVault/" class="home-link router-link-active"><img src="/CodeVault/img/huli.svg" alt="CodeVault文档站" class="logo"> <span class="site-name can-hide">CodeVault文档站</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/CodeVault/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="全栈开发" class="dropdown-title"><a href="/CodeVault/pages/d1eaf8/" class="link-title">全栈开发</a> <span class="title" style="display:none;">全栈开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>云计算运维</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/d1eaf8/" class="nav-link">云计算</a></li></ul></li><li class="dropdown-item"><h4>容器开发</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/e820a7/" class="nav-link">容器</a></li></ul></li><li class="dropdown-item"><h4>K8S虚拟化</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/da2470/" class="nav-link">容器虚拟化</a></li></ul></li><li class="dropdown-item"><h4>运维高级篇</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/ce761d/" class="nav-link">高可用</a></li></ul></li><li class="dropdown-item"><h4>前端开发</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/" class="nav-link">前端常用</a></li></ul></li><li class="dropdown-item"><h4>后端开发</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/" class="nav-link">后端常用</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="资源" class="dropdown-title"><a href="/CodeVault/pages/e4db9d/" class="link-title">资源</a> <span class="title" style="display:none;">资源</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/CodeVault/pages/e4db9d/" class="nav-link">资源</a></li><li class="dropdown-item"><!----> <a href="/CodeVault/pages/c936ca/" class="nav-link">学习文档资源</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习路线" class="dropdown-title"><a href="/CodeVault/pages/f24c41/" class="link-title">学习路线</a> <span class="title" style="display:none;">学习路线</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>后端开发</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/f24c41/" class="nav-link">后端学习路线</a></li></ul></li><li class="dropdown-item"><h4>Web3</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/1583d1/" class="nav-link">区块链学习路线</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/CodeVault/pages/6ffa63/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>HTML5+CSS3</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/6ffa63/" class="nav-link">HTML5</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/b23e0c/" class="nav-link">CSS3</a></li></ul></li><li class="dropdown-item"><h4>JavaScript</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/0e8324/" class="nav-link">JavaScript开篇</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/4d9ec9/" class="nav-link">JavaScript面向对象</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/0505ad/" class="nav-link">JavaScript DOM</a></li></ul></li><li class="dropdown-item"><h4>API</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/845076/" class="nav-link">JQuery</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/9c8e93/" class="nav-link">Ajax</a></li><li class="dropdown-subitem"><a href="/CodeVault/" class="nav-link">Axios</a></li></ul></li><li class="dropdown-item"><h4>Vue</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/a1209f/" class="nav-link">Vuejs</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/CodeVault/pages/5e1c7d/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/5e1c7d/" class="nav-link">Java进阶</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/9b262c/" class="nav-link">Spring</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/3e651a/" class="nav-link">SpringBoot</a></li></ul></li><li class="dropdown-item"><h4>Golang</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/135518/" class="nav-link">Beego</a></li><li class="dropdown-subitem"><a href="/CodeVault/" class="nav-link">Gin</a></li><li class="dropdown-subitem"><a href="/CodeVault/" class="nav-link">Gorm</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><a href="/CodeVault/pages/7ef2c7/" class="link-title">中间件</a> <span class="title" style="display:none;">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/CodeVault/pages/7ef2c7/" class="nav-link">MySQL</a></li><li class="dropdown-item"><!----> <a href="/CodeVault/pages/516f71/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/CodeVault/pages/1eaa9a/" class="nav-link">Nginx</a></li><li class="dropdown-item"><!----> <a href="/CodeVault/pages/1ac9b2/" class="nav-link">Ceph</a></li><li class="dropdown-item"><!----> <a href="/CodeVault/pages/719244/" class="nav-link">Elasticsearch</a></li><li class="dropdown-item"><!----> <a href="/CodeVault/pages/6ec6ec/" class="nav-link">Istio</a></li><li class="dropdown-item"><!----> <a href="/CodeVault/pages/30e340/" class="nav-link">Prometheus</a></li></ul></div></div><div class="nav-item"><a href="/CodeVault/pages/32fd53/" class="nav-link">Docker</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="K8S" class="dropdown-title"><a href="/CodeVault/pages/46159d/" class="link-title">K8S</a> <span class="title" style="display:none;">K8S</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>云原生</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/46159d/" class="nav-link">Kubernetes</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/f87a46/" class="nav-link">CKS认证</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/2d432e/" class="nav-link">Operator</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/CodeVault/pages/f6f110/" class="nav-link">CI/CD</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Linux" class="dropdown-title"><a href="/CodeVault/pages/f9fa7a/" class="link-title">Linux</a> <span class="title" style="display:none;">Linux</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Linux</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/f9fa7a/" class="nav-link">基础服务</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/314d26/" class="nav-link">Kvm</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/44e450/" class="nav-link">Ansible</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/8292d8/" class="nav-link">Git</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="区块链" class="dropdown-title"><a href="/CodeVault/pages/f3ea9f/" class="link-title">区块链</a> <span class="title" style="display:none;">区块链</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>FISCO BCOS</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/f3ea9f/" class="nav-link">WeBASE搭建</a></li></ul></li><li class="dropdown-item"><h4>2023年TASK挑战赛上</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/685f1f/" class="nav-link">碳排放解决方案</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/3f1596/" class="nav-link">慈善公益解决方案</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/cc43be/" class="nav-link">构造交易传入AppID</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/75ddc8/" class="nav-link">合约时间触发器</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/9bcc7c/" class="nav-link">一键部署环境脚本</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/a93fcf/" class="nav-link">合约调用机制与并行合约</a></li></ul></li><li class="dropdown-item"><h4>2023年TASK挑战赛下</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/1fdb40/" class="nav-link">DDCMS后端容器化</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/795b78/" class="nav-link">DDCMS第三方登录</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/a99040/" class="nav-link">DDCMS智能合约设计</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/cb310d/" class="nav-link">DDCMS部署和运维</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/0b1c5a/" class="nav-link">DDCMS接口报错</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/99df38/" class="nav-link">合约大小限制优化</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/f8a343/" class="nav-link">并行合约最佳实践</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/3d3086/" class="nav-link">一文搞懂Truffle测试</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/CodeVault/pages/e3d908/" class="nav-link">记录</a></div> <a href="https://github.com/CN-ZHANGYH/CodeVault" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/CodeVault/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="全栈开发" class="dropdown-title"><a href="/CodeVault/pages/d1eaf8/" class="link-title">全栈开发</a> <span class="title" style="display:none;">全栈开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>云计算运维</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/d1eaf8/" class="nav-link">云计算</a></li></ul></li><li class="dropdown-item"><h4>容器开发</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/e820a7/" class="nav-link">容器</a></li></ul></li><li class="dropdown-item"><h4>K8S虚拟化</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/da2470/" class="nav-link">容器虚拟化</a></li></ul></li><li class="dropdown-item"><h4>运维高级篇</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/ce761d/" class="nav-link">高可用</a></li></ul></li><li class="dropdown-item"><h4>前端开发</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/" class="nav-link">前端常用</a></li></ul></li><li class="dropdown-item"><h4>后端开发</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/" class="nav-link">后端常用</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="资源" class="dropdown-title"><a href="/CodeVault/pages/e4db9d/" class="link-title">资源</a> <span class="title" style="display:none;">资源</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/CodeVault/pages/e4db9d/" class="nav-link">资源</a></li><li class="dropdown-item"><!----> <a href="/CodeVault/pages/c936ca/" class="nav-link">学习文档资源</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习路线" class="dropdown-title"><a href="/CodeVault/pages/f24c41/" class="link-title">学习路线</a> <span class="title" style="display:none;">学习路线</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>后端开发</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/f24c41/" class="nav-link">后端学习路线</a></li></ul></li><li class="dropdown-item"><h4>Web3</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/1583d1/" class="nav-link">区块链学习路线</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/CodeVault/pages/6ffa63/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>HTML5+CSS3</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/6ffa63/" class="nav-link">HTML5</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/b23e0c/" class="nav-link">CSS3</a></li></ul></li><li class="dropdown-item"><h4>JavaScript</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/0e8324/" class="nav-link">JavaScript开篇</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/4d9ec9/" class="nav-link">JavaScript面向对象</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/0505ad/" class="nav-link">JavaScript DOM</a></li></ul></li><li class="dropdown-item"><h4>API</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/845076/" class="nav-link">JQuery</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/9c8e93/" class="nav-link">Ajax</a></li><li class="dropdown-subitem"><a href="/CodeVault/" class="nav-link">Axios</a></li></ul></li><li class="dropdown-item"><h4>Vue</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/a1209f/" class="nav-link">Vuejs</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/CodeVault/pages/5e1c7d/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/5e1c7d/" class="nav-link">Java进阶</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/9b262c/" class="nav-link">Spring</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/3e651a/" class="nav-link">SpringBoot</a></li></ul></li><li class="dropdown-item"><h4>Golang</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/135518/" class="nav-link">Beego</a></li><li class="dropdown-subitem"><a href="/CodeVault/" class="nav-link">Gin</a></li><li class="dropdown-subitem"><a href="/CodeVault/" class="nav-link">Gorm</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><a href="/CodeVault/pages/7ef2c7/" class="link-title">中间件</a> <span class="title" style="display:none;">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/CodeVault/pages/7ef2c7/" class="nav-link">MySQL</a></li><li class="dropdown-item"><!----> <a href="/CodeVault/pages/516f71/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/CodeVault/pages/1eaa9a/" class="nav-link">Nginx</a></li><li class="dropdown-item"><!----> <a href="/CodeVault/pages/1ac9b2/" class="nav-link">Ceph</a></li><li class="dropdown-item"><!----> <a href="/CodeVault/pages/719244/" class="nav-link">Elasticsearch</a></li><li class="dropdown-item"><!----> <a href="/CodeVault/pages/6ec6ec/" class="nav-link">Istio</a></li><li class="dropdown-item"><!----> <a href="/CodeVault/pages/30e340/" class="nav-link">Prometheus</a></li></ul></div></div><div class="nav-item"><a href="/CodeVault/pages/32fd53/" class="nav-link">Docker</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="K8S" class="dropdown-title"><a href="/CodeVault/pages/46159d/" class="link-title">K8S</a> <span class="title" style="display:none;">K8S</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>云原生</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/46159d/" class="nav-link">Kubernetes</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/f87a46/" class="nav-link">CKS认证</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/2d432e/" class="nav-link">Operator</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/CodeVault/pages/f6f110/" class="nav-link">CI/CD</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Linux" class="dropdown-title"><a href="/CodeVault/pages/f9fa7a/" class="link-title">Linux</a> <span class="title" style="display:none;">Linux</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Linux</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/f9fa7a/" class="nav-link">基础服务</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/314d26/" class="nav-link">Kvm</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/44e450/" class="nav-link">Ansible</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/8292d8/" class="nav-link">Git</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="区块链" class="dropdown-title"><a href="/CodeVault/pages/f3ea9f/" class="link-title">区块链</a> <span class="title" style="display:none;">区块链</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>FISCO BCOS</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/f3ea9f/" class="nav-link">WeBASE搭建</a></li></ul></li><li class="dropdown-item"><h4>2023年TASK挑战赛上</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/685f1f/" class="nav-link">碳排放解决方案</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/3f1596/" class="nav-link">慈善公益解决方案</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/cc43be/" class="nav-link">构造交易传入AppID</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/75ddc8/" class="nav-link">合约时间触发器</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/9bcc7c/" class="nav-link">一键部署环境脚本</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/a93fcf/" class="nav-link">合约调用机制与并行合约</a></li></ul></li><li class="dropdown-item"><h4>2023年TASK挑战赛下</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/1fdb40/" class="nav-link">DDCMS后端容器化</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/795b78/" class="nav-link">DDCMS第三方登录</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/a99040/" class="nav-link">DDCMS智能合约设计</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/cb310d/" class="nav-link">DDCMS部署和运维</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/0b1c5a/" class="nav-link">DDCMS接口报错</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/99df38/" class="nav-link">合约大小限制优化</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/f8a343/" class="nav-link">并行合约最佳实践</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/3d3086/" class="nav-link">一文搞懂Truffle测试</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/CodeVault/pages/e3d908/" class="nav-link">记录</a></div> <a href="https://github.com/CN-ZHANGYH/CodeVault" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Gitlab-CI</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/CodeVault/pages/f6f110/" class="sidebar-link">Gitlab-CI使用及.gitlab-ci.yml配置</a></li><li><a href="/CodeVault/pages/1ec44e/" class="sidebar-link">Gitlab-Runner + k8s 实现自动部署</a></li><li><a href="/CodeVault/pages/77c267/" aria-current="page" class="active sidebar-link">GitLab + GitLab CI + Harbor + Kubernetes</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/CodeVault/pages/77c267/#项目要求" class="sidebar-link">项目要求</a></li><li class="sidebar-sub-header level2"><a href="/CodeVault/pages/77c267/#环境准备" class="sidebar-link">环境准备</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/77c267/#_1-节点规划" class="sidebar-link">1.节点规划</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/77c267/#_2-查看集群状态" class="sidebar-link">2.查看集群状态</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/CodeVault/pages/77c267/#部署gitlab" class="sidebar-link">部署GitLab</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/77c267/#_1-gitlab概述" class="sidebar-link">1.GitLab概述</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/77c267/#_2-gitlab部署方式" class="sidebar-link">2.GitLab部署方式</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/77c267/#_3-docker部署gitlab" class="sidebar-link">3.Docker部署GitLab</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/77c267/#_4-创建项目" class="sidebar-link">4.创建项目</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/CodeVault/pages/77c267/#部署gitlab-runner" class="sidebar-link">部署GitLab-Runner</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/77c267/#_1-gitlab-ci介绍" class="sidebar-link">1.GitLab-CI介绍</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/77c267/#_2-gitlab-runner部署方式" class="sidebar-link">2.GitLab-Runner部署方式</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/77c267/#_3-docker部署runner" class="sidebar-link">3.Docker部署Runner</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/77c267/#_4-helm部署runner" class="sidebar-link">4.Helm部署Runner</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/CodeVault/pages/77c267/#部署harbor" class="sidebar-link">部署Harbor</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/77c267/#_1-harbor介绍" class="sidebar-link">1.Harbor介绍</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/77c267/#_2-harbor部署" class="sidebar-link">2.Harbor部署</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/77c267/#_3-添加镜像仓库" class="sidebar-link">3.添加镜像仓库</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/CodeVault/pages/77c267/#配置cicd" class="sidebar-link">配置CICD</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/77c267/#_1-配置-gitlab-ci-yml" class="sidebar-link">1.配置.gitlab-ci.yml</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/77c267/#_2-开始构建" class="sidebar-link">2.开始构建</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/77c267/#_3-查看gitlab-ci" class="sidebar-link">3.查看Gitlab-CI</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/77c267/#_4-访问项目" class="sidebar-link">4.访问项目</a></li></ul></li></ul></li><li><a href="/CodeVault/pages/7799fb/" class="sidebar-link">Gitea+K8s-Jenkins-master-slave(webhook钩子)</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/CodeVault/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>CICD</span></li><li data-v-06225672><span data-v-06225672>Gitlab-CI</span></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/cn-zhangyh" target="_blank" title="作者" class="beLink" data-v-06225672>Yyzop</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-04-27</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">GitLab + GitLab CI + Harbor + Kubernetes<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="gitlab-gitlab-ci-harbor-kubernetes"><a href="#gitlab-gitlab-ci-harbor-kubernetes" class="header-anchor">#</a> GitLab + GitLab CI + Harbor + Kubernetes</h1> <h2 id="项目要求"><a href="#项目要求" class="header-anchor">#</a> 项目要求</h2> <p>该公司决定采用<code>GitLab + GitLab CI + Harbor + Kubernetes</code>架构来构建CICD环境，以缩短新功能开发上线周期，及时满足客户的需求，实现DevOps的部分流程，来减轻部署运维的负担，实现可视化容器生命周期管理、应用发布和版本迭代更新，请完成CICD环境部署。CICD应用系统架构如下：</p> <p><img src="https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204250851345.png" alt="image-20220425085103011"></p> <h2 id="环境准备"><a href="#环境准备" class="header-anchor">#</a> 环境准备</h2> <p>这里使用项目为2048游戏</p> <p><strong>项目地址：</strong>  https://gitee.com/cn-zhangyh/demo-2048.git</p> <h3 id="_1-节点规划"><a href="#_1-节点规划" class="header-anchor">#</a> 1.节点规划</h3> <p>使用Docker或者使用Kubernetes集群环境，这里使用的是Kubernetes集群环境。</p> <table><thead><tr><th>IP地址</th> <th>主机名称</th> <th>主机资源</th> <th>节点名称</th></tr></thead> <tbody><tr><td>10.11.121.111</td> <td>k8s-master</td> <td>12G/6VCPU</td> <td>GitLab+GitLab-Runner</td></tr> <tr><td>10.11.121.112</td> <td>k8s-node1</td> <td>8G/6VCPU</td> <td>Harbor</td></tr> <tr><td>10.11.121.113</td> <td>k8s-node2</td> <td>8G/6VCPU</td> <td>node</td></tr></tbody></table> <h3 id="_2-查看集群状态"><a href="#_2-查看集群状态" class="header-anchor">#</a> 2.查看集群状态</h3> <p>可以通过<code>kubectl cluster-info</code>命令查看当前的集群信息。 通过 <code>kubectl get node</code>查看当前节点数量。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># kubectl cluster-info </span>
Kubernetes control plane is running at https://10.11.121.111:6443
KubeDNS is running at https://10.11.121.111:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy

To further debug and diagnose cluster problems, use <span class="token string">'kubectl cluster-info dump'</span><span class="token builtin class-name">.</span>

<span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get node </span>
NAME         STATUS   ROLES                  AGE   VERSION
k8s-master   Ready    control-plane,master   25h   v1.20.0
k8s-node1    Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>                 25h   v1.20.0
k8s-node2    Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>                 25h   v1.20.0
</code></pre></div><h2 id="部署gitlab"><a href="#部署gitlab" class="header-anchor">#</a> 部署GitLab</h2> <h3 id="_1-gitlab概述"><a href="#_1-gitlab概述" class="header-anchor">#</a> 1.GitLab概述</h3> <p>GitLab 是利用 Ruby on Rails 一个开源的版本管理系统，实现一个自托管的 Git 项目仓库，可通过 Web 界面进行访问公开的或者私人项目。它拥有与 Github 类似的功能，能够浏览源代码，管理缺陷和注释。可以管理团队对仓库的访问，它非常易于浏览提交过的版本并提供一个文件历史库。团队成员可以利用内置的简单聊天程序 (Wall) 进行交流。它还提供一个代码片段收集功能可以轻松实现代码复用，便于日后有需要的时候进行查找。</p> <h3 id="_2-gitlab部署方式"><a href="#_2-gitlab部署方式" class="header-anchor">#</a> 2.GitLab部署方式</h3> <p>GitLab 可以安装在大多数 GNU/Linux 发行版中，并与多个云提供商一起安装。要从 GitLab 获得最佳体验，您必须平衡性能、可靠性、易于管理（备份、升级和故障排除）以及托管成本。</p> <p>目前比较常见的部署方式有如下三种：</p> <ul><li>直接安装在操作系统上，例如： <code>Mac/Windows/Linux</code></li> <li>通过容器的方式安装，例如： <code>Docker、Kubernetes</code></li> <li>使用Helm包安装： <code>Chart包的方式</code></li></ul> <h3 id="_3-docker部署gitlab"><a href="#_3-docker部署gitlab" class="header-anchor">#</a> 3.Docker部署GitLab</h3> <p>1.使用Docker命令部署Gitlab，由于Gitlab的镜像大概有几个G，所以需要等待很久的时间，直到完全启动。</p> <p>参数解析：</p> <p><code>hostname</code>  			  域名 或 ip</p> <p><code>publish 、-p</code> 		端口映射</p> <p><code>restart</code> 				重启方式</p> <p><code>volume、-v</code> 		   目录挂载</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># docker run -d \</span>
  <span class="token parameter variable">--hostname</span> <span class="token number">10.11</span>.121.111 <span class="token punctuation">\</span>
  <span class="token parameter variable">-p</span> <span class="token number">443</span>:443 <span class="token parameter variable">-p</span> <span class="token number">80</span>:80 <span class="token parameter variable">-p</span> <span class="token number">222</span>:22 <span class="token punctuation">\</span>
  <span class="token parameter variable">--name</span> gitlab <span class="token punctuation">\</span>
  <span class="token parameter variable">--restart</span> always <span class="token punctuation">\</span>
  <span class="token parameter variable">-v</span> /srv/gitlab/config:/etc/gitlab <span class="token punctuation">\</span>
  <span class="token parameter variable">-v</span> /srv/gitlab/logs:/var/log/gitlab <span class="token punctuation">\</span>
  <span class="token parameter variable">-v</span> /srv/gitlab/data:/var/opt/gitlab <span class="token punctuation">\</span>
  gitlab/gitlab-ce:latest
</code></pre></div><p>2.查看当前的Docker进程。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># docker ps | grep  gitlab </span>
686f123b649c   gitlab/gitlab-ce:latest                             <span class="token string">&quot;/assets/wrapper&quot;</span>        <span class="token number">25</span> hours ago   Up <span class="token number">2</span> hours <span class="token punctuation">(</span>healthy<span class="token punctuation">)</span>   <span class="token number">0.0</span>.0.0:80-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp, :::80-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp, <span class="token number">0.0</span>.0.0:443-<span class="token operator">&gt;</span><span class="token number">443</span>/tcp, :::443-<span class="token operator">&gt;</span><span class="token number">443</span>/tcp, <span class="token number">0.0</span>.0.0:222-<span class="token operator">&gt;</span><span class="token number">22</span>/tcp, :::222-<span class="token operator">&gt;</span><span class="token number">22</span>/tcp   gitlab
</code></pre></div><p>3.通过浏览器访问GitLab的页面： http://10.11.121.111</p> <p><img src="https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204242235534.png" alt="image-20220424223532525"></p> <p>4.这里默认的用户是 <code>root</code> ，默认的密码只有24h有效，所以我们需要更改一下密码。</p> <p>先查出用户的id，例如下面用户是root id=1</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it gitlab /bin/bash</span>
<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span>:1,<span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;Administrator&quot;</span>,<span class="token string">&quot;username&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;root&quot;</span>,<span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;active&quot;</span>,<span class="token string">&quot;avatar_url&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;https://www.gravatar.com/avatar/e64c7d89f26bd1972efa854d13d7dd61?s=80<span class="token entity" title="\u0026">\u0026</span>d=identicon&quot;</span>,<span class="token string">&quot;web_url&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;http://192.168.0.173/root&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span>

root@10:/<span class="token comment"># gitlab-rails console -e production</span>
--------------------------------------------------------------------------------
 Ruby:         ruby <span class="token number">2.7</span>.4p191 <span class="token punctuation">(</span><span class="token number">2021</span>-07-07 revision a21a3b7d23<span class="token punctuation">)</span> <span class="token punctuation">[</span>x86_64-linux<span class="token punctuation">]</span>
 GitLab:       <span class="token number">14.4</span>.1 <span class="token punctuation">(</span>1a23d731c9f<span class="token punctuation">)</span> FOSS
 GitLab Shell: <span class="token number">13.21</span>.1
 PostgreSQL:   <span class="token number">12.7</span>
--------------------------------------------------------------------------------
Loading production environment <span class="token punctuation">(</span>Rails <span class="token number">6.1</span>.4.1<span class="token punctuation">)</span>
irb<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:001:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> <span class="token assign-left variable">u</span><span class="token operator">=</span>User.where<span class="token punctuation">(</span>id:1<span class="token punctuation">)</span>.first
<span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token comment">#&lt;User id:1 @root&gt;</span>
irb<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:002:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> <span class="token assign-left variable">u.password</span><span class="token operator">=</span><span class="token string">'00000000'</span>
<span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;00000000&quot;</span>
irb<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:003:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> <span class="token assign-left variable">u.password_confirmation</span><span class="token operator">=</span><span class="token string">'00000000'</span>
<span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;00000000&quot;</span>
irb<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:004:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> u.save<span class="token operator">!</span>
Enqueued ActionMailer::MailDeliveryJob <span class="token punctuation">(</span>Job ID: d7bc1e90-4941-4125-bf90-b018c92b5d73<span class="token punctuation">)</span> to Sidekiq<span class="token punctuation">(</span>mailers<span class="token punctuation">)</span> with arguments: <span class="token string">&quot;DeviseMailer&quot;</span>, <span class="token string">&quot;password_change&quot;</span>, <span class="token string">&quot;deliver_now&quot;</span>, <span class="token punctuation">{</span>:args<span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token comment">#&lt;GlobalID:0x00007f0b99fbc3a8 @uri=#&lt;URI::GID gid://gitlab/User/1&gt;&gt;]}</span>
<span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">true</span>
irb<span class="token punctuation">(</span>main<span class="token punctuation">)</span>:005:<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> <span class="token builtin class-name">exit</span>
</code></pre></div><h3 id="_4-创建项目"><a href="#_4-创建项目" class="header-anchor">#</a> 4.创建项目</h3> <p>2.登录Gitlab之后，需要创建一个项目名称叫做<code>demo</code>。</p> <p><img src="https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204242237733.png" alt="image-20220424223745243"></p> <p>2.选择<code>public</code>，也是上市的意思，不需要初始化存储库。</p> <p><img src="https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204242240317.png" alt="image-20220424224043845"></p> <p>3.首先我们拉取gitee上的源码到本地，再推送到Gitlab源码托管demo仓库的Master分支。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># git clone https://gitee.com/cn-zhangyh/demo-2048.git </span>
Cloning into <span class="token string">'demo-2048'</span><span class="token punctuation">..</span>.
Username <span class="token keyword">for</span> <span class="token string">'https://gitee.com'</span><span class="token builtin class-name">:</span> cn-zhangyh
Password <span class="token keyword">for</span> <span class="token string">'https://cn-zhangyh@gitee.com'</span><span class="token builtin class-name">:</span> 
remote: Enumerating objects: <span class="token number">71</span>, done.
remote: Counting objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">71</span>/71<span class="token punctuation">)</span>, done.
remote: Compressing objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">59</span>/59<span class="token punctuation">)</span>, done.
remote: Total <span class="token number">71</span> <span class="token punctuation">(</span>delta <span class="token number">21</span><span class="token punctuation">)</span>, reused <span class="token number">0</span> <span class="token punctuation">(</span>delta <span class="token number">0</span><span class="token punctuation">)</span>, pack-reused <span class="token number">0</span>
Unpacking objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">71</span>/71<span class="token punctuation">)</span>, done.
<span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># cd demo-2048/</span>
<span class="token punctuation">[</span>root@k8s-master demo<span class="token punctuation">]</span><span class="token comment"># ll</span>
total <span class="token number">8</span>
drwxr-xr-x <span class="token number">2</span> root root   <span class="token number">24</span> Apr <span class="token number">23</span> <span class="token number">13</span>:28 Dockerfiles
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">1491</span> Apr <span class="token number">23</span> <span class="token number">13</span>:28 pom.xml
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">315</span> Apr <span class="token number">23</span> <span class="token number">13</span>:28 README.md
drwxr-xr-x <span class="token number">3</span> root root   <span class="token number">18</span> Apr <span class="token number">23</span> <span class="token number">13</span>:28 src
drwxr-xr-x <span class="token number">2</span> root root   <span class="token number">28</span> Apr <span class="token number">24</span> <span class="token number">13</span>:06 template

<span class="token punctuation">[</span>root@k8s-master demo-2048<span class="token punctuation">]</span><span class="token comment"># git config --global user.name &quot;Administrator&quot;</span>
<span class="token punctuation">[</span>root@k8s-master demo-2048<span class="token punctuation">]</span><span class="token comment"># git config --global user.email &quot;admin@example.com&quot;</span>
<span class="token punctuation">[</span>root@k8s-master demo-2048<span class="token punctuation">]</span><span class="token comment"># git init</span>
Reinitialized existing Git repository <span class="token keyword">in</span> /opt/demo-2048/.git/
<span class="token punctuation">[</span>root@k8s-master demo-2048<span class="token punctuation">]</span><span class="token comment"># git remote rename origin old-origin</span>
<span class="token punctuation">[</span>root@k8s-master demo-2048<span class="token punctuation">]</span><span class="token comment"># git remote add origin http://10.11.121.111/root/demo.git</span>
<span class="token punctuation">[</span>root@k8s-master demo-2048<span class="token punctuation">]</span><span class="token comment"># git add .</span>
<span class="token punctuation">[</span>root@k8s-master demo-2048<span class="token punctuation">]</span><span class="token comment"># git commit -m &quot;Initial commit&quot;</span>
<span class="token comment"># On branch master</span>
nothing to commit, working directory clean
<span class="token punctuation">[</span>root@k8s-master demo-2048<span class="token punctuation">]</span><span class="token comment"># git push -u origin --all</span>
Username <span class="token keyword">for</span> <span class="token string">'http://10.11.121.111'</span><span class="token builtin class-name">:</span> root
Password <span class="token keyword">for</span> <span class="token string">'http://root@10.11.121.111'</span><span class="token builtin class-name">:</span> 
Counting objects: <span class="token number">71</span>, done.
Delta compression using up to <span class="token number">8</span> threads.
Compressing objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">59</span>/59<span class="token punctuation">)</span>, done.
Writing objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">71</span>/71<span class="token punctuation">)</span>, <span class="token number">82.04</span> KiB <span class="token operator">|</span> <span class="token number">0</span> bytes/s, done.
Total <span class="token number">71</span> <span class="token punctuation">(</span>delta <span class="token number">21</span><span class="token punctuation">)</span>, reused <span class="token number">0</span> <span class="token punctuation">(</span>delta <span class="token number">0</span><span class="token punctuation">)</span>
To http://10.11.121.111/root/demo2.git
 * <span class="token punctuation">[</span>new branch<span class="token punctuation">]</span>      master -<span class="token operator">&gt;</span> master
Branch master <span class="token builtin class-name">set</span> up to track remote branch master from origin.
</code></pre></div><p>4.再次刷新仓库查看，源码已经推送成功。</p> <p><img src="https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204242249037.png" alt="image-20220424224925906"></p> <p>5.需要记住这里的Runner的<code>URL和Token</code>，因为后面的GitLab—Runner连接GitLab需要使用到。</p> <p>此处我的URL: <code>http://10.11.121.111/</code></p> <p>此处我的Token：<code>o4_NCTZvpnViRE7iGxoi</code></p> <p><img src="https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204250847343.png" alt="image-20220424225358742"></p> <h2 id="部署gitlab-runner"><a href="#部署gitlab-runner" class="header-anchor">#</a> 部署GitLab-Runner</h2> <h3 id="_1-gitlab-ci介绍"><a href="#_1-gitlab-ci介绍" class="header-anchor">#</a> 1.GitLab-CI介绍</h3> <p><img src="https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204250847312.webp" alt="img"></p> <p>GitLab Runner是一个<a href="https://so.csdn.net/so/search?q=%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">开源项目<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，用于运行您的作业并将结果发送回GitLab。它与GitLab CI一起使用，GitLab CI是GitLab随附的开源持续集成服务，用于协调作业。</p> <p>一般来说，gitlab上已由负责人配置好了<code>gitlab-runner</code>，我们只需要编写好<code>.gitlab.yml</code>文件提交代码即可触发runner进行工作。但对于初学者来说，你可能想能不能在提交代码前在本地先执行<code>.gitlab.yml</code>文件的job，本地调试成功检查没有问题后再进行最终代码的提交，触发服务端的CI流程。答案当然也是可以的。<code>.gitlab.yml</code>文件中定义的job其实是某个服务器中的<code>gitlab-runner</code>在运行，那我们也可以在本地安装好<code>gitlab-runner</code>手动的来执行本地<code>.gitlab.yml</code>中的<code>job</code>。</p> <h3 id="_2-gitlab-runner部署方式"><a href="#_2-gitlab-runner部署方式" class="header-anchor">#</a> 2.GitLab-Runner部署方式</h3> <p>你几乎可以在任何机器上安装<code>gitlab-runner</code>，安装的方式这里推荐如下几种：</p> <ul><li>Linux使用二进制的方式</li> <li>Docker中使用容器的方式启动Gitlab—Runner</li> <li>Helm包的方式安装Gitlab-Runner</li></ul> <p><code>如下我分别使用了两种不同的方式部署Gitlab-Runner，可以选择其中一种。</code></p> <h3 id="_3-docker部署runner"><a href="#_3-docker部署runner" class="header-anchor">#</a> 3.Docker部署Runner</h3> <p><strong>1.安装gitlab runner</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># docker run -d --name gitlab-runner --restart always \</span>
  <span class="token parameter variable">-v</span> /srv/gitlab-runner/config:/etc/gitlab-runner <span class="token punctuation">\</span>
  <span class="token parameter variable">-v</span> /var/run/docker.sock:/var/run/docker.sock <span class="token punctuation">\</span>
  gitlab/gitlab-runner:latest
</code></pre></div><p><strong>2.注册gitlab runner</strong></p> <p>参数解析：</p> <ol><li>gitlab-runner register 是启动register的命令</li> <li>GitLab的Runner显示的URL地址： <code>--url</code></li> <li>GitLab的Runner显示的Token值：  <code>--registration-token</code></li> <li>设置Runner的标签： <code>--tag-list</code></li> <li>设置CICD构建时可以不启用Tag：<code>--run-untagged</code></li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># docker run --rm -v /srv/gitlab-runner/config:/etc/gitlab-runner gitlab/gitlab-runner register \</span>
  --non-interactive <span class="token punctuation">\</span>
  <span class="token parameter variable">--executor</span> <span class="token string">&quot;docker&quot;</span> <span class="token punctuation">\</span>
  --docker-image alpine:latest <span class="token punctuation">\</span>
  <span class="token parameter variable">--url</span> <span class="token string">&quot;http://10.11.121.111/&quot;</span> <span class="token punctuation">\</span>
  --registration-token <span class="token string">&quot;o4_NCTZvpnViRE7iGxoi&quot;</span> <span class="token punctuation">\</span>
  <span class="token parameter variable">--description</span> <span class="token string">&quot;first-register-runner&quot;</span> <span class="token punctuation">\</span>
  --tag-list <span class="token string">&quot;k8s&quot;</span> <span class="token punctuation">\</span>
  --run-untagged<span class="token operator">=</span><span class="token string">&quot;true&quot;</span> <span class="token punctuation">\</span>
  <span class="token parameter variable">--locked</span><span class="token operator">=</span><span class="token string">&quot;false&quot;</span> <span class="token punctuation">\</span>
  --access-level<span class="token operator">=</span><span class="token string">&quot;not_protected&quot;</span> 
  
<span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># docker ps | grep gitlab-runner </span>
3e0a02917540   gitlab/gitlab-runner:latest                         <span class="token string">&quot;/usr/bin/dumb-init …&quot;</span>   <span class="token number">26</span> hours ago   Up <span class="token number">3</span> hours                                                                                                                             gitlab-runner
</code></pre></div><p><strong>2.查看Gitlab连接情况</strong></p> <p>1.进入Gitlab的CICD配置中，找到Runner配置，刷新此页面。</p> <p><img src="https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204250848483.png" alt="image-20220424231601423"></p> <p>2.或者在Menu的菜单栏中，找到 <code>Admin</code>, 然后选择 <code>Runner</code>，可以查看到当前的Runner连接情况。</p> <p><img src="https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204250848560.png" alt="image-20220424231816380"></p> <p><img src="https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204250848031.png" alt="image-20220424232117034"></p> <h3 id="_4-helm部署runner"><a href="#_4-helm部署runner" class="header-anchor">#</a> 4.Helm部署Runner</h3> <p><strong>什么是Helm？</strong></p> <p>就像 Java 使用 maven；node 使用 npm；python 使用 pip；Linux 使用 yum 或 Apt 一样，不管是什么样的工作，技术人员都会希望有一种资源管理器/包管理器，以此来方便得查找、下载、安装、使用和分发软件包。</p> <p>Helm 使用的包格式称为 <code>chart</code>，它是一个描述 Kubernetes 相关资源对象的文件集合。它的技术特点类似 jinja模版，以渲染模版的方式，生成运行一个服务实例所需的一系列资源对象文件，并以此进行服务的发布。通过这种方式，我们也可以十分简单的制作自定义的 chart。</p> <p>所以 Helm 即可以说是 <code>K8S的包管理器</code>，它使得我们对于 K8S 的操作不再需要细化到资源对象，而是可以作为一个实例进行管理。不再需要去写 <code>deployment</code> 、<code>service</code> 、<code>ingress</code> 的 yaml，而是可以直接通过 <code>install</code> 命令实现服务实例的安装。</p> <p><strong>1.拉取Gitlab-Runner的Chart包</strong></p> <p>项目地址：<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgitlab.com%2Fgitlab-org%2Fcharts%2Fgitlab-runner" target="_blank" rel="noopener noreferrer">https://gitlab.com/gitlab-org/charts/gitlab-runner<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master gitlab-runner<span class="token punctuation">]</span><span class="token comment"># ll</span>
total <span class="token number">12</span>
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">369</span> Feb <span class="token number">21</span> 03:39 Chart.yaml
drwxr-xr-x <span class="token number">2</span> root root  <span class="token number">236</span> Apr <span class="token number">24</span> 05:48 templates
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">6452</span> Apr <span class="token number">24</span> 05:47 values.yaml
</code></pre></div><p><strong>2.配置Chart的模板</strong></p> <p>修改Chart包的values.yaml配置如下：</p> <ul><li><code>gitlabUrl:</code> 	配置Gitlab的URL</li> <li><code>runnerRegistrationToken:</code>      配置Gitlab的Runner的Token</li> <li><code>namespace:</code>     配置命名空间</li> <li><code>tags:</code>              配置标签</li> <li><code>cachePath:</code>     配置缓存路径</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">image</span><span class="token punctuation">:</span> gitlab/gitlab<span class="token punctuation">-</span>runner<span class="token punctuation">:</span>alpine<span class="token punctuation">-</span>v11.7.0
<span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
<span class="token key atrule">init</span><span class="token punctuation">:</span>
  <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox
  <span class="token key atrule">tag</span><span class="token punctuation">:</span> v1.0
<span class="token key atrule">gitlabUrl</span><span class="token punctuation">:</span> <span class="token string">&quot;http://10.11.121.111&quot;</span>
<span class="token key atrule">runnerRegistrationToken</span><span class="token punctuation">:</span> <span class="token string">&quot;o4_NCTZvpnViRE7iGxoi&quot;</span>
<span class="token key atrule">unregisterRunners</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">concurrent</span><span class="token punctuation">:</span> <span class="token number">10</span>
<span class="token key atrule">checkInterval</span><span class="token punctuation">:</span> <span class="token number">30</span>
<span class="token key atrule">rbac</span><span class="token punctuation">:</span>
  <span class="token key atrule">create</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">clusterWideAccess</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
<span class="token key atrule">metrics</span><span class="token punctuation">:</span>
  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">image</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">:</span><span class="token number">16.04</span>
  <span class="token key atrule">tags</span><span class="token punctuation">:</span> <span class="token string">&quot;k8s&quot;</span>
  <span class="token key atrule">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> demo
  <span class="token key atrule">cachePath</span><span class="token punctuation">:</span> <span class="token string">&quot;/opt/cache&quot;</span>
  <span class="token key atrule">cache</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token key atrule">builds</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token key atrule">services</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token key atrule">helpers</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> 
  <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> 
</code></pre></div><p><strong>3.Helm部署Gitlab-Runner</strong></p> <p>使用<code>helm install</code>命令创建安装Gitlab—Runner。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master gitlab-cicd<span class="token punctuation">]</span><span class="token comment"># helm install k8s-runner gitlab-runner/ -n demo</span>
<span class="token punctuation">[</span>root@k8s-master gitlab-cicd<span class="token punctuation">]</span><span class="token comment"># helm list -n demo </span>
NAME      	NAMESPACE	REVISION	UPDATED                                	STATUS  	CHART               	APP VERSION
k8s-runner	demo     	<span class="token number">1</span>       	<span class="token number">2022</span>-04-24 <span class="token number">13</span>:13:11.742949709 +0000 UTC	deployed	gitlab-runner-0.1.37	
</code></pre></div><p><strong>4.查看Gitlab连接情况</strong></p> <p>1.查看当前的资源是否创建成功。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get -n demo all</span>
NAME                                            READY   STATUS    RESTARTS   AGE
pod/k8s-runner-gitlab-runner-544f469c44-9m7zw   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          155m

NAME                                       READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/k8s-runner-gitlab-runner   <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           155m

NAME                                                  DESIRED   CURRENT   READY   AGE
replicaset.apps/k8s-runner-gitlab-runner-544f469c44   <span class="token number">1</span>         <span class="token number">1</span>         <span class="token number">1</span>       155m
</code></pre></div><p>2.回到Gitlab刷新CICD的Runner的配置，新的Gitlab-Runner连接成功。</p> <p><img src="https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204250848984.png" alt="image-20220424235055148"></p> <p><strong>3.测试GitLab的CICD流水线</strong></p> <p>1.进入demo的项目,点击 <code>CI/CD</code>，然后找到<code>Editor</code> ，编写一个流水线脚本，运行job1，输出Hello Word。</p> <p><img src="https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204250848184.png" alt="image-20220425000049979"></p> <p>如上的.gitlab-ci.yaml文件如下：</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">stages</span><span class="token punctuation">:</span> 
  <span class="token punctuation">-</span> .pre
  <span class="token punctuation">-</span> build
  <span class="token punctuation">-</span> test
  <span class="token punctuation">-</span> deploy 

<span class="token key atrule">job1</span><span class="token punctuation">:</span> 
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> .pre
  <span class="token key atrule">script</span><span class="token punctuation">:</span> 
    <span class="token punctuation">-</span> echo &quot;Hello Word&quot;

<span class="token key atrule">job2</span><span class="token punctuation">:</span> 
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> build
  <span class="token key atrule">script</span><span class="token punctuation">:</span> 
    <span class="token punctuation">-</span> echo &quot;This is build&quot;

<span class="token key atrule">job3</span><span class="token punctuation">:</span> 
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> test
  <span class="token key atrule">script</span><span class="token punctuation">:</span> 
    <span class="token punctuation">-</span> echo &quot;This is test&quot;

<span class="token key atrule">job4</span><span class="token punctuation">:</span> 
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> deploy
  <span class="token key atrule">script</span><span class="token punctuation">:</span> 
    <span class="token punctuation">-</span> echo &quot;This is deploy&quot;
</code></pre></div><p>2.点击 <code>Commit changes</code> 提交流水线脚本。</p> <p><img src="https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204250848169.png" alt="image-20220425000312131"></p> <p>3.构建完成之后，查看当前的部署情况，可以发现四个阶段的任务都正常部署，所以说明Gitlab-CI已经可以正常运行。</p> <p><img src="https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204250848335.png" alt="image-20220425000806089"></p> <p>4.点击Job1，查看当前的Job1输出的日志，是否为Hello Word。</p> <p><img src="https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204250848471.png" alt="image-20220425001000417"></p> <p>如上图可以看到Job1任务输出的内容正常。</p> <h2 id="部署harbor"><a href="#部署harbor" class="header-anchor">#</a> 部署Harbor</h2> <h3 id="_1-harbor介绍"><a href="#_1-harbor介绍" class="header-anchor">#</a> 1.Harbor介绍</h3> <p>Harbor 源于 2014 年 VMware中国研发中心云原生实验室的一个内部项目，旨在为容器的开发人员解决镜像管理的问题。随着 Kubernetes 和容器技术的流行，该项目于 2016 年开源，2018 年 7 月捐赠给 CNCF，在同年 11 月被正式接受为孵化项目，并在云原生技术路线与生态中演进。</p> <p>2020年5月 Harbor 2.0 正式发布，增加了对 OCI 制品的支持，能够存储大量云原生制品，例如容器镜像、Helm Chart、CNAB、OPA 和 Singularity 等等。开发人员可依照 OCI 规范，通过 OCI 索引和 OCI 制品功能开拓更广泛的应用场景，包括策略、远程复制和基于角色的访问控制等。</p> <h3 id="_2-harbor部署"><a href="#_2-harbor部署" class="header-anchor">#</a> 2.Harbor部署</h3> <ul><li>首选必须安装docker-compose的插件，这里我已经安装了docker-compose</li> <li>禁用https策略，使用http策略</li> <li>将hostname修改为10.11.121.112</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-node1 harbor<span class="token punctuation">]</span><span class="token comment"># docker-compose version </span>
Docker Compose version v2.2.1
<span class="token punctuation">[</span>root@k8s-node1 opt<span class="token punctuation">]</span><span class="token comment"># tar zxvf harbor-offline.tar.gz </span>
<span class="token punctuation">[</span>root@k8s-node1 opt<span class="token punctuation">]</span><span class="token comment"># cd harbor/</span>
<span class="token punctuation">[</span>root@k8s-node1 opt<span class="token punctuation">]</span><span class="token comment"># vim harbor.yaml </span>
hostname: <span class="token number">10.11</span>.121.112

<span class="token comment"># http related config</span>
http:
  <span class="token comment"># port for http, default is 80. If https enabled, this port will redirect to https port</span>
  port: <span class="token number">80</span>

<span class="token comment"># https related config</span>
<span class="token comment">#https:</span>
  <span class="token comment"># https port for harbor, default is 443</span>
<span class="token comment">#  port: 443</span>
  <span class="token comment"># The path of cert and key files for nginx</span>
<span class="token comment">#  certificate: /your/certificate/path</span>
<span class="token comment">#  private_key: /your/private/key/path</span>
</code></pre></div><p>执行命令安装Harbor，查看harbor的进程。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-node1 harbor<span class="token punctuation">]</span><span class="token comment"># ./install.sh </span>
<span class="token punctuation">[</span>Step <span class="token number">0</span><span class="token punctuation">]</span>: checking <span class="token keyword">if</span> <span class="token function">docker</span> is installed <span class="token punctuation">..</span>.
Note: <span class="token function">docker</span> version: <span class="token number">20.10</span>.14

<span class="token punctuation">[</span>Step <span class="token number">1</span><span class="token punctuation">]</span>: checking <span class="token function">docker-compose</span> is installed <span class="token punctuation">..</span>.
Note: <span class="token function">docker-compose</span> version: <span class="token number">2.2</span>.1

<span class="token punctuation">[</span>Step <span class="token number">2</span><span class="token punctuation">]</span>: loading Harbor images <span class="token punctuation">..</span>.
···
<span class="token punctuation">[</span>Step <span class="token number">5</span><span class="token punctuation">]</span>: starting Harbor <span class="token punctuation">..</span>.
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Running <span class="token number">10</span>/10
 ⠿ Network harbor_harbor        Created                                                                                                 <span class="token number">0</span>.1s
 ⠿ Container harbor-log         Started                                                                                                 <span class="token number">1</span>.6s
 ⠿ Container harbor-db          Started                                                                                                 <span class="token number">2</span>.6s
 ⠿ Container registryctl        Started                                                                                                 <span class="token number">3</span>.2s
 ⠿ Container harbor-portal      Started                                                                                                 <span class="token number">2</span>.8s
 ⠿ Container registry           Started                                                                                                 <span class="token number">3</span>.2s
 ⠿ Container redis              Started                                                                                                 <span class="token number">3</span>.2s
 ⠿ Container harbor-core        Started                                                                                                 <span class="token number">4</span>.0s
 ⠿ Container nginx              Started                                                                                                 <span class="token number">5</span>.3s
 ⠿ Container harbor-jobservice  Started                                                                                                 <span class="token number">5</span>.3s
✔ ----Harbor has been installed and started successfully.----


<span class="token punctuation">[</span>root@k8s-node1 harbor<span class="token punctuation">]</span><span class="token comment"># docker-compose  ps </span>
NAME                COMMAND                  SERVICE             STATUS              PORTS
harbor-core         <span class="token string">&quot;/harbor/entrypoint.…&quot;</span>   core                running <span class="token punctuation">(</span>healthy<span class="token punctuation">)</span>   
harbor-db           <span class="token string">&quot;/docker-entrypoint.…&quot;</span>   postgresql          running <span class="token punctuation">(</span>healthy<span class="token punctuation">)</span>   
harbor-jobservice   <span class="token string">&quot;/harbor/entrypoint.…&quot;</span>   jobservice          running <span class="token punctuation">(</span>healthy<span class="token punctuation">)</span>   
harbor-log          <span class="token string">&quot;/bin/sh -c /usr/loc…&quot;</span>   log                 running <span class="token punctuation">(</span>healthy<span class="token punctuation">)</span>   <span class="token number">127.0</span>.0.1:1514-<span class="token operator">&gt;</span><span class="token number">10514</span>/tcp
harbor-portal       <span class="token string">&quot;nginx -g 'daemon of…&quot;</span>   portal              running <span class="token punctuation">(</span>healthy<span class="token punctuation">)</span>   
nginx               <span class="token string">&quot;nginx -g 'daemon of…&quot;</span>   proxy               running <span class="token punctuation">(</span>healthy<span class="token punctuation">)</span>   <span class="token number">0.0</span>.0.0:80-<span class="token operator">&gt;</span><span class="token number">8080</span>/tcp, :::80-<span class="token operator">&gt;</span><span class="token number">8080</span>/tcp
redis               <span class="token string">&quot;redis-server /etc/r…&quot;</span>   redis               running <span class="token punctuation">(</span>healthy<span class="token punctuation">)</span>   
registry            <span class="token string">&quot;/home/harbor/entryp…&quot;</span>   registry            running <span class="token punctuation">(</span>healthy<span class="token punctuation">)</span>   
registryctl         <span class="token string">&quot;/home/harbor/start.…&quot;</span>   registryctl         running <span class="token punctuation">(</span>healthy<span class="token punctuation">)</span> 
</code></pre></div><p>访问Harbor地址： http://10.11.121.112</p> <p><img src="https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204250848345.png" alt="image-20220425001823055"></p> <h3 id="_3-添加镜像仓库"><a href="#_3-添加镜像仓库" class="header-anchor">#</a> 3.添加镜像仓库</h3> <p>点击 <code>新建项目</code> ，创建项目名称为 <code>demo</code>，访问级别设置为 <code>公开</code>。</p> <p><img src="https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204250848880.png" alt="image-20220425002022377"></p> <p><img src="https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204250848072.png" alt="image-20220425002121911"></p> <h2 id="配置cicd"><a href="#配置cicd" class="header-anchor">#</a> 配置CICD</h2> <h3 id="_1-配置-gitlab-ci-yml"><a href="#_1-配置-gitlab-ci-yml" class="header-anchor">#</a> 1.配置.gitlab-ci.yml</h3> <p>配置.gitlab-ci.yaml的流水线配置文件内容如下：</p> <ul><li>使用<code>docker:v1.0</code>的镜像作为基础镜像</li> <li>需要构建三个步骤：<code>maven-build、docker-build、deploy</code></li> <li>使用<code>maven镜像</code>构建编译demo-2048项目</li> <li>使用<code>docker镜像</code>build新的镜像，推送到Harbor仓库中</li> <li>使用<code>kubelet镜像</code>部署demo-2048的yaml文件</li></ul> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">image</span><span class="token punctuation">:</span> docker<span class="token punctuation">:</span>v1.0
<span class="token key atrule">stages</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> maven<span class="token punctuation">-</span>build
  <span class="token punctuation">-</span> docker<span class="token punctuation">-</span>build
  <span class="token punctuation">-</span> deploy

<span class="token comment"># 这是定义的变量，是Harbor仓库登录的验证信息。</span>
<span class="token key atrule">variables</span><span class="token punctuation">:</span>
  <span class="token key atrule">USERNAME</span><span class="token punctuation">:</span> admin
  <span class="token key atrule">PASSWORD</span><span class="token punctuation">:</span> Harbor12345
  <span class="token key atrule">HARBORIP</span><span class="token punctuation">:</span> 10.11.121.112

<span class="token key atrule">maven-build</span><span class="token punctuation">:</span>
  <span class="token key atrule">image</span><span class="token punctuation">:</span> maven<span class="token punctuation">:</span>3.6<span class="token punctuation">-</span>jdk<span class="token punctuation">-</span><span class="token number">8</span>
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> maven<span class="token punctuation">-</span>build 
  <span class="token key atrule">script</span><span class="token punctuation">:</span> 
    <span class="token punctuation">-</span> mkdir <span class="token punctuation">-</span>p /root/.m2/repository
    <span class="token punctuation">-</span> cp <span class="token punctuation">-</span>rvf /opt/repository/*  /root/.m2/repository/
    <span class="token punctuation">-</span> mvn clean install <span class="token punctuation">-</span>Dmaven.test.sktip=true
    <span class="token punctuation">-</span> cp <span class="token punctuation">-</span>rvf /root/demo/target/demo<span class="token punctuation">-</span>2048  /opt/cache

<span class="token key atrule">docker_build</span><span class="token punctuation">:</span>
  <span class="token key atrule">image</span><span class="token punctuation">:</span> docker<span class="token punctuation">:</span>v1.0
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> docker<span class="token punctuation">-</span>build
  <span class="token key atrule">script</span><span class="token punctuation">:</span> 
    <span class="token punctuation">-</span> mv /opt/cache/* /root/demo/Dockerfiles/
    <span class="token punctuation">-</span> cd /root/demo/Dockerfiles/ <span class="token important">&amp;&amp;</span> ls
    <span class="token punctuation">-</span> docker build <span class="token punctuation">-</span>t $HARBORIP/demo/demo<span class="token punctuation">-</span>2048<span class="token punctuation">:</span>v1.0 <span class="token punctuation">-</span>f /root/demo/Dockerfiles/Dockerfile . 
    <span class="token punctuation">-</span> docker login <span class="token punctuation">-</span>u $USERNAME <span class="token punctuation">-</span>p $PASSWORD $HARBORIP 
    <span class="token punctuation">-</span> docker push $HARBORIP/demo/demo<span class="token punctuation">-</span>2048<span class="token punctuation">:</span>v1.0

<span class="token comment"># 这里的kubectl是做的镜像，是在本地仓库，使用config连接Kubernetes集群</span>
<span class="token key atrule">deploy</span><span class="token punctuation">:</span>
  <span class="token key atrule">image</span><span class="token punctuation">:</span> kubectl<span class="token punctuation">:</span>1.16.6
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> deploy 
  <span class="token key atrule">script</span><span class="token punctuation">:</span> 
    <span class="token punctuation">-</span> mkdir $HOME/.kube <span class="token important">&amp;&amp;</span> cat $K8S_CONFIG <span class="token punctuation">&gt;</span> $HOME/.kube/config
    <span class="token punctuation">-</span> cd $HOME/.kube <span class="token important">&amp;&amp;</span> pwd
    <span class="token punctuation">-</span> sed <span class="token punctuation">-</span>i 's/10.24.2.3/10.11.121.112/g' /root/demo/template/demo<span class="token punctuation">-</span>2048.yaml 
    <span class="token punctuation">-</span> sed <span class="token punctuation">-</span>i 's/<span class="token punctuation">{</span><span class="token punctuation">{</span>build_tag<span class="token punctuation">}</span><span class="token punctuation">}</span>/v1.0/g' /root/demo/template/demo<span class="token punctuation">-</span>2048.yaml 
    <span class="token punctuation">-</span> sed <span class="token punctuation">-</span>i 's/8889/30003/g' /root/demo/template/demo<span class="token punctuation">-</span>2048.yaml 
    <span class="token punctuation">-</span> kubectl apply <span class="token punctuation">-</span>f /root/demo/template/demo<span class="token punctuation">-</span>2048.yaml
</code></pre></div><h3 id="_2-开始构建"><a href="#_2-开始构建" class="header-anchor">#</a> 2.开始构建</h3> <p>点击 <code>提交完成</code> 构建CICD。</p> <p><img src="https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204250848856.png" alt="image-20220425003143807"></p> <p>等待结果：</p> <p><img src="https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204250848288.png" alt="image-20220425003438600"></p> <h3 id="_3-查看gitlab-ci"><a href="#_3-查看gitlab-ci" class="header-anchor">#</a> 3.查看Gitlab-CI</h3> <p>查看构建的输出日志内容。</p> <p>如下是maven-build的输出内容：</p> <p><img src="https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204250848151.png" alt="image-20220425003531697"></p> <p>如下是docker-build的输出内容：</p> <p><img src="https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204250848855.png" alt="image-20220425003550405"></p> <p>如下是deploy的输出内容：</p> <p><img src="https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204250848591.png" alt="image-20220425003605898"></p> <h3 id="_4-访问项目"><a href="#_4-访问项目" class="header-anchor">#</a> 4.访问项目</h3> <p>查看当前的demo命名空间下的资源，demo-2048应用程序部署完成。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get  pods -n demo</span>
NAME                                        READY   STATUS    RESTARTS   AGE
demo-2048-6858bb9f8d-522rn                  <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3m19s
k8s-runner-gitlab-runner-544f469c44-9m7zw   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3h23m
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get svc -n demo </span>
NAME        TYPE       CLUSTER-IP     EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>          AGE
demo30003   NodePort   <span class="token number">10.96</span>.113.92   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">8080</span>:30003/TCP   3m24s
</code></pre></div><p>访问页面： http://10.11.121.112:30003</p> <p><img src="https://raw.githubusercontent.com/cn-zhangyh/image/main/img/202204250849199.png" alt="image-20220425003906131"></p></div></div> <!----> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2023/11/28, 22:03:59</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/CodeVault/pages/1ec44e/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Gitlab-Runner + k8s 实现自动部署</div></a> <a href="/CodeVault/pages/7799fb/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Gitea+K8s-Jenkins-master-slave(webhook钩子)</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/CodeVault/pages/1ec44e/" class="prev">Gitlab-Runner + k8s 实现自动部署</a></span> <span class="next"><a href="/CodeVault/pages/7799fb/">Gitea+K8s-Jenkins-master-slave(webhook钩子)</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/CodeVault/archives" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/CodeVault/pages/c936ca/"><div>
            学习文档
            <!----></div></a> <span class="date">11-28</span></dt></dl><dl><dd>02</dd> <dt><a href="/CodeVault/pages/53f082/"><div>
            如何成为FISCO社区的MVP 总结篇
            <!----></div></a> <span class="date">11-28</span></dt></dl><dl><dd>03</dd> <dt><a href="/CodeVault/pages/3d3086/"><div>
            一文搞懂Truffle测试
            <!----></div></a> <span class="date">11-28</span></dt></dl> <dl><dd></dd> <dt><a href="/CodeVault/archives" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:894072666@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/xugaoyi" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2023-2023
    <span>YYzop & Hior | MIT License</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/CodeVault/assets/js/app.ef278985.js" defer></script><script src="/CodeVault/assets/js/2.f96441c8.js" defer></script><script src="/CodeVault/assets/js/174.d0a94b6a.js" defer></script>
  </body>
</html>
