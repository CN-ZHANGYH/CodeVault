<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Kubernetes应用程序生命周期管理 | CodeVault文档站</title>
    <meta name="generator" content="VuePress 1.9.2">
    <link rel="icon" href="/CodeVault/img/Aj.svg">
    <meta name="description" content="CodeVault一个记录云计算、云原生、Java开发的文档站。">
    <meta name="keywords" content="vuepress,theme,blog,vdoing">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/CodeVault/assets/css/0.styles.bcdd6f38.css" as="style"><link rel="preload" href="/CodeVault/assets/js/app.ef278985.js" as="script"><link rel="preload" href="/CodeVault/assets/js/2.f96441c8.js" as="script"><link rel="preload" href="/CodeVault/assets/js/145.55b32ea3.js" as="script"><link rel="prefetch" href="/CodeVault/assets/js/10.0b981dbd.js"><link rel="prefetch" href="/CodeVault/assets/js/100.5c06c78f.js"><link rel="prefetch" href="/CodeVault/assets/js/101.88d67c9c.js"><link rel="prefetch" href="/CodeVault/assets/js/102.70928850.js"><link rel="prefetch" href="/CodeVault/assets/js/103.ef636770.js"><link rel="prefetch" href="/CodeVault/assets/js/104.c1927b63.js"><link rel="prefetch" href="/CodeVault/assets/js/105.85c8a7cd.js"><link rel="prefetch" href="/CodeVault/assets/js/106.fb2e66ea.js"><link rel="prefetch" href="/CodeVault/assets/js/107.0f35bf63.js"><link rel="prefetch" href="/CodeVault/assets/js/108.fccb735c.js"><link rel="prefetch" href="/CodeVault/assets/js/109.682036f0.js"><link rel="prefetch" href="/CodeVault/assets/js/11.ac4d24fe.js"><link rel="prefetch" href="/CodeVault/assets/js/110.b7f8edea.js"><link rel="prefetch" href="/CodeVault/assets/js/111.fd94666b.js"><link rel="prefetch" href="/CodeVault/assets/js/112.a07708f0.js"><link rel="prefetch" href="/CodeVault/assets/js/113.63efff87.js"><link rel="prefetch" href="/CodeVault/assets/js/114.ab1099fa.js"><link rel="prefetch" href="/CodeVault/assets/js/115.f5fe6b28.js"><link rel="prefetch" href="/CodeVault/assets/js/116.6ce08e8e.js"><link rel="prefetch" href="/CodeVault/assets/js/117.48dbb04e.js"><link rel="prefetch" href="/CodeVault/assets/js/118.5b909be0.js"><link rel="prefetch" href="/CodeVault/assets/js/119.8f6e0bf7.js"><link rel="prefetch" href="/CodeVault/assets/js/12.c1e5feb4.js"><link rel="prefetch" href="/CodeVault/assets/js/120.21cc7ba5.js"><link rel="prefetch" href="/CodeVault/assets/js/121.04134de2.js"><link rel="prefetch" href="/CodeVault/assets/js/122.31567951.js"><link rel="prefetch" href="/CodeVault/assets/js/123.002f9bee.js"><link rel="prefetch" href="/CodeVault/assets/js/124.e99e860a.js"><link rel="prefetch" href="/CodeVault/assets/js/125.72c926b3.js"><link rel="prefetch" href="/CodeVault/assets/js/126.01a5e87f.js"><link rel="prefetch" href="/CodeVault/assets/js/127.1956ebe6.js"><link rel="prefetch" href="/CodeVault/assets/js/128.d65996f5.js"><link rel="prefetch" href="/CodeVault/assets/js/129.67eabc56.js"><link rel="prefetch" href="/CodeVault/assets/js/13.13f84e24.js"><link rel="prefetch" href="/CodeVault/assets/js/130.634c4ce3.js"><link rel="prefetch" href="/CodeVault/assets/js/131.a418f195.js"><link rel="prefetch" href="/CodeVault/assets/js/132.ea662f19.js"><link rel="prefetch" href="/CodeVault/assets/js/133.63b2b38b.js"><link rel="prefetch" href="/CodeVault/assets/js/134.0cd9f3da.js"><link rel="prefetch" href="/CodeVault/assets/js/135.4e8913a1.js"><link rel="prefetch" href="/CodeVault/assets/js/136.53ad8182.js"><link rel="prefetch" href="/CodeVault/assets/js/137.8d8f6ff4.js"><link rel="prefetch" href="/CodeVault/assets/js/138.1e5627de.js"><link rel="prefetch" href="/CodeVault/assets/js/139.4c335178.js"><link rel="prefetch" href="/CodeVault/assets/js/14.92742bc3.js"><link rel="prefetch" href="/CodeVault/assets/js/140.ad32a483.js"><link rel="prefetch" href="/CodeVault/assets/js/141.509650db.js"><link rel="prefetch" href="/CodeVault/assets/js/142.8a4692a4.js"><link rel="prefetch" href="/CodeVault/assets/js/143.4226943d.js"><link rel="prefetch" href="/CodeVault/assets/js/144.a04016d3.js"><link rel="prefetch" href="/CodeVault/assets/js/146.d78a1fa5.js"><link rel="prefetch" href="/CodeVault/assets/js/147.c48fa78d.js"><link rel="prefetch" href="/CodeVault/assets/js/148.24a7cd95.js"><link rel="prefetch" href="/CodeVault/assets/js/149.a74e35f1.js"><link rel="prefetch" href="/CodeVault/assets/js/15.6953f44b.js"><link rel="prefetch" href="/CodeVault/assets/js/150.7f27817b.js"><link rel="prefetch" href="/CodeVault/assets/js/151.6445d326.js"><link rel="prefetch" href="/CodeVault/assets/js/152.eadc171d.js"><link rel="prefetch" href="/CodeVault/assets/js/153.2da9c7f8.js"><link rel="prefetch" href="/CodeVault/assets/js/154.a3546076.js"><link rel="prefetch" href="/CodeVault/assets/js/155.351a616f.js"><link rel="prefetch" href="/CodeVault/assets/js/156.e6bbf3b3.js"><link rel="prefetch" href="/CodeVault/assets/js/157.ee152deb.js"><link rel="prefetch" href="/CodeVault/assets/js/158.076e0f8c.js"><link rel="prefetch" href="/CodeVault/assets/js/159.9ad1744e.js"><link rel="prefetch" href="/CodeVault/assets/js/16.df859e45.js"><link rel="prefetch" href="/CodeVault/assets/js/160.c5beea39.js"><link rel="prefetch" href="/CodeVault/assets/js/161.0cf956e1.js"><link rel="prefetch" href="/CodeVault/assets/js/162.c58e81e1.js"><link rel="prefetch" href="/CodeVault/assets/js/163.63d65593.js"><link rel="prefetch" href="/CodeVault/assets/js/164.9626ab8a.js"><link rel="prefetch" href="/CodeVault/assets/js/165.fc09035b.js"><link rel="prefetch" href="/CodeVault/assets/js/166.b38be38b.js"><link rel="prefetch" href="/CodeVault/assets/js/167.8f5417ed.js"><link rel="prefetch" href="/CodeVault/assets/js/168.d636e649.js"><link rel="prefetch" href="/CodeVault/assets/js/169.dd84c459.js"><link rel="prefetch" href="/CodeVault/assets/js/17.a2971fe6.js"><link rel="prefetch" href="/CodeVault/assets/js/170.a488616f.js"><link rel="prefetch" href="/CodeVault/assets/js/171.a7896a98.js"><link rel="prefetch" href="/CodeVault/assets/js/172.90b58f0e.js"><link rel="prefetch" href="/CodeVault/assets/js/173.ce66d68a.js"><link rel="prefetch" href="/CodeVault/assets/js/174.d0a94b6a.js"><link rel="prefetch" href="/CodeVault/assets/js/175.87ea7df7.js"><link rel="prefetch" href="/CodeVault/assets/js/176.67abf34b.js"><link rel="prefetch" href="/CodeVault/assets/js/177.3b2acda5.js"><link rel="prefetch" href="/CodeVault/assets/js/178.5fe697a5.js"><link rel="prefetch" href="/CodeVault/assets/js/179.57349e36.js"><link rel="prefetch" href="/CodeVault/assets/js/18.45b06c71.js"><link rel="prefetch" href="/CodeVault/assets/js/180.a8b6136e.js"><link rel="prefetch" href="/CodeVault/assets/js/181.c96cb1ac.js"><link rel="prefetch" href="/CodeVault/assets/js/182.e13a2ed6.js"><link rel="prefetch" href="/CodeVault/assets/js/183.4982d955.js"><link rel="prefetch" href="/CodeVault/assets/js/184.123e3912.js"><link rel="prefetch" href="/CodeVault/assets/js/185.c1db2bfa.js"><link rel="prefetch" href="/CodeVault/assets/js/186.bff6dc40.js"><link rel="prefetch" href="/CodeVault/assets/js/187.3e10e06d.js"><link rel="prefetch" href="/CodeVault/assets/js/188.53f01570.js"><link rel="prefetch" href="/CodeVault/assets/js/189.53c9b973.js"><link rel="prefetch" href="/CodeVault/assets/js/19.21381c2f.js"><link rel="prefetch" href="/CodeVault/assets/js/190.f9e298a3.js"><link rel="prefetch" href="/CodeVault/assets/js/191.7055ec43.js"><link rel="prefetch" href="/CodeVault/assets/js/192.6083d608.js"><link rel="prefetch" href="/CodeVault/assets/js/193.72e5d099.js"><link rel="prefetch" href="/CodeVault/assets/js/194.cb4c2f87.js"><link rel="prefetch" href="/CodeVault/assets/js/195.add61432.js"><link rel="prefetch" href="/CodeVault/assets/js/196.cafb716f.js"><link rel="prefetch" href="/CodeVault/assets/js/197.29ad1cb1.js"><link rel="prefetch" href="/CodeVault/assets/js/198.1ca9886c.js"><link rel="prefetch" href="/CodeVault/assets/js/199.28f7095d.js"><link rel="prefetch" href="/CodeVault/assets/js/20.fe478246.js"><link rel="prefetch" href="/CodeVault/assets/js/200.cdd91d66.js"><link rel="prefetch" href="/CodeVault/assets/js/201.568571d0.js"><link rel="prefetch" href="/CodeVault/assets/js/202.0b55d1cd.js"><link rel="prefetch" href="/CodeVault/assets/js/203.c9d7036e.js"><link rel="prefetch" href="/CodeVault/assets/js/204.f877fa44.js"><link rel="prefetch" href="/CodeVault/assets/js/205.f7dcea25.js"><link rel="prefetch" href="/CodeVault/assets/js/206.266f6bb0.js"><link rel="prefetch" href="/CodeVault/assets/js/207.962cdf0e.js"><link rel="prefetch" href="/CodeVault/assets/js/208.dcbb7fb9.js"><link rel="prefetch" href="/CodeVault/assets/js/209.89cb12fb.js"><link rel="prefetch" href="/CodeVault/assets/js/21.1a17ddc5.js"><link rel="prefetch" href="/CodeVault/assets/js/210.442ced55.js"><link rel="prefetch" href="/CodeVault/assets/js/211.6d14fe33.js"><link rel="prefetch" href="/CodeVault/assets/js/212.65a1883d.js"><link rel="prefetch" href="/CodeVault/assets/js/213.21351702.js"><link rel="prefetch" href="/CodeVault/assets/js/214.bd781706.js"><link rel="prefetch" href="/CodeVault/assets/js/215.f30b644c.js"><link rel="prefetch" href="/CodeVault/assets/js/216.587501ff.js"><link rel="prefetch" href="/CodeVault/assets/js/217.8db2123f.js"><link rel="prefetch" href="/CodeVault/assets/js/218.aa6b1af6.js"><link rel="prefetch" href="/CodeVault/assets/js/219.2b27640b.js"><link rel="prefetch" href="/CodeVault/assets/js/22.7652d0d6.js"><link rel="prefetch" href="/CodeVault/assets/js/220.eafe6218.js"><link rel="prefetch" href="/CodeVault/assets/js/221.ab153f73.js"><link rel="prefetch" href="/CodeVault/assets/js/222.4f7df33b.js"><link rel="prefetch" href="/CodeVault/assets/js/223.6f5b1e03.js"><link rel="prefetch" href="/CodeVault/assets/js/224.6bed6414.js"><link rel="prefetch" href="/CodeVault/assets/js/225.03a64323.js"><link rel="prefetch" href="/CodeVault/assets/js/226.2db9dc4b.js"><link rel="prefetch" href="/CodeVault/assets/js/227.6e01bc51.js"><link rel="prefetch" href="/CodeVault/assets/js/228.d06cad32.js"><link rel="prefetch" href="/CodeVault/assets/js/229.3f46b203.js"><link rel="prefetch" href="/CodeVault/assets/js/23.8a5bbf3f.js"><link rel="prefetch" href="/CodeVault/assets/js/230.b84fd605.js"><link rel="prefetch" href="/CodeVault/assets/js/231.ca2e1834.js"><link rel="prefetch" href="/CodeVault/assets/js/232.e572f662.js"><link rel="prefetch" href="/CodeVault/assets/js/233.0a7e6deb.js"><link rel="prefetch" href="/CodeVault/assets/js/234.9dddbcb6.js"><link rel="prefetch" href="/CodeVault/assets/js/235.b4ed574b.js"><link rel="prefetch" href="/CodeVault/assets/js/236.252b1f69.js"><link rel="prefetch" href="/CodeVault/assets/js/237.c529d9c4.js"><link rel="prefetch" href="/CodeVault/assets/js/238.16da920c.js"><link rel="prefetch" href="/CodeVault/assets/js/239.14f7892d.js"><link rel="prefetch" href="/CodeVault/assets/js/24.1ca1bd80.js"><link rel="prefetch" href="/CodeVault/assets/js/240.d00a46df.js"><link rel="prefetch" href="/CodeVault/assets/js/25.43c779a1.js"><link rel="prefetch" href="/CodeVault/assets/js/26.bdfe293e.js"><link rel="prefetch" href="/CodeVault/assets/js/27.330c11f5.js"><link rel="prefetch" href="/CodeVault/assets/js/28.46dfe7f4.js"><link rel="prefetch" href="/CodeVault/assets/js/29.4fc19b1e.js"><link rel="prefetch" href="/CodeVault/assets/js/3.44fcbdc8.js"><link rel="prefetch" href="/CodeVault/assets/js/30.da1d9fd7.js"><link rel="prefetch" href="/CodeVault/assets/js/31.df871787.js"><link rel="prefetch" href="/CodeVault/assets/js/32.e62268d4.js"><link rel="prefetch" href="/CodeVault/assets/js/33.b2c675b0.js"><link rel="prefetch" href="/CodeVault/assets/js/34.461e2f23.js"><link rel="prefetch" href="/CodeVault/assets/js/35.2666157f.js"><link rel="prefetch" href="/CodeVault/assets/js/36.b55a4b34.js"><link rel="prefetch" href="/CodeVault/assets/js/37.556ba5c1.js"><link rel="prefetch" href="/CodeVault/assets/js/38.8c982590.js"><link rel="prefetch" href="/CodeVault/assets/js/39.a7850266.js"><link rel="prefetch" href="/CodeVault/assets/js/4.8a0557a7.js"><link rel="prefetch" href="/CodeVault/assets/js/40.9a11a440.js"><link rel="prefetch" href="/CodeVault/assets/js/41.c3a71e10.js"><link rel="prefetch" href="/CodeVault/assets/js/42.7e9779c1.js"><link rel="prefetch" href="/CodeVault/assets/js/43.e017fec5.js"><link rel="prefetch" href="/CodeVault/assets/js/44.22c5aef3.js"><link rel="prefetch" href="/CodeVault/assets/js/45.dfe95d23.js"><link rel="prefetch" href="/CodeVault/assets/js/46.10af373d.js"><link rel="prefetch" href="/CodeVault/assets/js/47.a1e4779a.js"><link rel="prefetch" href="/CodeVault/assets/js/48.3142bf91.js"><link rel="prefetch" href="/CodeVault/assets/js/49.08546fe2.js"><link rel="prefetch" href="/CodeVault/assets/js/5.1bad1047.js"><link rel="prefetch" href="/CodeVault/assets/js/50.75c37eaf.js"><link rel="prefetch" href="/CodeVault/assets/js/51.b2f39f65.js"><link rel="prefetch" href="/CodeVault/assets/js/52.97fc3d07.js"><link rel="prefetch" href="/CodeVault/assets/js/53.1a2a51df.js"><link rel="prefetch" href="/CodeVault/assets/js/54.09f7dfd6.js"><link rel="prefetch" href="/CodeVault/assets/js/55.d112e5e2.js"><link rel="prefetch" href="/CodeVault/assets/js/56.b7b00837.js"><link rel="prefetch" href="/CodeVault/assets/js/57.5beac805.js"><link rel="prefetch" href="/CodeVault/assets/js/58.04f116f1.js"><link rel="prefetch" href="/CodeVault/assets/js/59.d660a6b3.js"><link rel="prefetch" href="/CodeVault/assets/js/6.7220274d.js"><link rel="prefetch" href="/CodeVault/assets/js/60.54783427.js"><link rel="prefetch" href="/CodeVault/assets/js/61.6e520517.js"><link rel="prefetch" href="/CodeVault/assets/js/62.78b5acff.js"><link rel="prefetch" href="/CodeVault/assets/js/63.0492d6b3.js"><link rel="prefetch" href="/CodeVault/assets/js/64.bd2a8518.js"><link rel="prefetch" href="/CodeVault/assets/js/65.8acc8c15.js"><link rel="prefetch" href="/CodeVault/assets/js/66.c2dc1d15.js"><link rel="prefetch" href="/CodeVault/assets/js/67.d584fc60.js"><link rel="prefetch" href="/CodeVault/assets/js/68.7221e725.js"><link rel="prefetch" href="/CodeVault/assets/js/69.f1a4c42c.js"><link rel="prefetch" href="/CodeVault/assets/js/7.ee190d28.js"><link rel="prefetch" href="/CodeVault/assets/js/70.8fb27ce3.js"><link rel="prefetch" href="/CodeVault/assets/js/71.2011297a.js"><link rel="prefetch" href="/CodeVault/assets/js/72.81904f20.js"><link rel="prefetch" href="/CodeVault/assets/js/73.cae4a206.js"><link rel="prefetch" href="/CodeVault/assets/js/74.41ca332e.js"><link rel="prefetch" href="/CodeVault/assets/js/75.ae7006ef.js"><link rel="prefetch" href="/CodeVault/assets/js/76.8477b765.js"><link rel="prefetch" href="/CodeVault/assets/js/77.ae764f14.js"><link rel="prefetch" href="/CodeVault/assets/js/78.b47518b4.js"><link rel="prefetch" href="/CodeVault/assets/js/79.bde0466f.js"><link rel="prefetch" href="/CodeVault/assets/js/8.e3ab8186.js"><link rel="prefetch" href="/CodeVault/assets/js/80.94af34f8.js"><link rel="prefetch" href="/CodeVault/assets/js/81.f1ba0edc.js"><link rel="prefetch" href="/CodeVault/assets/js/82.4485e21e.js"><link rel="prefetch" href="/CodeVault/assets/js/83.940dbcc3.js"><link rel="prefetch" href="/CodeVault/assets/js/84.6be8c64a.js"><link rel="prefetch" href="/CodeVault/assets/js/85.aa147bd8.js"><link rel="prefetch" href="/CodeVault/assets/js/86.0259d757.js"><link rel="prefetch" href="/CodeVault/assets/js/87.c88b420b.js"><link rel="prefetch" href="/CodeVault/assets/js/88.38f98c94.js"><link rel="prefetch" href="/CodeVault/assets/js/89.421840d7.js"><link rel="prefetch" href="/CodeVault/assets/js/9.cb249ed0.js"><link rel="prefetch" href="/CodeVault/assets/js/90.cd9b70c8.js"><link rel="prefetch" href="/CodeVault/assets/js/91.0c040f15.js"><link rel="prefetch" href="/CodeVault/assets/js/92.1ea436cf.js"><link rel="prefetch" href="/CodeVault/assets/js/93.7de38599.js"><link rel="prefetch" href="/CodeVault/assets/js/94.f2ad5a97.js"><link rel="prefetch" href="/CodeVault/assets/js/95.22f940d7.js"><link rel="prefetch" href="/CodeVault/assets/js/96.6a991248.js"><link rel="prefetch" href="/CodeVault/assets/js/97.aeccee85.js"><link rel="prefetch" href="/CodeVault/assets/js/98.79db6c16.js"><link rel="prefetch" href="/CodeVault/assets/js/99.aa13c9cb.js">
    <link rel="stylesheet" href="/CodeVault/assets/css/0.styles.bcdd6f38.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/CodeVault/" class="home-link router-link-active"><img src="/CodeVault/img/huli.svg" alt="CodeVault文档站" class="logo"> <span class="site-name can-hide">CodeVault文档站</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/CodeVault/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="全栈开发" class="dropdown-title"><a href="/CodeVault/pages/d1eaf8/" class="link-title">全栈开发</a> <span class="title" style="display:none;">全栈开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>云计算运维</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/d1eaf8/" class="nav-link">云计算</a></li></ul></li><li class="dropdown-item"><h4>容器开发</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/e820a7/" class="nav-link">容器</a></li></ul></li><li class="dropdown-item"><h4>K8S虚拟化</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/da2470/" class="nav-link">容器虚拟化</a></li></ul></li><li class="dropdown-item"><h4>运维高级篇</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/ce761d/" class="nav-link">高可用</a></li></ul></li><li class="dropdown-item"><h4>前端开发</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/" class="nav-link">前端常用</a></li></ul></li><li class="dropdown-item"><h4>后端开发</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/" class="nav-link">后端常用</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="资源" class="dropdown-title"><a href="/CodeVault/pages/e4db9d/" class="link-title">资源</a> <span class="title" style="display:none;">资源</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/CodeVault/pages/e4db9d/" class="nav-link">资源</a></li><li class="dropdown-item"><!----> <a href="/CodeVault/pages/c936ca/" class="nav-link">学习文档资源</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习路线" class="dropdown-title"><a href="/CodeVault/pages/f24c41/" class="link-title">学习路线</a> <span class="title" style="display:none;">学习路线</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>后端开发</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/f24c41/" class="nav-link">后端学习路线</a></li></ul></li><li class="dropdown-item"><h4>Web3</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/1583d1/" class="nav-link">区块链学习路线</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/CodeVault/pages/6ffa63/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>HTML5+CSS3</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/6ffa63/" class="nav-link">HTML5</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/b23e0c/" class="nav-link">CSS3</a></li></ul></li><li class="dropdown-item"><h4>JavaScript</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/0e8324/" class="nav-link">JavaScript开篇</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/4d9ec9/" class="nav-link">JavaScript面向对象</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/0505ad/" class="nav-link">JavaScript DOM</a></li></ul></li><li class="dropdown-item"><h4>API</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/845076/" class="nav-link">JQuery</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/9c8e93/" class="nav-link">Ajax</a></li><li class="dropdown-subitem"><a href="/CodeVault/" class="nav-link">Axios</a></li></ul></li><li class="dropdown-item"><h4>Vue</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/a1209f/" class="nav-link">Vuejs</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/CodeVault/pages/5e1c7d/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/5e1c7d/" class="nav-link">Java进阶</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/9b262c/" class="nav-link">Spring</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/3e651a/" class="nav-link">SpringBoot</a></li></ul></li><li class="dropdown-item"><h4>Golang</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/135518/" class="nav-link">Beego</a></li><li class="dropdown-subitem"><a href="/CodeVault/" class="nav-link">Gin</a></li><li class="dropdown-subitem"><a href="/CodeVault/" class="nav-link">Gorm</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><a href="/CodeVault/pages/7ef2c7/" class="link-title">中间件</a> <span class="title" style="display:none;">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/CodeVault/pages/7ef2c7/" class="nav-link">MySQL</a></li><li class="dropdown-item"><!----> <a href="/CodeVault/pages/516f71/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/CodeVault/pages/1eaa9a/" class="nav-link">Nginx</a></li><li class="dropdown-item"><!----> <a href="/CodeVault/pages/1ac9b2/" class="nav-link">Ceph</a></li><li class="dropdown-item"><!----> <a href="/CodeVault/pages/719244/" class="nav-link">Elasticsearch</a></li><li class="dropdown-item"><!----> <a href="/CodeVault/pages/6ec6ec/" class="nav-link">Istio</a></li><li class="dropdown-item"><!----> <a href="/CodeVault/pages/30e340/" class="nav-link">Prometheus</a></li></ul></div></div><div class="nav-item"><a href="/CodeVault/pages/32fd53/" class="nav-link">Docker</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="K8S" class="dropdown-title"><a href="/CodeVault/pages/46159d/" class="link-title">K8S</a> <span class="title" style="display:none;">K8S</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>云原生</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/46159d/" class="nav-link">Kubernetes</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/f87a46/" class="nav-link">CKS认证</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/2d432e/" class="nav-link">Operator</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/CodeVault/pages/f6f110/" class="nav-link">CI/CD</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Linux" class="dropdown-title"><a href="/CodeVault/pages/f9fa7a/" class="link-title">Linux</a> <span class="title" style="display:none;">Linux</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Linux</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/f9fa7a/" class="nav-link">基础服务</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/314d26/" class="nav-link">Kvm</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/44e450/" class="nav-link">Ansible</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/8292d8/" class="nav-link">Git</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="区块链" class="dropdown-title"><a href="/CodeVault/pages/f3ea9f/" class="link-title">区块链</a> <span class="title" style="display:none;">区块链</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>FISCO BCOS</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/f3ea9f/" class="nav-link">WeBASE搭建</a></li></ul></li><li class="dropdown-item"><h4>2023年TASK挑战赛上</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/685f1f/" class="nav-link">碳排放解决方案</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/3f1596/" class="nav-link">慈善公益解决方案</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/cc43be/" class="nav-link">构造交易传入AppID</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/75ddc8/" class="nav-link">合约时间触发器</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/9bcc7c/" class="nav-link">一键部署环境脚本</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/a93fcf/" class="nav-link">合约调用机制与并行合约</a></li></ul></li><li class="dropdown-item"><h4>2023年TASK挑战赛下</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/1fdb40/" class="nav-link">DDCMS后端容器化</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/795b78/" class="nav-link">DDCMS第三方登录</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/a99040/" class="nav-link">DDCMS智能合约设计</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/cb310d/" class="nav-link">DDCMS部署和运维</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/0b1c5a/" class="nav-link">DDCMS接口报错</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/99df38/" class="nav-link">合约大小限制优化</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/f8a343/" class="nav-link">并行合约最佳实践</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/3d3086/" class="nav-link">一文搞懂Truffle测试</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/CodeVault/pages/e3d908/" class="nav-link">记录</a></div> <a href="https://github.com/CN-ZHANGYH/CodeVault" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/CodeVault/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="全栈开发" class="dropdown-title"><a href="/CodeVault/pages/d1eaf8/" class="link-title">全栈开发</a> <span class="title" style="display:none;">全栈开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>云计算运维</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/d1eaf8/" class="nav-link">云计算</a></li></ul></li><li class="dropdown-item"><h4>容器开发</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/e820a7/" class="nav-link">容器</a></li></ul></li><li class="dropdown-item"><h4>K8S虚拟化</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/da2470/" class="nav-link">容器虚拟化</a></li></ul></li><li class="dropdown-item"><h4>运维高级篇</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/ce761d/" class="nav-link">高可用</a></li></ul></li><li class="dropdown-item"><h4>前端开发</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/" class="nav-link">前端常用</a></li></ul></li><li class="dropdown-item"><h4>后端开发</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/" class="nav-link">后端常用</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="资源" class="dropdown-title"><a href="/CodeVault/pages/e4db9d/" class="link-title">资源</a> <span class="title" style="display:none;">资源</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/CodeVault/pages/e4db9d/" class="nav-link">资源</a></li><li class="dropdown-item"><!----> <a href="/CodeVault/pages/c936ca/" class="nav-link">学习文档资源</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习路线" class="dropdown-title"><a href="/CodeVault/pages/f24c41/" class="link-title">学习路线</a> <span class="title" style="display:none;">学习路线</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>后端开发</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/f24c41/" class="nav-link">后端学习路线</a></li></ul></li><li class="dropdown-item"><h4>Web3</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/1583d1/" class="nav-link">区块链学习路线</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/CodeVault/pages/6ffa63/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>HTML5+CSS3</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/6ffa63/" class="nav-link">HTML5</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/b23e0c/" class="nav-link">CSS3</a></li></ul></li><li class="dropdown-item"><h4>JavaScript</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/0e8324/" class="nav-link">JavaScript开篇</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/4d9ec9/" class="nav-link">JavaScript面向对象</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/0505ad/" class="nav-link">JavaScript DOM</a></li></ul></li><li class="dropdown-item"><h4>API</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/845076/" class="nav-link">JQuery</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/9c8e93/" class="nav-link">Ajax</a></li><li class="dropdown-subitem"><a href="/CodeVault/" class="nav-link">Axios</a></li></ul></li><li class="dropdown-item"><h4>Vue</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/a1209f/" class="nav-link">Vuejs</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/CodeVault/pages/5e1c7d/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/5e1c7d/" class="nav-link">Java进阶</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/9b262c/" class="nav-link">Spring</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/3e651a/" class="nav-link">SpringBoot</a></li></ul></li><li class="dropdown-item"><h4>Golang</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/135518/" class="nav-link">Beego</a></li><li class="dropdown-subitem"><a href="/CodeVault/" class="nav-link">Gin</a></li><li class="dropdown-subitem"><a href="/CodeVault/" class="nav-link">Gorm</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><a href="/CodeVault/pages/7ef2c7/" class="link-title">中间件</a> <span class="title" style="display:none;">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/CodeVault/pages/7ef2c7/" class="nav-link">MySQL</a></li><li class="dropdown-item"><!----> <a href="/CodeVault/pages/516f71/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/CodeVault/pages/1eaa9a/" class="nav-link">Nginx</a></li><li class="dropdown-item"><!----> <a href="/CodeVault/pages/1ac9b2/" class="nav-link">Ceph</a></li><li class="dropdown-item"><!----> <a href="/CodeVault/pages/719244/" class="nav-link">Elasticsearch</a></li><li class="dropdown-item"><!----> <a href="/CodeVault/pages/6ec6ec/" class="nav-link">Istio</a></li><li class="dropdown-item"><!----> <a href="/CodeVault/pages/30e340/" class="nav-link">Prometheus</a></li></ul></div></div><div class="nav-item"><a href="/CodeVault/pages/32fd53/" class="nav-link">Docker</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="K8S" class="dropdown-title"><a href="/CodeVault/pages/46159d/" class="link-title">K8S</a> <span class="title" style="display:none;">K8S</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>云原生</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/46159d/" class="nav-link">Kubernetes</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/f87a46/" class="nav-link">CKS认证</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/2d432e/" class="nav-link">Operator</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/CodeVault/pages/f6f110/" class="nav-link">CI/CD</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Linux" class="dropdown-title"><a href="/CodeVault/pages/f9fa7a/" class="link-title">Linux</a> <span class="title" style="display:none;">Linux</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Linux</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/f9fa7a/" class="nav-link">基础服务</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/314d26/" class="nav-link">Kvm</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/44e450/" class="nav-link">Ansible</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/8292d8/" class="nav-link">Git</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="区块链" class="dropdown-title"><a href="/CodeVault/pages/f3ea9f/" class="link-title">区块链</a> <span class="title" style="display:none;">区块链</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>FISCO BCOS</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/f3ea9f/" class="nav-link">WeBASE搭建</a></li></ul></li><li class="dropdown-item"><h4>2023年TASK挑战赛上</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/685f1f/" class="nav-link">碳排放解决方案</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/3f1596/" class="nav-link">慈善公益解决方案</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/cc43be/" class="nav-link">构造交易传入AppID</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/75ddc8/" class="nav-link">合约时间触发器</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/9bcc7c/" class="nav-link">一键部署环境脚本</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/a93fcf/" class="nav-link">合约调用机制与并行合约</a></li></ul></li><li class="dropdown-item"><h4>2023年TASK挑战赛下</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CodeVault/pages/1fdb40/" class="nav-link">DDCMS后端容器化</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/795b78/" class="nav-link">DDCMS第三方登录</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/a99040/" class="nav-link">DDCMS智能合约设计</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/cb310d/" class="nav-link">DDCMS部署和运维</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/0b1c5a/" class="nav-link">DDCMS接口报错</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/99df38/" class="nav-link">合约大小限制优化</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/f8a343/" class="nav-link">并行合约最佳实践</a></li><li class="dropdown-subitem"><a href="/CodeVault/pages/3d3086/" class="nav-link">一文搞懂Truffle测试</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/CodeVault/pages/e3d908/" class="nav-link">记录</a></div> <a href="https://github.com/CN-ZHANGYH/CodeVault" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>学习笔记</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/CodeVault/pages/46159d/" class="sidebar-link">初识Kubernetes</a></li><li><a href="/CodeVault/pages/ff772d/" class="sidebar-link">kubeadm安装kubernetes</a></li><li><a href="/CodeVault/pages/9f3db7/" class="sidebar-link">Centos7基于Containerd部署Kubernetes v1.23.5</a></li><li><a href="/CodeVault/pages/e46184/" class="sidebar-link">Kubernetes的基础操作</a></li><li><a href="/CodeVault/pages/3ce2fd/" class="sidebar-link">Kubernetes监控与日志管理</a></li><li><a href="/CodeVault/pages/3738ba/" aria-current="page" class="active sidebar-link">Kubernetes应用程序生命周期管理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/CodeVault/pages/3738ba/#应用程序生命周期管理" class="sidebar-link">应用程序生命周期管理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#使用deployment部署java应用" class="sidebar-link">使用Deployment部署Java应用</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#服务编排-yaml文件格式说明" class="sidebar-link">服务编排：YAML文件格式说明</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#服务编排-yaml文件创建资源对象" class="sidebar-link">服务编排：YAML文件创建资源对象</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#服务编排-yaml文件创建资源对象-2" class="sidebar-link">服务编排：YAML文件创建资源对象</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#资源字段多的问题" class="sidebar-link">资源字段多的问题</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/CodeVault/pages/3738ba/#pod" class="sidebar-link">Pod</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#pod对象-基本概念" class="sidebar-link">Pod对象：基本概念</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#如何使用-pod" class="sidebar-link">如何使用 Pod</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#pod-怎样管理多个容器" class="sidebar-link">Pod 怎样管理多个容器</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#pod-使用" class="sidebar-link">Pod 使用</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#pod-模版" class="sidebar-link">Pod 模版</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#pod-更新与替换" class="sidebar-link">Pod 更新与替换</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#容器探针" class="sidebar-link">容器探针</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#pod-的生命周期" class="sidebar-link">Pod 的生命周期</a></li><li class="sidebar-sub-header level4"><a href="/CodeVault/pages/3738ba/#pod-生命期" class="sidebar-link">Pod 生命期</a></li><li class="sidebar-sub-header level4"><a href="/CodeVault/pages/3738ba/#pod-阶段" class="sidebar-link">Pod 阶段</a></li><li class="sidebar-sub-header level4"><a href="/CodeVault/pages/3738ba/#容器状态" class="sidebar-link">容器状态</a></li><li class="sidebar-sub-header level4"><a href="/CodeVault/pages/3738ba/#容器重启策略" class="sidebar-link">容器重启策略</a></li><li class="sidebar-sub-header level4"><a href="/CodeVault/pages/3738ba/#pod-状况" class="sidebar-link">Pod 状况</a></li><li class="sidebar-sub-header level4"><a href="/CodeVault/pages/3738ba/#pod-就绪态" class="sidebar-link">Pod 就绪态</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#容器探针-2" class="sidebar-link">容器探针</a></li><li class="sidebar-sub-header level4"><a href="/CodeVault/pages/3738ba/#何时该使用存活态探针" class="sidebar-link">何时该使用存活态探针?</a></li><li class="sidebar-sub-header level4"><a href="/CodeVault/pages/3738ba/#何时该使用就绪态探针" class="sidebar-link">何时该使用就绪态探针?</a></li><li class="sidebar-sub-header level4"><a href="/CodeVault/pages/3738ba/#何时该使用启动探针" class="sidebar-link">何时该使用启动探针？</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#pod对象-管理命令" class="sidebar-link">Pod对象：管理命令</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#pod对象-重启策略-健康检查" class="sidebar-link">Pod对象：重启策略+健康检查</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#重启策略" class="sidebar-link">重启策略</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#健康检查有以下两种类型" class="sidebar-link">健康检查有以下两种类型</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#支持以下三种检查方法" class="sidebar-link">支持以下三种检查方法</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#pod对象-lnit-container" class="sidebar-link">Pod对象：lnit Container</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#pod对象-静态pod" class="sidebar-link">Pod对象：静态Pod</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#静态pod的特点" class="sidebar-link">静态Pod的特点：</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#在kubelet配置文件中启用静态pod" class="sidebar-link">在kubelet配置文件中启用静态Pod：</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/CodeVault/pages/3738ba/#deployment" class="sidebar-link">Deployment</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#deployment-应用生命周期管理流程" class="sidebar-link">Deployment：应用生命周期管理流程</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#deployment-部署应用" class="sidebar-link">Deployment：部署应用</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#deployment-滚动升级" class="sidebar-link">Deployment：滚动升级</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#deployment-水平扩缩容" class="sidebar-link">Deployment：水平扩缩容</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#deployment-回滚" class="sidebar-link">Deployment：回滚</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#deployment-删除" class="sidebar-link">Deployment：删除</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#deployment-滚动升级与回滚实现机制" class="sidebar-link">Deployment：滚动升级与回滚实现机制</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/CodeVault/pages/3738ba/#replicationcontroller和replicaset" class="sidebar-link">ReplicationController和ReplicaSet</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#replicationcontroller" class="sidebar-link">ReplicationController</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#replicationcontroller的使用" class="sidebar-link">ReplicationController的使用</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#便捷的进行扩容和缩容" class="sidebar-link">便捷的进行扩容和缩容</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/CodeVault/pages/3738ba/#replicaset" class="sidebar-link">ReplicaSet</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#replicaset控制器用途" class="sidebar-link">ReplicaSet控制器用途：</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#replicaset的使用" class="sidebar-link">ReplicaSet的使用</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/CodeVault/pages/3738ba/#hpa" class="sidebar-link">HPA</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#hpa的简要概述" class="sidebar-link">HPA的简要概述</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#安装metrics-server" class="sidebar-link">安装Metrics Server</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#hpa的使用" class="sidebar-link">HPA的使用</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#模拟增加负载" class="sidebar-link">模拟增加负载</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/CodeVault/pages/3738ba/#job-和-cronjob" class="sidebar-link">Job 和 Cronjob</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#job的使用" class="sidebar-link">Job的使用</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#cronjob的使用" class="sidebar-link">CronJob的使用</a></li><li class="sidebar-sub-header level3"><a href="/CodeVault/pages/3738ba/#cron-时间表语法" class="sidebar-link">Cron 时间表语法</a></li></ul></li></ul></li><li><a href="/CodeVault/pages/b5d485/" class="sidebar-link">Kubernetes调度</a></li><li><a href="/CodeVault/pages/c7deaf/" class="sidebar-link">Kubernetes网络</a></li><li><a href="/CodeVault/pages/ed6cb5/" class="sidebar-link">Kubernetes存储</a></li><li><a href="/CodeVault/pages/de082c/" class="sidebar-link">Kubernetes安全</a></li><li><a href="/CodeVault/pages/256223/" class="sidebar-link">Kubernetes集群维护</a></li><li><a href="/CodeVault/pages/24d932/" class="sidebar-link">Kubernetes故障排查</a></li><li><a href="/CodeVault/pages/d13a63/" class="sidebar-link">Helm包管理</a></li><li><a href="/CodeVault/pages/a2b2e9/" class="sidebar-link">Kubernetes 高级运维</a></li><li><a href="/CodeVault/pages/79ca6c/" class="sidebar-link">NFS做Kubernetes的后端存储</a></li><li><a href="/CodeVault/pages/af5bae/" class="sidebar-link">GlusterFs对接K8S</a></li><li><a href="/CodeVault/pages/2e6a5b/" class="sidebar-link">Ceph对接K8S存储使用RBD</a></li><li><a href="/CodeVault/pages/c741d8/" class="sidebar-link">Rook构建Ceph云原生存储</a></li><li><a href="/CodeVault/pages/a5e623/" class="sidebar-link">Kubectl多集群配置</a></li><li><a href="/CodeVault/pages/a19b63/" class="sidebar-link">为系统守护进程预留计算资源</a></li><li><a href="/CodeVault/pages/770b73/" class="sidebar-link">Kubernetes（k8s）Helm v3 部署 EFK 日志系统</a></li><li><a href="/CodeVault/pages/53253e/" class="sidebar-link">Kubernetes Python Client</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>CKS认证</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/CodeVault/pages/f87a46/" class="sidebar-link">K8S集群部署与安全配置</a></li><li><a href="/CodeVault/pages/0afbf4/" class="sidebar-link">集群强化</a></li><li><a href="/CodeVault/pages/b1d55f/" class="sidebar-link">K8s容器运行环境安全加固</a></li><li><a href="/CodeVault/pages/a07736/" class="sidebar-link">最小化微服务漏洞</a></li><li><a href="/CodeVault/pages/203728/" class="sidebar-link">供应链安全</a></li><li><a href="/CodeVault/pages/1ac8ea/" class="sidebar-link">监控、审计和运行时安全</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Operator</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/CodeVault/pages/2d432e/" class="sidebar-link">深入理解 Kubernetes Operator</a></li><li><a href="/CodeVault/pages/4b0d17/" class="sidebar-link">RESTClient原理</a></li><li><a href="/CodeVault/pages/91f3df/" class="sidebar-link">基于Client-go访问Kubernetes API</a></li><li><a href="/CodeVault/pages/ea64f1/" class="sidebar-link">Kubernetes CRD详解</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/CodeVault/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>K8S</span></li><li data-v-06225672><span data-v-06225672>学习笔记</span></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/cn-zhangyh" target="_blank" title="作者" class="beLink" data-v-06225672>Yyzop</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-01-22</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">Kubernetes应用程序生命周期管理<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="kubernetes应用程序生命周期管理"><a href="#kubernetes应用程序生命周期管理" class="header-anchor">#</a> Kubernetes应用程序生命周期管理</h1> <h2 id="应用程序生命周期管理"><a href="#应用程序生命周期管理" class="header-anchor">#</a> 应用程序生命周期管理</h2> <p><strong>在Kubernetes中部署应用流程</strong></p> <p><strong>服务编排（YAML）</strong></p> <p><strong>Deployment工作负载均衡器</strong></p> <ul><li>介绍</li> <li>应用生命周期管理流程</li> <li>应用部署</li> <li>应用升级</li> <li>水平扩缩容 回滚</li> <li>滚动升级与回滚实现机制</li></ul> <img src="https://pic.imgdb.cn/item/61ebeca92ab3f51d911391a7.png" style="zoom:67%;"> <h3 id="使用deployment部署java应用"><a href="#使用deployment部署java应用" class="header-anchor">#</a> 使用Deployment部署Java应用</h3> <p><strong>使用Deployment控制器部署镜像：</strong></p> <p><strong>创建一个Deployment控制器然后镜像使用的时nginx:latest</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl create deployment web --image=nginx:latest deployment.apps/web created</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get deploy </span>
NAME   READY   UP-TO-DATE   AVAILABLE   AGEweb    <span class="token number">0</span>/1     <span class="token number">1</span>            <span class="token number">0</span>           11s
</code></pre></div><p><strong>使用Service将Pod暴露出去：</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl expose deployment web --port=80 --target-port=80 --type=NodePort      service/web exposed</span>
</code></pre></div><p><strong>访问应用：</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get service</span>
NAME         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>        AGE
kubernetes   ClusterIP   <span class="token number">10.96</span>.0.1       <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">443</span>/TCP        11h
web          NodePort    <span class="token number">10.99</span>.251.101   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">80</span>:30746/TCP   3m15shttp://NodeIP:Port     
</code></pre></div><h3 id="服务编排-yaml文件格式说明"><a href="#服务编排-yaml文件格式说明" class="header-anchor">#</a> 服务编排：YAML文件格式说明</h3> <p><strong>在此之前学习ansible的时候就有学习过yaml文件格式</strong></p> <p>K8s是一个容器编排引擎，使用YAML文件编排要部署应用，因此在学习之前，应先了解YAML语法格式：</p> <p>• 缩进表示层级关系</p> <p>• 不支持制表符“tab”缩进，使用空格缩进</p> <p>• 通常开头缩进 2 个空格</p> <p>• 字符后缩进 1 个空格，如冒号、逗号等</p> <p>• “---” 表示YAML格式，一个文件的开始</p> <p>• “#”注释</p> <h3 id="服务编排-yaml文件创建资源对象"><a href="#服务编排-yaml文件创建资源对象" class="header-anchor">#</a> 服务编排：YAML文件创建资源对象</h3> <img src="https://pic.imgdb.cn/item/61ebeca92ab3f51d911391b3.png" style="zoom:67%;"> <h3 id="服务编排-yaml文件创建资源对象-2"><a href="#服务编排-yaml文件创建资源对象-2" class="header-anchor">#</a> 服务编排：YAML文件创建资源对象</h3> <img src="https://pic.imgdb.cn/item/61ebeca92ab3f51d911391be.png" style="zoom:67%;"> <blockquote><p><strong>服务编排：资源字段太多，记不住怎么办?</strong></p></blockquote> <p><img src="https://pic.imgdb.cn/item/61ebecb52ab3f51d9113a1b6.png" alt=""></p> <h3 id="资源字段多的问题"><a href="#资源字段多的问题" class="header-anchor">#</a> 资源字段多的问题</h3> <ul><li>用create命令生成</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>$ kubectl create deployment nginx <span class="token parameter variable">--image</span><span class="token operator">=</span>nginx:1.16 <span class="token parameter variable">-o</span> yaml --dry-run   <span class="token operator">&gt;</span> my-deploy.yaml
</code></pre></div><ul><li>用get命令导出</li></ul> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl get deployment nginx -o yaml &gt; my-deploy.yaml
</code></pre></div><ul><li>Pod容器的字段忘记拼写了</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>$ kubectl explain pods.spec.containers
$ kubectl explain deployment
</code></pre></div><h2 id="pod"><a href="#pod" class="header-anchor">#</a> Pod</h2> <h3 id="pod对象-基本概念"><a href="#pod对象-基本概念" class="header-anchor">#</a> Pod对象：基本概念</h3> <ul><li><strong><code>Pod 是可以在 Kubernetes 中创建和管理的、最小的可部署的计算单元。</code></strong></li> <li><em>Pod</em> （就像在鲸鱼荚或者豌豆荚中）是一组（一个或多个） <a href="https://kubernetes.io/zh/docs/concepts/overview/what-is-kubernetes/#why-containers" target="_blank" rel="noopener noreferrer">容器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>； 这些容器共享存储、网络、以及怎样运行这些容器的声明。 Pod 中的内容总是并置（colocated）的并且一同调度，在共享的上下文中运行。 Pod 所建模的是特定于应用的“逻辑主机”，其中包含一个或多个应用容器， 这些容器是相对紧密的耦合在一起的。 在非云环境中，在相同的物理机或虚拟机上运行的应用类似于 在同一逻辑主机上运行的云应用。</li> <li>除了应用容器，Pod 还可以包含在 Pod 启动期间运行的 <a href="https://kubernetes.io/zh/docs/concepts/workloads/pods/init-containers/" target="_blank" rel="noopener noreferrer">Init 容器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。 你也可以在集群中支持<a href="https://kubernetes.io/zh/docs/concepts/workloads/pods/ephemeral-containers/" target="_blank" rel="noopener noreferrer">临时性容器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的情况下，为调试的目的注入临时性容器。</li> <li><strong><code>资源共享和通信：</code></strong>  Pod 使它的成员容器间能够进行数据共享和通信。</li> <li><strong><code>Pod中的存储：</code></strong> 一个 Pod 可以设置一组共享的存储<a href="https://kubernetes.io/zh/docs/concepts/storage/volumes/" target="_blank" rel="noopener noreferrer">卷<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。 Pod 中的所有容器都可以访问该共享卷，从而允许这些容器共享数据。 卷还允许 Pod 中的持久数据保留下来，即使其中的容器需要重新启动。</li></ul> <h3 id="如何使用-pod"><a href="#如何使用-pod" class="header-anchor">#</a> 如何使用 Pod</h3> <p>通常你不需要直接创建 Pod，甚至单实例 Pod。 相反，你会使用诸如 <a href="https://kubernetes.io/zh/docs/concepts/workloads/controllers/deployment/" target="_blank" rel="noopener noreferrer">Deployment<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 或 <a href="https://kubernetes.io/zh/docs/concepts/workloads/controllers/job/" target="_blank" rel="noopener noreferrer">Job<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 这类工作负载资源 来创建 Pod。如果 Pod 需要跟踪状态， 可以考虑 <a href="https://kubernetes.io/zh/docs/concepts/workloads/controllers/statefulset/" target="_blank" rel="noopener noreferrer">StatefulSet<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 资源。</p> <p>你很少在 Kubernetes 中直接创建一个个的 Pod，甚至是单实例（Singleton）的 Pod。 这是因为 Pod 被设计成了相对临时性的、用后即抛的一次性实体。 当 Pod 由你或者间接地由 <a href="https://kubernetes.io/zh/docs/concepts/architecture/controller/" target="_blank" rel="noopener noreferrer">控制器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 创建时，它被调度在集群中的<a href="https://kubernetes.io/zh/docs/concepts/architecture/nodes/" target="_blank" rel="noopener noreferrer">节点<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>上运行。 Pod 会保持在该节点上运行，直到 Pod 结束执行、Pod 对象被删除、Pod 因资源不足而被 <em>驱逐</em> 或者节点失效为止。</p> <p>Kubernetes 集群中的 Pod 主要有两种用法：</p> <ul><li><strong>运行单个容器的 Pod</strong>。&quot;每个 Pod 一个容器&quot;模型是最常见的 Kubernetes 用例； 在这种情况下，可以将 Pod 看作单个容器的包装器，并且 Kubernetes 直接管理 Pod，而不是容器。</li> <li><strong>运行多个协同工作的容器的 Pod</strong>。 Pod 可能封装由多个紧密耦合且需要共享资源的共处容器组成的应用程序。 这些位于同一位置的容器可能形成单个内聚的服务单元 —— 一个容器将文件从共享卷提供给公众， 而另一个单独的“边车”（sidecar）容器则刷新或更新这些文件。 Pod 将这些容器和存储资源打包为一个可管理的实体。</li></ul> <h3 id="pod-怎样管理多个容器"><a href="#pod-怎样管理多个容器" class="header-anchor">#</a> Pod 怎样管理多个容器</h3> <ul><li>Pod 被设计成支持形成内聚服务单元的多个协作过程（形式为容器）。 Pod 中的容器被自动安排到集群中的同一物理机或虚拟机上，并可以一起进行调度。 容器之间可以共享资源和依赖、彼此通信、协调何时以及何种方式终止自身。</li> <li>Pod 天生地为其成员容器提供了两种共享资源：<a href="https://kubernetes.io/zh/docs/concepts/workloads/pods/#pod-networking" target="_blank" rel="noopener noreferrer">网络<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>和 <a href="https://kubernetes.io/zh/docs/concepts/workloads/pods/#pod-storage" target="_blank" rel="noopener noreferrer">存储<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</li></ul> <h3 id="pod-使用"><a href="#pod-使用" class="header-anchor">#</a> Pod 使用</h3> <blockquote><p><strong>说明：</strong> 重启 Pod 中的容器不应与重启 Pod 混淆。 Pod 不是进程，而是容器运行的环境。 在被删除之前，Pod 会一直存在。</p> <p><strong>Pod 和控制器</strong></p> <p><strong>你可以使用工作负载资源来创建和管理多个 Pod。 资源的控制器能够处理副本的管理、上线，并在 Pod 失效时提供自愈能力。 例如，如果一个节点失败，控制器注意到该节点上的 Pod 已经停止工作， 就可以创建替换性的 Pod。调度器会将替身 Pod 调度到一个健康的节点执行。</strong></p></blockquote> <h3 id="pod-模版"><a href="#pod-模版" class="header-anchor">#</a> Pod 模版</h3> <ul><li><a href="https://kubernetes.io/zh/docs/concepts/workloads/" target="_blank" rel="noopener noreferrer">负载<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>资源的控制器通常使用 <em>Pod 模板（Pod Template）</em> 来替你创建 Pod 并管理它们。</li> <li>Pod 模板是包含在工作负载对象中的规范，用来创建 Pod。这类负载资源包括 <a href="https://kubernetes.io/zh/docs/concepts/workloads/controllers/deployment/" target="_blank" rel="noopener noreferrer">Deployment<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、 <a href="https://kubernetes.io/zh/docs/concepts/workloads/controllers/job/" target="_blank" rel="noopener noreferrer">Job<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 和 <a href="https://kubernetes.io/zh/docs/concepts/workloads/controllers/daemonset/" target="_blank" rel="noopener noreferrer">DaemonSets<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>等。</li> <li>工作负载的控制器会使用负载对象中的 <code>PodTemplate</code> 来生成实际的 Pod。 <code>PodTemplate</code> 是你用来运行应用时指定的负载资源的目标状态的一部分。</li></ul> <p>下面的示例是一个简单的 Job 的清单，其中的 <code>template</code> 指示启动一个容器。 该 Pod 中的容器会打印一条消息之后暂停。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> batch/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Job
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> hello
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token comment"># 这里是 Pod 模版</span>
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> hello
        <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox
        <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'sh'</span><span class="token punctuation">,</span> <span class="token string">'-c'</span><span class="token punctuation">,</span> <span class="token string">'echo &quot;Hello, Kubernetes!&quot; &amp;&amp; sleep 3600'</span><span class="token punctuation">]</span>
      <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> OnFailure
</code></pre></div><h3 id="pod-更新与替换"><a href="#pod-更新与替换" class="header-anchor">#</a> Pod 更新与替换</h3> <ul><li>修改 Pod 模版或者切换到新的 Pod 模版都不会对已经存在的 Pod 起作用。 Pod 不会直接收到模版的更新。相反， 新的 Pod 会被创建出来，与更改后的 Pod 模版匹配。</li> <li>当某工作负载的 Pod 模板被改变时，控制器会基于更新的模板 创建新的 Pod 对象而不是对现有 Pod 执行更新或者修补操作。</li> <li>Pod 的绝大多数元数据都是不可变的。例如，你不可以改变其 <code>namespace</code>、<code>name</code>、 <code>uid</code> 或者 <code>creationTimestamp</code> 字段；<code>generation</code> 字段是比较特别的，如果更新 该字段，只能增加字段取值而不能减少。</li> <li>在更新<code>spec.activeDeadlineSeconds</code> 字段时，以下两种更新操作是被允许的：
<ol><li>如果该字段尚未设置，可以将其设置为一个正数；</li> <li>如果该字段已经设置为一个正数，可以将其设置为一个更小的、非负的整数。</li></ol></li></ul> <h3 id="容器探针"><a href="#容器探针" class="header-anchor">#</a> 容器探针</h3> <p><em>Pr+obe</em> 是由 kubelet 对容器执行的定期诊断。要执行诊断，kubelet 可以执行三种动作：</p> <ul><li><code>ExecAction</code>（借助容器运行时执行）</li> <li><code>TCPSocketAction</code>（由 kubelet 直接检测）</li> <li><code>HTTPGetAction</code>（由 kubelet 直接检测）</li></ul> <h3 id="pod-的生命周期"><a href="#pod-的生命周期" class="header-anchor">#</a> Pod 的生命周期</h3> <ul><li>Pod 遵循一个预定义的生命周期，起始于 <code>Pending</code> <a href="https://kubernetes.io/zh/docs/concepts/workloads/pods/pod-lifecycle/#pod-phase" target="_blank" rel="noopener noreferrer">阶段<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，如果至少 其中有一个主要容器正常启动，则进入 <code>Running</code>，之后取决于 Pod 中是否有容器以 失败状态结束而进入 <code>Succeeded</code> 或者 <code>Failed</code> 阶段。</li> <li>在 Pod 运行期间，<code>kubelet</code> 能够重启容器以处理一些失效场景。 在 Pod 内部，Kubernetes 跟踪不同容器的<a href="https://kubernetes.io/zh/docs/concepts/workloads/pods/pod-lifecycle/#container-states" target="_blank" rel="noopener noreferrer">状态<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 并确定使 Pod 重新变得健康所需要采取的动作。</li> <li>Pod 在其生命周期中只会被<a href="https://kubernetes.io/zh/docs/concepts/scheduling-eviction/" target="_blank" rel="noopener noreferrer">调度<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>一次。 一旦 Pod 被调度（分派）到某个节点，Pod 会一直在该节点运行，直到 Pod 停止或者 被<a href="https://kubernetes.io/zh/docs/concepts/workloads/pods/pod-lifecycle/#pod-termination" target="_blank" rel="noopener noreferrer">终止<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</li></ul> <blockquote><h4 id="pod-生命期"><a href="#pod-生命期" class="header-anchor">#</a> Pod 生命期</h4></blockquote> <ul><li>[x] 和一个个独立的应用容器一样，Pod 也被认为是相对临时性（而不是长期存在）的实体。 Pod 会被创建、赋予一个唯一的 ID（<a href="https://kubernetes.io/zh/docs/concepts/overview/working-with-objects/names/#uids" target="_blank" rel="noopener noreferrer">UID<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>）， 并被调度到节点，并在终止（根据重启策略）或删除之前一直运行在该节点。</li> <li>[x] 如果一个<a href="https://kubernetes.io/zh/docs/concepts/architecture/nodes/" target="_blank" rel="noopener noreferrer">节点<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>死掉了，调度到该节点 的 Pod 也被计划在给定超时期限结束后<a href="https://kubernetes.io/zh/docs/concepts/workloads/pods/pod-lifecycle/#pod-garbage-collection" target="_blank" rel="noopener noreferrer">删除<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</li> <li>[x] Pod 自身不具有自愈能力。如果 Pod 被调度到某<a href="https://kubernetes.io/zh/docs/concepts/architecture/nodes/" target="_blank" rel="noopener noreferrer">节点<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 而该节点之后失效，Pod 会被删除；类似地，Pod 无法在因节点资源 耗尽或者节点维护而被驱逐期间继续存活。Kubernetes 使用一种高级抽象 来管理这些相对而言可随时丢弃的 Pod 实例，称作 <a href="https://kubernetes.io/zh/docs/concepts/architecture/controller/" target="_blank" rel="noopener noreferrer">控制器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</li> <li>[x] 任何给定的 Pod （由 UID 定义）从不会被“重新调度（rescheduled）”到不同的节点； 相反，这一 Pod 可以被一个新的、几乎完全相同的 Pod 替换掉。 如果需要，新 Pod 的名字可以不变，但是其 UID 会不同。</li> <li>[x] 如果某物声称其生命期与某 Pod 相同，例如存储<a href="https://kubernetes.io/zh/docs/concepts/storage/volumes/" target="_blank" rel="noopener noreferrer">卷<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>， 这就意味着该对象在此 Pod （UID 亦相同）存在期间也一直存在。 如果 Pod 因为任何原因被删除，甚至某完全相同的替代 Pod 被创建时， 这个相关的对象（例如这里的卷）也会被删除并重建。</li></ul> <blockquote><h4 id="pod-阶段"><a href="#pod-阶段" class="header-anchor">#</a> Pod 阶段</h4></blockquote> <p>Pod 的阶段是 Pod 在其生命周期中所处位置的简单宏观概述。 该阶段并不是对容器或 Pod 状态的综合汇总，也不是为了成为完整的状态机。</p> <table><thead><tr><th><code>Pending</code>（悬决）</th> <th>Pod 已被 Kubernetes 系统接受，但有一个或者多个容器尚未创建亦未运行。此阶段包括等待 Pod 被调度的时间和通过网络下载镜像的时间，</th></tr></thead> <tbody><tr><td><code>Running</code>（运行中）</td> <td>Pod 已经绑定到了某个节点，Pod 中所有的容器都已被创建。至少有一个容器仍在运行，或者正处于启动或重启状态。</td></tr> <tr><td><code>Succeeded</code>（成功）</td> <td>Pod 中的所有容器都已成功终止，并且不会再重启。</td></tr> <tr><td><code>Failed</code>（失败）</td> <td>Pod 中的所有容器都已终止，并且至少有一个容器是因为失败终止。也就是说，容器以非 0 状态退出或者被系统终止。</td></tr> <tr><td><code>Unknown</code>（未知）</td> <td>因为某些原因无法取得 Pod 的状态。这种情况通常是因为与 Pod 所在主机通信失败。</td></tr></tbody></table> <p>如果某节点死掉或者与集群中其他节点失联，Kubernetes 会实施一种策略，将失去的节点上运行的所有 Pod 为 <code>Failed</code>。</p> <blockquote><h4 id="容器状态"><a href="#容器状态" class="header-anchor">#</a> 容器状态</h4></blockquote> <p>Kubernetes 会跟踪 Pod 中每个容器的状态，就像它跟踪 Pod 总体上的<a href="https://kubernetes.io/zh/docs/concepts/workloads/pods/pod-lifecycle/#pod-phase" target="_blank" rel="noopener noreferrer">阶段<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>一样。 你可以使用<a href="https://kubernetes.io/zh/docs/concepts/containers/container-lifecycle-hooks/" target="_blank" rel="noopener noreferrer">容器生命周期回调<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 来在容器生命周期中的特定时间点触发事件。</p> <p>一旦<a href="https://kubernetes.io/docs/reference/generated/kube-scheduler/" target="_blank" rel="noopener noreferrer">调度器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>将 Pod 分派给某个节点，<code>kubelet</code> 就通过 <a href="https://kubernetes.io/zh/docs/setup/production-environment/container-runtimes" target="_blank" rel="noopener noreferrer">容器运行时<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 开始为 Pod 创建容器。</p> <p>容器的状态有三种：</p> <ul><li><code>Waiting</code>（等待）</li> <li><code>Running</code>（运行中）</li> <li><code>Terminated</code>（已终止）</li></ul> <blockquote><h4 id="容器重启策略"><a href="#容器重启策略" class="header-anchor">#</a> 容器重启策略</h4></blockquote> <p>Pod 的 <code>spec</code> 中包含一个 <code>restartPolicy</code> 字段，其可能取值包括 Always、OnFailure 和 Never。默认值是 Always。</p> <p><code>restartPolicy</code> 适用于 Pod 中的所有容器。<code>restartPolicy</code> 仅针对同一节点上 <code>kubelet</code> 的容器重启动作。当 Pod 中的容器退出时，<code>kubelet</code> 会按指数回退 方式计算重启的延迟（10s、20s、40s、...），其最长延迟为 5 分钟。 一旦某容器执行了 10 分钟并且没有出现问题，<code>kubelet</code> 对该容器的重启回退计时器执行 重置操作。</p> <blockquote><h4 id="pod-状况"><a href="#pod-状况" class="header-anchor">#</a> Pod 状况</h4></blockquote> <p>Pod 有一个 PodStatus 对象，其中包含一个 <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.22/#podcondition-v1-core" target="_blank" rel="noopener noreferrer">PodConditions<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 数组。Pod 可能通过也可能未通过其中的一些状况测试。</p> <ul><li><code>PodScheduled</code>：Pod 已经被调度到某节点；</li> <li><code>ContainersReady</code>：Pod 中所有容器都已就绪；</li> <li><code>Initialized</code>：所有的 <a href="https://kubernetes.io/zh/docs/concepts/workloads/pods/init-containers/" target="_blank" rel="noopener noreferrer">Init 容器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 都已成功启动；</li> <li><code>Ready</code>：Pod 可以为请求提供服务，并且应该被添加到对应服务的负载均衡池中</li></ul> <table><thead><tr><th><code>type</code></th> <th>Pod 状况的名称</th></tr></thead> <tbody><tr><td><code>status</code></td> <td>表明该状况是否适用，可能的取值有 &quot;<code>True</code>&quot;, &quot;<code>False</code>&quot; 或 &quot;<code>Unknown</code>&quot;</td></tr> <tr><td><code>lastProbeTime</code></td> <td>上次探测 Pod 状况时的时间戳</td></tr> <tr><td><code>lastTransitionTime</code></td> <td>Pod 上次从一种状态转换到另一种状态时的时间戳</td></tr> <tr><td><code>reason</code></td> <td>机器可读的、驼峰编码（UpperCamelCase）的文字，表述上次状况变化的原因</td></tr> <tr><td><code>message</code></td> <td>人类可读的消息，给出上次状态转换的详细信息</td></tr></tbody></table> <blockquote><h4 id="pod-就绪态"><a href="#pod-就绪态" class="header-anchor">#</a> Pod 就绪态</h4></blockquote> <ul><li><p><strong>FEATURE STATE:</strong> <code>Kubernetes v1.14 [stable]</code></p></li> <li><p>你的应用可以向 PodStatus 中注入额外的反馈或者信号：<em>Pod Readiness（Pod 就绪态）</em>。 要使用这一特性，可以设置 Pod 规约中的 <code>readinessGates</code> 列表，为 kubelet 提供一组额外的状况供其评估 Pod 就绪态时使用。</p></li> <li><p>就绪态门控基于 Pod 的 <code>status.conditions</code> 字段的当前值来做决定。 如果 Kubernetes 无法在 <code>status.conditions</code> 字段中找到某状况，则该状况的 状态值默认为 &quot;<code>False</code>&quot;。</p></li></ul> <h3 id="容器探针-2"><a href="#容器探针-2" class="header-anchor">#</a> 容器探针</h3> <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.22/#probe-v1-core" target="_blank" rel="noopener noreferrer">Probe<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是由 <a href="https://kubernetes.io/zh/docs/reference/command-line-tools-reference/kubelet/" target="_blank" rel="noopener noreferrer">kubelet<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 对容器执行的定期诊断。 要执行诊断，kubelet 调用由容器实现的 <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.22/#handler-v1-core" target="_blank" rel="noopener noreferrer">Handler<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> （处理程序）。有三种类型的处理程序：</p> <ul><li><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.22/#execaction-v1-core" target="_blank" rel="noopener noreferrer">ExecAction<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>： 在容器内执行指定命令。如果命令退出时返回码为 0 则认为诊断成功。</li> <li><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.22/#tcpsocketaction-v1-core" target="_blank" rel="noopener noreferrer">TCPSocketAction<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>： 对容器的 IP 地址上的指定端口执行 TCP 检查。如果端口打开，则诊断被认为是成功的。</li> <li><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.22/#httpgetaction-v1-core" target="_blank" rel="noopener noreferrer">HTTPGetAction<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>： 对容器的 IP 地址上指定端口和路径执行 HTTP Get 请求。如果响应的状态码大于等于 200 且小于 400，则诊断被认为是成功的。</li></ul> <p>每次探测都将获得以下三种结果之一：</p> <ul><li><code>Success</code>（成功）：容器通过了诊断。</li> <li><code>Failure</code>（失败）：容器未通过诊断。</li> <li><code>Unknown</code>（未知）：诊断失败，因此不会采取任何行动。</li></ul> <p>针对运行中的容器，<code>kubelet</code> 可以选择是否执行以下三种探针，以及如何针对探测结果作出反应：</p> <ul><li><p><code>livenessProbe</code>：指示容器是否正在运行。如果存活态探测失败，则 kubelet 会杀死容器， 并且容器将根据其<a href="https://kubernetes.io/zh/docs/concepts/workloads/pods/pod-lifecycle/#restart-policy" target="_blank" rel="noopener noreferrer">重启策略<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>决定未来。如果容器不提供存活探针， 则默认状态为 <code>Success</code>。</p></li> <li><p><code>readinessProbe</code>：指示容器是否准备好为请求提供服务。如果就绪态探测失败， 端点控制器将从与 Pod 匹配的所有服务的端点列表中删除该 Pod 的 IP 地址。 初始延迟之前的就绪态的状态值默认为 <code>Failure</code>。 如果容器不提供就绪态探针，则默认状态为 <code>Success</code>。</p></li> <li><p><code>startupProbe</code>: 指示容器中的应用是否已经启动。如果提供了启动探针，则所有其他探针都会被 禁用，直到此探针成功为止。如果启动探测失败，<code>kubelet</code> 将杀死容器，而容器依其 <a href="https://kubernetes.io/zh/docs/concepts/workloads/pods/pod-lifecycle/#restart-policy" target="_blank" rel="noopener noreferrer">重启策略<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>进行重启。 如果容器没有提供启动探测，则默认状态为 <code>Success</code>。</p></li> <li><h4 id="何时该使用存活态探针"><a href="#何时该使用存活态探针" class="header-anchor">#</a> 何时该使用存活态探针?</h4> <ul><li><strong>FEATURE STATE:</strong> <code>Kubernetes v1.0 [stable]</code></li> <li>如果容器中的进程能够在遇到问题或不健康的情况下自行崩溃，则不一定需要存活态探针; <code>kubelet</code> 将根据 Pod 的<code>restartPolicy</code> 自动执行修复操作。</li> <li>如果你希望容器在探测失败时被杀死并重新启动，那么请指定一个存活态探针， 并指定<code>restartPolicy</code> 为 &quot;<code>Always</code>&quot; 或 &quot;<code>OnFailure</code>&quot;。</li></ul></li> <li><h4 id="何时该使用就绪态探针"><a href="#何时该使用就绪态探针" class="header-anchor">#</a> 何时该使用就绪态探针?</h4> <ul><li><p><strong>FEATURE STATE:</strong> <code>Kubernetes v1.0 [stable]</code></p></li> <li><p>如果要仅在探测成功时才开始向 Pod 发送请求流量，请指定就绪态探针。 在这种情况下，就绪态探针可能与存活态探针相同，但是规约中的就绪态探针的存在意味着 Pod 将在启动阶段不接收任何数据，并且只有在探针探测成功后才开始接收数据。</p></li> <li><p>如果你希望容器能够自行进入维护状态，也可以指定一个就绪态探针，检查某个特定于 就绪态的因此不同于存活态探测的端点。</p></li> <li><p>如果你的应用程序对后端服务有严格的依赖性，你可以同时实现存活态和就绪态探针。 当应用程序本身是健康的，存活态探针检测通过后，就绪态探针会额外检查每个所需的后端服务是否可用。 这可以帮助你避免将流量导向只能返回错误信息的 Pod。</p></li> <li><p><strong>说明：</strong></p> <p><strong><code>请注意，如果你只是想在 Pod 被删除时能够排空请求，则不一定需要使用就绪态探针； 在删除 Pod 时，Pod 会自动将自身置于未就绪状态，无论就绪态探针是否存在。 等待 Pod 中的容器停止期间，Pod 会一直处于未就绪状态。</code></strong></p></li></ul></li> <li><h4 id="何时该使用启动探针"><a href="#何时该使用启动探针" class="header-anchor">#</a> 何时该使用启动探针？</h4> <ul><li><p><strong>FEATURE STATE:</strong> <code>Kubernetes v1.18 [beta]</code></p></li> <li><p>对于所包含的容器需要较长时间才能启动就绪的 Pod 而言，启动探针是有用的。 你不再需要配置一个较长的存活态探测时间间隔，只需要设置另一个独立的配置选定， 对启动期间的容器执行探测，从而允许使用远远超出存活态时间间隔所允许的时长。</p></li> <li><p>如果你的容器启动时间通常超出 <code>initialDelaySeconds + failureThreshold × periodSeconds</code> 总值，你应该设置一个启动探测，对存活态探针所使用的同一端点执行检查。 <code>periodSeconds</code> 的默认值是 10 秒。你应该将其 <code>failureThreshold</code> 设置得足够高， 以便容器有充足的时间完成启动，并且避免更改存活态探针所使用的默认值。 这一设置有助于减少死锁状况的发生。</p></li></ul></li></ul> <h3 id="pod对象-管理命令"><a href="#pod对象-管理命令" class="header-anchor">#</a> Pod对象：管理命令</h3> <p><strong>创建Pod</strong></p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># vim pod.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> web
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> container1
    <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx

$ kubectl apply  <span class="token punctuation">-</span>f pod.yaml 
pod/web created
$ kubectl get pods 
NAME   READY   STATUS    RESTARTS   AGE
web    1/1     Running   0          2m23s
</code></pre></div><p><strong>查看Pod</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ kubectl get pods 
$ kubectl describe pod <span class="token operator">&lt;</span>Pod名称<span class="token operator">&gt;</span>
</code></pre></div><p><strong>查看日志</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ kubectl logs <span class="token operator">&lt;</span>Pod名称<span class="token operator">&gt;</span> <span class="token punctuation">[</span>-c container<span class="token punctuation">]</span>
$ kubectl logs <span class="token operator">&lt;</span>Pod名称<span class="token operator">&gt;</span> <span class="token punctuation">[</span>-c container<span class="token punctuation">]</span> <span class="token parameter variable">-f</span> 

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl logs web container1 </span>
/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration
/docker-entrypoint.sh: Looking <span class="token keyword">for</span> shell scripts <span class="token keyword">in</span> /docker-entrypoint.d/
/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh
<span class="token number">10</span>-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf
<span class="token number">10</span>-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 <span class="token keyword">in</span> /etc/nginx/conf.d/default.conf
/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh
/docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh
/docker-entrypoint.sh: Configuration complete<span class="token punctuation">;</span> ready <span class="token keyword">for</span> start up
<span class="token number">2021</span>/10/27 02:26:25 <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: using the &quot;epoll&quot; event method</span>
<span class="token number">2021</span>/10/27 02:26:25 <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: nginx/1.21.3</span>
<span class="token number">2021</span>/10/27 02:26:25 <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: built by gcc 8.3.0 (Debian 8.3.0-6) </span>
<span class="token number">2021</span>/10/27 02:26:25 <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: OS: Linux 3.10.0-862.2.3.el7.x86_64</span>
<span class="token number">2021</span>/10/27 02:26:25 <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576</span>
<span class="token number">2021</span>/10/27 02:26:25 <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: start worker processes</span>
<span class="token number">2021</span>/10/27 02:26:25 <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: start worker process 31</span>
<span class="token number">2021</span>/10/27 02:26:25 <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: start worker process 32</span>
</code></pre></div><p><strong>进入容器终端</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ kubectl <span class="token builtin class-name">exec</span> <span class="token operator">&lt;</span>Pod名称<span class="token operator">&gt;</span> <span class="token punctuation">[</span>-c container<span class="token punctuation">]</span> <span class="token parameter variable">--bash</span>
</code></pre></div><p><strong>删除Pod</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ kubectl delete pod <span class="token operator">&lt;</span>Pod名称<span class="token operator">&gt;</span>
</code></pre></div><h3 id="pod对象-重启策略-健康检查"><a href="#pod对象-重启策略-健康检查" class="header-anchor">#</a> Pod对象：重启策略+健康检查</h3> <h3 id="重启策略"><a href="#重启策略" class="header-anchor">#</a> <code>重启策略</code></h3> <ul><li><p><code>Always：</code> 当容器终止退出后，总是重启容器，默认策略。</p></li> <li><p><code>OnFailure：</code> 当容器异常退出后，（退出状态码非0）时，才重启容器。</p></li> <li><p><code>Never：</code> 当容器终止退出，从不重启容器。</p></li></ul> <h3 id="健康检查有以下两种类型"><a href="#健康检查有以下两种类型" class="header-anchor">#</a> <code>健康检查有以下两种类型</code></h3> <ul><li><p><code>livenessProbe（存活检查）：</code>  如果检查失败，将杀死容器，根据Pod的restartPolicy来操作。</p></li> <li><p><code>readinessProbe（就绪检查）：</code>  如果检查失败，Kubernetes会把Pod从service endpoints中剔除。</p></li></ul> <h3 id="支持以下三种检查方法"><a href="#支持以下三种检查方法" class="header-anchor">#</a> <code>支持以下三种检查方法</code></h3> <ul><li><p><code>httpGet：</code>  发送http请求，返回200-400范围状态码为成功。</p></li> <li><p><code>exec：</code> 执行Shell命令返回状态码是0为成功。</p></li> <li><p><code>tcpSocket：</code>  发起TCP Socket建立成功。</p></li></ul> <p><strong>端口探测</strong></p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat pod.yaml  </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> web
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> Always		   <span class="token comment">#重启策略 </span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
    <span class="token key atrule">name</span><span class="token punctuation">:</span> web
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token key atrule">readinessProbe</span><span class="token punctuation">:</span> 		   <span class="token comment">#端口探测</span>
      <span class="token key atrule">tcpSocket</span><span class="token punctuation">:</span> 
        <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span> 			   <span class="token comment">#探测的端口是80	</span>
      <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">30</span>  <span class="token comment">#启动容器后多少秒健康检查</span>
      <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>        <span class="token comment">#以后间隔多少秒检查一次</span>
        
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f pod.yaml        </span>
pod/web created
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get  pods </span>
NAME   READY   STATUS    RESTARTS   AGE
web    0/1     Running   0          97s

需要等到端口探测完成之后才能ready
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get  pods </span>
NAME   READY   STATUS    RESTARTS   AGE
web    1/1     Running   0          97s
</code></pre></div><p><strong>http请求的健康检查</strong></p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># vim pod.yaml  </span>
      <span class="token key atrule">tcpSocket</span><span class="token punctuation">:</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> web
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
    <span class="token key atrule">name</span><span class="token punctuation">:</span> web
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token key atrule">readinessProbe</span><span class="token punctuation">:</span>
      <span class="token key atrule">httpGet</span><span class="token punctuation">:</span>
        <span class="token key atrule">path</span><span class="token punctuation">:</span> /index.html
        <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">30</span>
      <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
      

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f pod.yaml  </span>
pod/web created

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods </span>
NAME   READY   STATUS    RESTARTS   AGE
web    0/1     Running   0          19s
</code></pre></div><p><strong>查看日志检查是否有健康检查成功</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl logs web web -f </span>
/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration
/docker-entrypoint.sh: Looking <span class="token keyword">for</span> shell scripts <span class="token keyword">in</span> /docker-entrypoint.d/
/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh
<span class="token number">10</span>-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf
<span class="token number">10</span>-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 <span class="token keyword">in</span> /etc/nginx/conf.d/default.conf
/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh
/docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh
/docker-entrypoint.sh: Configuration complete<span class="token punctuation">;</span> ready <span class="token keyword">for</span> start up
<span class="token number">2021</span>/10/27 <span class="token number">12</span>:10:13 <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: using the &quot;epoll&quot; event method</span>
<span class="token number">2021</span>/10/27 <span class="token number">12</span>:10:13 <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: nginx/1.21.3</span>
<span class="token number">2021</span>/10/27 <span class="token number">12</span>:10:13 <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: built by gcc 8.3.0 (Debian 8.3.0-6) </span>
<span class="token number">2021</span>/10/27 <span class="token number">12</span>:10:13 <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: OS: Linux 3.10.0-862.2.3.el7.x86_64</span>
<span class="token number">2021</span>/10/27 <span class="token number">12</span>:10:13 <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576</span>
<span class="token number">2021</span>/10/27 <span class="token number">12</span>:10:13 <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: start worker processes</span>
<span class="token number">2021</span>/10/27 <span class="token number">12</span>:10:13 <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: start worker process 31</span>
<span class="token number">2021</span>/10/27 <span class="token number">12</span>:10:13 <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: start worker process 32</span>
<span class="token number">172.25</span>.253.138 - - <span class="token punctuation">[</span><span class="token number">27</span>/Oct/2021:12:10:45 +0000<span class="token punctuation">]</span> <span class="token string">&quot;GET /index.html HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">615</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;kube-probe/1.20&quot;</span> <span class="token string">&quot;-&quot;</span>
<span class="token number">172.25</span>.253.138 - - <span class="token punctuation">[</span><span class="token number">27</span>/Oct/2021:12:10:55 +0000<span class="token punctuation">]</span> <span class="token string">&quot;GET /index.html HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">615</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;kube-probe/1.20&quot;</span> <span class="token string">&quot;-&quot;</span>
</code></pre></div><p><strong>示例：执行Shell命令</strong></p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span> 
  <span class="token key atrule">exec</span><span class="token punctuation">:</span> 
    <span class="token key atrule">command</span><span class="token punctuation">:</span> 
    <span class="token punctuation">-</span> cat
    <span class="token punctuation">-</span> /tmp/healthy
</code></pre></div><p><strong>示例：HTTP请求</strong></p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span> 
  <span class="token key atrule">httpGet</span><span class="token punctuation">:</span> 
    <span class="token key atrule">path</span><span class="token punctuation">:</span> /healthz 
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
    <span class="token key atrule">httpHeaders</span><span class="token punctuation">:</span> 
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Custom<span class="token punctuation">-</span>Header
      <span class="token key atrule">value</span><span class="token punctuation">:</span> Awesome
</code></pre></div><h3 id="pod对象-lnit-container"><a href="#pod对象-lnit-container" class="header-anchor">#</a> Pod对象：lnit Container</h3> <p><strong>lnit Container： 顾名思义，用于初始化工作，执行完就结束，可以理解为一次性任务。</strong></p> <ul><li><code>支持大部分应用容器配置，但不支持健康检查</code></li> <li><code>优先应用容器执行</code></li></ul> <p><strong>应用场景：</strong></p> <ul><li><code>环境检查： 例如确保应用容器依赖的服务启动后再启动应用容器</code></li> <li><code>初始化配置： 例如给应用容器准备配置文件</code></li></ul> <p><strong>示例：部署一个web网站，网站程序没有打包到镜像中，而是希望从代码仓库中动态拉取放到应用容器中。</strong></p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat init-container.yaml  </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> init<span class="token punctuation">-</span>demo
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">initContainers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox
    <span class="token key atrule">name</span><span class="token punctuation">:</span> init<span class="token punctuation">-</span>demo
    <span class="token key atrule">command</span><span class="token punctuation">:</span> 
    <span class="token punctuation">-</span> wget 
    <span class="token punctuation">-</span> <span class="token string">&quot;-O&quot;</span>
    <span class="token punctuation">-</span> <span class="token string">&quot;/opt/index.html&quot;</span>
    <span class="token punctuation">-</span> <span class="token string">&quot;http://www.ctnrs.com&quot;</span>
    <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> wwwroot
      <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> <span class="token string">&quot;/opt&quot;</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span> 
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx 
    <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx 
    <span class="token key atrule">ports</span><span class="token punctuation">:</span> 
    <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span> 
    <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span> 
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> wwwroot 
      <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /usr/share/nginx/html 
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span> 
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> wwwroot 
    <span class="token key atrule">emptyDir</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f init-container.yaml  </span>
pod/init-demo created
</code></pre></div><p><strong>因此，Pod中会有这几种类型的容器：</strong></p> <ul><li><p><strong><code>Infrastructure Container:</code></strong> 基础容器</p> <ul><li>维护整个Pod的网络</li></ul></li> <li><p><strong><code>InitContainers：</code></strong> 初始化容器</p> <ul><li>先于业务容器开始执行</li></ul></li> <li><p><strong><code>Containers：</code></strong> 业务容器</p> <ul><li>并行启动</li></ul></li></ul> <h3 id="pod对象-静态pod"><a href="#pod对象-静态pod" class="header-anchor">#</a> Pod对象：静态Pod</h3> <ul><li><p><em>静态 Pod（Static Pod）</em> 直接由特定节点上的 <code>kubelet</code> 守护进程管理， 不需要<a href="https://kubernetes.io/zh/docs/reference/command-line-tools-reference/kube-apiserver/" target="_blank" rel="noopener noreferrer">API 服务器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>看到它们。 尽管大多数 Pod 都是通过控制面（例如，<a href="https://kubernetes.io/zh/docs/concepts/workloads/controllers/deployment/" target="_blank" rel="noopener noreferrer">Deployment<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>） 来管理的，对于静态 Pod 而言，<code>kubelet</code> 直接监控每个 Pod，并在其失效时重启之。</p></li> <li><p>静态 Pod 通常绑定到某个节点上的 <a href="https://kubernetes.io/docs/reference/generated/kubelet" target="_blank" rel="noopener noreferrer">kubelet<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。 其主要用途是运行自托管的控制面。 在自托管场景中，使用 <code>kubelet</code> 来管理各个独立的 <a href="https://kubernetes.io/zh/docs/concepts/overview/components/#control-plane-components" target="_blank" rel="noopener noreferrer">控制面组件<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p></li> <li><p><code>kubelet</code> 自动尝试为每个静态 Pod 在 Kubernetes API 服务器上创建一个 <a href="https://kubernetes.io/zh/docs/reference/glossary/?all=true#term-mirror-pod" target="_blank" rel="noopener noreferrer">镜像 Pod<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。 这意味着在节点上运行的 Pod 在 API 服务器上是可见的，但不可以通过 API 服务器来控制。</p></li> <li><p><strong>说明：</strong></p> <p>静态 Pod 的 <code>spec</code> 不能引用其他的 API 对象（例如：<a href="https://kubernetes.io/zh/docs/tasks/configure-pod-container/configure-service-account/" target="_blank" rel="noopener noreferrer">ServiceAccount<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、<a href="https://kubernetes.io/zh/docs/tasks/configure-pod-container/configure-pod-configmap/" target="_blank" rel="noopener noreferrer">ConfigMap<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、<a href="https://kubernetes.io/zh/docs/concepts/configuration/secret/" target="_blank" rel="noopener noreferrer">Secret<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>等）。</p></li></ul> <h3 id="静态pod的特点"><a href="#静态pod的特点" class="header-anchor">#</a> 静态Pod的特点：</h3> <ul><li><strong>Pod由特定节点上的kubelet管理</strong></li> <li><strong>不能使用控制器</strong></li> <li><strong>Pod的名称标识当前节点的名称</strong></li> <li><strong>在kubelet的配置文件下启动Pod无法使用kubectl删除，只能删除yaml文件，方便更新数据</strong></li></ul> <h3 id="在kubelet配置文件中启用静态pod"><a href="#在kubelet配置文件中启用静态pod" class="header-anchor">#</a> 在kubelet配置文件中启用静态Pod：</h3> <div class="language-http extra-class"><pre class="language-http"><code>[root@master ~]# cat /var/lib/kubelet/config.yaml | grep staticPodPath:
<span class="token header"><span class="token header-name keyword">staticPodPath</span><span class="token punctuation">:</span> <span class="token header-value">/etc/kubernetes/manifests</span></span>
</code></pre></div><div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cd /etc/kubernetes/manifests/</span>
<span class="token punctuation">[</span>root@master manifests<span class="token punctuation">]</span><span class="token comment"># vim pod.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">run</span><span class="token punctuation">:</span> mypod1
  <span class="token key atrule">name</span><span class="token punctuation">:</span> static<span class="token punctuation">-</span>pod
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox
    <span class="token key atrule">name</span><span class="token punctuation">:</span> mypod1
    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;/bin/sh&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-c&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;sleep 360000&quot;</span><span class="token punctuation">]</span>
</code></pre></div><h2 id="deployment"><a href="#deployment" class="header-anchor">#</a> Deployment</h2> <img src="https://pic.imgdb.cn/item/61ebecb52ab3f51d9113a1c2.png" style="zoom:67%;"> <h3 id="deployment-应用生命周期管理流程"><a href="#deployment-应用生命周期管理流程" class="header-anchor">#</a> Deployment：应用生命周期管理流程</h3> <img src="https://pic.imgdb.cn/item/61ebecb52ab3f51d9113a1cb.png" style="zoom:67%;"> <h3 id="deployment-部署应用"><a href="#deployment-部署应用" class="header-anchor">#</a> Deployment：部署应用</h3> <ul><li><strong>创建deployment的yaml文件</strong></li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat deployment.yaml  </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> web
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span> 				<span class="token comment"># Pod副本预期数量</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> web
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> web 			<span class="token comment"># Pod副本的标签</span>
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> web
        <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
</code></pre></div><ul><li><strong>部署nginx镜像</strong></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f deployment.yaml  </span>
deployment.apps/web unchanged
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get  deployment </span>
NAME   READY   UP-TO-DATE   AVAILABLE   AGE
web    <span class="token number">2</span>/3     <span class="token number">2</span>            <span class="token number">2</span>           3m
</code></pre></div><h3 id="deployment-滚动升级"><a href="#deployment-滚动升级" class="header-anchor">#</a> Deployment：滚动升级</h3> <p><strong><code>第二步：应用升级（更新镜像三种方式）</code></strong></p> <ul><li>kubectl apply -f xxx.yaml</li> <li>kubectl set image deployment/web nginx=nginx:1.16</li> <li>kubectl edit deployment/web</li> <li>滚动升级：K8s对Pod升级的默认策略，通过使 用新版本Pod逐步更新旧版本Pod，实现零停机 发布，用户无感知。</li></ul> <p><strong>使用kubectl set实现滚动升级</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment">#  kubectl set image deployment/web  web=nginx:1.16  </span>
deployment.apps/web image updated
</code></pre></div><img src="https://pic.imgdb.cn/item/61ebecb52ab3f51d9113a1d3.png" style="zoom:67%;"> <h3 id="deployment-水平扩缩容"><a href="#deployment-水平扩缩容" class="header-anchor">#</a> Deployment：水平扩缩容</h3> <p><strong><code>第三步：水平扩缩容（启动多实例，提高并发）</code></strong></p> <ul><li><p>修改yaml里replicas值，再apply</p></li> <li><p>kubectl scale deployment web --replicas=10</p> <p>注：replicas参数控制Pod副本数量</p></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl scale deployment/web --replicas=10 </span>
deployment.apps/web scaled

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get  deployment</span>
NAME   READY   UP-TO-DATE   AVAILABLE   AGE
web    <span class="token number">2</span>/10    <span class="token number">0</span>            <span class="token number">2</span>           16m
</code></pre></div><h3 id="deployment-回滚"><a href="#deployment-回滚" class="header-anchor">#</a> Deployment：回滚</h3> <p><strong><code>第四步：回滚（发布失败恢复正常版本）</code></strong></p> <ul><li>kubectl rollout history deployment/web # 查看历史发布版本</li> <li>kubectl rollout undo deployment/web # 回滚上一个版本</li> <li>kubectl rollout undo deployment/web --to-revision=2 # 回滚历史指定版本</li> <li>注：回滚是重新部署某一次部署时的状态，即当时版本所有配置</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl rollout history deployment/web </span>
deployment.apps/web 
REVISION  CHANGE-CAUSE
<span class="token number">1</span>         <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
<span class="token number">2</span>         <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl rollout undo deployment/web        </span>
deployment.apps/web rolled back

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl rollout undo deployment/web --to-revision=2 </span>
deployment.apps/web rolled back
</code></pre></div><h3 id="deployment-删除"><a href="#deployment-删除" class="header-anchor">#</a> Deployment：删除</h3> <p><strong><code>最后，项目下线：</code></strong></p> <ul><li>kubectl delete deploy/web</li> <li>kubectl delete svc/web</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl delete deployment/web </span>
deployment.apps <span class="token string">&quot;web&quot;</span> deleted
</code></pre></div><h3 id="deployment-滚动升级与回滚实现机制"><a href="#deployment-滚动升级与回滚实现机制" class="header-anchor">#</a> Deployment：滚动升级与回滚实现机制</h3> <p><strong><code>滚动更新策略</code></strong></p> <p>每次只升级一个或多个服务，升级完成加入生产环境，不断执行这个过 程，直到集群中的全部旧版升级新版本。</p> <p><strong>特点：</strong></p> <ul><li>用户无感知，平滑过渡</li></ul> <p><strong>缺点：</strong></p> <ul><li>部署周期长</li> <li>发布策略较复杂</li></ul> <h2 id="replicationcontroller和replicaset"><a href="#replicationcontroller和replicaset" class="header-anchor">#</a> ReplicationController和ReplicaSet</h2> <h3 id="replicationcontroller"><a href="#replicationcontroller" class="header-anchor">#</a> ReplicationController</h3> <ul><li><code>实际工作中，很少单独操作Pod的，之所以k8s能够“自愈”，就是通过rc（ReplicationController）、rs（ReplicaSet）、Deployment等这些组件，再加上k8s核心controller工作机制来实现的。</code></li> <li><code>ReplicationController（简称为RC）。</code> 在旧版本的Kubernetes中，只有ReplicationController对象。它的主要作用是确保Pod以你指定的副本数运行，即如果有容器异常退出，会自动创建新的 Pod 来替代；而异常多出来的容器也会自动回收。可以说，通过ReplicationController，Kubernetes实现了集群的高可用性。</li> <li><code>ReplicationController（rc）在新的版本中，已经被ReplicaSet（rs）替换了，相对于rc，rs有更好的标签控制策略。</code>对于pod副本的控制作用，rs和rc的效果是一样的。**</li></ul> <h3 id="replicationcontroller的使用"><a href="#replicationcontroller的使用" class="header-anchor">#</a> ReplicationController的使用</h3> <ul><li>创建一个RC</li> <li>快速生成一个deployment然后修改类型为replicationcontroller</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat  nginx.yaml 									</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1						<span class="token comment">#api的版本用v1，deployment默认是apps/v1</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ReplicationController			<span class="token comment">#指定资源类型是ReplicationController</span>
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>rc
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>						<span class="token comment">#副本控制在3</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>rc					<span class="token comment">#标签选择器</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>rc
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
        <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f replicationcontroller.yaml </span>
replicationcontroller/test<span class="token punctuation">-</span>rc created
</code></pre></div><p><strong>验证操作</strong></p> <ul><li>查看生成的rc，查看pod副本数。</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl delete rc nginx-demo </span>
replicationcontroller <span class="token string">&quot;nginx-demo&quot;</span> deleted
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get rc</span>
NAME      DESIRED   CURRENT   READY   AGE
test-rc   <span class="token number">3</span>         <span class="token number">3</span>         <span class="token number">3</span>       2m53s
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods </span>
NAME            READY   STATUS    RESTARTS   AGE
test-rc-v952c   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3m
test-rc-vr252   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3m
test-rc-x42p9   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3m
</code></pre></div><blockquote><p>操作pod，验证rc的副本控制效果。</p></blockquote> <ul><li>可以直接删除pod，但由于rc设置了目标副本数——3个，所以使用kubectl delete命令删除pod后，又会马上创建一个新的pod，以便维持3个副本。</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods </span>
NAME            READY   STATUS    RESTARTS   AGE
test-rc-v952c   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3m
test-rc-vr252   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3m
test-rc-x42p9   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3m
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl delete pods --all</span>
pod <span class="token string">&quot;test-rc-v952c&quot;</span> deleted
pod <span class="token string">&quot;test-rc-vr252&quot;</span> deleted
pod <span class="token string">&quot;test-rc-x42p9&quot;</span> deleted

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods </span>
NAME            READY   STATUS              RESTARTS   AGE
test-rc-dwqpf   <span class="token number">0</span>/1     ContainerCreating   <span class="token number">0</span>          19s
test-rc-r2pjp   <span class="token number">0</span>/1     ContainerCreating   <span class="token number">0</span>          19s
test-rc-s4j58   <span class="token number">1</span>/1     Running             <span class="token number">0</span>          19s
</code></pre></div><h3 id="便捷的进行扩容和缩容"><a href="#便捷的进行扩容和缩容" class="header-anchor">#</a> <strong>便捷的进行扩容和缩容</strong></h3> <ul><li>对其Pod进行扩展伸缩，扩展到5个副本</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl scale replicationcontroller test-rc --replicas=5</span>
replicationcontroller/test-rc scaled

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods </span>
NAME            READY   STATUS    RESTARTS   AGE
test-rc-dwqpf   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          2m12s
test-rc-f75hw   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          33s
test-rc-r2pjp   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          2m12s
test-rc-s4j58   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          2m12s
test-rc-w6tdr   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          33s
</code></pre></div><h2 id="replicaset"><a href="#replicaset" class="header-anchor">#</a> ReplicaSet</h2> <ul><li><p><strong>Kubernetes官方强烈建议避免直接使用ReplicaSet，而应该通过Deployment来创建RS和Pod。由于ReplicaSet是ReplicationController的代替物，因此用法基本相同，唯一的区别在于ReplicaSet支持集合式的selector。</strong></p></li> <li><p><strong>作为ReplicationController的下一代，支持新的基于集合的标签选择算符。</strong></p></li></ul> <h3 id="replicaset控制器用途"><a href="#replicaset控制器用途" class="header-anchor">#</a> <strong>ReplicaSet控制器用途：</strong></h3> <p><strong>Pod副本数量管理，不断对比当前Pod数量与期望Pod数量</strong></p> <p><strong>Deployment每次发布都会创建一个RS作为记录，用于实现回滚</strong></p> <ul><li><strong>kubectl get rs #查看RS记录</strong></li> <li><strong>kubectl rollout history deployment web #版本对应RS记录</strong></li></ul> <h3 id="replicaset的使用"><a href="#replicaset的使用" class="header-anchor">#</a> ReplicaSet的使用</h3> <ul><li><p>创建一个RS</p></li> <li><p>创建一个replicaset的yaml</p></li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat replicaset.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ReplicaSet
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">tier</span><span class="token punctuation">:</span> frontend
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">tier</span><span class="token punctuation">:</span> fronted
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">tier</span><span class="token punctuation">:</span> fronted
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
        <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f replicaset.yaml </span>
replicaset.apps/nginx created
</code></pre></div><ul><li>行验证replicaset和pods的数量</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get replicaset</span>
NAME    DESIRED   CURRENT   READY   AGE
nginx   <span class="token number">3</span>         <span class="token number">3</span>         <span class="token number">3</span>       3m1s

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get  pods</span>
NAME          READY   STATUS    RESTARTS   AGE
nginx-75rjb   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3m6s
nginx-87ncr   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3m6s
nginx-xsw76   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3m6s
</code></pre></div><p>###ReplicaSet的伸缩</p> <ul><li><p><code>使用Horizontal Pod Autoscaler（HPA）</code></p></li> <li><p>RS可以通过HPA来根据一些运行时指标实现自动伸缩，下面是一个简单的例子：</p></li> <li><p>下面的描述文件会创建一个名为frontend-scaler的HorizontalPodAutoscaler，它会根据CPU的运行参数来对名为frontend的RS进行自动伸缩。</p></li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat  hpa.yaml  </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> autoscaling/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> HorizontalPodAutoscaler
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> frontend<span class="token punctuation">-</span>scaler
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">scaleTargetRef</span><span class="token punctuation">:</span>
    <span class="token key atrule">kind</span><span class="token punctuation">:</span> ReplicaSet
    <span class="token key atrule">name</span><span class="token punctuation">:</span> frontend			<span class="token comment">#这里就可以绑定上面的标记对应的frontend</span>
  <span class="token key atrule">minReplicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">maxReplicas</span><span class="token punctuation">:</span> <span class="token number">10</span>
  <span class="token key atrule">targetCPUUtilizationPercentage</span><span class="token punctuation">:</span> <span class="token number">50</span>
</code></pre></div><ul><li>查看hpa的详细</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f hpa.yaml </span>
horizontalpodautoscaler.autoscaling/frontend-scaler created

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get hpa </span>
NAME              REFERENCE             TARGETS         MINPODS   MAXPODS   REPLICAS   AGE
frontend-scaler   ReplicaSet/frontend   <span class="token operator">&lt;</span>unknown<span class="token operator">&gt;</span>/50%   <span class="token number">3</span>         <span class="token number">10</span>        <span class="token number">0</span>          5s
</code></pre></div><ul><li><p>最后我们总结下关于 RC / RS 的⼀些特性和作⽤吧：</p></li> <li><p>⼤部分情况下，我们可以通过定义⼀个 RC 实现的 Pod 的创建和副本数</p></li> <li><p>RC 中包含⼀个完整的 Pod 定义模块（不包含 apiversion 和 kind)</p></li> <li><p>RC 是通过 label selector 机制来实现对 Pod 副本</p></li> <li><p>通过改变 RC ⾥⾯的 Pod 副本数量，可以实现 Pod 的扩</p></li> <li><p>通过改变 RC ⾥⾯的 Pod 模板中镜像版本，可以实现 Pod 的滚动升级功能（但是不⽀持⼀键回 滚，需要⽤相同的⽅法去修改镜像地址）</p></li></ul> <h2 id="hpa"><a href="#hpa" class="header-anchor">#</a> HPA</h2> <h3 id="hpa的简要概述"><a href="#hpa的简要概述" class="header-anchor">#</a> HPA的简要概述</h3> <ul><li>Kubernetes 为我们提供了这样⼀个资源对象： <code>Horizontal Pod Autoscaling （Pod⽔平⾃动 伸缩）</code>，简称 HPA 。 HAP 通过监控分析 RC 或者 Deployment 控制的所有 Pod 的负载变化情况来确定 是否需要调整 Pod 的副本数量，这是 HPA 最基本的原理。</li></ul> <img src="https://pic.imgdb.cn/item/61ebeefb2ab3f51d9115f0d9.png" style="zoom:67%;"> <ul><li><p>HPA 在 kubernetes 集群中被设计成⼀个 controller ，我们可以简单的通过 kubectl autoscale 命令 来创建⼀个 HPA 资源对象， HPA Controller 默认30s轮询⼀次（可通过 kube-controller-manager 的标志 --horizontal-pod-autoscaler-sync-period 进⾏设置），查询指定的资源（RC或者 Deployment）中 Pod 的资源使⽤率，并且与创建时设定的值和指标做对⽐，从⽽实现⾃动伸缩的功能。</p></li> <li><p>目前主要分两个版本，autoscaling/v1和autoscaling/v2beta2，v1版本只支持 cpu，v2beta2版本支持 自定义 ，内存 ，但是目前也仅仅是处于beta阶段。</p></li></ul> <h3 id="安装metrics-server"><a href="#安装metrics-server" class="header-anchor">#</a> 安装Metrics Server</h3> <ul><li><p><code>HPA需要从Metrics Server中获取Pod的CPU和内存Metrics，用来判断是否达到自动伸缩阈值。</code></p></li> <li><p>Kubernetes集群使用Metrics Server来采集容器的CPU和内存使用情况，用来监控Node和Pod的CPU和内存使用情况，并用作HPA（自动横向扩展）。</p></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># wget https://github.com/kubernetes-sigs/metrics-server/releases/download/v0.3.7/components.yaml</span>
</code></pre></div><div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># vim components.yaml</span>
<span class="token punctuation">...</span>
<span class="token key atrule">containers</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> metrics<span class="token punctuation">-</span>server
<span class="token key atrule">image</span><span class="token punctuation">:</span> lizhenliang/metrics<span class="token punctuation">-</span>server<span class="token punctuation">:</span>v0.3.7 					<span class="token comment">#修改镜像</span>
<span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
<span class="token key atrule">args</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>cert<span class="token punctuation">-</span>dir=/tmp
<span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>secure<span class="token punctuation">-</span>port=4443
<span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>kubelet<span class="token punctuation">-</span>insecure<span class="token punctuation">-</span>tls									<span class="token comment">#不验证kubelet提供的https证书</span>
<span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>kubelet<span class="token punctuation">-</span>preferred<span class="token punctuation">-</span>address<span class="token punctuation">-</span>types=InternalIP				<span class="token comment">#使用节点IP连接kubelet</span>
<span class="token punctuation">...</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl delete -f components.yaml </span>
clusterrole.rbac.authorization.k8s.io <span class="token string">&quot;system:aggregated-metrics-reader&quot;</span> deleted
clusterrolebinding.rbac.authorization.k8s.io <span class="token string">&quot;metrics-server:system:auth-delegator&quot;</span> deleted
rolebinding.rbac.authorization.k8s.io <span class="token string">&quot;metrics-server-auth-reader&quot;</span> deleted
Warning: apiregistration.k8s.io/v1beta1 APIService is deprecated <span class="token keyword">in</span> v1.19+, unavailable <span class="token keyword">in</span> v1.22+<span class="token punctuation">;</span> use apiregistration.k8s.io/v1 APIService
apiservice.apiregistration.k8s.io <span class="token string">&quot;v1beta1.metrics.k8s.io&quot;</span> deleted
serviceaccount <span class="token string">&quot;metrics-server&quot;</span> deleted
deployment.apps <span class="token string">&quot;metrics-server&quot;</span> deleted
<span class="token function">service</span> <span class="token string">&quot;metrics-server&quot;</span> deleted
clusterrole.rbac.authorization.k8s.io <span class="token string">&quot;system:metrics-server&quot;</span> deleted
clusterrolebinding.rbac.authorization.k8s.io <span class="token string">&quot;system:metrics-server&quot;</span> deleted
</code></pre></div><ul><li>检查监控资源是否正常运行</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl top nodes</span>
NAME     CPU<span class="token punctuation">(</span>cores<span class="token punctuation">)</span>   CPU%   MEMORY<span class="token punctuation">(</span>bytes<span class="token punctuation">)</span>   MEMORY%   
master   182m         <span class="token number">4</span>%     2166Mi          <span class="token number">28</span>%       
<span class="token function">node</span>     76m          <span class="token number">1</span>%     1818Mi          <span class="token number">23</span>%    
</code></pre></div><h3 id="hpa的使用"><a href="#hpa的使用" class="header-anchor">#</a> HPA的使用</h3> <ul><li>创建⼀个 Deployment 管理的 Nginx Pod，然后利⽤ HPA 来进⾏⾃动扩缩容。</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat deployment.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> hpa<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>deployment
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">revisionHistoryLimit</span><span class="token punctuation">:</span> <span class="token number">15</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> hpa<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>deployment
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> hpa<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>deployment
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
        <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
</code></pre></div><ul><li>查看deployment和pod</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get deployments.apps </span>
NAME                   READY   UP-TO-DATE   AVAILABLE   AGE
hpa-nginx-deployment   <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           3m58s

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods </span>
NAME                                    READY   STATUS    RESTARTS   AGE
hpa-nginx-deployment-7d546c5c67-qdkhm   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          4m2s
</code></pre></div><ul><li>创建一个HPA，用kubectl autosca来创建</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl autoscale deployment hpa-nginx-deployment --max=10 --min=1 --cpu-percent=50 --dry-run -o yaml &gt;&gt; hpa.yaml </span>
</code></pre></div><div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat hpa.yaml  </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> autoscaling/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> HorizontalPodAutoscaler
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> hpa<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>deployment
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">maxReplicas</span><span class="token punctuation">:</span> <span class="token number">10</span>		<span class="token comment">#最大伸缩副本到10</span>
  <span class="token key atrule">minReplicas</span><span class="token punctuation">:</span> <span class="token number">1</span>		<span class="token comment">#最小伸缩副本到1</span>
  <span class="token key atrule">scaleTargetRef</span><span class="token punctuation">:</span>		<span class="token comment">#伸缩副本的来源，资源类型，RC，RS，Deployment</span>
    <span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
    <span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
    <span class="token key atrule">name</span><span class="token punctuation">:</span> hpa<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>deployment
  <span class="token key atrule">targetCPUUtilizationPercentage</span><span class="token punctuation">:</span> <span class="token number">50</span>		<span class="token comment">#触发伸缩的cpu使⽤率</span>
<span class="token key atrule">status</span><span class="token punctuation">:</span>
  <span class="token key atrule">currentCPUUtilizationPercentage</span><span class="token punctuation">:</span> <span class="token number">48</span> 		<span class="token comment">#当前资源下pod的cpu使⽤率</span>
  <span class="token key atrule">currentReplicas</span><span class="token punctuation">:</span> <span class="token number">1</span> 						<span class="token comment">#当前的副本数</span>
  <span class="token key atrule">desiredReplicas</span><span class="token punctuation">:</span> <span class="token number">2</span> 						<span class="token comment">#期望的副本数</span>
</code></pre></div><ul><li>查看hpa的创建是否正确</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f hpa.yaml  </span>
horizontalpodautoscaler.autoscaling/hpa-nginx-deployment configured

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get hpa</span>
NAME                   REFERENCE                         TARGETS         MINPODS   MAXPODS   REPLICAS   AGE
frontend-scaler        ReplicaSet/frontend               <span class="token operator">&lt;</span>unknown<span class="token operator">&gt;</span>/50%   <span class="token number">3</span>         <span class="token number">10</span>        <span class="token number">0</span>          125m
hpa-nginx-deployment   Deployment/hpa-nginx-deployment   <span class="token operator">&lt;</span>unknown<span class="token operator">&gt;</span>/50%   <span class="token number">1</span>         <span class="token number">10</span>        <span class="token number">1</span>          93s
</code></pre></div><h3 id="模拟增加负载"><a href="#模拟增加负载" class="header-anchor">#</a> 模拟增加负载</h3> <ul><li>打开一个新的Terminal，创建一个临时的pod <code>load-generator</code>，并在该pod中向<code>php-apache</code>服务发起不间断循环请求，模拟增加<code>php-apache</code>的负载（CPU使用率）。</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl run -i --tty load-generator --rm --image=busybox --restart=Never -- /bin/sh </span>
<span class="token comment">#/  while sleep 0.01; do wget -q -O- http://10.244.167.145; done</span>
</code></pre></div><ul><li>模拟压力测试几分钟后，观察HPA：</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get hpa php-apache</span>
</code></pre></div><ul><li>HPA情况类似：</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>NAME         REFERENCE               TARGETS    MINPODS   MAXPODS   REPLICAS   AGE
php-apache   Deployment/php-apache   <span class="token number">250</span>%/50%   <span class="token number">1</span>         <span class="token number">10</span>        <span class="token number">5</span>          4m45s
</code></pre></div><ul><li><p>可以看到TARGETS（CPU使用率）的acutal值已升高到250% (超过了期望值50%)，副本数REPLICAS也从1自动扩容到了5。</p></li> <li><p>注意：如果Kubernetes集群worker节点的CPU资源已经不足，HPA自动扩容会失败，新扩容的pod会一直处在Pending状态。通过kubectl describe命令查看pod详细信息时，会看到“Insufficient cpu&quot;的错误信息。</p></li></ul> <h2 id="job-和-cronjob"><a href="#job-和-cronjob" class="header-anchor">#</a> Job 和 Cronjob</h2> <ul><li><strong>另外⼀类资源对象：Job，我们在⽇常的⼯作中经常都 会遇到⼀些需要进⾏批量数据处理和分析的需求，当然也会有按时间来进⾏调度的⼯作，在我们 的 Kubernetes 集群中为我们提供了 Job 和 CronJob 两种资源对象来应对我们的这种需求。</strong></li> <li><strong>Job 负责处理任务，即仅执⾏⼀次的任务，它保证批处理任务的⼀个或多个 Pod 成功结束。 ⽽ CronJob 则就是在 Job 上加上了时间调度。</strong></li></ul> <h3 id="job的使用"><a href="#job的使用" class="header-anchor">#</a> Job的使用</h3> <ul><li><p>我们⽤ Job 这个资源对象来创建⼀个任务，我们定⼀个 Job 来执⾏⼀个倒计时的任务，定义 YAML ⽂ 件：</p></li> <li><p>注意 Job 的 <code>RestartPolicy 仅⽀持 Never 和 OnFailure 两种</code>，不⽀持 Always ，我们知道 Job 就相 当于来执⾏⼀个批处理任务，执⾏完就结束了，如果⽀持 Always 的话就陷⼊了死循环了</p></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl create job job-demo --image=busybox --dry-run -o yaml &gt; job.yaml </span>
</code></pre></div><div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat job.yaml  </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> batch/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Job
<span class="token key atrule">metadata</span><span class="token punctuation">:</span> 
  <span class="token key atrule">name</span><span class="token punctuation">:</span> job<span class="token punctuation">-</span>demo
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox
        <span class="token key atrule">name</span><span class="token punctuation">:</span> job<span class="token punctuation">-</span>demo
        <span class="token key atrule">command</span><span class="token punctuation">:</span>  
        <span class="token punctuation">-</span> <span class="token string">&quot;/bin/sh&quot;</span> 
        <span class="token punctuation">-</span> <span class="token string">&quot;-c&quot;</span>
        <span class="token punctuation">-</span> <span class="token string">&quot;for i in 9 8 7 6 5 4 3 2 1; do echo $i; done&quot;</span>
      <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> Never
</code></pre></div><ul><li>然后来创建该 Job</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f job.yaml  </span>
job.batch/job-demo created.

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get job </span>
NAME       COMPLETIONS   DURATION   AGE
job-demo   <span class="token number">1</span>/1           17s        2m54s
</code></pre></div><ul><li>注意查看我们的 Pod 的状态，同样我们可以通过 kubectl logs 来查看当前任务的执⾏结果。</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl logs job-demo-ntxgx job-demo </span>
<span class="token number">9</span>
<span class="token number">8</span>
<span class="token number">7</span>
<span class="token number">6</span>
<span class="token number">5</span>
<span class="token number">4</span>
<span class="token number">3</span>
<span class="token number">2</span>
<span class="token number">1</span>
</code></pre></div><h3 id="cronjob的使用"><a href="#cronjob的使用" class="header-anchor">#</a> CronJob的使用</h3> <ul><li><p>CronJob 其实就是在 Job 的基础上加上了时间调度，我们可以：在给定的时间点运⾏⼀个任务，也可 以周期性地在给定时间点运⾏。这个实际上和我们 Linux 中的 crontab 就⾮常类似了。</p></li> <li><p>⼀个 CronJob 对象其实就对应中 crontab ⽂件中的⼀⾏，它根据配置的时间格式周期性地运⾏⼀ 个 Job ，格式和 crontab 也是⼀样的。</p></li> <li><p><code>crontab 的格式如下： 分 时 ⽇ ⽉ 星期 要运⾏的命令 第1列分钟0～59 第2列⼩时0～23） 第3列⽇1～31 第4列⽉1～ 12 第5列星期0～7（0和7表示星期天） 第6列要运⾏的命令</code></p></li></ul> <h3 id="cron-时间表语法"><a href="#cron-时间表语法" class="header-anchor">#</a> Cron 时间表语法</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">#      ┌────────────────── 时区 (可选)</span>
<span class="token comment">#      |      ┌───────────── 分钟 (0 - 59)</span>
<span class="token comment">#      |      │ ┌───────────── 小时 (0 - 23)</span>
<span class="token comment">#      |      │ │ ┌───────────── 月的某天 (1 - 31)</span>
<span class="token comment">#      |      │ │ │ ┌───────────── month (1 - 12)</span>
<span class="token comment">#      |      │ │ │ │ ┌───────────── 周的某天 (0 - 6)（周日到周一；在某些系统上，7 也是星期日）</span>
<span class="token comment">#      |      │ │ │ │ │                                </span>
<span class="token comment">#      |      │ │ │ │ │</span>
<span class="token comment">#      |      │ │ │ │ │</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># CRON_TZ=UTC * * * * *</span>
<span class="token comment"># ┌───────────── 分钟 (0 - 59)</span>
<span class="token comment"># │ ┌───────────── 小时 (0 - 23)</span>
<span class="token comment"># │ │ ┌───────────── 月的某天 (1 - 31)</span>
<span class="token comment"># │ │ │ ┌───────────── 月份 (1 - 12)</span>
<span class="token comment"># │ │ │ │ ┌───────────── 周的某天 (0 - 6) （周日到周一；在某些系统上，7 也是星期日）</span>
<span class="token comment"># │ │ │ │ │                                   </span>
<span class="token comment"># │ │ │ │ │</span>
<span class="token comment"># │ │ │ │ │</span>
<span class="token comment"># * * * * *</span>
</code></pre></div><ul><li>现在，我们⽤ CronJob 来管理我们上⾯的 Job 任务</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl create cronjob cronjob-demo --image=busybox   --schedule &quot;*/1 * * * *&quot;  --dry-run -o yaml &gt; cronjob.yaml </span>
</code></pre></div><div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat cronjob1.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> batch/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> CronJob
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> cronjob<span class="token punctuation">-</span>demo1
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">jobTemplate</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> cronjob<span class="token punctuation">-</span>demo1
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">template</span><span class="token punctuation">:</span>
        <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
        <span class="token key atrule">spec</span><span class="token punctuation">:</span>
          <span class="token key atrule">containers</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox
            <span class="token key atrule">name</span><span class="token punctuation">:</span> cronjob<span class="token punctuation">-</span>demo1
            <span class="token key atrule">args</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;bin/sh&quot;</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;-c&quot;</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;for i in 9 8 7 6 5 4 3 2 1; do echo $i; done&quot;</span>
          <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> OnFailure
  <span class="token key atrule">schedule</span><span class="token punctuation">:</span> <span class="token string">'*/1 * * * *'</span>
  
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f cronjob1.yaml </span>
cronjob.batch/cronjob<span class="token punctuation">-</span>demo1 created
</code></pre></div><ul><li><p>这⾥的 Kind 是 CronJob 了，要注意的是 .spec.schedule 字段是必须填写的，⽤来指定任务运⾏ 的周期，格式就和 <code>crontab</code> ⼀样，另外⼀个字段是 <code>.spec.jobTemplate</code> , ⽤来指定需要运⾏的任务，格 式当然和 Job 是⼀致的</p></li> <li><p>段 <code>.spec.successfulJobsHistoryLimit</code> 和 <code>.spec.failedJobsHistoryLimit</code> ，表示历史限制，是可选的 字段。它们指定了可以保留多少完成和失败的 Job ，默认没有限制，所有成功和失败的 Job 都会被保 留。然⽽，当运⾏⼀个 Cron Job 时， Job 可以很快就堆积很多，所以⼀般推荐设置这两个字段的 值。如果设置限制的值为 0，那么相关类型的 Job 完成后将不会被保留。</p></li> <li><p>查看当前的cronjob</p></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get cronjobs.batch </span>
NAME            SCHEDULE      SUSPEND   ACTIVE   LAST SCHEDULE   AGE
cronjob-demo1   */1 * * * *   False     <span class="token number">1</span>        11s             11m

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get jobs </span>
NAME                       COMPLETIONS   DURATION   AGE
cronjob-demo1-1636527840   <span class="token number">1</span>/1           17s        3m
cronjob-demo1-1636527900   <span class="token number">1</span>/1           17s        2m
cronjob-demo1-1636527960   <span class="token number">1</span>/1           17s        60s
job-demo                   <span class="token number">1</span>/1           17s        49m
</code></pre></div><ul><li>也可以⽤ kubectl run来创建⼀个CronJob：</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl run hello --schedule=&quot;*/1 * * * *&quot; --restart=OnFailure --image=busybox -- /bin/sh -c &quot;date; echo Hello from the Kubernetes cluster&quot;</span>
</code></pre></div><ul><li>这将会终⽌正在创建的 Job。然⽽，运⾏中的 Job 将不会被终⽌，不会删除 Job 或 它们的 Pod。为了 清理那些 Job 和 Pod，需要列出该 Cron Job 创建的全部 Job，然后删除它们：</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get job </span>
NAME                       COMPLETIONS   DURATION   AGE
cronjob-demo1-1636528440   <span class="token number">1</span>/1           16s        3m
cronjob-demo1-1636528500   <span class="token number">1</span>/1           17s        2m
cronjob-demo1-1636528560   <span class="token number">1</span>/1           18s        60s
job-demo                   <span class="token number">1</span>/1           17s        59m
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get jobs </span>
NAME                       COMPLETIONS   DURATION   AGE
cronjob-demo1-1636528500   <span class="token number">1</span>/1           17s        2m45s
cronjob-demo1-1636528560   <span class="token number">1</span>/1           18s        105s
cronjob-demo1-1636528620   <span class="token number">1</span>/1           17s        45s
job-demo                   <span class="token number">1</span>/1           17s        60m
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl delete cronjob --all</span>
cronjob.batch <span class="token string">&quot;cronjob-demo1&quot;</span> deleted
</code></pre></div></div></div> <!----> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2023/11/28, 22:03:59</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/CodeVault/pages/3ce2fd/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Kubernetes监控与日志管理</div></a> <a href="/CodeVault/pages/b5d485/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Kubernetes调度</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/CodeVault/pages/3ce2fd/" class="prev">Kubernetes监控与日志管理</a></span> <span class="next"><a href="/CodeVault/pages/b5d485/">Kubernetes调度</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/CodeVault/archives" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/CodeVault/pages/c936ca/"><div>
            学习文档
            <!----></div></a> <span class="date">11-28</span></dt></dl><dl><dd>02</dd> <dt><a href="/CodeVault/pages/53f082/"><div>
            如何成为FISCO社区的MVP 总结篇
            <!----></div></a> <span class="date">11-28</span></dt></dl><dl><dd>03</dd> <dt><a href="/CodeVault/pages/3d3086/"><div>
            一文搞懂Truffle测试
            <!----></div></a> <span class="date">11-28</span></dt></dl> <dl><dd></dd> <dt><a href="/CodeVault/archives" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:894072666@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/xugaoyi" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2023-2023
    <span>YYzop & Hior | MIT License</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/CodeVault/assets/js/app.ef278985.js" defer></script><script src="/CodeVault/assets/js/2.f96441c8.js" defer></script><script src="/CodeVault/assets/js/145.55b32ea3.js" defer></script>
  </body>
</html>
